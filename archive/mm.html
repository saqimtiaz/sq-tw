<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<script type="text/javascript">
var version = {major: 2, minor: 0, revision: 10, date: new Date("Apr 19, 2006"), extensions: {}};
</script>
<!--
TiddlyWiki 2.0.10 by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)

Copyright (c) Osmosoft Limited 2004-2006

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of the Osmosoft Limited nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<!--PRE-HEAD-START-->
<link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml'>
<!--PRE-HEAD-END-->
<title> My TiddlyWiki - a reusable non-linear personal web notebook </title>
<script type="text/javascript">

// ---------------------------------------------------------------------------------
// Configuration repository
// ---------------------------------------------------------------------------------

// Miscellaneous options
var config = {
	numRssItems: 20, // Number of items in the RSS feed
	animFast: 0.12, // Speed for animations (lower == slower)
	animSlow: 0.01, // Speed for EasterEgg animations
	cascadeFast: 20, // Speed for cascade animations (higher == slower)
	cascadeSlow: 60, // Speed for EasterEgg cascade animations
	cascadeDepth: 5 // Depth of cascade animation
	};

// Options that can be set in the options panel and/or cookies
config.options = {
	chkRegExpSearch: false,
	chkCaseSensitiveSearch: false,
	chkAnimate: true,
	txtUserName: "YourName",
	chkSaveBackups: true,
	chkAutoSave: false,
	chkGenerateAnRssFeed: false,
	chkSaveEmptyTemplate: false,
	chkOpenInNewWindow: true,
	chkToggleLinks: false,
	chkHttpReadOnly: true,
	chkForceMinorUpdate: false,
	chkConfirmDelete: true,
	txtBackupFolder: "",
	txtMainTab: "tabTimeline",
	txtMoreTab: "moreTabAll",
	txtMaxEditRows: "30"
	};
	
// List of notification functions to be called when certain tiddlers are changed or deleted
config.notifyTiddlers = [
	{name: "StyleSheetLayout", notify: refreshStyles},
	{name: "StyleSheetColors", notify: refreshStyles},
	{name: "StyleSheet", notify: refreshStyles},
	{name: "StyleSheetPrint", notify: refreshStyles},
	{name: "PageTemplate", notify: refreshPageTemplate},
	{name: null, notify: refreshDisplay}
	];

// Default tiddler templates
var DEFAULT_VIEW_TEMPLATE = 1;
var DEFAULT_EDIT_TEMPLATE = 2;
config.tiddlerTemplates = {
	1: "ViewTemplate",
	2: "EditTemplate"
	};

// Messages
config.messages = {
	customConfigError: "Error in systemConfig tiddler '%1' - %0",
	savedSnapshotError: "It appears that this TiddlyWiki has been incorrectly saved. Please see http://www.tiddlywiki.com/#DownloadSoftware for details",
	subtitleUnknown: "(unknown)",
	undefinedTiddlerToolTip: "The tiddler '%0' doesn't yet exist",
	shadowedTiddlerToolTip: "The tiddler '%0' doesn't yet exist, but has a pre-defined shadow value",
	tiddlerLinkTooltip: "%0 - %1, %2",
	externalLinkTooltip: "External link to %0",
	noTags: "There are no tagged tiddlers",
	notFileUrlError: "You need to save this TiddlyWiki to a file before you can save changes",
	cantSaveError: "It's not possible to save changes. This could be because your browser doesn't support saving (instead, use FireFox if you can), or because the pathname to your TiddlyWiki file contains illegal characters",
	invalidFileError: "The original file '%0' does not appear to be a valid TiddlyWiki",
	backupSaved: "Backup saved",
	backupFailed: "Failed to save backup file",
	rssSaved: "RSS feed saved",
	rssFailed: "Failed to save RSS feed file",
	emptySaved: "Empty template saved",
	emptyFailed: "Failed to save empty template file",
	mainSaved: "Main TiddlyWiki file saved",
	mainFailed: "Failed to save main TiddlyWiki file. Your changes have not been saved",
	macroError: "Error in macro <<%0>>",
	macroErrorDetails: "Error while executing macro <<%0>>:\n%1",
	missingMacro: "No such macro",
	overwriteWarning: "A tiddler named '%0' already exists. Choose OK to overwrite it",
	unsavedChangesWarning: "WARNING! There are unsaved changes in TiddlyWiki\n\nChoose OK to save\nChoose CANCEL to discard",
	confirmExit: "--------------------------------\n\nThere are unsaved changes in TiddlyWiki. If you continue you will lose those changes\n\n--------------------------------",
	saveInstructions: "SaveChanges",
	messageClose: {text: "close", tooltip: "close this message area"},
	dates: {
		months: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November","December"],
		days: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"]
		}
	};

// More messages (rather a legacy layout that shouldn't really be like this)
config.views = {
	wikified: {
		tag: {labelNoTags: "no tags", labelTags: "tags: ", openTag: "Open tag '%0'", tooltip: "Show tiddlers tagged with '%0'", openAllText: "Open all", openAllTooltip: "Open all of these tiddlers", popupNone: "No other tiddlers tagged with '%0'"},
		defaultText: "The tiddler '%0' doesn't yet exist. Double-click to create it",
		defaultModifier: "(missing)",
		shadowModifier: "(shadow)"
		},
	editor: {
		tagPrompt: "Type tags separated with spaces, [[use double square brackets]] if necessary, or add existing",
		tagChooser: {text: "tags", tooltip: "Choose existing tags to add to this tiddler", popupNone: "There are no tags defined", tagTooltip: "Add the tag '%0'"},
		defaultText: "Type the text for '%0'"
		}
	};
		
// Macros; each has a 'handler' member that is inserted later
config.macros = {
	today: {},
	version: {},
	search: {label: "search", prompt: "Search this TiddlyWiki", sizeTextbox: 15, accessKey: "F", successMsg: "%0 tiddlers found matching %1", failureMsg: "No tiddlers found matching %0"},
	tiddler: {},
	tag: {},
	tags: {},
	tagging: {label: "tagging:", labelNotTag: "not tagging", tooltip: "List of tiddlers tagged with '%0'"},
	timeline: {dateFormat: "DD MMM YYYY"},
	allTags: {tooltip: "Show tiddlers tagged with '%0'", noTags: "There are no tagged tiddlers"},
	list: {
		all: {prompt: "All tiddlers in alphabetical order"},
		missing: {prompt: "Tiddlers that have links to them but are not defined"},
		orphans: {prompt: "Tiddlers that are not linked to from any other tiddlers"},
		shadowed: {prompt: "Tiddlers shadowed with default contents"}
		},
	closeAll: {label: "close all", prompt: "Close all displayed tiddlers (except any that are being edited)"},
	permaview: {label: "permaview", prompt: "Link to an URL that retrieves all the currently displayed tiddlers"},
	saveChanges: {label: "save changes", prompt: "Save all tiddlers to create a new TiddlyWiki", accessKey: "S"},
	slider: {},
	option: {},
	newTiddler: {label: "new tiddler", prompt: "Create a new tiddler", title: "New Tiddler", accessKey: "N"},
	newJournal: {label: "new journal", prompt: "Create a new tiddler from the current date and time", accessKey: "J"},
	sparkline: {},
	tabs: {},
	gradient: {},
	message: {},
	view: {},
	edit: {},
	tagChooser: {},
	toolbar: {},
	br: {}
	};

// Commands supported by the toolbar macro
config.commands = {
	closeTiddler: {text: "close", tooltip: "Close this tiddler"},
	closeOthers: {text: "close others", tooltip: "Close all other tiddlers"},
	editTiddler: {text: "edit", tooltip: "Edit this tiddler", readOnlyText: "view", readOnlyTooltip: "View the source of this tiddler"},
	saveTiddler: {text: "done", tooltip: "Save changes to this tiddler", hideReadOnly: true},
	cancelTiddler: {text: "cancel", tooltip: "Undo changes to this tiddler", warning: "Are you sure you want to abandon your changes to '%0'?", readOnlyText: "done", readOnlyTooltip: "View this tiddler normally"},
	deleteTiddler: {text: "delete", tooltip: "Delete this tiddler", warning: "Are you sure you want to delete '%0'?", hideReadOnly: true},
	permalink: {text: "permalink", tooltip: "Permalink for this tiddler"},
	references: {text: "references", tooltip: "Show tiddlers that link to this one", popupNone: "No references"},
	jump: {text: "jump", tooltip: "Jump to another open tiddler"}
	};
	
// Browser detection... In a very few places, there's nothing else for it but to
// know what browser we're using.
config.userAgent = navigator.userAgent.toLowerCase();
config.browser = {
	isIE: config.userAgent.indexOf("msie") != -1 && config.userAgent.indexOf("opera") == -1,
	isSafari: config.userAgent.indexOf("applewebkit") != -1,
	isBadSafari: !((new RegExp("[\u0150\u0170]","g")).test("\u0150")),
	firefoxDate: /Gecko\/(\d{8})/i.exec(config.userAgent),
	isLinux: config.userAgent.indexOf("linux") != -1,
	isUnix: config.userAgent.indexOf("x11") != -1,
	isMac: config.userAgent.indexOf("mac") != -1,
	isWindows: config.userAgent.indexOf("win") != -1
	};

// Basic regular expressions
config.textPrimitives = {
	upperLetter: "[A-Z\u00c0-\u00de\u0150\u0170]",
	lowerLetter: "[a-z\u00df-\u00ff_0-9\\-\u0151\u0171]",
	anyLetter: "[A-Za-z\u00c0-\u00de\u00df-\u00ff_0-9\\-\u0150\u0170\u0151\u0171]"
	};
if(config.browser.isBadSafari)
	config.textPrimitives = {
		upperLetter: "[A-Z\u00c0-\u00de]",
		lowerLetter: "[a-z\u00df-\u00ff_0-9\\-]",
		anyLetter: "[A-Za-z\u00c0-\u00de\u00df-\u00ff_0-9\\-]"
		}
config.textPrimitives.anyDigit = "[0-9]";
config.textPrimitives.anyNumberChar = "[0-9\\.E]";
config.textPrimitives.urlPattern = "(?:file|http|https|mailto|ftp):[^\\s'\"]+(?:/|\\b)";
config.textPrimitives.unWikiLink = "~";
config.textPrimitives.wikiLink = "(?:" + config.textPrimitives.unWikiLink + "{0,1})(?:(?:" + config.textPrimitives.upperLetter + "+" +
												  config.textPrimitives.lowerLetter + "+" +
												  config.textPrimitives.upperLetter +
												  config.textPrimitives.anyLetter + "*)|(?:" +
												  config.textPrimitives.upperLetter + "{2,}" +
												  config.textPrimitives.lowerLetter + "+))";

// ---------------------------------------------------------------------------------
// Shadow tiddlers for emergencies
// ---------------------------------------------------------------------------------

config.shadowTiddlers = {
	DefaultTiddlers: "GettingStarted",
	MainMenu: "GettingStarted",
	SiteTitle: "My TiddlyWiki",
	SiteSubtitle: "a reusable non-linear personal web notebook",
	SiteUrl: "http://www.tiddlywiki.com/",
	GettingStarted: "To get started with this blank TiddlyWiki, you'll need to modify the following tiddlers:\n* SiteTitle & SiteSubtitle: The title and subtitle of the site, as shown above (after saving, they will also appear in the browser title bar)\n* MainMenu: The menu (usually on the left)\n* DefaultTiddlers: Contains the names of the tiddlers that you want to appear when the TiddlyWiki is opened\nYou'll also need to enter your username for signing your edits: <<option txtUserName>>",
	SideBarOptions: "<<search>><<closeAll>><<permaview>><<newTiddler>><<newJournal 'DD MMM YYYY'>><<saveChanges>><<slider chkSliderOptionsPanel OptionsPanel 'options Â»' 'Change TiddlyWiki advanced options'>>",
	OptionsPanel: "These InterfaceOptions for customising TiddlyWiki are saved in your browser\n\nYour username for signing your edits. Write it as a WikiWord (eg JoeBloggs)\n\n<<option txtUserName>>\n<<option chkSaveBackups>> SaveBackups\n<<option chkAutoSave>> AutoSave\n<<option chkRegExpSearch>> RegExpSearch\n<<option chkCaseSensitiveSearch>> CaseSensitiveSearch\n<<option chkAnimate>> EnableAnimations\n\nSee AdvancedOptions",
	AdvancedOptions: "<<option chkGenerateAnRssFeed>> GenerateAnRssFeed\n<<option chkOpenInNewWindow>> OpenLinksInNewWindow\n<<option chkSaveEmptyTemplate>> SaveEmptyTemplate\n<<option chkToggleLinks>> Clicking on links to tiddlers that are already open causes them to close\n^^(override with Control or other modifier key)^^\n<<option chkHttpReadOnly>> HideEditingFeatures when viewed over HTTP\n<<option chkForceMinorUpdate>> Treat edits as MinorChanges by preserving date and time\n^^(override with Shift key when clicking 'done' or by pressing Ctrl-Shift-Enter^^\n<<option chkConfirmDelete>> ConfirmBeforeDeleting\nMaximum number of lines in a tiddler edit box: <<option txtMaxEditRows>>\nFolder name for backup files: <<option txtBackupFolder>>\n",
	SideBarTabs: "<<tabs txtMainTab Timeline Timeline TabTimeline All 'All tiddlers' TabAll Tags 'All tags' TabTags More 'More lists' TabMore>>",
	TabTimeline: "<<timeline>>",
	TabAll: "<<list all>>",
	TabTags: "<<allTags>>",
	TabMore: "<<tabs txtMoreTab Missing 'Missing tiddlers' TabMoreMissing Orphans 'Orphaned tiddlers' TabMoreOrphans Shadowed 'Shadowed tiddlers' TabMoreShadowed>>",
	TabMoreMissing: "<<list missing>>",
	TabMoreOrphans: "<<list orphans>>",
	TabMoreShadowed: "<<list shadowed>>",
	StyleSheet: "/***\nPlace your custom CSS here\n***/\n/*{{{*/\n\n/*}}}*/\n",
	StyleSheetColors: "/***\n!Colors Used\n*@@bgcolor(#8cf): #8cf - Background blue@@\n*@@bgcolor(#18f): #18f - Top blue@@\n*@@bgcolor(#04b): #04b - Mid blue@@\n*@@bgcolor(#014):color(#fff): #014 - Bottom blue@@\n*@@bgcolor(#ffc): #ffc - Bright yellow@@\n*@@bgcolor(#fe8): #fe8 - Highlight yellow@@\n*@@bgcolor(#db4): #db4 - Background yellow@@\n*@@bgcolor(#841): #841 - Border yellow@@\n*@@bgcolor(#703):color(#fff): #703 - Title red@@\n*@@bgcolor(#866): #866 - Subtitle grey@@\n!Generic Rules /%==============================================%/\n***/\n/*{{{*/\nbody {\n	background: #fff;\n	color: #000;\n}\n\na{\n	color: #04b;\n}\n\na:hover{\n	background: #04b;\n	color: #fff;\n}\n\na img{\n	border: 0;\n}\n\nh1,h2,h3,h4,h5 {\n	color: #703;\n	background: #8cf;\n}\n\n.button {\n	color: #014;\n	border: 1px solid #fff;\n}\n\n.button:hover {\n	color: #014;\n	background: #fe8;\n	border-color: #db4;\n}\n\n.button:active {\n	color: #fff;\n	background: #db4;\n	border: 1px solid #841;\n}\n\n/*}}}*/\n/***\n!Header /%==================================================%/\n***/\n/*{{{*/\n.header {\n	background: #04b;\n}\n\n.headerShadow {\n	color: #000;\n}\n\n.headerShadow a {\n	font-weight: normal;\n	color: #000;\n}\n\n.headerForeground {\n	color: #fff;\n}\n\n.headerForeground a {\n	font-weight: normal;\n	color: #8cf;\n}\n\n/*}}}*/\n/***\n!General tabs /%=================================================%/\n***/\n/*{{{*/\n\n.tabSelected{\n	color: #014;\n	background: #eee;\n	border-left: 1px solid #ccc;\n	border-top: 1px solid #ccc;\n	border-right: 1px solid #ccc;\n}\n\n.tabUnselected {\n	color: #fff;\n	background: #999;\n}\n\n.tabContents {\n	color: #014;\n	background: #eee;\n	border: 1px solid #ccc;\n}\n\n.tabContents .button {\n	 border: 0;}\n\n/*}}}*/\n/***\n!Sidebar options /%=================================================%/\n~TiddlyLinks and buttons are treated identically in the sidebar and slider panel\n***/\n/*{{{*/\n#sidebar {\n}\n\n#sidebarOptions input {\n	border: 1px solid #04b;\n}\n\n#sidebarOptions .sliderPanel {\n	background: #8cf;\n}\n\n#sidebarOptions .sliderPanel a {\n	border: none;\n	color: #04b;\n}\n\n#sidebarOptions .sliderPanel a:hover {\n	color: #fff;\n	background: #04b;\n}\n\n#sidebarOptions .sliderPanel a:active {\n	color: #04b;\n	background: #fff;\n}\n/*}}}*/\n/***\n!Message Area /%=================================================%/\n***/\n/*{{{*/\n#messageArea {\n	border: 1px solid #841;\n	background: #db4;\n	color: #014;\n}\n\n#messageArea .button {\n	padding: 0.2em 0.2em 0.2em 0.2em;\n	color: #014;\n	background: #fff;\n}\n\n/*}}}*/\n/***\n!Popup /%=================================================%/\n***/\n/*{{{*/\n.popup {\n	background: #18f;\n	border: 1px solid #04b;\n}\n\n.popup hr {\n	color: #014;\n	background: #014;\n	border-bottom: 1px;\n}\n\n.popup li.disabled {\n	color: #04b;\n}\n\n.popup li a, .popup li a:visited {\n	color: #eee;\n	border: none;\n}\n\n.popup li a:hover {\n	background: #014;\n	color: #fff;\n	border: none;\n}\n/*}}}*/\n/***\n!Tiddler Display /%=================================================%/\n***/\n/*{{{*/\n.tiddler .defaultCommand {\n font-weight: bold;\n}\n\n.shadow .title {\n	color: #866;\n}\n\n.title {\n	color: #703;\n}\n\n.subtitle {\n	color: #866;\n}\n\n.toolbar {\n	color: #04b;\n}\n\n.tagging, .tagged {\n	border: 1px solid #eee;\n	background-color: #eee;\n}\n\n.selected .tagging, .selected .tagged {\n	background-color: #ddd;\n	border: 1px solid #bbb;\n}\n\n.tagging .listTitle, .tagged .listTitle {\n	color: #014;\n}\n\n.tagging .button, .tagged .button {\n		border: none;\n}\n\n.footer {\n	color: #ddd;\n}\n\n.selected .footer {\n	color: #888;\n}\n\n.sparkline {\n	background: #8cf;\n	border: 0;\n}\n\n.sparktick {\n	background: #014;\n}\n\n.errorButton {\n	color: #ff0;\n	background: #f00;\n}\n\n.cascade {\n	background: #eef;\n	color: #aac;\n	border: 1px solid #aac;\n}\n\n.imageLink, #displayArea .imageLink {\n	background: transparent;\n}\n\n/*}}}*/\n/***\n''The viewer is where the tiddler content is displayed'' /%------------------------------------------------%/\n***/\n/*{{{*/\n\n.viewer .listTitle {list-style-type: none; margin-left: -2em;}\n\n.viewer .button {\n	border: 1px solid #db4;\n}\n\n.viewer blockquote {\n	border-left: 3px solid #666;\n}\n\n.viewer table {\n	border: 2px solid #333;\n}\n\n.viewer th, thead td {\n	background: #db4;\n	border: 1px solid #666;\n	color: #fff;\n}\n\n.viewer td, .viewer tr {\n	border: 1px solid #666;\n}\n\n.viewer pre {\n	border: 1px solid #fe8;\n	background: #ffc;\n}\n\n.viewer code {\n	color: #703;\n}\n\n.viewer hr {\n	border: 0;\n	border-top: dashed 1px #666;\n	color: #666;\n}\n\n.highlight, .marked {\n	background: #fe8;\n}\n/*}}}*/\n/***\n''The editor replaces the viewer in the tiddler'' /%------------------------------------------------%/\n***/\n/*{{{*/\n.editor input {\n	border: 1px solid #04b;\n}\n\n.editor textarea {\n	border: 1px solid #04b;\n	width: 100%;\n}\n\n.editorFooter {\n	color: #aaa;\n}\n\n/*}}}*/",
	StyleSheetLayout: "/***\n!Sections in this Tiddler:\n*Generic rules\n**Links styles\n**Link Exceptions\n*Header\n*Main menu\n*Sidebar\n**Sidebar options\n**Sidebar tabs\n*Message area\n*Popup\n*Tabs\n*Tiddler display\n**Viewer\n**Editor\n*Misc. rules\n!Generic Rules /%==============================================%/\n***/\n/*{{{*/\nbody {\n	font-size: .75em;\n	font-family: arial,helvetica;\n	position: relative;\n	margin: 0;\n	padding: 0;\n}\n\nh1,h2,h3,h4,h5 {\n	font-weight: bold;\n	text-decoration: none;\n	padding-left: 0.4em;\n}\n\nh1 {font-size: 1.35em;}\nh2 {font-size: 1.25em;}\nh3 {font-size: 1.1em;}\nh4 {font-size: 1em;}\nh5 {font-size: .9em;}\n\nhr {\n	height: 1px;\n}\n\na{\n	text-decoration: none;\n}\n\nol { list-style-type: decimal }\nol ol { list-style-type: lower-alpha }\nol ol ol { list-style-type: lower-roman }\nol ol ol ol { list-style-type: decimal }\nol ol ol ol ol { list-style-type: lower-alpha }\nol ol ol ol ol ol { list-style-type: lower-roman }\nol ol ol ol ol ol ol { list-style-type: decimal }\n/*}}}*/\n/***\n''General Link Styles'' /%-----------------------------------------------------------------------------%/\n***/\n/*{{{*/\n.externalLink {\n	text-decoration: underline;\n}\n\n.tiddlyLinkExisting {\n	font-weight: bold;\n}\n\n.tiddlyLinkNonExisting {\n	font-style: italic;\n}\n\n/* the 'a' is required for IE, otherwise it renders the whole tiddler a bold */\na.tiddlyLinkNonExisting.shadow {\n	font-weight: bold;\n}\n/*}}}*/\n/***\n''Exceptions to common link styles'' /%------------------------------------------------------------------%/\n***/\n/*{{{*/\n\n#mainMenu .tiddlyLinkExisting, \n#mainMenu .tiddlyLinkNonExisting,\n#sidebarTabs .tiddlyLinkExisting,\n#sidebarTabs .tiddlyLinkNonExisting{\n font-weight: normal;\n font-style: normal;\n}\n\n/*}}}*/\n/***\n!Header /%==================================================%/\n***/\n/*{{{*/\n\n.header {\n		position: relative;\n}\n\n.header a:hover {\n	background: transparent;\n}\n\n.headerShadow {\n	position: relative;\n	padding: 4.5em 0em 1em 1em;\n	left: -1px;\n	top: -1px;\n}\n\n.headerForeground {\n	position: absolute;\n	padding: 4.5em 0em 1em 1em;\n	left: 0px;\n	top: 0px;\n}\n\n.siteTitle {\n	font-size: 3em;\n}\n\n.siteSubtitle {\n	font-size: 1.2em;\n}\n\n/*}}}*/\n/***\n!Main menu /%==================================================%/\n***/\n/*{{{*/\n#mainMenu {\n	position: absolute;\n	left: 0;\n	width: 10em;\n	text-align: right;\n	line-height: 1.6em;\n	padding: 1.5em 0.5em 0.5em 0.5em;\n	font-size: 1.1em;\n}\n\n/*}}}*/\n/***\n!Sidebar rules /%==================================================%/\n***/\n/*{{{*/\n#sidebar {\n	position: absolute;\n	right: 3px;\n	width: 16em;\n	font-size: .9em;\n}\n/*}}}*/\n/***\n''Sidebar options'' /%----------------------------------------------------------------------------------%/\n***/\n/*{{{*/\n#sidebarOptions {\n	padding-top: 0.3em;\n}\n\n#sidebarOptions a {\n	margin: 0em 0.2em;\n	padding: 0.2em 0.3em;\n	display: block;\n}\n\n#sidebarOptions input {\n	margin: 0.4em 0.5em;\n}\n\n#sidebarOptions .sliderPanel {\n	margin-left: 1em;\n	padding: 0.5em;\n	font-size: .85em;\n}\n\n#sidebarOptions .sliderPanel a {\n	font-weight: bold;\n	display: inline;\n	padding: 0;\n}\n\n#sidebarOptions .sliderPanel input {\n	margin: 0 0 .3em 0;\n}\n/*}}}*/\n/***\n''Sidebar tabs'' /%-------------------------------------------------------------------------------------%/\n***/\n/*{{{*/\n\n#sidebarTabs .tabContents {\n	width: 15em;\n	overflow: hidden;\n}\n\n/*}}}*/\n/***\n!Message area /%==================================================%/\n***/\n/*{{{*/\n#messageArea {\nposition:absolute; top:0; right:0; margin: 0.5em; padding: 0.5em;\n}\n\n*[id='messageArea'] {\nposition:fixed !important; z-index:99;}\n\n.messageToolbar {\ndisplay: block;\ntext-align: right;\n}\n\n#messageArea a{\n	text-decoration: underline;\n}\n/*}}}*/\n/***\n!Popup /%==================================================%/\n***/\n/*{{{*/\n.popup {\n	font-size: .9em;\n	padding: 0.2em;\n	list-style: none;\n	margin: 0;\n}\n\n.popup hr {\n	display: block;\n	height: 1px;\n	width: auto;\n	padding: 0;\n	margin: 0.2em 0em;\n}\n\n.popup li.disabled {\n	padding: 0.2em;\n}\n\n.popup li a{\n	display: block;\n	padding: 0.2em;\n}\n/*}}}*/\n/***\n!Tabs /%==================================================%/\n***/\n/*{{{*/\n.tabset {\n	padding: 1em 0em 0em 0.5em;\n}\n\n.tab {\n	margin: 0em 0em 0em 0.25em;\n	padding: 2px;\n}\n\n.tabContents {\n	padding: 0.5em;\n}\n\n.tabContents ul, .tabContents ol {\n	margin: 0;\n	padding: 0;\n}\n\n.txtMainTab .tabContents li {\n	list-style: none;\n}\n\n.tabContents li.listLink {\n	 margin-left: .75em;\n}\n/*}}}*/\n/***\n!Tiddler display rules /%==================================================%/\n***/\n/*{{{*/\n#displayArea {\n	margin: 1em 17em 0em 14em;\n}\n\n\n.toolbar {\n	text-align: right;\n	font-size: .9em;\n	visibility: hidden;\n}\n\n.selected .toolbar {\n	visibility: visible;\n}\n\n.tiddler {\n	padding: 1em 1em 0em 1em;\n}\n\n.missing .viewer,.missing .title {\n	font-style: italic;\n}\n\n.title {\n	font-size: 1.6em;\n	font-weight: bold;\n}\n\n.missing .subtitle {\n display: none;\n}\n\n.subtitle {\n	font-size: 1.1em;\n}\n\n/* I'm not a fan of how button looks in tiddlers... */\n.tiddler .button {\n	padding: 0.2em 0.4em;\n}\n\n.tagging {\nmargin: 0.5em 0.5em 0.5em 0;\nfloat: left;\ndisplay: none;\n}\n\n.isTag .tagging {\ndisplay: block;\n}\n\n.tagged {\nmargin: 0.5em;\nfloat: right;\n}\n\n.tagging, .tagged {\nfont-size: 0.9em;\npadding: 0.25em;\n}\n\n.tagging ul, .tagged ul {\nlist-style: none;margin: 0.25em;\npadding: 0;\n}\n\n.tagClear {\nclear: both;\n}\n\n.footer {\n	font-size: .9em;\n}\n\n.footer li {\ndisplay: inline;\n}\n/***\n''The viewer is where the tiddler content is displayed'' /%------------------------------------------------%/\n***/\n/*{{{*/\n* html .viewer pre {\n	width: 99%;\n	padding: 0 0 1em 0;\n}\n\n.viewer {\n	line-height: 1.4em;\n	padding-top: 0.5em;\n}\n\n.viewer .button {\n	margin: 0em 0.25em;\n	padding: 0em 0.25em;\n}\n\n.viewer blockquote {\n	line-height: 1.5em;\n	padding-left: 0.8em;\n	margin-left: 2.5em;\n}\n\n.viewer ul, .viewer ol{\n	margin-left: 0.5em;\n	padding-left: 1.5em;\n}\n\n.viewer table {\n	border-collapse: collapse;\n	margin: 0.8em 1.0em;\n}\n\n.viewer th, .viewer td, .viewer tr,.viewer caption{\n	padding: 3px;\n}\n\n.viewer pre {\n	padding: 0.5em;\n	margin-left: 0.5em;\n	font-size: 1.2em;\n	line-height: 1.4em;\n	overflow: auto;\n}\n\n.viewer code {\n	font-size: 1.2em;\n	line-height: 1.4em;\n}\n/*}}}*/\n/***\n''The editor replaces the viewer in the tiddler'' /%------------------------------------------------%/\n***/\n/*{{{*/\n.editor {\nfont-size: 1.1em;\n}\n\n.editor input, .editor textarea {\n	display: block;\n	width: 100%;\n	font: inherit;\n}\n\n.editorFooter {\n	padding: 0.25em 0em;\n	font-size: .9em;\n}\n\n.editorFooter .button {\npadding-top: 0px; padding-bottom: 0px;}\n\n.fieldsetFix {border: 0;\npadding: 0;\nmargin: 1px 0px 1px 0px;\n}\n/*}}}*/\n/***\n!Misc rules /%==================================================%/\n***/\n/*{{{*/\n.sparkline {\n	line-height: 1em;\n}\n\n.sparktick {\n	outline: 0;\n}\n\n.zoomer {\n	font-size: 1.1em;\n	position: absolute;\n	padding: 1em;\n}\n\n.cascade {\n	font-size: 1.1em;\n	position: absolute;\n	overflow: hidden;\n}\n/*}}}*/",
	StyleSheetPrint: "@media print {\n#mainMenu, #sidebar, #messageArea {display: none ! important;}\n#displayArea {margin: 1em 1em 0em 1em;}\n/* Fixes a feature in Firefox 1.5.0.2 where print preview displays the noscript content */\nnoscript {display:none;}\n}",
	PageTemplate: "<div class='header' macro='gradient vert #18f #04b'>\n<div class='headerShadow'>\n<span class='siteTitle' refresh='content' tiddler='SiteTitle'></span>&nbsp;\n<span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'></span>\n</div>\n<div class='headerForeground'>\n<span class='siteTitle' refresh='content' tiddler='SiteTitle'></span>&nbsp;\n<span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'></span>\n</div>\n</div>\n<div id='mainMenu' refresh='content' tiddler='MainMenu'></div>\n<div id='sidebar'>\n<div id='sidebarOptions' refresh='content' tiddler='SideBarOptions'></div>\n<div id='sidebarTabs' refresh='content' force='true' tiddler='SideBarTabs'></div>\n</div>\n<div id='displayArea'>\n<div id='messageArea'></div>\n<div id='tiddlerDisplay'></div>\n</div>",
	ViewTemplate: "<div class='toolbar' macro='toolbar -closeTiddler closeOthers +editTiddler permalink references jump'></div>\n<div class='title' macro='view title'></div>\n<div class='subtitle'><span macro='view modifier link'></span>, <span macro='view modified date [[DD MMM YYYY]]'></span> (created <span macro='view created date [[DD MMM YYYY]]'></span>)</div>\n<div class='tagging' macro='tagging'></div>\n<div class='tagged' macro='tags'></div>\n<div class='viewer' macro='view text wikified'></div>\n<div class='tagClear'></div>",
	EditTemplate: "<div class='toolbar' macro='toolbar +saveTiddler -cancelTiddler deleteTiddler'></div>\n<div class='title' macro='view title'></div>\n<div class='editor' macro='edit title'></div>\n<div class='editor' macro='edit text'></div>\n<div class='editor' macro='edit tags'></div><div class='editorFooter'><span macro='message views.editor.tagPrompt'></span><span macro='tagChooser'></span></div>",
	MarkupPreHead: "<link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml'>",
	MarkupPostHead: "",
	MarkupPreBody: "",
	MarkupPostBody: ""
	};

// ---------------------------------------------------------------------------------
// Main
// ---------------------------------------------------------------------------------

var params = null; // Command line parameters
var store = null; // TiddlyWiki storage
var story = null; // Main story
var formatter = null; // Default formatters for the wikifier
var anim = new Animator(); // Animation engine
var readOnly = false; // Whether we're in readonly mode
var highlightHack = null; // Embarrassing hack department...
var hadConfirmExit = false; // Don't warn more than once
var safeMode = false; // Disable all plugins and cookies

// Starting up
function main()
{
	params = getParameters();
	if(params)
		params = params.parseParams("open",null,false);
	store = new TiddlyWiki();
	invokeParamifier(params,"oninit");
	story = new Story("tiddlerDisplay","tiddler");
	addEvent(document,"click",Popup.onDocumentClick);
	saveTest();
	loadOptionsCookie();
	for(var s=0; s<config.notifyTiddlers.length; s++)
		store.addNotification(config.notifyTiddlers[s].name,config.notifyTiddlers[s].notify);
	store.loadFromDiv("storeArea","store");
	invokeParamifier(params,"onload");
	loadSystemConfig();
	formatter = new Formatter(config.formatters);
	readOnly = (window.location.protocol == "file:") ? false : config.options.chkHttpReadOnly;
	invokeParamifier(params,"onconfig");
	store.notifyAll();
	restart();
}

// Restarting
function restart()
{
	invokeParamifier(params,"onstart");
	if(story.isEmpty())
		{
		var defaultParams = store.getTiddlerText("DefaultTiddlers").parseParams("open",null,false);
		invokeParamifier(defaultParams,"onstart");
		}
	window.scrollTo(0,0);
}

function saveTest()
{
	var saveTest = document.getElementById("saveTest");
	if(saveTest.hasChildNodes())
		alert(config.messages.savedSnapshotError);
	saveTest.appendChild(document.createTextNode("savetest"));
}

function loadSystemConfig()
{
	if(safeMode)
		return;
	var configTiddlers = store.getTaggedTiddlers("systemConfig");
	for(var t=0; t<configTiddlers.length; t++)
		{
		var ex = processConfig(configTiddlers[t].text);
		if(ex)
			displayMessage(config.messages.customConfigError.format([ex,configTiddlers[t].title]));
		}
}

// Merge a custom configuration over the top of the current configuration
// Returns a string error message or null if it went OK
function processConfig(customConfig)
{
	try
		{
		if(customConfig && customConfig != "")
			window.eval(customConfig);
		}
	catch(e)
		{
		return(e.description ? e.description : e.toString());
		}
	return null;
}

function invokeMacro(place,macro,params,wikifier,tiddler)
{
	try
		{
		var m = config.macros[macro];
		if(m && m.handler)
			m.handler(place,macro,params.readMacroParams(),wikifier,params,tiddler);
		else
			createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,config.messages.missingMacro]));
		}
	catch(ex)
		{
		createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,ex.toString()]));
		}
}

// ---------------------------------------------------------------------------------
// Paramifiers
// ---------------------------------------------------------------------------------

function getParameters()
{
	var p = null;
	if(window.location.hash)
		{
		p = decodeURI(window.location.hash.substr(1));
		if(config.browser.firefoxDate == null || config.browser.firefoxDate[1] < "20051111")
			p = convertUTF8ToUnicode(p);
		}
	return p;
}

function invokeParamifier(params,handler)
{
	if(!params || params.length == undefined || params.length <= 1)
		return;
	for(var t=1; t<params.length; t++)
		{
		var p = config.paramifiers[params[t].name];
		if(p && p[handler] instanceof Function)
			p[handler](params[t].value);
		}
}

config.paramifiers = {};

config.paramifiers.start = {
	oninit: function(v) {
		safeMode = v.toLowerCase() == "safe";
		}
};

config.paramifiers.open = {
	onstart: function(v) {
		story.displayTiddler("bottom",v,null,false,false);
		}
};

config.paramifiers.search = {
	onstart: function(v) {
		story.search(v,false,false);
		}
};

config.paramifiers.tag = {
	onstart: function(v) {
		var tagged = store.getTaggedTiddlers(v,"title");
		for(var t=0; t<tagged.length; t++)
			story.displayTiddler("bottom",tagged[t].title,null,false,false);
		}
};

config.paramifiers.newTiddler = {
	onstart: function(v) {
		if(!readOnly)
			{
			story.displayTiddler(null,v,DEFAULT_EDIT_TEMPLATE);
			story.focusTiddler(v,"text");
			}
		}
};

config.paramifiers.newJournal = {
	onstart: function(v) {
		if(!readOnly)
			{
			var now = new Date();
			var title = now.formatString(v.trim());
			story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE);
			story.focusTiddler(title,"text");
			}
		}
};

// ---------------------------------------------------------------------------------
// Formatters
// ---------------------------------------------------------------------------------

function Formatter(formatters)
{
	this.formatters = [];
	var pattern = [];
	for(var n=0; n<formatters.length; n++)
		{
		pattern.push("(" + formatters[n].match + ")");
		this.formatters.push(formatters[n]);
		}
	this.formatterRegExp = new RegExp(pattern.join("|"),"mg");
}

config.formatterHelpers = {

	charFormatHelper: function(w)
	{
		var e = createTiddlyElement(w.output,this.element);
		w.subWikify(e,this.terminator);
	},
	
	inlineCssHelper:  function(w)
	{
		var styles = [];
		var lookahead = "(?:(" + config.textPrimitives.anyLetter + "+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:(" + config.textPrimitives.anyLetter + "+):([^;\\|\\n]+);)";
		var lookaheadRegExp = new RegExp(lookahead,"mg");
		var hadStyle = false;
		do {
			lookaheadRegExp.lastIndex = w.nextMatch;
			var lookaheadMatch = lookaheadRegExp.exec(w.source);
			var gotMatch = lookaheadMatch && lookaheadMatch.index == w.nextMatch;
			if(gotMatch)
				{
				var s,v;
				hadStyle = true;
				if(lookaheadMatch[1])
					{
					s = lookaheadMatch[1].unDash();
					v = lookaheadMatch[2];
					}
				else
					{
					s = lookaheadMatch[3].unDash();
					v = lookaheadMatch[4];
					}
				switch(s)
					{
					case "bgcolor": s = "backgroundColor"; break;
					}
				styles.push({style: s, value: v});
				w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
				}
		} while(gotMatch);
		return styles;
	},

	applyCssHelper: function(e,styles)
	{
		for(var t=0; t<styles.length; t++)
			{
			try
				{
				e.style[styles[t].style] = styles[t].value;
				}
			catch (ex)
				{
				}
			}
	},

	monospacedByLineHelper: function(w)
	{
		var lookaheadRegExp = new RegExp(this.lookahead,"mg");
		lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			{
			var text = lookaheadMatch[1];
			if(config.browser.isIE)
				text = text.replace(/\n/g,"\r");
			var e = createTiddlyElement(w.output,"pre",null,null,text);
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			}
	}

};

config.formatters = [
{
	name: "table",
	match: "^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",
	lookahead: "^\\|([^\\n]*)\\|([fhck]?)$",
	rowTerminator: "\\|(?:[fhck]?)$\\n?",
	cellPattern: "(?:\\|([^\\n\\|]*)\\|)|(\\|[fhck]?$\\n?)",
	cellTerminator: "(?:\\x20*)\\|",
	rowTypes: {"c": "caption", "h": "thead", "": "tbody", "f": "tfoot"},
	handler: function(w)
	{
		var table = createTiddlyElement(w.output,"table");
		w.nextMatch = w.matchStart;
		var lookaheadRegExp = new RegExp(this.lookahead,"mg");
		var currRowType = null, nextRowType;
		var rowContainer, rowElement;
		var prevColumns = [];
		var rowCount = 0;
		do {
			lookaheadRegExp.lastIndex = w.nextMatch;
			var lookaheadMatch = lookaheadRegExp.exec(w.source);
			var matched = lookaheadMatch && lookaheadMatch.index == w.nextMatch;
			if(matched)
				{
				nextRowType = lookaheadMatch[2];
				if(nextRowType == "k")
					{
					table.className = lookaheadMatch[1];
					w.nextMatch += lookaheadMatch[0].length+1;
					continue;
					}
				if(nextRowType != currRowType)
					rowContainer = createTiddlyElement(table,this.rowTypes[nextRowType]);
				currRowType = nextRowType;
				if(currRowType == "c")
					{
					if(rowCount == 0)
						rowContainer.setAttribute("align","top");
					else
						rowContainer.setAttribute("align","bottom");
					w.nextMatch = w.nextMatch + 1;
					w.subWikify(rowContainer,this.rowTerminator);
					table.insertBefore(rowContainer,table.firstChild);
					}
				else
					{
					var rowClass = (rowCount & 1) ? "oddRow" : "evenRow";
					rowElement = createTiddlyElement(rowContainer,"tr",null,rowClass);
					this.rowHandler(w,rowElement,prevColumns);
					}
				rowCount++;
				}
		} while(matched);
	},
	rowHandler: function(w,e,prevColumns)
	{
		var col = 0;
		var currColCount = 1;
		var matched;
		var cellRegExp = new RegExp(this.cellPattern,"mg");
		do {
			cellRegExp.lastIndex = w.nextMatch;
			var cellMatch = cellRegExp.exec(w.source);
			matched = cellMatch && cellMatch.index == w.nextMatch;
			if(matched)
				{
				if(cellMatch[1] == "~")
					{
					var last = prevColumns[col];
					if(last)
						{
						last.rowCount++;
						last.element.setAttribute("rowSpan",last.rowCount);
						last.element.setAttribute("rowspan",last.rowCount);
						last.element.valign = "center";
						}
					w.nextMatch = cellMatch.index + cellMatch[0].length-1;
					}
				else if(cellMatch[1] == ">")
					{
					currColCount++;
					w.nextMatch = cellMatch.index + cellMatch[0].length-1;
					}
				else if(cellMatch[2])
					{
					w.nextMatch = cellMatch.index + cellMatch[0].length;;
					break;
					}
				else
					{
					var spaceLeft = false, spaceRight = false;
					w.nextMatch++;
					var styles = config.formatterHelpers.inlineCssHelper(w);
					while(w.source.substr(w.nextMatch,1) == " ")
						{
						spaceLeft = true;
						w.nextMatch++;
						}
					var cell;
					if(w.source.substr(w.nextMatch,1) == "!")
						{
						cell = createTiddlyElement(e,"th");
						w.nextMatch++;
						}
					else
						cell = createTiddlyElement(e,"td");
					prevColumns[col] = {rowCount: 1, element: cell};
					if(currColCount > 1)
						{
						cell.setAttribute("colSpan",currColCount);
						cell.setAttribute("colspan",currColCount);
						currColCount = 1;
						}
					config.formatterHelpers.applyCssHelper(cell,styles);
					w.subWikify(cell,this.cellTerminator);
					if(w.matchText.substr(w.matchText.length-2,1) == " ")
						spaceRight = true;
					if(spaceLeft && spaceRight)
						cell.align = "center";
					else if (spaceLeft)
						cell.align = "right";
					else if (spaceRight)
						cell.align = "left";
					w.nextMatch = w.nextMatch-1;
					}
				col++;
				}
		} while(matched);		
	}
},

{
	name: "rule",
	match: "^----+$\\n?",
	handler: function(w)
	{
		createTiddlyElement(w.output,"hr");
	}
},

{
	name: "heading",
	match: "^!{1,5}",
	terminator: "\\n",
	handler: function(w)
	{
		var e = createTiddlyElement(w.output,"h" + w.matchLength);
		w.subWikify(e,this.terminator);
	}
},

{
	name: "monospacedByLine",
	match: "^\\{\\{\\{\\n",
	lookahead: "^\\{\\{\\{\\n((?:^[^\\n]*\\n)+?)(^\\}\\}\\}$\\n?)",
	handler: config.formatterHelpers.monospacedByLineHelper
},

{
	name: "monospacedByLineForCSS",
	match: "^/\\*[\\{]{3}\\*/\\n",
	lookahead: "/\\*[\\{]{3}\\*/\\n*((?:^[^\\n]*\\n)+?)(\\n*^/\\*[\\}]{3}\\*/$\\n?)", 
	handler: config.formatterHelpers.monospacedByLineHelper
},

{
	name: "monospacedByLineForPlugin",
	match: "^//\\{\\{\\{\\n",
	lookahead: "^//\\{\\{\\{\\n\\n*((?:^[^\\n]*\\n)+?)(\\n*^//\\}\\}\\}$\\n?)",
	handler: config.formatterHelpers.monospacedByLineHelper
},

{
	name: "monospacedByLineForTemplate",
	match: "^<!--[\\{]{3}-->\\n",
	lookahead: "<!--[\\{]{3}-->\\n*((?:^[^\\n]*\\n)+?)(\\n*^<!--[\\}]{3}-->$\\n?)", 
	handler: config.formatterHelpers.monospacedByLineHelper
},

{
	name: "wikifyCommentForPlugin", 
	match: "^/\\*\\*\\*\\n",
	terminator: "^\\*\\*\\*/\\n",
	handler: function(w)
	{
		w.subWikify(w.output,this.terminator);
	}
},

{
	name: "wikifyCommentForTemplate", 
	match: "^<!---\\n",
	terminator: "^--->\\n",
	handler: function(w) 
	{
		w.subWikify(w.output,this.terminator);
	}
},

{
	name: "quoteByBlock",
	match: "^<<<\\n",
	terminator: "^<<<(\\n|$)",
	handler: function(w)
	{
		var e = createTiddlyElement(w.output,"blockquote");
		w.subWikify(e,this.terminator);
	}
},

{
	name: "quoteByLine",
	match: "^>+",
	terminator: "\\n",
	element: "blockquote",
	handler: function(w)
	{
		var lookaheadRegExp = new RegExp(this.match,"mg");
		var placeStack = [w.output];
		var currLevel = 0;
		var newLevel = w.matchLength;
		var t;
		do {
			if(newLevel > currLevel)
				{
				for(t=currLevel; t<newLevel; t++)
					placeStack.push(createTiddlyElement(placeStack[placeStack.length-1],this.element));
				}
			else if(newLevel < currLevel)
				{
				for(t=currLevel; t>newLevel; t--)
					placeStack.pop();
				}
			currLevel = newLevel;
			w.subWikify(placeStack[placeStack.length-1],this.terminator);
			createTiddlyElement(placeStack[placeStack.length-1],"br");
			lookaheadRegExp.lastIndex = w.nextMatch;
			var lookaheadMatch = lookaheadRegExp.exec(w.source);
			var matched = lookaheadMatch && lookaheadMatch.index == w.nextMatch;
			if(matched)
				{
				newLevel = lookaheadMatch[0].length;
				w.nextMatch += lookaheadMatch[0].length;
				}
		} while(matched);
	}
},

{
	name: "list",
	match: "^(?:(?:\\*+)|(?:#+))",
	lookahead: "^(?:(\\*+)|(#+))",
	terminator: "\\n",
	outerElement: "ul",
	itemElement: "li",
	handler: function(w)
	{
		var lookaheadRegExp = new RegExp(this.lookahead,"mg");
		w.nextMatch = w.matchStart;
		var placeStack = [w.output];
		var currType = null, newType;
		var currLevel = 0, newLevel;
		var t;
		do {
			lookaheadRegExp.lastIndex = w.nextMatch;
			var lookaheadMatch = lookaheadRegExp.exec(w.source);
			var matched = lookaheadMatch && lookaheadMatch.index == w.nextMatch;
			if(matched)
				{
				if(lookaheadMatch[1])
					newType = "ul";
				if(lookaheadMatch[2])
					newType = "ol";
				newLevel = lookaheadMatch[0].length;
				w.nextMatch += lookaheadMatch[0].length;
				if(newLevel > currLevel)
					{
					for(t=currLevel; t<newLevel; t++)
						placeStack.push(createTiddlyElement(placeStack[placeStack.length-1],newType));
					}
				else if(newLevel < currLevel)
					{
					for(t=currLevel; t>newLevel; t--)
						placeStack.pop();
					}
				else if(newLevel == currLevel && newType != currType)
					{
						placeStack.pop();
						placeStack.push(createTiddlyElement(placeStack[placeStack.length-1],newType));
					}
				currLevel = newLevel;
				currType = newType;
				var e = createTiddlyElement(placeStack[placeStack.length-1],"li");
				w.subWikify(e,this.terminator);
				}
		} while(matched);
	}
},

{
	name: "wikiLink",
	match: config.textPrimitives.wikiLink,
	badPrefix: config.textPrimitives.anyLetter,
	handler: function(w)
	{
		var preRegExp = new RegExp(config.textPrimitives.anyLetter,"mg");
		var preMatch = null;
		if(w.matchStart > 0)
			{
			preRegExp.lastIndex = w.matchStart-1;
			preMatch = preRegExp.exec(w.source);
			}
		if(preMatch && preMatch.index == w.matchStart-1)
			w.outputText(w.output,w.matchStart,w.nextMatch);
		else if(w.matchText.substr(0,1) == config.textPrimitives.unWikiLink)
			w.outputText(w.output,w.matchStart + 1,w.nextMatch);
		else
			{
			var link = createTiddlyLink(w.output,w.matchText,false);
			w.outputText(link,w.matchStart,w.nextMatch);
			}
	}
},

{
	name: "prettyLink",
	match: "\\[\\[",
	lookahead: "\\[\\[([^\\|\\]]*?)(?:(\\]\\])|(\\|(.*?)\\]\\]))",
	terminator: "\\|",
	handler: function(w)
	{
		var lookaheadRegExp = new RegExp(this.lookahead,"mg");
		lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = lookaheadRegExp.exec(w.source)
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart && lookaheadMatch[2]) // Simple bracketted link
			{
			var link = createTiddlyLink(w.output,lookaheadMatch[1],false);
			w.outputText(link,w.nextMatch,w.nextMatch + lookaheadMatch[1].length);
			w.nextMatch += lookaheadMatch[1].length + 2;
			}
		else if(lookaheadMatch && lookaheadMatch.index == w.matchStart && lookaheadMatch[3]) // Pretty bracketted link
			{
			var e;
			if(store.tiddlerExists(lookaheadMatch[4]) || store.isShadowTiddler(lookaheadMatch[4]))
				e = createTiddlyLink(w.output,lookaheadMatch[4],false);
			else
				e = createExternalLink(w.output,lookaheadMatch[4]);
			w.outputText(e,w.nextMatch,w.nextMatch + lookaheadMatch[1].length);
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			}
	}
},

{
	name: "urlLink",
	match: config.textPrimitives.urlPattern,
	handler: function(w)
	{
		var e = createExternalLink(w.output,w.matchText);
		w.outputText(e,w.matchStart,w.nextMatch);
	}
},

{
	name: "image",
	match: "\\[(?:[<]{0,1})(?:[>]{0,1})[Ii][Mm][Gg]\\[",
	lookahead: "\\[([<]{0,1})([>]{0,1})[Ii][Mm][Gg]\\[(?:([^\\|\\]]+)\\|)?([^\\[\\]\\|]+)\\](?:\\[([^\\]]*)\\]?)?(\\])",
	handler: function(w)
	{
		var lookaheadRegExp = new RegExp(this.lookahead,"mg");
		lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) // Simple bracketted link
			{
			var e = w.output;
			if(lookaheadMatch[5])
				{
				if(store.tiddlerExists(lookaheadMatch[5]) || store.isShadowTiddler(lookaheadMatch[5]))
					e = createTiddlyLink(w.output,lookaheadMatch[5],false);
				else
					e = createExternalLink(w.output,lookaheadMatch[5]);
				addClass(e,"imageLink");
				}
			var img = createTiddlyElement(e,"img");
			if(lookaheadMatch[1])
				img.align = "left";
			else if(lookaheadMatch[2])
				img.align = "right";
			if(lookaheadMatch[3])
				img.title = lookaheadMatch[3];
			img.src = lookaheadMatch[4];
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			}
	}
},

{
	name: "macro",
	match: "<<",
	lookahead: "<<([^>\\s]+)(?:\\s*)((?:[^>]|(?:>(?!>)))*)>>",
	handler: function(w)
	{
		var lookaheadRegExp = new RegExp(this.lookahead,"mg");
		lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = lookaheadRegExp.exec(w.source)
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart && lookaheadMatch[1])
			{		
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			invokeMacro(w.output,lookaheadMatch[1],lookaheadMatch[2],w,w.tiddler);
			}
	}
},

{
	name: "html",
	match: "<[Hh][Tt][Mm][Ll]>",
	lookahead: "<[Hh][Tt][Mm][Ll]>((?:.|\\n)*?)</[Hh][Tt][Mm][Ll]>",
	handler: function(w)
	{
		var lookaheadRegExp = new RegExp(this.lookahead,"mg");
		lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = lookaheadRegExp.exec(w.source)
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			{
			var e = createTiddlyElement(w.output,"span");
			e.innerHTML = lookaheadMatch[1];
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			}
	}
},

{
	name: "commentByBlock",
	match: "/%",
	lookahead: "/%((?:.|\\n)*?)%/",
	handler: function(w)
	{
		var lookaheadRegExp = new RegExp(this.lookahead,"mg");
		lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = lookaheadRegExp.exec(w.source)
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
	}
},

{
	name: "boldByChar",
	match: "''",
	terminator: "''",
	element: "strong",
	handler: config.formatterHelpers.charFormatHelper
},

{
	name: "strikeByChar",
	match: "==",
	terminator: "==",
	element: "strike",
	handler: config.formatterHelpers.charFormatHelper
},

{
	name: "underlineByChar",
	match: "__",
	terminator: "__",
	element: "u",
	handler: config.formatterHelpers.charFormatHelper
},

{
	name: "italicByChar",
	match: "//",
	terminator: "//",
	element: "em",
	handler: config.formatterHelpers.charFormatHelper
},

{
	name: "subscriptByChar",
	match: "~~",
	terminator: "~~",
	element: "sub",
	handler: config.formatterHelpers.charFormatHelper
},

{
	name: "superscriptByChar",
	match: "\\^\\^",
	terminator: "\\^\\^",
	element: "sup",
	handler: config.formatterHelpers.charFormatHelper
},

{
	name: "monospacedByChar",
	match: "\\{\\{\\{",
	lookahead: "\\{\\{\\{((?:.|\\n)*?)\\}\\}\\}",
	handler: function(w)
	{
		var lookaheadRegExp = new RegExp(this.lookahead,"mg");
		lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = lookaheadRegExp.exec(w.source)
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			{
			var e = createTiddlyElement(w.output,"code",null,null,lookaheadMatch[1]);
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			}
	}
},

{
	name: "styleByChar",
	match: "@@",
	terminator: "@@",
	lookahead: "(?:([^\\(@]+)\\(([^\\)]+)(?:\\):))|(?:([^:@]+):([^;]+);)",
	handler:  function(w)
	{
		var e = createTiddlyElement(w.output,"span",null,null,null);
		var styles = config.formatterHelpers.inlineCssHelper(w);
		if(styles.length == 0)
			e.className = "marked";
		else
			config.formatterHelpers.applyCssHelper(e,styles);
		w.subWikify(e,this.terminator);
	}
},

{
	name: "lineBreak",
	match: "\\n",
	handler: function(w)
	{
		createTiddlyElement(w.output,"br");
	}
},

{
	name: "htmlEntitiesEncoding",
	match: "&#?[a-zA-Z0-9]{2,8};",
	handler: function(w)
		{
		var e = createTiddlyElement(w.output,"span");
		e.innerHTML = w.matchText ;
		}
},

{
	name: "customClasses",
	match: "\\{\\{",
	terminator: "\\}\\}\\}",
	lookahead: "\\{\\{[\\s]*([\\w]+[\\s\\w]*)[\\s]*\\{(\\n{0,1})",
	handler: function(w)
	{
		var lookaheadRegExp = new RegExp(this.lookahead,"g");
		lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = lookaheadRegExp.exec(w.source);
		if(lookaheadMatch)
			{
			var isByLine = lookaheadMatch[2] == "\n";
			var p = createTiddlyElement(w.output,isByLine ? "div" : "span",null,lookaheadMatch[1]);
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			w.subWikify(p,this.terminator);
			}
	}
}

];

// ---------------------------------------------------------------------------------
// Wikifier
// ---------------------------------------------------------------------------------

function wikify(source,output,highlightRegExp,tiddler)
{
	if(source && source != "")
		{
		var wikifier = new Wikifier(source,formatter,highlightRegExp,tiddler);
		wikifier.subWikify(output,null);
		}
}

// Wikify a named tiddler to plain text
function wikifyPlain(title)
{
	if(store.tiddlerExists(title) || store.isShadowTiddler(title))
		{
		var wikifier = new Wikifier(store.getTiddlerText(title),formatter,null,store.getTiddler(title));
		return wikifier.wikifyPlain();
		}
	else
		return "";
}

// Highlight plain text into an element
function highlightify(source,output,highlightRegExp)
{
	if(source && source != "")
		{
		var wikifier = new Wikifier(source,formatter,highlightRegExp,null);
		wikifier.outputText(output,0,source.length);
		}
}

// Construct a wikifier object
// source - source string that's going to be wikified
// formatter - Formatter() object containing the list of formatters to be used
// highlightRegExp - regular expression of the text string to highlight
// tiddler - reference to the tiddler that's taken to be the container for this wikification
function Wikifier(source,formatter,highlightRegExp,tiddler)
{
	this.source = source;
	this.output = null;
	this.formatter = formatter;
	this.nextMatch = 0;
	this.highlightRegExp = highlightRegExp;
	this.highlightMatch = null;	
	if(highlightRegExp)
		{
		highlightRegExp.lastIndex = 0;
		this.highlightMatch = highlightRegExp.exec(source);
		}
	this.tiddler = tiddler;
}

Wikifier.prototype.wikifyPlain = function()
{
	var e = createTiddlyElement(document.body,"div");
	e.style.display = "none";
	this.subWikify(e,null);
	var text = getPlainText(e);
	e.parentNode.removeChild(e);
	return text;
}

Wikifier.prototype.subWikify = function(output,terminator)
{
	// Temporarily replace the output pointer
	var oldOutput = this.output;
	this.output = output;
	// Prepare the terminator RegExp
	var terminatorRegExp = terminator ? new RegExp("(" + terminator + ")","mg") : null;
	do {
		// Prepare the RegExp match positions
		this.formatter.formatterRegExp.lastIndex = this.nextMatch;
		if(terminatorRegExp)
			terminatorRegExp.lastIndex = this.nextMatch;
		// Get the first matches
		var formatterMatch = this.formatter.formatterRegExp.exec(this.source);
		var terminatorMatch = terminatorRegExp ? terminatorRegExp.exec(this.source) : null;
		// Check for a terminator match
		if(terminatorMatch && (!formatterMatch || terminatorMatch.index <= formatterMatch.index))
			{
			// Output any text before the match
			if(terminatorMatch.index > this.nextMatch)
				this.outputText(this.output,this.nextMatch,terminatorMatch.index);
			// Set the match parameters
			this.matchStart = terminatorMatch.index;
			this.matchLength = terminatorMatch[1].length;
			this.matchText = terminatorMatch[1];
			this.nextMatch = terminatorMatch.index + terminatorMatch[1].length;
			// Restore the output pointer and exit
			this.output = oldOutput;
			return;		
			}
		// Check for a formatter match
		else if(formatterMatch)
			{
			// Output any text before the match
			if(formatterMatch.index > this.nextMatch)
				this.outputText(this.output,this.nextMatch,formatterMatch.index);
			// Set the match parameters
			this.matchStart = formatterMatch.index;
			this.matchLength = formatterMatch[0].length;
			this.matchText = formatterMatch[0];
			this.nextMatch = this.formatter.formatterRegExp.lastIndex;
			// Figure out which formatter matched
			var matchingFormatter = -1;
			for(var t=1; t<formatterMatch.length; t++)
				if(formatterMatch[t])
					matchingFormatter = t-1;
			// Call the formatter
			if(matchingFormatter != -1)
				this.formatter.formatters[matchingFormatter].handler(this);
			}
	} while(terminatorMatch || formatterMatch);
	// Output any text after the last match
	if(this.nextMatch < this.source.length)
		{
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
		}
	// Restore the output pointer
	this.output = oldOutput;
}

Wikifier.prototype.outputText = function(place,startPos,endPos)
{
	// Check for highlights
	while(this.highlightMatch && (this.highlightRegExp.lastIndex > startPos) && (this.highlightMatch.index < endPos) && (startPos < endPos))
		{
		// Deal with any plain text before the highlight
		if(this.highlightMatch.index > startPos)
			{
			createTiddlyText(place,this.source.substring(startPos,this.highlightMatch.index));
			startPos = this.highlightMatch.index;
			}
		// Deal with the highlight
		var highlightEnd = Math.min(this.highlightRegExp.lastIndex,endPos);
		var theHighlight = createTiddlyElement(place,"span",null,"highlight",this.source.substring(startPos,highlightEnd));
		startPos = highlightEnd;
		// Nudge along to the next highlight if we're done with this one
		if(startPos >= this.highlightRegExp.lastIndex)
			this.highlightMatch = this.highlightRegExp.exec(this.source);
		}
	// Do the unhighlighted text left over
	if(startPos < endPos)
		{
		createTiddlyText(place,this.source.substring(startPos,endPos));
		}
}

// ---------------------------------------------------------------------------------
// Macro definitions
// ---------------------------------------------------------------------------------

config.macros.today.handler = function(place,macroName,params)
{
	var now = new Date();
	var text;
	if(params[0])
		text = now.formatString(params[0].trim());
	else
		text = now.toLocaleString();
	createTiddlyElement(place,"span",null,null,text);
}

config.macros.version.handler = function(place)
{
	createTiddlyElement(place,"span",null,null,version.major + "." + version.minor + "." + version.revision + (version.beta ? " (beta " + version.beta + ")" : ""));
}

config.macros.list.handler = function(place,macroName,params)
{
	var type = params[0] ? params[0] : "all";
	var theList = document.createElement("ul");
	place.appendChild(theList);
	if(this[type].prompt)
		createTiddlyElement(theList,"li",null,"listTitle",this[type].prompt);
	var results;
	if(this[type].handler)
		results = this[type].handler(params);
	for (var t = 0; t < results.length; t++)
		{
		theListItem = document.createElement("li")
		theList.appendChild(theListItem);
		if(typeof results[t] == "string")
			createTiddlyLink(theListItem,results[t],true);
		else
			createTiddlyLink(theListItem,results[t].title,true);
		}
}

config.macros.list.all.handler = function(params)
{
	return store.reverseLookup("tags","excludeLists",false,"title");
}

config.macros.list.missing.handler = function(params)
{
	return store.getMissingLinks();
}

config.macros.list.orphans.handler = function(params)
{
	return store.getOrphans();
}

config.macros.list.shadowed.handler = function(params)
{
	return store.getShadowed();
}

config.macros.allTags.handler = function(place,macroName,params)
{
	var tags = store.getTags();
	var theDateList = createTiddlyElement(place,"ul",null,null,null);
	if(tags.length == 0)
		createTiddlyElement(theDateList,"li",null,"listTitle",this.noTags);
	for(var t=0; t<tags.length; t++)
		{
		var theListItem =createTiddlyElement(theDateList,"li",null,null,null);
		var theTag = createTiddlyButton(theListItem,tags[t][0] + " (" + tags[t][1] + ")",this.tooltip.format([tags[t][0]]),onClickTag);
		theTag.setAttribute("tag",tags[t][0]);
		}
}

config.macros.timeline.handler = function(place,macroName,params)
{
	var field = params[0] ? params[0] : "modified";
	var tiddlers = store.reverseLookup("tags","excludeLists",false,field);
	var lastDay = "";
	var last = params[1] ? tiddlers.length-Math.min(tiddlers.length,parseInt(params[1])) : 0;
	for(var t=tiddlers.length-1; t>=last; t--)
		{
		var tiddler = tiddlers[t];
		var theDay = tiddler[field].convertToLocalYYYYMMDDHHMM().substr(0,8);
		if(theDay != lastDay)
			{
			var theDateList = document.createElement("ul");
			place.appendChild(theDateList);
			createTiddlyElement(theDateList,"li",null,"listTitle",tiddler[field].formatString(this.dateFormat));
			lastDay = theDay;
			}
		var theDateListItem = createTiddlyElement(theDateList,"li",null,"listLink",null);
		theDateListItem.appendChild(createTiddlyLink(place,tiddler.title,true));
		}
}

config.macros.search.handler = function(place,macroName,params)
{
	var searchTimeout = null;
	var btn = createTiddlyButton(place,this.label,this.prompt,this.onClick);
	var txt = createTiddlyElement(place,"input",null,null,null);
	if(params[0])
		txt.value = params[0];
	txt.onkeyup = this.onKeyPress;
	txt.onfocus = this.onFocus;
	txt.setAttribute("size",this.sizeTextbox);
	txt.setAttribute("accessKey",this.accessKey);
	txt.setAttribute("autocomplete","off");
	txt.setAttribute("lastSearchText","");
	if(config.browser.isSafari)
		{
		txt.setAttribute("type","search");
		txt.setAttribute("results","5");
		}
	else
		txt.setAttribute("type","text");
}

// Global because there's only ever one outstanding incremental search timer
config.macros.search.timeout = null;

config.macros.search.doSearch = function(txt)
{
	if(txt.value.length > 0)
		{
		story.search(txt.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch);
		txt.setAttribute("lastSearchText",txt.value);
		}
}

config.macros.search.onClick = function(e)
{
	config.macros.search.doSearch(this.nextSibling);
	return false;
}

config.macros.search.onKeyPress = function(e)
{
	if (!e) var e = window.event;
	switch(e.keyCode)
		{
		case 27:
			this.value = "";
			clearMessage();
			break;
		}
	if(this.value.length > 2)
		{
		if(this.value != this.getAttribute("lastSearchText"))
			{
			if(config.macros.search.timeout)
				clearTimeout(config.macros.search.timeout);
			var txt = this;
			config.macros.search.timeout = setTimeout(function() {config.macros.search.doSearch(txt);},500);
			}
		}
	else
		{
		if(config.macros.search.timeout)
			clearTimeout(config.macros.search.timeout);
		}
}

config.macros.search.onFocus = function(e)
{
	this.select();
}

config.macros.tiddler.handler = function(place,macroName,params)
{
	var wrapper = createTiddlyElement(place,"span",null,params[1] ? params[1] : null,null);
	var text = store.getTiddlerText(params[0]);
	if(text)
		{
		var tiddlerName = params[0];
		var stack = config.macros.tiddler.tiddlerStack;
		if(stack.find(tiddlerName) !== null)
			return;
		stack.push(tiddlerName);
		try
			{
			wikify(text,wrapper,null,store.getTiddler(tiddlerName));
			}
		finally
			{
			stack.pop();
			}
		}
}

config.macros.tiddler.tiddlerStack = [];

config.macros.tag.handler = function(place,macroName,params)
{
	createTagButton(place,params[0]);
}

config.macros.tags.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var theList = createTiddlyElement(place,"ul");
	if(params[0] && store.tiddlerExists[params[0]])
		tiddler = store.getTiddler(params[0]);
	var lingo = config.views.wikified.tag;
	var prompt = tiddler.tags.length == 0 ? lingo.labelNoTags : lingo.labelTags;
	createTiddlyElement(theList,"li",null,"listTitle",prompt.format([tiddler.title]));
	for(var t=0; t<tiddler.tags.length; t++)
		createTagButton(createTiddlyElement(theList,"li"),tiddler.tags[t],tiddler.title);
}

config.macros.tagging.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var theList = createTiddlyElement(place,"ul");
	var title = "";
	if(tiddler instanceof Tiddler)
        title = tiddler.title;
	if(params[0])
        title = params[0];
	theList.setAttribute("title",this.tooltip.format([title]));
	var tagged = store.getTaggedTiddlers(title);
	var prompt = tagged.length == 0 ? this.labelNotTag : this.label;
	createTiddlyElement(theList,"li",null,"listTitle",prompt.format([title]));
	for(var t=0; t<tagged.length; t++)
		createTiddlyLink(createTiddlyElement(theList,"li"),tagged[t].title,true);
}

config.macros.closeAll.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
}

config.macros.closeAll.onClick = function(e)
{
	story.closeAllTiddlers();
	return false;
}

config.macros.permaview.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
}

config.macros.permaview.onClick = function(e)
{
	story.permaView();
	return false;
}

config.macros.saveChanges.handler = function(place)
{
	if(!readOnly)
		createTiddlyButton(place,this.label,this.prompt,this.onClick,null,null,this.accessKey);
}

config.macros.saveChanges.onClick = function(e)
{
	saveChanges();
	return false;
}

config.macros.slider.onClickSlider = function(e)
{
	if (!e) var e = window.event;
	var n = this.nextSibling;
	var cookie = n.getAttribute("cookie");
	var isOpen = n.style.display != "none";
	if(config.options.chkAnimate)
		anim.startAnimating(new Slider(n,!isOpen,e.shiftKey || e.altKey,"none"));
	else
		n.style.display = isOpen ? "none" : "block";
	config.options[cookie] = !isOpen;
	saveOptionCookie(cookie);
	return false;
}

config.macros.slider.createSlider = function(place,cookie,title,tooltip)
{
	var cookie = cookie ? cookie : "";
	var btn = createTiddlyButton(place,title,tooltip,this.onClickSlider);
	var panel = createTiddlyElement(place,"div",null,"sliderPanel",null);
	panel.setAttribute("cookie",cookie);
	panel.style.display = config.options[cookie] ? "block" : "none";
	return panel;
}

config.macros.slider.handler = function(place,macroName,params)
{
	var panel = this.createSlider(place,params[0],params[2],params[3]);
	var text = store.getTiddlerText(params[1]);
	if(text)
		wikify(text,panel,null,store.getTiddler(params[1]));
}

config.macros.option.onChangeOption = function(e)
{
	var opt = this.getAttribute("option");
	var elementType,valueField;
	if(opt)
		{
		switch(opt.substr(0,3))
			{
			case "txt":
				elementType = "input";
				valueField = "value";
				break;
			case "chk":
				elementType = "input";
				valueField = "checked";
				break;
			}
		config.options[opt] = this[valueField];
		saveOptionCookie(opt);
		var nodes = document.getElementsByTagName(elementType);
		for(var t=0; t<nodes.length; t++)
			{
			var optNode = nodes[t].getAttribute("option");
			if(opt == optNode)
				nodes[t][valueField] = this[valueField];
			}
		}
	return(true);
}

config.macros.option.handler = function(place,macroName,params)
{
	var opt = params[0];
	if(config.options[opt] == undefined)
		return;
	var c;
	switch(opt.substr(0,3))
		{
		case "txt":
			c = document.createElement("input");
			c.onkeyup = this.onChangeOption;
			c.setAttribute("option",opt);
			c.size = 15;
			place.appendChild(c);
			c.value = config.options[opt];
			break;
		case "chk":
			c = document.createElement("input");
			c.setAttribute("type","checkbox");
			c.onclick = this.onChangeOption;
			c.setAttribute("option",opt);
			place.appendChild(c);
			c.checked = config.options[opt];
			break;
		}
}

config.macros.newTiddler.onClick = function()
{
	story.displayTiddler(null,config.macros.newTiddler.title,DEFAULT_EDIT_TEMPLATE);
	story.focusTiddler(config.macros.newTiddler.title,"title");
	return false;
}

config.macros.newTiddler.handler = function(place)
{
	if(!readOnly)
		createTiddlyButton(place,this.label,this.prompt,this.onClick,null,null,this.accessKey);
}

config.macros.newJournal.handler = function(place,macroName,params)
{
	if(!readOnly)
		{
		var now = new Date();
		var title = now.formatString(params[0].trim());
		var btn = createTiddlyButton(place,this.label,this.prompt,this.createJournal,null,null,this.accessKey);
		btn.setAttribute("journalTitle",title);
		btn.setAttribute("params",params.join("|"));
		}
}

config.macros.newJournal.createJournal = function(e)
{
	var title = this.getAttribute("journalTitle");
	var params = this.getAttribute("params").split("|");
	story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE);
	for(var t=1;t<params.length;t++)
		story.setTiddlerTag(title,params[t],+1);
	story.focusTiddler(title,"text");
	return false;
}

config.macros.sparkline.handler = function(place,macroName,params)
{
	var data = [];
	var min = 0;
	var max = 0;
	for(var t=0; t<params.length; t++)
		{
		var v = parseInt(params[t]);
		if(v < min)
			min = v;
		if(v > max)
			max = v;
		data.push(v);
		}
	if(data.length < 1)
		return;
	var box = createTiddlyElement(place,"span",null,"sparkline",String.fromCharCode(160));
	box.title = data.join(",");
	var w = box.offsetWidth;
	var h = box.offsetHeight;
	box.style.paddingRight = (data.length * 2 - w) + "px";
	box.style.position = "relative";
	for(var d=0; d<data.length; d++)
		{
		var tick = document.createElement("img");
		tick.border = 0;
		tick.className = "sparktick";
		tick.style.position = "absolute";
		tick.src = "data:image/gif,GIF89a%01%00%01%00%91%FF%00%FF%FF%FF%00%00%00%C0%C0%C0%00%00%00!%F9%04%01%00%00%02%00%2C%00%00%00%00%01%00%01%00%40%02%02T%01%00%3B";
		tick.style.left = d*2 + "px";
		tick.style.width = "2px";
		var v = Math.floor(((data[d] - min)/(max-min)) * h);
		tick.style.top = (h-v) + "px";
		tick.style.height = v + "px";
		box.appendChild(tick);
		}
}

config.macros.tabs.handler = function(place,macroName,params)
{
	var cookie = params[0];
	var numTabs = (params.length-1)/3;
	var wrapper = createTiddlyElement(place,"div",null,cookie,null);
	var tabset = createTiddlyElement(wrapper,"div",null,"tabset",null);
	tabset.setAttribute("cookie",cookie);
	var validTab = false;
	for(var t=0; t<numTabs; t++)
		{
		var label = params[t*3+1];
		var prompt = params[t*3+2];
		var content = params[t*3+3];
		var tab = createTiddlyButton(tabset,label,prompt,this.onClickTab,"tab tabUnselected");
		tab.setAttribute("tab",label);
		tab.setAttribute("content",content);
		tab.title = prompt;
		if(config.options[cookie] == label)
			validTab = true;
		}
	if(!validTab)
		config.options[cookie] = params[1];
	this.switchTab(tabset,config.options[cookie]);
}

config.macros.tabs.onClickTab = function(e)
{
	config.macros.tabs.switchTab(this.parentNode,this.getAttribute("tab"));
	return false;
}

config.macros.tabs.switchTab = function(tabset,tab)
{
	var cookie = tabset.getAttribute("cookie");
	var theTab = null
	var nodes = tabset.childNodes;
	for(var t=0; t<nodes.length; t++)
		if(nodes[t].getAttribute && nodes[t].getAttribute("tab") == tab)
			{
			theTab = nodes[t];
			theTab.className = "tab tabSelected";
			}
		else
			nodes[t].className = "tab tabUnselected"
	if(theTab)
		{
		if(tabset.nextSibling && tabset.nextSibling.className == "tabContents")
			tabset.parentNode.removeChild(tabset.nextSibling);
		var tabContent = createTiddlyElement(null,"div",null,"tabContents",null);
		tabset.parentNode.insertBefore(tabContent,tabset.nextSibling);
		var contentTitle = theTab.getAttribute("content");
		wikify(store.getTiddlerText(contentTitle),tabContent,null,store.getTiddler(contentTitle));
		if(cookie)
			{
			config.options[cookie] = tab;
			saveOptionCookie(cookie);
			}
		}
}

// <<gradient [[tiddler name]] vert|horiz rgb rgb rgb rgb... >>
config.macros.gradient.handler = function(place,macroName,params,wikifier)
{
	var terminator = ">>";
	var panel;
	if(wikifier)
		panel = createTiddlyElement(place,"div",null,"gradient",null);
	else
		panel = place;
	panel.style.position = "relative";
	panel.style.overflow = "hidden";
	panel.style.zIndex = "0";
	var t;
	if(wikifier)
		{
		var styles = config.formatterHelpers.inlineCssHelper(wikifier);
		config.formatterHelpers.applyCssHelper(panel,styles);
		}
	var colours = [];
	for(t=1; t<params.length; t++)
		{
		var c = new RGB(params[t]);
		if(c)
			colours.push(c);
		}
	drawGradient(panel,params[0] != "vert",colours);
	if(wikifier)
		wikifier.subWikify(panel,terminator);
	if(document.all)
		{
		panel.style.height = "100%";
		panel.style.width = "100%";
		}
}

config.macros.message.handler = function(place,macroName,params)
{
	if(params[0])
		{
		var m = config;
		var p = params[0].split(".");
		for(var t=0; t<p.length; t++)
			{
			if(p[t] in m)
				m = m[p[t]];
			else
				break;
			}
		createTiddlyText(place,m.toString().format(params.splice(1)));
		}
}

config.macros.view.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if((tiddler instanceof Tiddler) && params[0] && (tiddler[params[0]] != undefined))
		{
		switch(params[1])
			{
			case undefined:
				highlightify(tiddler[params[0]],place,highlightHack);
				break;
			case "link":
				createTiddlyLink(place,tiddler[params[0]],true);
				break;
			case "wikified":
				wikify(tiddler[params[0]],place,highlightHack,tiddler);
				break;
			case "date":
				if(params[2])
					createTiddlyText(place,tiddler[params[0]].formatString(params[2]));
				else
					createTiddlyText(place,tiddler[params[0]]);
				break;
			}
		}
}

config.macros.edit.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var field = params[0];
	if((tiddler instanceof Tiddler) && field && (tiddler[field] != undefined))
		{
		story.setDirty(tiddler.title,true);
		switch(field)
			{
			case "title":
				var e = createTiddlyElement(place,"input");
				if(tiddler.isReadOnly())
					e.setAttribute("readOnly","readOnly");
				e.setAttribute("edit","title");
				e.setAttribute("type","text");
				e.value = tiddler.title;
				e.setAttribute("size","40");
				e.setAttribute("autocomplete","off");
				break;
			case "text":
				var wrapper1 = createTiddlyElement(place,"fieldset",null,"fieldsetFix",null);
				var wrapper2 = createTiddlyElement(wrapper1,"div",null,null,null);
				var e = createTiddlyElement(wrapper2,"textarea");
				if(tiddler.isReadOnly())
					e.setAttribute("readOnly","readOnly");
				e.value = tiddler.text;
				var rows = 10;
				var lines = tiddler.text.match(regexpNewLine);
				var maxLines = Math.max(parseInt(config.options.txtMaxEditRows),5);
				if(lines != null && lines.length > rows)
					rows = lines.length + 5;
				rows = Math.min(rows,maxLines);
				e.setAttribute("rows",rows);
				e.setAttribute("edit","text");
				break;
			case "tags":
				var e = createTiddlyElement(place,"input");
				if(tiddler.isReadOnly())
					e.setAttribute("readOnly","readOnly");
				e.setAttribute("edit","tags");
				e.setAttribute("type","text");
				e.value = tiddler.getTags();
				e.setAttribute("size","40");
				e.setAttribute("autocomplete","off");
				break;
			}
		}
}

config.macros.tagChooser.onClick = function(e)
{
	if (!e) var e = window.event;
	var lingo = config.views.editor.tagChooser;
	var popup = Popup.create(this);
	var tags = store.getTags();
	if(tags.length == 0)
		createTiddlyText(createTiddlyElement(popup,"li"),lingo.popupNone);
	for (var t=0; t<tags.length; t++)
		{
		var theTag = createTiddlyButton(createTiddlyElement(popup,"li"),tags[t][0],lingo.tagTooltip.format([tags[t][0]]),config.macros.tagChooser.onTagClick);
		theTag.setAttribute("tag",tags[t][0]);
		theTag.setAttribute("tiddler", this.getAttribute("tiddler"));
		}
	Popup.show(popup,false);
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	return(false);
}

config.macros.tagChooser.onTagClick = function(e)
{
	if (!e) var e = window.event;
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	var tiddler = store.getTiddler(title);
	if(!readOnly)
		story.setTiddlerTag(title,tag,0);
	return(false);
}

config.macros.tagChooser.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(tiddler instanceof Tiddler)
		{
		var title = tiddler.title;
		var lingo = config.views.editor.tagChooser;
		var btn = createTiddlyButton(place,lingo.text,lingo.tooltip,this.onClick);
		btn.setAttribute("tiddler", title);
		}
}

// Create a toolbar command button
// place - parent DOM element
// command - reference to config.commands[] member -or- name of member
// tiddler - reference to tiddler that toolbar applies to
// theClass - the class to give the button
config.macros.toolbar.createCommand = function(place,commandName,tiddler,theClass)
{
	if(typeof commandName != "string")
		{
		var c = null;
		for(var t in config.commands)
			if(config.commands[t] == commandName)
				c = t;
		commandName = c;
		}
	if((tiddler instanceof Tiddler) && (typeof commandName == "string"))
		{
		var title = tiddler.title;
		var command = config.commands[commandName];
		var ro = tiddler.isReadOnly();
		var text = ro && command.readOnlyText ? command.readOnlyText : command.text;
		var tooltip = ro && command.readOnlyTooltip ? command.readOnlyTooltip : command.tooltip;
		if(!ro || (ro && !command.hideReadOnly))
			{
			var btn = createTiddlyButton(place,text,tooltip,this.onClickCommand);
			btn.setAttribute("commandName", commandName);
			btn.setAttribute("tiddler", title);
			if(theClass)
				addClass(btn,theClass);
			}
		}
}

config.macros.toolbar.onClickCommand = function(e)
{
	if (!e) var e = window.event;
	var command = config.commands[this.getAttribute("commandName")];
	return command.handler(e,this,this.getAttribute("tiddler"));
}

// Invoke the first command encountered from a given place that is tagged with a specified class
config.macros.toolbar.invokeCommand = function(place,theClass,event)
{
	var children = place.getElementsByTagName("a")
	for (var t=0; t<children.length; t++)
		{
		var c = children[t];
		if(hasClass(c,theClass) && c.getAttribute && c.getAttribute("commandName"))
			{
			if(c.onclick instanceof Function)
				c.onclick.call(c,event);
			break;
			}
		}
}

config.macros.toolbar.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	for(var t=0; t<params.length; t++)
		{
		var c = params[t];
		var theClass = "";
		switch(c.substr(0,1))
			{
			case "+":
				theClass = "defaultCommand";
				c = c.substr(1);
				break;
			case "-":
				theClass = "cancelCommand";
				c = c.substr(1);
				break;
			}
		if(c in config.commands)
			this.createCommand(place,c,tiddler,theClass);
		}
}

config.macros.br.handler = function(place)
{
	createTiddlyElement(place,"br");
}

// ---------------------------------------------------------------------------------
// Menu and toolbar commands
// ---------------------------------------------------------------------------------

config.commands.closeTiddler.handler = function(event,src,title)
{
	story.closeTiddler(title,true,event.shiftKey || event.altKey);
	return false;
}

config.commands.closeOthers.handler = function(event,src,title)
{
	story.closeAllTiddlers(title);
	return false;
}

config.commands.editTiddler.handler = function(event,src,title)
{
	clearMessage();
	story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE);
	story.focusTiddler(title,"text");
	return false;
}

config.commands.saveTiddler.handler = function(event,src,title)
{
	var newTitle = story.saveTiddler(title,event.shiftKey);
	if(newTitle)
	   story.displayTiddler(null,newTitle);
	return false;
}

config.commands.cancelTiddler.handler = function(event,src,title)
{
	if(story.hasChanges(title) && !readOnly)
		if(!confirm(this.warning.format([title])))
			return false;
	story.setDirty(title,false);
	story.displayTiddler(null,title);
	return false;
}

config.commands.deleteTiddler.handler = function(event,src,title)
{
	var deleteIt = true; 
	if (config.options.chkConfirmDelete)
		deleteIt = confirm(this.warning.format([title]));
	if (deleteIt)
		{
		store.removeTiddler(title);
		story.closeTiddler(title,true,event.shiftKey || event.altKey);
		if(config.options.chkAutoSave)
			saveChanges();
		}
	return false;
}

config.commands.permalink.handler = function(event,src,title)
{
	var t = encodeURIComponent(String.encodeTiddlyLink(title));
	if(window.location.hash != t)
		window.location.hash = t;
	return false;
}

config.commands.references.handler = function(event,src,title)
{
	var popup = Popup.create(src);
	if(popup)
		{
		var references = store.getReferringTiddlers(title);
		var c = false;
		for(var r=0; r<references.length; r++)
			if(references[r].title != title && !references[r].isTagged("excludeLists"))
				{
				createTiddlyLink(createTiddlyElement(popup,"li"),references[r].title,true);
				c = true;
				}
		if(!c)
			createTiddlyText(createTiddlyElement(popup,"li",null,"disabled"),this.popupNone);
		}
	Popup.show(popup,false);
	event.cancelBubble = true;
	if (event.stopPropagation) event.stopPropagation();
	return false;
}

config.commands.jump.handler = function(event,src,title)
{
	var popup = Popup.create(src);
	if(popup)
		{
		story.forEachTiddler(function(title,element) {
			createTiddlyLink(createTiddlyElement(popup,"li"),title,true);
			});
		}
	Popup.show(popup,false);
	event.cancelBubble = true;
	if (event.stopPropagation) event.stopPropagation();
	return false;
}

// ---------------------------------------------------------------------------------
// Tiddler() object
// ---------------------------------------------------------------------------------

function Tiddler()
{
	this.title = null;
	this.text = null;
	this.modifier = null;
	this.modified = new Date();
	this.created = new Date();
	this.links = [];
	this.tags = [];
	return this;
}

// Load a tiddler from an HTML DIV. The caller should make sure to later call Tiddler.changed()
Tiddler.prototype.loadFromDiv = function(divRef,title)
{
	var text = Tiddler.unescapeLineBreaks(divRef.firstChild ? divRef.firstChild.nodeValue : "");
	var modifier = divRef.getAttribute("modifier");
	var modified = Date.convertFromYYYYMMDDHHMM(divRef.getAttribute("modified"));
	var c = divRef.getAttribute("created");
	var created = c ? Date.convertFromYYYYMMDDHHMM(c) : modified;
	var tags = divRef.getAttribute("tags");
	this.assign(title,text,modifier,modified,tags,created);
	return this;
}

// Format the text for storage in an HTML DIV
Tiddler.prototype.saveToDiv = function()
{
	return '<div tiddler="%0" modifier="%1" modified="%2" created="%3" tags="%4">%5</div>'.format([
			this.title.htmlEncode(),
			this.modifier.htmlEncode(),
			this.modified.convertToYYYYMMDDHHMM(),
			this.created.convertToYYYYMMDDHHMM(),
			this.getTags().htmlEncode(),
			this.escapeLineBreaks().htmlEncode()
		]);
}

// Format the text for storage in an RSS item
Tiddler.prototype.saveToRss = function(url)
{
	var s = [];
	s.push("<item>");
	s.push("<title>" + this.title.htmlEncode() + "</title>");
	s.push("<description>" + this.text.replace(regexpNewLine,"<br />").htmlEncode() + "</description>");
	for(var t=0; t<this.tags.length; t++)
		s.push("<category>" + this.tags[t] + "</category>");
	s.push("<link>" + url + "#" + encodeURIComponent(String.encodeTiddlyLink(this.title)) + "</link>");
	s.push("<pubDate>" + this.modified.toGMTString() + "</pubDate>");
	s.push("</item>");
	return(s.join("\n"));
}

// Change the text and other attributes of a tiddler
Tiddler.prototype.set = function(title,text,modifier,modified,tags,created)
{
	this.assign(title,text,modifier,modified,tags,created);
	this.changed();
	return this;
}

// Change the text and other attributes of a tiddler without triggered a tiddler.changed() call
Tiddler.prototype.assign = function(title,text,modifier,modified,tags,created)
{
	if(title != undefined)
		this.title = title;
	if(text != undefined)
		this.text = text;
	if(modifier != undefined)
		this.modifier = modifier;
	if(modified != undefined)
		this.modified = modified;
	if(created != undefined)
		this.created = created;
	if(tags != undefined)
		this.tags = (typeof tags == "string") ? tags.readBracketedList() : tags;
	else if(this.tags == undefined)
		this.tags = [];
	return this;
}

// Get the tags for a tiddler as a string (space delimited, using [[brackets]] for tags containing spaces)
Tiddler.prototype.getTags = function()
{
	if(this.tags)
		{
		var results = [];
		for(var t=0; t<this.tags.length; t++)
			results.push(String.encodeTiddlyLink(this.tags[t]));
		return results.join(" ");
		}
	else
		return "";
}

// Test if a tiddler carries a tag
Tiddler.prototype.isTagged = function(tag)
{
	return this.tags.find(tag) != null;
}

var regexpBackSlashEn = new RegExp("\\\\n","mg");
var regexpBackSlash = new RegExp("\\\\","mg");
var regexpBackSlashEss = new RegExp("\\\\s","mg");
var regexpNewLine = new RegExp("\n","mg");
var regexpCarriageReturn = new RegExp("\r","mg");

// Static method to Convert "\n" to newlines, "\s" to "\"
Tiddler.unescapeLineBreaks = function(text)
{
	if(text && text != "")
		return text.replace(regexpBackSlashEn,"\n").replace(regexpBackSlashEss,"\\").replace(regexpCarriageReturn,"");
	else
		return "";
}

// Convert newlines to "\n", "\" to "\s"
Tiddler.prototype.escapeLineBreaks = function()
{
	return this.text.replace(regexpBackSlash,"\\s").replace(regexpNewLine,"\\n").replace(regexpCarriageReturn,"");
}

// Updates the secondary information (like links[] array) after a change to a tiddler
Tiddler.prototype.changed = function()
{
	this.links = [];
	var nextPos = 0;
	var theLink;
	var aliasedPrettyLink = "\\[\\[([^\\[\\]\\|]+)\\|([^\\[\\]\\|]+)\\]\\]";
	var prettyLink = "\\[\\[([^\\]]+)\\]\\]";
	var wikiNameRegExp = new RegExp("(" + config.textPrimitives.wikiLink + ")|(?:" + aliasedPrettyLink + ")|(?:" + prettyLink + ")","mg");
	do {
		var formatMatch = wikiNameRegExp.exec(this.text);
		if(formatMatch)
			{
			if(formatMatch[1] && formatMatch[1].substr(0,1) != config.textPrimitives.unWikiLink && formatMatch[1] != this.title)
				this.links.pushUnique(formatMatch[1]);
			else if(formatMatch[2] && (store.tiddlerExists(formatMatch[3]) || store.isShadowTiddler(formatMatch[3])))
				this.links.pushUnique(formatMatch[3]);
			else if(formatMatch[4] && formatMatch[4] != this.title)
				this.links.pushUnique(formatMatch[4]);
			}
	} while(formatMatch);
	return;
}

Tiddler.prototype.getSubtitle = function()
{
	var theModifier = this.modifier;
	if(!theModifier)
		theModifier = config.messages.subtitleUnknown;
	var theModified = this.modified;
	if(theModified)
		theModified = theModified.toLocaleString();
	else
		theModified = config.messages.subtitleUnknown;
	return(config.messages.tiddlerLinkTooltip.format([this.title,theModifier,theModified]));
}

Tiddler.prototype.isReadOnly = function()
{
	return readOnly;
}

// ---------------------------------------------------------------------------------
// TiddlyWiki() object contains Tiddler()s
// ---------------------------------------------------------------------------------

function TiddlyWiki()
{
	var tiddlers = {}; // Hashmap by name of tiddlers
	this.namedNotifications = []; // Array of {name:,notify:} of notification functions
	this.notificationLevel = 0;
	this.clear = function() {
		tiddlers = {};
		this.setDirty(false);
		};
	this.fetchTiddler = function(title) {
		return tiddlers[title];
		};
	this.deleteTiddler = function(title) {
		 delete tiddlers[title];
		};
	this.addTiddler = function(tiddler) {
		 tiddlers[tiddler.title] = tiddler;
		};
	this.forEachTiddler = function(callback) {
		for(var t in tiddlers)
			{
			var tiddler = tiddlers[t];
			if(tiddler instanceof Tiddler)
				callback.call(this,t,tiddler);
			}
		};
}

// Set the dirty flag
TiddlyWiki.prototype.setDirty = function(dirty)
{
	this.dirty = dirty;
}

TiddlyWiki.prototype.isDirty = function()
{
	return this.dirty;
}

TiddlyWiki.prototype.suspendNotifications = function()
{
	this.notificationLevel--;
}

TiddlyWiki.prototype.resumeNotifications = function()
{
	this.notificationLevel++;
}

// Invoke the notification handlers for a particular tiddler
TiddlyWiki.prototype.notify = function(title,doBlanket)
{
	if(!this.notificationLevel)
		for(var t=0; t<this.namedNotifications.length; t++)
			{
			var n = this.namedNotifications[t];
			if((n.name == null && doBlanket) || (n.name == title))
				n.notify(title);
			}
}

// Invoke the notification handlers for all tiddlers
TiddlyWiki.prototype.notifyAll = function()
{
	if(!this.notificationLevel)
		for(var t=0; t<this.namedNotifications.length; t++)
			{
			var n = this.namedNotifications[t];
			n.notify(n.name);
			}
}

// Add a notification handler to a tiddler
TiddlyWiki.prototype.addNotification = function(title,fn)
{
	for (var i=0; i<this.namedNotifications.length; i++)
		if((this.namedNotifications[i].name == title) && (this.namedNotifications[i].notify == fn))
			return this;
	this.namedNotifications.push({name: title, notify: fn});
	return this;
}

TiddlyWiki.prototype.removeTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler)
		{
		this.deleteTiddler(title);
		this.notify(title,true);
		this.setDirty(true);
		}
}

TiddlyWiki.prototype.tiddlerExists = function(title)
{
	var t = this.fetchTiddler(title);
	return (t != undefined);
}

TiddlyWiki.prototype.isShadowTiddler = function(title)
{
	var s = config.shadowTiddlers[title];
	return (s != undefined && typeof s == "string");
}

TiddlyWiki.prototype.getTiddler = function(title)
{
	var t = this.fetchTiddler(title);
	if(t != undefined)
		return t;
	else
		return null;
}

TiddlyWiki.prototype.getTiddlerText = function(title,defaultText)
{
	if(!title)
		return(defaultText);
	var tiddler = this.fetchTiddler(title);
	if(tiddler)
		return tiddler.text;
	else if(this.isShadowTiddler(title))
		return config.shadowTiddlers[title];
	else if(defaultText != undefined)
		return defaultText;
	else
		return null;
}

TiddlyWiki.prototype.getRecursiveTiddlerText = function(title,defaultText,depth)
{
	var bracketRegExp = new RegExp("(?:\\[\\[([^\\]]+)\\]\\])","mg");
	var text = this.getTiddlerText(title,defaultText);
	if(text == null)
		return "";
	var textOut = [];
	var lastPos = 0;
	do {
		var match = bracketRegExp.exec(text);
		if(match)
			{
			textOut.push(text.substr(lastPos,match.index-lastPos));
			if(match[1])
				{
				if(depth <= 0)
					textOut.push(match[1]);
				else
					textOut.push(this.getRecursiveTiddlerText(match[1],match[1],depth-1));
				}
			lastPos = match.index + match[0].length;
			}
		else
			textOut.push(text.substr(lastPos));
	} while(match);
	return(textOut.join(""));
}

TiddlyWiki.prototype.saveTiddler = function(title,newTitle,newBody,modifier,modified,tags)
{
	var tiddler = this.fetchTiddler(title);
	var created;
	if(tiddler)
		{
 		created = tiddler.created; // preserve created date
		this.deleteTiddler(title);
		}
	else
		{
		tiddler = new Tiddler();
		created = modified;
		}
	tiddler.set(newTitle,newBody,modifier,modified,tags,created);
	this.addTiddler(tiddler);
	if(title != newTitle)
		this.notify(title,true);
	this.notify(newTitle,true);
	this.setDirty(true);
	return tiddler;
}

TiddlyWiki.prototype.createTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler)
		{
		tiddler = new Tiddler();
		tiddler.title = title;
		this.addTiddler(tiddler);
		this.setDirty(true);
		}
	return tiddler;
}

// Load contents of a tiddlywiki from an HTML DIV
TiddlyWiki.prototype.loadFromDiv = function(srcID,idPrefix)
{
	if(document.normalize)
		document.normalize();
	var lenPrefix = idPrefix.length;
	var store = document.getElementById(srcID).childNodes;
	var tiddlers = [];
	for(var t = 0; t < store.length; t++)
		{
		var e = store[t];
		var title = null;
		if(e.getAttribute)
			title = e.getAttribute("tiddler");
		if(!title && e.id && e.id.substr(0,lenPrefix) == idPrefix)
			title = e.id.substr(lenPrefix);
		if(title && title != "")
			{
			var tiddler = this.createTiddler(title);
			tiddler.loadFromDiv(e,title);
			tiddlers.push(tiddler);
			}
		}
	for(var t = 0;t<tiddlers.length; t++)
		tiddlers[t].changed();
	this.setDirty(false);
}

// Return an array of tiddlers matching a search regular expression
TiddlyWiki.prototype.search = function(searchRegExp,sortField,excludeTag)
{
	var candidates = this.reverseLookup("tags",excludeTag,false);
	var results = [];
	for(var t=0; t<candidates.length; t++)
		{
		if((candidates[t].title.search(searchRegExp) != -1) || (candidates[t].text.search(searchRegExp) != -1))
			results.push(candidates[t]);
		}
	if(!sortField)
		sortField = "title";
	results.sort(function (a,b) {if(a[sortField] == b[sortField]) return(0); else return (a[sortField] < b[sortField]) ? -1 : +1; });
	return results;
}

// Return an array of all the tags in use. Each member of the array is another array where [0] is the name of the tag and [1] is the number of occurances
TiddlyWiki.prototype.getTags = function()
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		for(var g=0; g<tiddler.tags.length; g++)
			{
			var tag = tiddler.tags[g];
			var f = false;
			for(var c=0; c<results.length; c++)
				if(results[c][0] == tag)
					{
					f = true;
					results[c][1]++;
					}
			if(!f)
				results.push([tag,1]);
			}
		});
	results.sort(function (a,b) {if(a[0].toLowerCase() == b[0].toLowerCase()) return(0); else return (a[0].toLowerCase() < b[0].toLowerCase()) ? -1 : +1; });
	return results;
}

// Return an array of the tiddlers that are tagged with a given tag
TiddlyWiki.prototype.getTaggedTiddlers = function(tag,sortField)
{
	return this.reverseLookup("tags",tag,true,sortField);
}

// Return an array of the tiddlers that link to a given tiddler
TiddlyWiki.prototype.getReferringTiddlers = function(title,unusedParameter,sortField)
{
	return this.reverseLookup("links",title,true,sortField);
}

// Return an array of the tiddlers that do or do not have a specified entry in the specified storage array (ie, "links" or "tags")
// lookupMatch == true to match tiddlers, false to exclude tiddlers
TiddlyWiki.prototype.reverseLookup = function(lookupField,lookupValue,lookupMatch,sortField)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		var f = !lookupMatch;
		for(var lookup=0; lookup<tiddler[lookupField].length; lookup++)
			if(tiddler[lookupField][lookup] == lookupValue)
				f = lookupMatch;
		if(f)
			results.push(tiddler);
		});
	if(!sortField)
		sortField = "title";
	results.sort(function (a,b) {if(a[sortField] == b[sortField]) return(0); else return (a[sortField] < b[sortField]) ? -1 : +1; });
	return results;
}

// Return the tiddlers as a sorted array
TiddlyWiki.prototype.getTiddlers = function(field,excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		if(excludeTag == undefined || tiddler.tags.find(excludeTag) == null)
			results.push(tiddler);
		});
	if(field)
		results.sort(function (a,b) {if(a[field] == b[field]) return(0); else return (a[field] < b[field]) ? -1 : +1; });
	return results;
}

// Return array of names of tiddlers that are referred to but not defined
TiddlyWiki.prototype.getMissingLinks = function(sortField)
{
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		if(tiddler.tags.find("systemConfig") == null && tiddler.tags.find("excludeMissing") == null)
			for(var n=0; n<tiddler.links.length;n++)
				{
				var link = tiddler.links[n];
				if(this.fetchTiddler(link) == null && !this.isShadowTiddler(link))
					results.pushUnique(link);
				}
		});
	results.sort();
	return results;
}

// Return an array of names of tiddlers that are defined but not referred to
TiddlyWiki.prototype.getOrphans = function()
{
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		if(this.getReferringTiddlers(title).length == 0 && !tiddler.isTagged("excludeLists"))
			results.push(title);
		});
	results.sort();
	return results;
}

// Return an array of names of all the shadow tiddlers
TiddlyWiki.prototype.getShadowed = function()
{
	var results = [];
	for(var t in config.shadowTiddlers)
		if(typeof config.shadowTiddlers[t] == "string")
			results.push(t);
	results.sort();
	return results;
}

// ---------------------------------------------------------------------------------
// Story functions
// ---------------------------------------------------------------------------------

function displayTiddlers(srcElement,titles,template,unused1,unused2,animate,slowly)
{
	story.displayTiddlers(srcElement,titles,template,animate,slowly);
}

function displayTiddler(srcElement,title,template,unused1,unused2,animate,slowly)
{
	story.displayTiddler(srcElement,title,template,animate,slowly);
}

// A story is a HTML div containing a sequence of tiddlers that can be manipulated
// container - id of containing element
// idPrefix - string prefix prepended to title to make ids for tiddlers in this story
function Story(container,idPrefix)
{
	this.container = container;
	this.idPrefix = idPrefix;
	this.highlightRegExp = null;
}

// Iterate through all the tiddlers in a story
// fn - callback function to be called for each tiddler. Arguments are:
//		tiddler - reference to Tiddler object
//		element - reference to tiddler display element
Story.prototype.forEachTiddler = function(fn)
{
	var place = document.getElementById(this.container);
	if(!place)
		return;
	var e = place.firstChild;
	while(e)
		{
		var n = e.nextSibling;
		var title = e.getAttribute("tiddler");
		fn.call(this,title,e);
		e = n;
		}
}

// Display several tiddlers given their titles in an array. Parameters same as displayTiddler(), except:
// titles - array of string titles
Story.prototype.displayTiddlers = function(srcElement,titles,template,animate,slowly)
{
	for(var t = titles.length-1;t>=0;t--)
		this.displayTiddler(srcElement,titles[t],template,animate,slowly);
}

// Display a given tiddler with a given template. If the tiddler is already displayed but with a different
// template, it is switched to the specified template
// srcElement - reference to element from which this one is being opened -or-
//              special positions "top", "bottom"
// title - title of tiddler to display
// template - the name of the tiddler containing the template -or-
//			  one of the constants DEFAULT_VIEW_TEMPLATE and DEFAULT_EDIT_TEMPLATE -or-
//			  null or undefined to indicate the current template if there is one, DEFAULT_VIEW_TEMPLATE if not
// animate - whether to perform animations
// slowly - whether to perform animations in slomo
Story.prototype.displayTiddler = function(srcElement,title,template,animate,slowly)
{
	var place = document.getElementById(this.container);
	var theTiddler = document.getElementById(this.idPrefix + title);
	if(theTiddler)
		this.refreshTiddler(title,template);
	else
		{
		var before = this.positionTiddler(srcElement);
		theTiddler = this.createTiddler(place,before,title,template);
		}
	if(srcElement)
		{
		if(config.options.chkAnimate && (animate == undefined || animate == true))
			anim.startAnimating(new Cascade(title,srcElement,theTiddler,slowly),new Scroller(theTiddler,slowly));
		else
			window.scrollTo(0,ensureVisible(theTiddler));
		}
}

// Figure out the appropriate position for a newly opened tiddler
// srcElement - reference to the element containing the link to the tiddler -or-
//              special positions "top", "bottom"
// returns - reference to the tiddler that the new one should appear before (null for the bottom of the story)
Story.prototype.positionTiddler = function(srcElement)
{
	var place = document.getElementById(this.container);
	var before;
	if(typeof srcElement == "string")
		{
		switch(srcElement)
			{
			case "top":
				before = place.firstChild;
				break;
			case "bottom":
				before = null;
				break;
			}
		}
	else
		{
		var after = this.findContainingTiddler(srcElement);
		if(after == null)
			before = place.firstChild;
		else if(after.nextSibling)
			before = after.nextSibling;
		else
			before = null;
		}
	return before;
}

// Create a tiddler frame at the appropriate place in a story column
// place - reference to parent element
// before - null, or reference to element before which to insert new tiddler
// title - title of new tiddler
// template - the name of the tiddler containing the template or one of the constants DEFAULT_VIEW_TEMPLATE and DEFAULT_EDIT_TEMPLATE
Story.prototype.createTiddler = function(place,before,title,template)
{
	var theTiddler = createTiddlyElement(null,"div",this.idPrefix + title,"tiddler",null);
	place.insertBefore(theTiddler,before);
	this.refreshTiddler(title,template);
	return theTiddler;
}

// Overridable for choosing the name of the template to apply for a tiddler
Story.prototype.chooseTemplateForTiddler = function(title,template)
{
	if(!template)
		template = DEFAULT_VIEW_TEMPLATE;
	if(template == DEFAULT_VIEW_TEMPLATE || template == DEFAULT_EDIT_TEMPLATE)
		template = config.tiddlerTemplates[template];
	return template;
}

// Overridable for extracting the text of a template from a tiddler
Story.prototype.getTemplateForTiddler = function(title,template,tiddler)
{
	return store.getTiddlerText(template);
}

// Apply a template to an existing tiddler if it is not already displayed using that template
// title - title of tiddler to update
// template - the name of the tiddler containing the template or one of the constants DEFAULT_VIEW_TEMPLATE and DEFAULT_EDIT_TEMPLATE
// force - if true, forces the refresh even if the template hasn't changedd
Story.prototype.refreshTiddler = function(title,template,force)
{
	var theTiddler = document.getElementById(this.idPrefix + title);
	if(theTiddler)
		{
		if(theTiddler.getAttribute("dirty") == "true" && !force)
			return theTiddler;
		template = this.chooseTemplateForTiddler(title,template);
		var currTemplate = theTiddler.getAttribute("template");
		if((template != currTemplate) || force)
			{
			var tiddler = store.getTiddler(title);
			if(!tiddler)
				{
				tiddler = new Tiddler();
				if(store.isShadowTiddler(title))
					tiddler.set(title,store.getTiddlerText(title),config.views.wikified.shadowModifier,version.date,[],version.date);
				else
					{
					var text = template=="EditTemplate"
								? config.views.editor.defaultText.format([title])
								: config.views.wikified.defaultText.format([title]);
					tiddler.set(title,text,config.views.wikified.defaultModifier,version.date,[],version.date);
					}
				}
			theTiddler.setAttribute("tags",tiddler.tags.join(" "));
			theTiddler.setAttribute("tiddler",title);
			theTiddler.setAttribute("template",template);
			var me = this;
			theTiddler.onmouseover = this.onTiddlerMouseOver;
			theTiddler.onmouseout = this.onTiddlerMouseOut;
			theTiddler.ondblclick = this.onTiddlerDblClick;
			theTiddler.onkeypress = this.onTiddlerKeyPress;
			var html = this.getTemplateForTiddler(title,template,tiddler);
			theTiddler.innerHTML = html;
			applyHtmlMacros(theTiddler,tiddler);
			if(store.getTaggedTiddlers(title).length > 0)
				addClass(theTiddler,"isTag");
			else
				removeClass(theTiddler,"isTag");
			if(!store.tiddlerExists(title))
				{
				if(store.isShadowTiddler(title))
					addClass(theTiddler,"shadow");
				else
					addClass(theTiddler,"missing");
				}
			else
				{
				removeClass(theTiddler,"shadow");
				removeClass(theTiddler,"missing");
				}
			}
		}
	return theTiddler;
}

// Default tiddler onmouseover/out event handlers
Story.prototype.onTiddlerMouseOver = function(e)
{
	if(window.addClass instanceof Function)
		addClass(this,"selected");
}

Story.prototype.onTiddlerMouseOut = function(e)
{
	if(window.removeClass instanceof Function)
		removeClass(this,"selected");
}

// Default tiddler ondblclick event handler
Story.prototype.onTiddlerDblClick = function(e)
{
	if (!e) var e = window.event;
	var theTarget = resolveTarget(e);
	if(theTarget && theTarget.nodeName.toLowerCase() != "input" && theTarget.nodeName.toLowerCase() != "textarea")
		{
		if(document.selection && document.selection.empty)
			document.selection.empty();
		config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
		e.cancelBubble = true;
		if (e.stopPropagation) e.stopPropagation();
		return true;
		}
	else
		return false;
}

// Default tiddler onkeypress event handler
Story.prototype.onTiddlerKeyPress = function(e)
{
	if (!e) var e = window.event;
	clearMessage();
	var consume = false;
	var title = this.getAttribute("tiddler");
	switch(e.keyCode)
		{
		case 13: // Ctrl-Enter
		case 10: // Ctrl-Enter on IE PC
		case 77: // Ctrl-Enter is "M" on some platforms
			if(e.ctrlKey)
				{
				blurElement(this);
				config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
				consume = true;
				}
			break;
		case 27: // Escape
			blurElement(this);
			config.macros.toolbar.invokeCommand(this,"cancelCommand",e);
			consume = true;
			break;
		}
	e.cancelBubble = consume;
	if(consume)
		if (e.stopPropagation) e.stopPropagation();
	return(!consume);
};

// Focus a specified tiddler. Attempts to focus the specified field, otherwise the first edit field it finds
Story.prototype.focusTiddler = function(title,field)
{
	var tiddler = document.getElementById(this.idPrefix + title);
	if(tiddler != null)
		{
		var children = tiddler.getElementsByTagName("*")
		var e = null;
		for (var t=0; t<children.length; t++)
			{
			var c = children[t];
			if(c.tagName.toLowerCase() == "input" || c.tagName.toLowerCase() == "textarea")
				{
				if(!e)
					e = c;
				if(c.getAttribute("edit") == field)
					e = c;
				}
			}
		if(e)
			{
			e.focus();
			e.select();
			}
		}
}

// Ensures that a specified tiddler does not have the focus
Story.prototype.blurTiddler = function (title)
{
	var tiddler = document.getElementById(this.idPrefix + title);
	if(tiddler != null && tiddler.focus && tiddler.blur)
		{
		tiddler.focus();
		tiddler.blur();
		}
}

// Adds a specified tag to the edit controls (if any) for a particular tiddler)
// title - name of tiddler
// tag - name of tag, without any [[brackets]]
// mode - +1 to add the tag, -1 to remove it, 0 to toggle it
Story.prototype.setTiddlerTag = function(title,tag,add)
{
	var tiddler = document.getElementById(this.idPrefix + title);
	if(tiddler != null)
		{
		var children = tiddler.getElementsByTagName("input")
		for (var t=0; t<children.length; t++)
			{
			var c = children[t];
			if(c.tagName.toLowerCase() == "input" && c.getAttribute("edit") == "tags")
				{
				var tags = c.value.readBracketedList();
				var p = tags.find(tag);
				if(add == 0)
				    add = (p == null) ? +1 : -1;
				if(add == +1)
					{
					if(p == null)
						tags.push(tag);
					}
				else if(add == -1)
					{
					if(p != null)
						tags.splice(p,1);
					}
				var result = [];
				for(var r=0; r<tags.length; r++)
					result.push(String.encodeTiddlyLink(tags[r]));
				c.value = result.join(" ");
				}
			}
		}
}

// Close a specified tiddler
// title - name of tiddler to close
// animate - whether to perform animations
// slowly - whether to perform animations in slomo
Story.prototype.closeTiddler = function(title,animate,slowly)
{
	var tiddler = document.getElementById(this.idPrefix + title);
	if(tiddler != null)
		{
		clearMessage();
		this.scrubTiddler(tiddler);
		if(config.options.chkAnimate && animate)
			anim.startAnimating(new Slider(tiddler,false,slowly,"all"));
		else
			tiddler.parentNode.removeChild(tiddler);
		}
}

// Scrub IDs from a tiddler. This is so that the 'ghost' of a tiddler while it is being closed
// does not interfere with things
// tiddler - reference to the tiddler element
Story.prototype.scrubTiddler = function(tiddler)
{
	tiddler.id = null;
}

// Set the 'dirty' flag of a tiddler
// tiddler - title of tiddler to change
// dirty - new boolean status of flag
Story.prototype.setDirty = function(title,dirty)
{
	var tiddler = document.getElementById(this.idPrefix + title);
	if(tiddler != null)
		tiddler.setAttribute("dirty",dirty ? "true" : "false");
}

// Is a particular tiddler dirty (with unsaved changes)?
Story.prototype.isDirty = function(title)
{
	var tiddler = document.getElementById(this.idPrefix + title);
	if(tiddler != null)
		return tiddler.getAttribute("dirty") == "true";
	return null;
}

// Close all tiddlers in the story
Story.prototype.closeAllTiddlers = function(exclude)
{
	clearMessage();
	this.forEachTiddler(function(title,element) {
		if((title != exclude) && element.getAttribute("dirty") != "true")
			this.closeTiddler(title);
		});
	window.scrollTo(0,0);
}

// Check if there are any tiddlers in the story
Story.prototype.isEmpty = function()
{
	var place = document.getElementById(this.container);
	return(place && place.firstChild == null);
}

// Perform a search and display the result
// text - text to search for
// useCaseSensitive - true for case sensitive matching
// useRegExp - true to interpret text as a RegExp
Story.prototype.search = function(text,useCaseSensitive,useRegExp)
{
	this.closeAllTiddlers();
	highlightHack = new RegExp(useRegExp ?	 text : text.escapeRegExp(),useCaseSensitive ? "mg" : "img");
	var matches = store.search(highlightHack,"title","excludeSearch");
	for(var t=matches.length-1; t>=0; t--)
		this.displayTiddler(null,matches[t].title);
	highlightHack = null;
	var q = useRegExp ? "/" : "'";
	if(matches.length > 0)
		displayMessage(config.macros.search.successMsg.format([matches.length.toString(),q + text + q]));
	else
		displayMessage(config.macros.search.failureMsg.format([q + text + q]));
}

// Determine if the specified element is within a tiddler in this story
// e - reference to an element
// returns: reference to a tiddler element or null if none
Story.prototype.findContainingTiddler = function(e)
{
	while(e && !hasClass(e,"tiddler"))
		e = e.parentNode;
	return(e);
}

// Gather any saveable fields from a tiddler element
// e - reference to an element to scan recursively
// fields - object to contain gathered field values
Story.prototype.gatherSaveFields = function(e,fields)
{
	if(e && e.getAttribute)
		{
		var f = e.getAttribute("edit");
		if(f)
			fields[f] = e.value.replace(/\r/mg,"");;
		if(e.hasChildNodes())
			{
			var c = e.childNodes;
			for(var t=0; t<c.length; t++)
				this.gatherSaveFields(c[t],fields)
			}
		}
}

// Determine whether a tiddler has any edit fields, and if so if their values have been changed
// title - name of tiddler
Story.prototype.hasChanges = function(title)
{
	var changed = false;
	var e = document.getElementById(this.idPrefix + title);
	if(e != null)
		{
		var fields = {};
		this.gatherSaveFields(e,fields);
		var tiddler = store.fetchTiddler(title);
		for(var n in fields)
			{
			switch(n)
				{
				case "title":
					if(tiddler && tiddler.title != fields.title)
						changed = true;
					break;
				case "text":
					if(tiddler && tiddler.text != fields.text)
						changed = true;
					break;
				case "tags":
					if(tiddler && tiddler.getTags() != fields.tags)
						changed = true;
					break;
				}
			}
		}
	return changed;
}

// Save any open edit fields of a tiddler and updates the display as necessary
// title - name of tiddler
// minorUpdate - true if the modified date shouldn't be updated
// returns: title of saved tiddler, or null if not saved
Story.prototype.saveTiddler = function(title,minorUpdate)
{
	var tiddler = document.getElementById(this.idPrefix + title);
	if(tiddler != null)
		{
		var fields = {};
		this.gatherSaveFields(tiddler,fields);
		var newTitle = fields.title ? fields.title : title;
		if(store.tiddlerExists(newTitle) && newTitle != title)
			{
			if(confirm(config.messages.overwriteWarning.format([newTitle.toString()])))
				this.closeTiddler(newTitle,false,false);
			else
				return null;
			}
		tiddler.id = this.idPrefix + newTitle;
		tiddler.setAttribute("tiddler",newTitle);
		tiddler.setAttribute("dirty","false");
		if(config.options.chkForceMinorUpdate)
			minorUpdate = !minorUpdate;
		var newDate = new Date();
		store.saveTiddler(title,newTitle,fields.text,config.options.txtUserName,minorUpdate ? undefined : newDate,fields.tags);
		if(config.options.chkAutoSave)
			saveChanges();
		return newTitle;
		}
	return null;
}

Story.prototype.permaView = function()
{
	var links = [];
	this.forEachTiddler(function(title,element) {
		links.push(String.encodeTiddlyLink(title));
		});
	var t = encodeURIComponent(links.join(" "));
	if(t == "")
		t = "#";
	if(window.location.hash != t)
		window.location.hash = t;
}

// ---------------------------------------------------------------------------------
// Message area
// ---------------------------------------------------------------------------------

function displayMessage(text,linkText)
{
	var msgArea = document.getElementById("messageArea");
	if(!msgArea)
		{
		alert(text);
		return;
		}
	if(!msgArea.hasChildNodes())
		createTiddlyButton(createTiddlyElement(msgArea,"div",null,"messageToolbar"),config.messages.messageClose.text,config.messages.messageClose.tooltip,clearMessage);
	var msg;
	if(linkText)
		{
		msg = createTiddlyElement(msgArea,"div",null,null,null);
		var link = createTiddlyElement(msg,"a",null,null,text);
		link.href = linkText;
		link.target = "_blank";
		}
	else
		msg = createTiddlyElement(msgArea,"div",null,null,text);
	msgArea.style.display = "block";
}

function clearMessage()
{
	var msgArea = document.getElementById("messageArea");
	if(msgArea)
		{
		removeChildren(msgArea);
		msgArea.style.display = "none";
		}
	return false;
}

// ---------------------------------------------------------------------------------
// Refresh mechanism
// ---------------------------------------------------------------------------------

config.refreshers = {
	link: function(e,changeList)
		{
		var title = e.getAttribute("tiddlyLink");
		refreshTiddlyLink(e,title);
		},
		
	content: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var force = e.getAttribute("force");
		if(force != null || changeList == null || changeList.find(title) != null)
			{
			removeChildren(e);
			wikify(store.getTiddlerText(title,title),e,null,null);
			}
		}
};

function refreshElements(root,changeList)
{
	var nodes = root.childNodes;
	for(var c=0; c<nodes.length; c++)
		{
		var e = nodes[c],type;
		if(e.getAttribute)
			type = e.getAttribute("refresh");
		else
			type = null;
		var refresher = config.refreshers[type];
		if(refresher == undefined)
			{
			if(e.hasChildNodes())
				refreshElements(e,changeList);
			}
		else
			refresher(e,changeList);
		}
}

function applyHtmlMacros(root,tiddler)
{
	var e = root.firstChild;
	while(e)
		{
		var nextChild = e.nextSibling;
		if(e.getAttribute)
			{
			var macro = e.getAttribute("macro");
			if(macro)
				{
				var params = "";
				var p = macro.indexOf(" ");
				if(p != -1)
					{
					params = macro.substr(p+1);
					macro = macro.substr(0,p);
					}
				invokeMacro(e,macro,params,null,tiddler);
				}
			}
		if(e.hasChildNodes())
			applyHtmlMacros(e,tiddler);
		e = nextChild;
		}
}

function refreshPageTemplate(title)
{
	applyPageTemplate(title);
}

function applyPageTemplate(title)
{
	var stash = createTiddlyElement(document.body,"div");
	stash.style.display = "none";
	var display = document.getElementById("tiddlerDisplay");
	var nodes,t;
	if(display)
		{
		nodes = display.childNodes;
		for(t=nodes.length-1; t>=0; t--)
			stash.appendChild(nodes[t]);
		}
	var wrapper = document.getElementById("contentWrapper");
	if(!title)
		title = "PageTemplate";
	var html = store.getTiddlerText(title);
	wrapper.innerHTML = html;
	applyHtmlMacros(wrapper,null);
	refreshElements(wrapper,null);
	display = document.getElementById("tiddlerDisplay");
	removeChildren(display);
	if(!display)
		display = createTiddlyElement(wrapper,"div","tiddlerDisplay");
	nodes = stash.childNodes;
	for(t=nodes.length-1; t>=0; t--)
		display.appendChild(nodes[t]);
	stash.parentNode.removeChild(stash);
}

function refreshDisplay(hint)
{
	var e = document.getElementById("contentWrapper");
	refreshElements(e,hint == null ? null : [hint]);
}

function refreshPageTitle()
{
	document.title = wikifyPlain("SiteTitle") + " - " + wikifyPlain("SiteSubtitle");
}

function refreshStyles(title)
{
	setStylesheet(title == null ? "" : store.getRecursiveTiddlerText(title,"",10),title);
}

// ---------------------------------------------------------------------------------
// Options cookie stuff
// ---------------------------------------------------------------------------------

function loadOptionsCookie()
{
	if(safeMode)
		return;
	var cookies = document.cookie.split(";");
	for(var c=0; c<cookies.length; c++)
		{
		var p = cookies[c].indexOf("=");
		if(p != -1)
			{
			var name = cookies[c].substr(0,p).trim();
			var value = cookies[c].substr(p+1).trim();
			switch(name.substr(0,3))
				{
				case "txt":
					config.options[name] = unescape(value);
					break;
				case "chk":
					config.options[name] = value == "true";
					break;
				}
			}
		}
}

function saveOptionCookie(name)
{
	if(safeMode)
		return;
	var c = name + "=";
	switch(name.substr(0,3))
		{
		case "txt":
			c += escape(config.options[name].toString());
			break;
		case "chk":
			c += config.options[name] ? "true" : "false";
			break;
		}
	c += "; expires=Fri, 1 Jan 2038 12:00:00 UTC; path=/";
	document.cookie = c;
}

// ---------------------------------------------------------------------------------
// Saving
// ---------------------------------------------------------------------------------

var saveUsingSafari = false;
var startSaveArea = '<div id="' + 'storeArea">'; // Split up into two so that indexOf() of this source doesn't find it
var endSaveArea = '</d' + 'iv>';

// If there are unsaved changes, force the user to confirm before exitting
function confirmExit()
{
	hadConfirmExit = true;
	if(store && store.isDirty && store.isDirty())
		return config.messages.confirmExit;
}

// Give the user a chance to save changes before exitting
function checkUnsavedChanges()
{
	if(store && store.isDirty && store.isDirty() && window.hadConfirmExit === false)
		{
		if(confirm(config.messages.unsavedChangesWarning))
			saveChanges();
		}
}

// Save this tiddlywiki with the pending changes
function saveChanges()
{
	clearMessage();
	// Get the URL of the document
	var originalPath = document.location.toString();
	// Check we were loaded from a file URL
	if(originalPath.substr(0,5) != "file:")
		{
		alert(config.messages.notFileUrlError);
		if(store.tiddlerExists(config.messages.saveInstructions))
			displayTiddler(null,config.messages.saveInstructions);
		return;
		}
	var localPath = getLocalPath(originalPath);
	// Load the original file
	var original = loadFile(localPath);
	if(original == null)
		{
		alert(config.messages.cantSaveError);
		if(store.tiddlerExists(config.messages.saveInstructions))
			displayTiddler(null,config.messages.saveInstructions);
		return;
		}
	// Locate the storeArea div's
	var posOpeningDiv = original.indexOf(startSaveArea);
	var posClosingDiv = original.lastIndexOf(endSaveArea);
	if((posOpeningDiv == -1) || (posClosingDiv == -1))
		{
		alert(config.messages.invalidFileError.format([localPath]));
		return;
		}
	// Save the backup
	if(config.options.chkSaveBackups)
		{
		var backupPath = getBackupPath(localPath);
		var backup = saveFile(backupPath,original);
		if(backup)
			displayMessage(config.messages.backupSaved,"file://" + backupPath);
		else
			alert(config.messages.backupFailed);
		}
	// Save Rss
	if(config.options.chkGenerateAnRssFeed)
		{
		var rssPath = localPath.substr(0,localPath.lastIndexOf(".")) + ".xml";
		var rssSave = saveFile(rssPath,convertUnicodeToUTF8(generateRss()));
		if(rssSave)
			displayMessage(config.messages.rssSaved,"file://" + rssPath);
		else
			alert(config.messages.rssFailed);
		}
	// Save empty template
	if(config.options.chkSaveEmptyTemplate)
		{
		var emptyPath,p;
		if((p = localPath.lastIndexOf("/")) != -1)
			emptyPath = localPath.substr(0,p) + "/empty.html";
		else if((p = localPath.lastIndexOf("\\")) != -1)
			emptyPath = localPath.substr(0,p) + "\\empty.html";
		else
			emptyPath = localPath + ".empty.html";
		var empty = original.substr(0,posOpeningDiv + startSaveArea.length) + original.substr(posClosingDiv);
		var emptySave = saveFile(emptyPath,empty);
		if(emptySave)
			displayMessage(config.messages.emptySaved,"file://" + emptyPath);
		else
			alert(config.messages.emptyFailed);
		}
	// Save new file
	var revised = original.substr(0,posOpeningDiv + startSaveArea.length) + 
				convertUnicodeToUTF8(allTiddlersAsHtml()) + "\n\t\t" +
				original.substr(posClosingDiv);
	var newSiteTitle = convertUnicodeToUTF8((wikifyPlain("SiteTitle") + " - " + wikifyPlain("SiteSubtitle")).htmlEncode());
	revised = revised.replaceChunk("<title"+">","</title"+">"," " + newSiteTitle + " ");
	revised = revised.replaceChunk("<!--PRE-HEAD-START--"+">","<!--PRE-HEAD-END--"+">","\n" + store.getTiddlerText("MarkupPreHead","") + "\n");
	revised = revised.replaceChunk("<!--POST-HEAD-START--"+">","<!--POST-HEAD-END--"+">","\n" + store.getTiddlerText("MarkupPostHead","") + "\n");
	revised = revised.replaceChunk("<!--PRE-BODY-START--"+">","<!--PRE-BODY-END--"+">","\n" + store.getTiddlerText("MarkupPreBody","") + "\n");
	revised = revised.replaceChunk("<!--POST-BODY-START--"+">","<!--POST-BODY-END--"+">","\n" + store.getTiddlerText("MarkupPostBody","") + "\n");
	var save = saveFile(localPath,revised);
	if(save)
		{
		displayMessage(config.messages.mainSaved,"file://" + localPath);
		store.setDirty(false);
		}
	else
		alert(config.messages.mainFailed);
}

function getLocalPath(originalPath)
{
	// Remove any location or query part of the URL
	var argPos = originalPath.indexOf("?");
	if(argPos != -1)
		originalPath = originalPath.substr(0,argPos);
	var hashPos = originalPath.indexOf("#");
	if(hashPos != -1)
		originalPath = originalPath.substr(0,hashPos);
	// Convert file://localhost/ to file:///
	if(originalPath.indexOf("file://localhost/") == 0)
		originalPath = "file://" + originalPath.substr(16);
	// Convert to a native file format assuming
	// "file:///x:/path/path/path..." - pc local file --> "x:\path\path\path..."
	// "file://///server/share/path/path/path..." - FireFox pc network file --> "\\server\share\path\path\path..."
	// "file:///path/path/path..." - mac/unix local file --> "/path/path/path..."
	// "file://server/share/path/path/path..." - pc network file --> "\\server\share\path\path\path..."
	var localPath;
	if(originalPath.charAt(9) == ":") // pc local file
		localPath = unescape(originalPath.substr(8)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file://///") == 0) // FireFox pc network file
		localPath = "\\\\" + unescape(originalPath.substr(10)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file:///") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(7));
	else if(originalPath.indexOf("file:/") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(5));
	else // pc network file
		localPath = "\\\\" + unescape(originalPath.substr(7)).replace(new RegExp("/","g"),"\\");
	return localPath;
}

function getBackupPath(localPath)
{
	var backSlash = true;
	var dirPathPos = localPath.lastIndexOf("\\");
	if(dirPathPos == -1)
		{
		dirPathPos = localPath.lastIndexOf("/");
		backSlash = false;
		}
	var backupFolder = config.options.txtBackupFolder;
	if(!backupFolder || backupFolder == "")
		backupFolder = ".";
	var backupPath = localPath.substr(0,dirPathPos) + (backSlash ? "\\" : "/") + backupFolder + localPath.substr(dirPathPos);
	backupPath = backupPath.substr(0,backupPath.lastIndexOf(".")) + "." + (new Date()).convertToYYYYMMDDHHMMSSMMM() + ".html";
	return backupPath;
}

function generateRss()
{
	var s = [];
	var d = new Date();
	var u = store.getTiddlerText("SiteUrl",null);
	// Assemble the header
	s.push("<" + "?xml version=\"1.0\"?" + ">");
	s.push("<rss version=\"2.0\">");
	s.push("<channel>");
	s.push("<title>" + wikifyPlain("SiteTitle").htmlEncode() + "</title>");
	if(u)
		s.push("<link>" + u.htmlEncode() + "</link>");
	s.push("<description>" + wikifyPlain("SiteSubtitle").htmlEncode() + "</description>");
	s.push("<language>en-us</language>");
	s.push("<copyright>Copyright " + d.getFullYear() + " " + config.options.txtUserName.htmlEncode() + "</copyright>");
	s.push("<pubDate>" + d.toGMTString() + "</pubDate>");
	s.push("<lastBuildDate>" + d.toGMTString() + "</lastBuildDate>");
	s.push("<docs>http://blogs.law.harvard.edu/tech/rss</docs>");
	s.push("<generator>TiddlyWiki " + version.major + "." + version.minor + "." + version.revision + "</generator>");
	// The body
	var tiddlers = store.getTiddlers("modified","excludeLists");
	var n = config.numRssItems > tiddlers.length ? 0 : tiddlers.length-config.numRssItems;
	for (var t=tiddlers.length-1; t>=n; t--)
		s.push(tiddlers[t].saveToRss(u));
	// And footer
	s.push("</channel>");
	s.push("</rss>");
	// Save it all
	return s.join("\n");
}

function allTiddlersAsHtml()
{
	var savedTiddlers = [];
	var tiddlers = store.getTiddlers("title");
	for (var t = 0; t < tiddlers.length; t++)
		savedTiddlers.push(tiddlers[t].saveToDiv());
	return savedTiddlers.join("\n");
}

// UTF-8 encoding rules:
// 0x0000 - 0x007F:	0xxxxxxx
// 0x0080 - 0x07FF:	110xxxxx 10xxxxxx
// 0x0800 - 0xFFFF:	1110xxxx 10xxxxxx 10xxxxxx

function convertUTF8ToUnicode(u)
{
	if(window.Components)
		return mozConvertUTF8ToUnicode(u);
	else
		return manualConvertUTF8ToUnicode(u);
}

function manualConvertUTF8ToUnicode(u)
{
	var s = "";
	var t = 0;
	var b1, b2, b3;
	while(t < u.length)
		{
		b1 = u.charCodeAt(t++);
		if(b1 < 0x80)
			s += String.fromCharCode(b1);
		else if(b1 < 0xE0)
			{
			b2 = u.charCodeAt(t++);
			s += String.fromCharCode(((b1 & 0x1F) << 6) | (b2 & 0x3F));
			}
		else
			{
			b2 = u.charCodeAt(t++);
			b3 = u.charCodeAt(t++);
			s += String.fromCharCode(((b1 & 0xF) << 12) | ((b2 & 0x3F) << 6) | (b3 & 0x3F));
			}
	}
	return(s);
}

function mozConvertUTF8ToUnicode(u)
{
	if (window.netscape == undefined)
		return manualConvertUTF8ToUnicode(u); // fallback
	try
		{
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		}
	catch(e)
		{
		return manualConvertUTF8ToUnicode(u);
		} // fallback
	var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
	converter.charset = "UTF-8";
	var s = converter.ConvertToUnicode(u);
	var fin = converter.Finish();
	return (fin.length > 0) ? s+fin : s;
}

function convertUnicodeToUTF8(s)
{
	if(saveUsingSafari)
		return s;
	else if(window.Components)
		return mozConvertUnicodeToUTF8(s);
	else
		return manualConvertUnicodeToUTF8(s);
}

function manualConvertUnicodeToUTF8(s)
{
	var re = /[^\u0000-\u007F]/g ;
	return s.replace(re, function($0) {return("&#" + $0.charCodeAt(0).toString() + ";");})
}

function mozConvertUnicodeToUTF8(s)
{
	netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
	var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
	converter.charset = "UTF-8";
	var u = converter.ConvertFromUnicode(s);
	var fin = converter.Finish();
	if(fin.length > 0)
		return u + fin;
	else
		return u;
}

function saveFile(fileUrl, content)
{
	var r = null;
	if(saveUsingSafari)
		r = safariSaveFile(fileUrl, content);
	if((r == null) || (r == false))
		r = mozillaSaveFile(fileUrl, content);
	if((r == null) || (r == false))
		r = ieSaveFile(fileUrl, content);
	if((r == null) || (r == false))
		r = operaSaveFile(fileUrl, content);
	return(r);
}

function loadFile(fileUrl)
{
	var r = null;
	if(saveUsingSafari)
		r = safariLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = mozillaLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = ieLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = operaLoadFile(fileUrl);
	return(r);
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function ieSaveFile(filePath, content)
{
	try
		{
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		}
	catch(e)
		{
		//alert("Exception while attempting to save\n\n" + e.toString());
		return(null);
		}
	var file = fso.OpenTextFile(filePath,2,-1,0);
	file.Write(content);
	file.Close();
	return(true);
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function ieLoadFile(filePath)
{
	try
		{
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		var file = fso.OpenTextFile(filePath,1);
		var content = file.ReadAll();
		file.Close();
		}
	catch(e)
		{
		//alert("Exception while attempting to load\n\n" + e.toString());
		return(null);
		}
	return(content);
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function mozillaSaveFile(filePath, content)
{
	if(window.Components)
		try
			{
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if (!file.exists())
				file.create(0, 0664);
			var out = Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);
			out.init(file, 0x20 | 0x02, 00004,null);
			out.write(content, content.length);
			out.flush();
			out.close();
			return(true);
			}
		catch(e)
			{
			//alert("Exception while attempting to save\n\n" + e);
			return(false);
			}
	return(null);
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function mozillaLoadFile(filePath)
{
	if(window.Components)
		try
			{
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if (!file.exists())
				return(null);
			var inputStream = Components.classes["@mozilla.org/network/file-input-stream;1"].createInstance(Components.interfaces.nsIFileInputStream);
			inputStream.init(file, 0x01, 00004, null);
			var sInputStream = Components.classes["@mozilla.org/scriptableinputstream;1"].createInstance(Components.interfaces.nsIScriptableInputStream);
			sInputStream.init(inputStream);
			return(sInputStream.read(sInputStream.available()));
			}
		catch(e)
			{
			//alert("Exception while attempting to load\n\n" + e);
			return(false);
			}
	return(null);
}

function operaUrlToFilename(url)
{
	var f = "//localhost";
	if(url.indexOf(f) == 0)
		return url.substring(f.length);
	var i = url.indexOf(":");
	if(i > 0)
		return url.substring(i-1);
	return url;
}

function operaSaveFile(filePath, content)
{
	try
		{
		var s = new java.io.PrintStream(new java.io.FileOutputStream(operaUrlToFilename(filePath)));
		s.print(content);
		s.close();
		}
	catch(e)
		{
		if(window.opera)
			opera.postError(e);
		return null;
		}
	return true;
}

function operaLoadFile(filePath)
{
	var content = [];
	try
		{
		var r = new java.io.BufferedReader(new java.io.FileReader(operaUrlToFilename(filePath)));
		var line;
		while ((line = r.readLine()) != null)
			content.push(new String(line));
		r.close();
		}
	catch(e)
		{
		if(window.opera)
			opera.postError(e);
		return null;
		}
	return content.join("\n");
}

function safariFilenameToUrl(filename) {
	return ("file://" + filename);
}

function safariLoadFile(url)
{
	url = safariFilenameToUrl(url);
	var plugin = document.embeds["tiddlyWikiSafariSaver"];
	return plugin.readURL(url);
}

function safariSaveFile(url,content)
{
	url = safariFilenameToUrl(url);
	var plugin = document.embeds["tiddlyWikiSafariSaver"];
	return plugin.writeStringToURL(content,url);
}

// Lifted from http://developer.apple.com/internet/webcontent/detectplugins.html
function detectPlugin()
{
	var daPlugins = detectPlugin.arguments;
	var pluginFound = false;
	if (navigator.plugins && navigator.plugins.length > 0)
		{
		var pluginsArrayLength = navigator.plugins.length;
		for (var pluginsArrayCounter=0; pluginsArrayCounter < pluginsArrayLength; pluginsArrayCounter++ )
			{
			var numFound = 0;
			for(var namesCounter=0; namesCounter < daPlugins.length; namesCounter++)
				{
				if( (navigator.plugins[pluginsArrayCounter].name.indexOf(daPlugins[namesCounter]) >= 0) || 
						(navigator.plugins[pluginsArrayCounter].description.indexOf(daPlugins[namesCounter]) >= 0) )
					numFound++;
				}
			if(numFound == daPlugins.length)
				{
				pluginFound = true;
				break;
				}
			}
	}
	return pluginFound;
}

// ---------------------------------------------------------------------------------
// TiddlyWiki-specific utility functions
// ---------------------------------------------------------------------------------

function createTiddlyButton(theParent,theText,theTooltip,theAction,theClass,theId,theAccessKey)
{
	var theButton = document.createElement("a");
	theButton.className = "button";
	if(theAction)
		{
		theButton.onclick = theAction;
		theButton.setAttribute("href","javascript:;");
		}
	theButton.setAttribute("title",theTooltip);
	if(theText)
		theButton.appendChild(document.createTextNode(theText));
	if(theClass)
		theButton.className = theClass;
	if(theId)
		theButton.id = theId;
	if(theParent)
		theParent.appendChild(theButton);
	if(theAccessKey)
		theButton.setAttribute("accessKey",theAccessKey);
	return(theButton);
}

function createTiddlyLink(place,title,includeText,theClass)
{
	var text = includeText ? title : null;
	var btn = createTiddlyButton(place,text,null,onClickTiddlerLink,theClass);
	btn.setAttribute("refresh","link");
	btn.setAttribute("tiddlyLink",title);
	refreshTiddlyLink(btn,title);
	return(btn);
}

function refreshTiddlyLink(e,title)
{
	var subTitle, theClass = "tiddlyLink";
	var tiddler = store.fetchTiddler(title);
	if(tiddler)
		{
		subTitle = tiddler.getSubtitle();
		theClass += " tiddlyLinkExisting";
		}
	else
		{
		subTitle = config.messages.undefinedTiddlerToolTip.format([title]);
		theClass += " tiddlyLinkNonExisting";
		if(store.isShadowTiddler(title))
			{
			subTitle = config.messages.shadowedTiddlerToolTip.format([title]);
			theClass += " shadow";
			}
		else
			subTitle = config.messages.undefinedTiddlerToolTip.format([title]);
		}
	e.className = theClass;
	e.title = subTitle;
}

function createExternalLink(place,url)
{
	var theLink = document.createElement("a");
	theLink.className = "externalLink";
	theLink.href = url;
	theLink.title = config.messages.externalLinkTooltip.format([url]);
	if(config.options.chkOpenInNewWindow)
		theLink.target = "_blank";
	place.appendChild(theLink);
	return(theLink);
}

// Event handler for clicking on a tiddly link
function onClickTiddlerLink(e)
{
	if (!e) var e = window.event;
	var theTarget = resolveTarget(e);
	var theLink = theTarget;
	var title = null;
	do {
		title = theLink.getAttribute("tiddlyLink");
		theLink = theLink.parentNode;
	} while(title == null && theLink != null);
	if(title)
		{
		var toggling = e.metaKey || e.ctrlKey;
		if(config.options.chkToggleLinks)
			toggling = !toggling;
		var opening;
		if(toggling && document.getElementById("tiddler" + title))
			story.closeTiddler(title,true,e.shiftKey || e.altKey);
		else
			story.displayTiddler(theTarget,title,null,true,e.shiftKey || e.altKey);
		}
	clearMessage();
	return(false);
}

// Create a button for a tag with a popup listing all the tiddlers that it tags
function createTagButton(place,tag,excludeTiddler)
{
	var theTag = createTiddlyButton(place,tag,config.views.wikified.tag.tooltip.format([tag]),onClickTag);
	theTag.setAttribute("tag",tag);
	if(excludeTiddler)
		theTag.setAttribute("tiddler",excludeTiddler);
	return(theTag);
}

// Event handler for clicking on a tiddler tag
function onClickTag(e)
{
	if (!e) var e = window.event;
	var theTarget = resolveTarget(e);
	var popup = Popup.create(this);
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(popup && tag)
		{
		var tagged = store.getTaggedTiddlers(tag);
		var titles = [];
		var li,r;
		for(r=0;r<tagged.length;r++)
			if(tagged[r].title != title)
				titles.push(tagged[r].title);
		var lingo = config.views.wikified.tag;
		if(titles.length > 0)
			{
			var openAll = createTiddlyButton(createTiddlyElement(popup,"li"),lingo.openAllText.format([tag]),lingo.openAllTooltip,onClickTagOpenAll);
			openAll.setAttribute("tag",tag);
			createTiddlyElement(createTiddlyElement(popup,"li"),"hr");
			for(r=0; r<titles.length; r++)
				{
				createTiddlyLink(createTiddlyElement(popup,"li"),titles[r],true);
				}
			}
		else
			createTiddlyText(createTiddlyElement(popup,"li",null,"disabled"),lingo.popupNone.format([tag]));
		createTiddlyElement(createTiddlyElement(popup,"li"),"hr");
		var h = createTiddlyLink(createTiddlyElement(popup,"li"),tag,false);
		createTiddlyText(h,lingo.openTag.format([tag]));
		}
	Popup.show(popup,false);
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	return(false);
}

// Event handler for 'open all' on a tiddler popup
function onClickTagOpenAll(e)
{
	if (!e) var e = window.event;
	var tag = this.getAttribute("tag");
	var tagged = store.getTaggedTiddlers(tag);
	for(var t=tagged.length-1; t>=0; t--)
		story.displayTiddler(this,tagged[t].title,null,false,e.shiftKey || e.altKey);
	return(false);
}

function onClickError(e)
{
	if (!e) var e = window.event;
	var popup = Popup.create(this);
	var lines = this.getAttribute("errorText").split("\n");
	for(var t=0; t<lines.length; t++)
		createTiddlyElement(popup,"li",null,null,lines[t]);
	Popup.show(popup,false);
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyError(place,title,text)
{
	var btn = createTiddlyButton(place,title,null,onClickError,"errorButton");
	if (text) btn.setAttribute("errorText",text);
}

// ---------------------------------------------------------------------------------
// Animation engine
// ---------------------------------------------------------------------------------

function Animator()
{
	this.running = 0; // Incremented at start of each animation, decremented afterwards. If zero, the interval timer is disabled
	this.timerID; // ID of the timer used for animating
	this.animations = []; // List of animations in progress
	return this;
}

// Start animation engine
Animator.prototype.startAnimating = function() // Variable number of arguments
{
	for(var t=0; t<arguments.length; t++)
		this.animations.push(arguments[t]);
	if(this.running == 0)
		{
		var me = this;
		this.timerID = window.setInterval(function() {me.doAnimate(me);},5);
		}
	this.running += arguments.length;
}

// Perform an animation engine tick, calling each of the known animation modules
Animator.prototype.doAnimate = function(me)
{
	var a = 0;
	while(a < me.animations.length)
		{
		var animation = me.animations[a];
		if(animation.tick())
			a++;
		else
			{
			me.animations.splice(a,1);
			if(--me.running == 0)
				window.clearInterval(me.timerID);
			}
		}
}

// Map a 0..1 value to 0..1, but slow down at the start and end
Animator.slowInSlowOut = function(progress)
{
	return(1-((Math.cos(progress * Math.PI)+1)/2));
}

// ---------------------------------------------------------------------------------
// Cascade animation
// ---------------------------------------------------------------------------------

function Cascade(text,startElement,targetElement,slowly)
{
	var winWidth = findWindowWidth();
	var winHeight = findWindowHeight();
	this.elements = [];
	this.startElement = startElement;
	this.startLeft = findPosX(this.startElement);
	this.startTop = findPosY(this.startElement);
	this.startWidth = Math.min(this.startElement.offsetWidth,winWidth);
	this.startHeight = Math.min(this.startElement.offsetHeight,winHeight);
	this.targetElement = targetElement;
	targetElement.style.position = "relative";
	targetElement.style.zIndex = 2;
	this.targetLeft = findPosX(this.targetElement);
	this.targetTop = findPosY(this.targetElement);
	this.targetWidth = Math.min(this.targetElement.offsetWidth,winWidth);
	this.targetHeight = Math.min(this.targetElement.offsetHeight,winHeight);
	this.progress = -1;
	this.steps = slowly ? config.cascadeSlow : config.cascadeFast;
	this.text = text;
	this.tick();
	return this;
}

Cascade.prototype.tick = function()
{
	this.progress++;
	if(this.progress >= this.steps)
		{
		while(this.elements.length > 0)
			this.removeTail();
		this.targetElement.style.position = "static";
		this.targetElement.style.zIndex = null;
		return false;
		}
	else
		{
		if(this.elements.length > 0 && this.progress > config.cascadeDepth)
			this.removeTail();
		if(this.progress < (this.steps - config.cascadeDepth))
			{
			var f = Animator.slowInSlowOut(this.progress/(this.steps - config.cascadeDepth - 1));
			var e = createTiddlyElement(document.body,"div",null,"cascade",this.text);
			e.style.zIndex = 1;
			e.style.left = this.startLeft + (this.targetLeft-this.startLeft) * f + "px";
			e.style.top = this.startTop + (this.targetTop-this.startTop) * f + "px";
			e.style.width = this.startWidth + (this.targetWidth-this.startWidth) * f + "px";
			e.style.height = this.startHeight + (this.targetHeight-this.startHeight) * f + "px";
			e.style.display = "block";
			this.elements.push(e);
			}
		return true;
		}
}

Cascade.prototype.removeTail = function()
{
	var e = this.elements[0];
	e.parentNode.removeChild(e);
	this.elements.shift();
}

// ---------------------------------------------------------------------------------
// Scroller animation
// ---------------------------------------------------------------------------------

function Scroller(targetElement,slowly)
{
	this.targetElement = targetElement;
	this.startScroll = findScrollY();
	this.targetScroll = ensureVisible(targetElement);
	this.progress = 0;
	this.step = slowly ? config.animSlow : config.animFast;
	return this;
}

Scroller.prototype.tick = function()
{
	this.progress += this.step;
	if(this.progress > 1)
		{
		window.scrollTo(0,this.targetScroll);
		return false;
		}
	else
		{
		var f = Animator.slowInSlowOut(this.progress);
		window.scrollTo(0,this.startScroll + (this.targetScroll-this.startScroll) * f);
		return true;
		}
}

// ---------------------------------------------------------------------------------
// Slider animation
// ---------------------------------------------------------------------------------

// deleteMode - "none", "all" [delete target element and it's children], [only] "children" [but not the target element]
function Slider(element,opening,slowly,deleteMode)
{
	this.element = element;
	element.style.display = "block";
	this.deleteMode = deleteMode;
	this.element.style.height = "auto";
	this.realHeight = element.offsetHeight;
	this.opening = opening;
	this.step = slowly ? config.animSlow : config.animFast;
	if(opening)
		{
		this.progress = 0;
		element.style.height = "0px";
		element.style.display = "block";
		}
	else
		{
		this.progress = 1;
		this.step = -this.step;
		}
	element.style.overflow = "hidden";
	return this;
}

Slider.prototype.stop = function()
{
	if(this.opening)
		{
		this.element.style.height = "auto";
		this.element.style.opacity = 1;
		this.element.style.filter = "alpha(opacity:100)";
		}
	else
		{
		switch(this.deleteMode)
			{
			case "none":
				this.element.style.display = "none";
				break;
			case "all":
				this.element.parentNode.removeChild(this.element);
				break;
			case "children":
				removeChildren(this.element);
				break;
			}
		}
}

Slider.prototype.tick = function()
{
	this.progress += this.step;
	if(this.progress < 0 || this.progress > 1)
		{
		this.stop();
		return false;
		}
	else
		{
		var f = Animator.slowInSlowOut(this.progress);
		var h = this.realHeight * f;
		this.element.style.height = h + "px";
		this.element.style.opacity = f;
		this.element.style.filter = "alpha(opacity:" + f * 100 +")";
		return true;
		}
}

// ---------------------------------------------------------------------------------
// Popup menu
// ---------------------------------------------------------------------------------

var Popup = {
	stack: [] // Array of objects with members root: and popup:
	};

Popup.create = function(root)
{
	Popup.remove();
	var popup = createTiddlyElement(document.body,"ol","popup","popup",null);
	Popup.stack.push({root: root, popup: popup});
	return popup;
}

Popup.onDocumentClick = function(e)
{
	if (!e) var e = window.event;
	var target = resolveTarget(e);
	if(e.eventPhase == undefined)
		Popup.remove();
	else if(e.eventPhase == Event.BUBBLING_PHASE || e.eventPhase == Event.AT_TARGET)
		Popup.remove();
	return true;
}

Popup.show = function(unused,slowly)
{
	var curr = Popup.stack[Popup.stack.length-1];
	var rootLeft = findPosX(curr.root);
	var rootTop = findPosY(curr.root);
	var rootHeight = curr.root.offsetHeight;
	var popupLeft = rootLeft;
	var popupTop = rootTop + rootHeight;
	var popupWidth = curr.popup.offsetWidth;
	var winWidth = findWindowWidth();
	if(popupLeft + popupWidth > winWidth)
		popupLeft = winWidth - popupWidth;
	curr.popup.style.left = popupLeft + "px";
	curr.popup.style.top = popupTop + "px";
	curr.popup.style.display = "block";
	addClass(curr.root,"highlight");
	if(config.options.chkAnimate)
		anim.startAnimating(new Scroller(curr.popup,slowly));
	else
		window.scrollTo(0,ensureVisible(curr.popup));
}

Popup.remove = function()
{
	if(Popup.stack.length > 0)
		{
		Popup.removeFrom(0);
		}
}

Popup.removeFrom = function(from)
{
	for(var t=Popup.stack.length-1; t>=from; t--)
		{
		var p = Popup.stack[t];
		removeClass(p.root,"highlight");
		p.popup.parentNode.removeChild(p.popup);
		}
	Popup.stack = Popup.stack.slice(0,from);
}

// Backwards compatibility
var createTiddlerPopup = Popup.create;
var scrollToTiddlerPopup = Popup.show;
var hideTiddlerPopup = Popup.remove;

// ---------------------------------------------------------------------------------
// Augmented methods for the JavaScript Number(), Array() and String() objects
// ---------------------------------------------------------------------------------

// Clamp a number to a range
Number.prototype.clamp = function(min,max)
{
	var c = this;
	if(c < min)
		c = min;
	if(c > max)
		c = max;
	return c;
}

// Find an entry in an array. Returns the array index or null
Array.prototype.find = function(item)
{
	for(var t=0; t<this.length; t++)
		if(this[t] == item)
			return t;
	return null;
}

// Return whether an entry exists in an array
Array.prototype.contains = function(item)
{
    return this.find(item) != null;
};

// Return whether one of a list of values exists in an array
Array.prototype.containsAny = function(items)
{
    for(var i=0; i<items.length; i++)
        if (this.contains(items[i]))
            return true;
    return false;
};

// Return wheter all of a list of values exists in an array
Array.prototype.containsAll = function(items)
{
    for (var i = 0; i<items.length; i++)
        if (!this.contains(items[i]))
            return false;
    return true;
};

// Push a new value into an array only if it is not already present in the array. If the optional unique parameter is false, it reverts to a normal push
Array.prototype.pushUnique = function(item,unique)
{
	if(unique != undefined && unique == false)
		this.push(item);
	else
		{
		if(this.find(item) == null)
			this.push(item);
		}
}

// Get characters from the right end of a string
String.prototype.right = function(n)
{
	if(n < this.length)
		return this.slice(this.length-n);
	else
		return this;
}

// Trim whitespace from both ends of a string
String.prototype.trim = function()
{
	return this.replace(/^\s*|\s*$/g,"");
}

// Convert a string from a CSS style property name to a JavaScript style name ("background-color" -> "backgroundColor")
String.prototype.unDash = function()
{
	var s = this.split("-");
	if(s.length > 1)
		for(var t=1; t<s.length; t++)
			s[t] = s[t].substr(0,1).toUpperCase() + s[t].substr(1);
	return s.join("");
}

// Substitute substrings from an array into a format string that includes '%1'-type specifiers
String.prototype.format = function(substrings)
{
	var subRegExp = new RegExp("(?:%(\\d+))","mg");
	var currPos = 0;
	var r = [];
	do {
		var match = subRegExp.exec(this);
		if(match && match[1])
			{
			if(match.index > currPos)
				r.push(this.substring(currPos,match.index));
			r.push(substrings[parseInt(match[1])]);
			currPos = subRegExp.lastIndex;
			}
	} while(match);
	if(currPos < this.length)
		r.push(this.substring(currPos,this.length));
	return r.join("");
}

// Escape any special RegExp characters with that character preceded by a backslash
String.prototype.escapeRegExp = function()
{
	var s = "\\^$*+?()=!|,{}[].";
	var c = this;
	for(var t=0; t<s.length; t++)
		c = c.replace(new RegExp("\\" + s.substr(t,1),"g"),"\\" + s.substr(t,1));
	return c;
}

// Convert & to "&amp;", < to "&lt;", > to "&gt;" and " to "&quot;"
String.prototype.htmlEncode = function()
{
	var regexpAmp = new RegExp("&","mg");
	var regexpLessThan = new RegExp("<","mg");
	var regexpGreaterThan = new RegExp(">","mg");
	var regexpQuote = new RegExp("\"","mg");
	return(this.replace(regexpAmp,"&amp;").replace(regexpLessThan,"&lt;").replace(regexpGreaterThan,"&gt;").replace(regexpQuote,"&quot;"));
}

// Convert "&amp;" to &, "&lt;" to <, "&gt;" to > and "&quot;" to "
String.prototype.htmlDecode = function()
{
	var regexpAmp = new RegExp("&amp;","mg");
	var regexpLessThan = new RegExp("&lt;","mg");
	var regexpGreaterThan = new RegExp("&gt;","mg");
	var regexpQuote = new RegExp("&quot;","mg");
	return(this.replace(regexpLessThan,"<").replace(regexpGreaterThan,">").replace(regexpQuote,"\"").replace(regexpAmp,"&"));
}

// Parse a space-separated string of name:value parameters where:
//   - the name or the value can be optional (and a separate default is used instead)
//     - in case of ambiguity, a lone word is taken to be a value
//   - if both the name and value are present they must be separated by a colon
//   - the name and the value may both be quoted with single- or double-quotes, double-square brackets
//   - names or values quoted with {{double-curly braces}} are evaluated as a JavaScript expression
// The result is an array of objects:
//   result[0] = object with a member for each parameter name, value of that member being an array of values
//   result[1..n] = one object for each parameter, with 'name' and 'value' members
String.prototype.parseParams = function(defaultName,defaultValue,allowEval,noNames)
{
	var parseToken = function(match,p)
		{
		var n;
		if(match[p]) // Double quoted
			n = match[p];
		else if(match[p+1]) // Single quoted
			n = match[p+1];
		else if(match[p+2]) // Double-square-bracket quoted
			n = match[p+2];
		else if(match[p+3]) // Double-brace quoted
			try
				{
				n = match[p+3];
				if(allowEval)
					n = window.eval(n);
				}
			catch(ex)
				{
				throw "Unable to evaluate {{" + match[p+3] + "}}: " + ex.toString();
				}
		else if(match[p+4]) // Unquoted
			n = match[p+4];
		return n;
		};
	var r = [{}];
	var dblQuote = "(?:\"((?:(?:\\\\\")|[^\"])*)\")";
	var sngQuote = "(?:'((?:(?:\\\\\')|[^'])*)')";
	var dblSquare = "(?:\\[\\[((?:\\s|\\S)*?)\\]\\])";
	var dblBrace = "(?:\\{\\{((?:\\s|\\S)*?)\\}\\})";
	var unQuoted = noNames ? "([^\"'\\s]\\S*)" : "([^\"':\\s][^\\s:]*)";
	var skipSpace = "(?:\\s*)";
	var token = "(?:" + dblQuote + "|" + sngQuote + "|" + dblSquare + "|" + dblBrace + "|" + unQuoted + ")";
	var re = noNames
		? new RegExp(token,"mg")
		: new RegExp(skipSpace + token + skipSpace + "(?:(\\:)" + skipSpace + token + "){0,1}","mg");
	var params = [];
	do {
		var match = re.exec(this);
		if(match)
			{
			var n = parseToken(match,1);
			if(noNames)
				r.push({name: "", value: n});
			else
				{
				var v = parseToken(match,7);
				if(v == null && defaultName)
					{
					v = n;
					n = defaultName;
					}
				else if(v == null && defaultValue)
					v = defaultValue;
				r.push({name: n, value: v});
				}
			}
	} while(match);
	// Summarise parameters into first element
	for(var t=1; t<r.length; t++)
		{
		if(r[0][r[t].name])
			r[0][r[t].name].push(r[t].value);
		else
			r[0][r[t].name] = [r[t].value];
		}
	return r;
}

// Process a string list of macro parameters into an array. Parameters can be quoted with "", '',
// [[]], {{ }} or left unquoted (and therefore space-separated). Double-braces {{}} results in
// an *evaluated* parameter: e.g. {{config.options.txtUserName}} results in the current user's name.
String.prototype.readMacroParams = function()
{
	var p = this.parseParams("list",null,true,true);
	var n = [];
	for(var t=1; t<p.length; t++)
		n.push(p[t].value);
	return n;
}

// Process a string list of unique tiddler names into an array. Tiddler names that have spaces in them must be [[bracketed]]
String.prototype.readBracketedList = function(unique)
{
	var p = this.parseParams("list",null,false,true);
	var n = [];
	for(var t=1; t<p.length; t++)
		n.pushUnique(p[t].value,unique);
	return n;
}

// Replace a chunk of a string given start and end markers
String.prototype.replaceChunk = function(start,end,sub)
{
	var s = this.indexOf(start);
	if(s != -1)
		{
		var e = this.indexOf(end,s + start.length);
		if(e != -1)
			return this.substring(0,s + start.length) + sub + this.substring(e);
		}
	return this;
}

// Static method to bracket a string with double square brackets if it contains a space
String.encodeTiddlyLink = function(title)
{
	if(title.indexOf(" ") == -1)
		return(title);
	else
		return("[[" + title + "]]");
}

// Static method to left-pad a string with 0s to a certain width
String.zeroPad = function(n,d)
{
	var s = n.toString();
	if(s.length < d)
		s = "000000000000000000000000000".substr(0,d-s.length) + s;
	return(s);
}

// ---------------------------------------------------------------------------------
// RGB colour object
// ---------------------------------------------------------------------------------

// Construct an RGB colour object from a '#rrggbb', '#rgb' or 'rgb(n,n,n)' string or from separate r,g,b values
function RGB(r,g,b)
{
	this.r = 0;
	this.g = 0;
	this.b = 0;
	if(typeof r == "string")
		{
		if(r.substr(0,1) == "#")
			{
			if(r.length == 7)
				{
				this.r = parseInt(r.substr(1,2),16)/255;
				this.g = parseInt(r.substr(3,2),16)/255;
				this.b = parseInt(r.substr(5,2),16)/255;
				}
			else
				{
				this.r = parseInt(r.substr(1,1),16)/15;
				this.g = parseInt(r.substr(2,1),16)/15;
				this.b = parseInt(r.substr(3,1),16)/15;
				}
			}
		else
			{
			var rgbPattern = /rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/ ;
			var c = r.match(rgbPattern);
			if (c)
				{
				this.r = parseInt(c[1],10)/255;
				this.g = parseInt(c[2],10)/255;
				this.b = parseInt(c[3],10)/255;
				}
			}
		}
	else
		{
		this.r = r;
		this.g = g;
		this.b = b;
		}
	return this;
}

// Mixes this colour with another in a specified proportion
// c = other colour to mix
// f = 0..1 where 0 is this colour and 1 is the new colour
// Returns an RGB object
RGB.prototype.mix = function(c,f)
{
	return new RGB(this.r + (c.r-this.r) * f,this.g + (c.g-this.g) * f,this.b + (c.b-this.b) * f);
}

// Return an rgb colour as a #rrggbb format hex string
RGB.prototype.toString = function()
{
	var r = this.r.clamp(0,1);
	var g = this.g.clamp(0,1);
	var b = this.b.clamp(0,1);
	return("#" + ("0" + Math.floor(r * 255).toString(16)).right(2) +
				 ("0" + Math.floor(g * 255).toString(16)).right(2) +
				 ("0" + Math.floor(b * 255).toString(16)).right(2));
}

// ---------------------------------------------------------------------------------
// Augmented methods for the JavaScript Date() object
// ---------------------------------------------------------------------------------

// Substitute date components into a string
Date.prototype.formatString = function(template)
{
	template = template.replace(/YYYY/g,this.getFullYear());
	template = template.replace(/YY/g,String.zeroPad(this.getFullYear()-2000,2));
	template = template.replace(/MMM/g,config.messages.dates.months[this.getMonth()]);
	template = template.replace(/0MM/g,String.zeroPad(this.getMonth()+1,2));
	template = template.replace(/MM/g,this.getMonth()+1);
	template = template.replace(/DDD/g,config.messages.dates.days[this.getDay()]);
	template = template.replace(/0DD/g,String.zeroPad(this.getDate(),2));
	template = template.replace(/DDth/g,this.getDate()+this.daySuffix());
	template = template.replace(/DD/g,this.getDate());
	template = template.replace(/0hh/g,String.zeroPad(this.getHours(),2));
	template = template.replace(/hh/g,this.getHours());
	template = template.replace(/0mm/g,String.zeroPad(this.getMinutes(),2));
	template = template.replace(/mm/g,this.getMinutes());
	template = template.replace(/0ss/g,String.zeroPad(this.getSeconds(),2));
	template = template.replace(/ss/g,this.getSeconds());
	return template;
}

Date.prototype.daySuffix = function()
{
	var num = this.getDate();
	if (num >= 11 && num <= 13) return "th";
	else if (num.toString().substr(-1)=="1") return "st";
	else if (num.toString().substr(-1)=="2") return "nd";
	else if (num.toString().substr(-1)=="3") return "rd";
	return "th";
}

// Convert a date to local YYYYMMDDHHMM string format
Date.prototype.convertToLocalYYYYMMDDHHMM = function()
{
	return(String.zeroPad(this.getFullYear(),4) + String.zeroPad(this.getMonth()+1,2) + String.zeroPad(this.getDate(),2) + String.zeroPad(this.getHours(),2) + String.zeroPad(this.getMinutes(),2));
}

// Convert a date to UTC YYYYMMDDHHMM string format
Date.prototype.convertToYYYYMMDDHHMM = function()
{
	return(String.zeroPad(this.getUTCFullYear(),4) + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2));
}

// Convert a date to UTC YYYYMMDD.HHMMSSMMM string format
Date.prototype.convertToYYYYMMDDHHMMSSMMM = function()
{
	return(String.zeroPad(this.getUTCFullYear(),4) + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + "." + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2) + String.zeroPad(this.getUTCSeconds(),2) + String.zeroPad(this.getUTCMilliseconds(),4));
}

// Static method to create a date from a UTC YYYYMMDDHHMM format string
Date.convertFromYYYYMMDDHHMM = function(d)
{
	var theDate = new Date(Date.UTC(parseInt(d.substr(0,4),10),
							parseInt(d.substr(4,2),10)-1,
							parseInt(d.substr(6,2),10),
							parseInt(d.substr(8,2),10),
							parseInt(d.substr(10,2),10),0,0));
	return(theDate);
}

// ---------------------------------------------------------------------------------
// DOM utilities - many derived from www.quirksmode.org 
// ---------------------------------------------------------------------------------

function drawGradient(place,horiz,colours)
{
	for(var t=0; t<= 100; t+=2)
		{
		var bar = document.createElement("div");
		place.appendChild(bar);
		bar.style.position = "absolute";
		bar.style.left = horiz ? t + "%" : 0;
		bar.style.top = horiz ? 0 : t + "%";
		bar.style.width = horiz ? (101-t) + "%" : "100%";
		bar.style.height = horiz ? "100%" : (101-t) + "%";
		bar.style.zIndex = -1;
		var f = t/100;
		var p = f*(colours.length-1);
		bar.style.backgroundColor = colours[Math.floor(p)].mix(colours[Math.ceil(p)],p-Math.floor(p)).toString();
		}
}

function createTiddlyText(theParent,theText)
{
	return theParent.appendChild(document.createTextNode(theText));
}

function createTiddlyElement(theParent,theElement,theID,theClass,theText)
{
	var e = document.createElement(theElement);
	if(theClass != null)
		e.className = theClass;
	if(theID != null)
		e.setAttribute("id",theID);
	if(theText != null)
		e.appendChild(document.createTextNode(theText));
	if(theParent != null)
		theParent.appendChild(e);
	return(e);
}

// Add an event handler
// Thanks to John Resig, via QuirksMode
function addEvent(obj,type,fn)
{
	if(obj.attachEvent)
		{
		obj['e'+type+fn] = fn;
		obj[type+fn] = function(){obj['e'+type+fn](window.event);}
		obj.attachEvent('on'+type,obj[type+fn]);
		}
	else
		obj.addEventListener(type,fn,false);
}

// Remove  an event handler
// Thanks to John Resig, via QuirksMode
function removeEvent(obj,type,fn)
{
	if(obj.detachEvent)
		{
		obj.detachEvent('on'+type,obj[type+fn]);
		obj[type+fn] = null;
		}
	else
		obj.removeEventListener(type,fn,false);
}

function addClass(e,theClass)
{
	removeClass(e,theClass);
	e.className += " " + theClass;
}

function removeClass(e,theClass)
{
	var newClass = [];
	var currClass = e.className.split(" ");
	for(var t=0; t<currClass.length; t++)
		if(currClass[t] != theClass)
			newClass.push(currClass[t]);
	e.className = newClass.join(" ");
}

function hasClass(e,theClass)
{
	var c = e.className;
	if(c)
		{
		c = c.split(" ");
		for(var t=0; t<c.length; t++)
			if(c[t] == theClass)
				return true;
		}
	return false;
}

// Resolve the target object of an event
function resolveTarget(e)
{
	var obj;
	if (e.target)
		obj = e.target;
	else if (e.srcElement)
		obj = e.srcElement;
	if (obj.nodeType == 3) // defeat Safari bug
		obj = obj.parentNode;
	return(obj);
}

// Return the content of an element as plain text with no formatting
function getPlainText(e)
{
	var text = "";
	if(e.innerText)
		text = e.innerText;
	else if(e.textContent)
		text = e.textContent;
	return text;
}

// Get the scroll position for window.scrollTo necessary to scroll a given element into view
function ensureVisible(e)
{
	var posTop = findPosY(e);
	var posBot = posTop + e.offsetHeight;
	var winTop = findScrollY();
	var winHeight = findWindowHeight();
	var winBot = winTop + winHeight;
	if(posTop < winTop)
		return(posTop);
	else if(posBot > winBot)
		{
		if(e.offsetHeight < winHeight)
			return(posTop - (winHeight - e.offsetHeight));
		else
			return(posTop);
		}
	else
		return(winTop);
}

// Get the current width of the display window
function findWindowWidth()
{
	return(window.innerWidth ? window.innerWidth : document.documentElement.clientWidth);
}

// Get the current height of the display window
function findWindowHeight()
{
	return(window.innerHeight ? window.innerHeight : document.documentElement.clientHeight);
}

// Get the current horizontal page scroll position
function findScrollX()
{
	return(window.scrollX ? window.scrollX : document.documentElement.scrollLeft);
}

// Get the current vertical page scroll position
function findScrollY()
{
	return(window.scrollY ? window.scrollY : document.documentElement.scrollTop);
}

function findPosX(obj)
{
	var curleft = 0;
	while (obj.offsetParent)
		{
		curleft += obj.offsetLeft;
		obj = obj.offsetParent;
		}
	return curleft;
}

function findPosY(obj)
{
	var curtop = 0;
	while (obj.offsetParent)
		{
		curtop += obj.offsetTop;
		obj = obj.offsetParent;
		}
	return curtop;
}

// Blur a particular element
function blurElement(e)
{
	if(e != null && e.focus && e.blur)
		{
		e.focus();
		e.blur();
		}
}

// Create a non-breaking space
function insertSpacer(place)
{
	var e = document.createTextNode(String.fromCharCode(160));
	if(place)
		place.appendChild(e);
	return e;
}

// Remove all children of a node
function removeChildren(e)
{
	while(e.hasChildNodes())
		e.removeChild(e.firstChild);
}

// Add a stylesheet, replacing any previous custom stylesheet
function setStylesheet(s,id)
{
	if(!id)
		id = "customStyleSheet";
	var n = document.getElementById(id);
	if(document.createStyleSheet) // Test for IE's non-standard createStyleSheet method
		{
		if(n)
			n.parentNode.removeChild(n);
		// This failed without the &nbsp;
		document.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd","&nbsp;<style id='" + id + "'>" + s + "</style>");
		}
	else
		{
		if(n)
			n.replaceChild(document.createTextNode(s),n.firstChild);
		else
			{
			var n = document.createElement("style");
			n.type = "text/css";
			n.id = id;
			n.appendChild(document.createTextNode(s));
			document.getElementsByTagName("head")[0].appendChild(n);
			}
		}
}

// ---------------------------------------------------------------------------------
// End of scripts
// ---------------------------------------------------------------------------------

</script>
<style type="text/css">

#saveTest {
	display: none;
}

.zoomer {
	display: none;
}

#messageArea {
	display: none;
}

#storeArea, #copyright {
	display: none;
}

.popup {
	position: absolute;
}

</style>
<noscript>
<style type="text/css">

#storeArea {
	display: block;
	margin: 4em 10em 3em;
}

#storeArea div {
 padding: 0.5em;
 margin: 1em 0em 0em 0em;
 border-color: #f0f0f0 #606060 #404040 #d0d0d0; 
 border-style: solid; 
 border-width: 2px;
 overflow: auto;
}

#javascriptWarning {
	width: 100%;
	text-align: center;
	font-weight: bold;
	background-color: #dd1100;
	color: #fff;
	padding:1em 0em; 
}

</style>
</noscript>
<!--POST-HEAD-START-->

<!--POST-HEAD-END-->
</head>
<body onload="main();" onunload="if(window.checkUnsavedChanges) checkUnsavedChanges();" onbeforeunload="if(window.confirmExit) return confirmExit();">
<!--PRE-BODY-START-->

<!--PRE-BODY-END-->
	<script>
	if (detectPlugin("TiddlyWiki Saver"))
		{
		document.write('<embed style="display: none" name="tiddlyWikiSafariSaver" width="0" height="0" type="application/x-webkit-tiddlywiki-saver"></embed>'); 
		saveUsingSafari = true;
		}
	</script>
	<div id="copyright">
	Welcome to TiddlyWiki by Jeremy Ruston, Copyright &copy; 2005 Osmosoft Limited
	</div>
	<noscript>
		<div id="javascriptWarning">This page requires JavaScript to function properly</div>
	</noscript>
	<div id="saveTest"></div>
	<div id="contentWrapper"></div>
	<div id="contentStash"></div>
	<div id="storeArea"><div tiddler="AutoClear Message" modifier="Saq" modified="200606031754" created="200606031341" tags="systemConfig excludeLists">window.oldDisplayMessage = displayMessage;\ndisplayMessage = function (text,linkText)\n{ oldDisplayMessage(text,linkText);\nsetTimeout( 'clearMessage()', 5000 );\n}</div>
<div tiddler="BackupTweaks" modifier="Saq" modified="200604171220" created="200604162146" tags="systemConfigz excludeLists MovieManagerTiddlers">/***\n|''Name:''|AlternateBackupPlugin|\n|''Version:''|1.0.1 (3-Mar-2006)|\n|''Source:''||\n|''Author:''|KyleHale|\n|''Type:''|Plugin|\n!Description\nHijacks core backupPath function, replacing the datetime naming system\nwith a rotating set of backups, whose number is limited by the user.\n\n!Issues/Todos\n* Possible to insert an option into the AdvancedOptions Tiddler? That'd\nmake editing the number of backups that much easier.\n\n!Revision History\n* 1.0.1 (3-Mar-2006)\n** Wrote code, totally stole [[Simon|SimonBaird]]'s documentation\nsystem\n\n!Code\n***/\n//{{{\nconfig.options.txtBackupFolder = &quot;twBackups&quot;;\n\nif (!config.options.txtMaxBackups) config.options.txtMaxBackups=&quot;10&quot;;\nif (!config.options.txtCurrentBackup)\nconfig.options.txtCurrentBackup=&quot;1&quot;;\n\ngetBackupPath = function(localPath)\n{\n var backSlash = true;\n var dirPathPos = localPath.lastIndexOf(&quot;\s\s&quot;);\n if(dirPathPos == -1)\n {\n dirPathPos = localPath.lastIndexOf(&quot;/&quot;);\n backSlash = false;\n }\n var backupFolder = config.options.txtBackupFolder;\n if(!backupFolder || backupFolder == &quot;&quot;)\n backupFolder = &quot;.&quot;;\n var backupPath = localPath.substr(0,dirPathPos) + (backSlash ? &quot;\s\s&quot; :\n&quot;/&quot;) + backupFolder + localPath.substr(dirPathPos);\n backupNum = config.options[&quot;txtCurrentBackup&quot;];\n backupNum++;\n if (backupNum&gt;config.options[&quot;txtMaxBackups&quot;]) {\n backupNum=1;\n }\n backupPath = backupPath.substr(0,backupPath.lastIndexOf(&quot;.&quot;)) + &quot;.&quot; +\nbackupNum + &quot;.html&quot;;\n config.options[&quot;txtCurrentBackup&quot;]=backupNum;\n saveOptionCookie(&quot;txtCurrentBackup&quot;);\n return backupPath;\n}\n\n//}}}</div>
<div tiddler="CSS-movietable" modifier="Saq" modified="200604171220" created="200603080743" tags="excludeLists MovieManagerTiddlers">/***\n&lt;!--.movietable {text-align: right;}--&gt;\n***/\n/*{{{*/\n\n.movietable, .movietable td, .movietable tr, .movietable th,\n.movietable tbody\n { border:0px solid #000 } \n\n.movietable table {border:1px solid #3A4856}\n\n\n\n/*the margin auto for both sides, below, centers the table*/\n.movietable table {font: 100% &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, &quot;Trebuchet MS&quot;, sans-serif; padding: 0; border-spacing:0; margin:0 auto; border-collapse: separate; color: #333; background: #F9FAFC; text-align: left;}\n\n.movietable table a, .movietable table a:visited {color: #3A4856; text-decoration: none;}\n\n.movietable table a:hover {color: #000; background: transparent; border-bottom: 1px solid #3A4856;}\n\n\n\n\n.movietable table caption {font: 150% &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, &quot;Trebuchet MS&quot;, sans-serif; margin: 0 auto; background: #3A4856; padding: 12px 10px 4px 10px; color: #FFFFFF; }\n\n.movietable table thead th, .movietable table tbody th {background: #3A4856; padding: 10px 13px 15px 13px; color: #FFFFFF; font-weight: bold; font-size: 100%; text-align: center;}\n\n.movietable table thead th a, .movietable table thead th a:visited{color: #FFFFFF; background: transparent; text-decoration:none; border-bottom: 0px;}\n\n.movietable table thead th a:hover{color: #FFFFFF; background: transparent; text-decoration:none;}\n\n.movietable table tbody, .movietable table thead {border-left: 1px solid #EAECEE; border-right: 1px solid #EAECEE;}\n\n.movietable table tbody, .movietable tbody {border-bottom: 1px solid #EAECEE !important;}\n\n.movietable table tbody td, .movietable table tbody th {padding: 10px; background: url(&quot;http://strony.aster.pl/drsaq/td_back.gif&quot;) repeat-x;}\n\n.movietable table tbody td {padding: 10px 14px;}\n\n.movietable table tbody tr:hover td,\n.movietable table tbody tr:hover th {\n border-top: 1px solid !important; border-bottom:1px solid !important;\n border-color:#3A4856; !important;\n }\n\n.movietable tbody td,\n.movietable tbody th {\n border:1px solid #F3F5F7;\n border-width:1px 0; !important;\n }\n\n.movietable tbody tr.oddRow td {\n border:1px solid #F0F2F4;\n border-width:1px 0; !important;\n }\n\n.movietable table tbody th a, .movietable table tbody th a:visited{color: #FFFFFF; background: transparent; text-decoration:none; border-bottom: 0px}\n\n.movietable table tbody th a:hover{color: #FFFFFF; background: transparent; text-decoration:underline;}\n\n.movietable table tbody tr {background: #F9FAFC;}\n\n.movietable table tbody tr.oddRow {background: #F0F2F4;}\n\n.movietable table tbody tr:hover {background: #EAECEE; color: #111;}\n\n.movietable table tfoot td, .movietable table tfoot th, .movietable table tfoot tr {font: 120% &quot;Lucida Grande&quot;, &quot;Lucida Sans Unicode&quot;, &quot;Trebuchet MS&quot;, sans-serif; text-transform: uppercase; background: #fff; padding: 10px;}\n/*}}}*/</div>
<div tiddler="ChangeLog" modifier="Saq" modified="200606031802" created="200602242217" tags="">updated moviemanager (incomplete) with click for movierating\n        return false if no rating entered, or cancelled.\n\nupdated sortit macro\n\nsetRating\n\nupdated addremove tag\n\n\nupdated moviemanger tab tiddlers with set rating\n\nupdated paramifier\n\nupdated movie tools\ntabtimeline\ntimelinehack\nautoclear message\nDropTags\nViewTemplate\nTabEditPlugin</div>
<div tiddler="CheckboxPlugin" modifier="Saq" modified="200604171220" created="200602251704" tags="systemConfig excludeLists MovieManagerTiddlers">/***\n''CheckboxPlugin for TiddlyWiki version 2.0''\n^^author: Eric Shulman\nsource: http://www.TiddlyTools.com/#CheckboxPlugin \nlicense: [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]^^\n\nAdd checkboxes to your tiddler content. Checkbox states can be preserved in the document by either automatically modifying the tiddler content or setting/removing tags on specified tiddlers, or they may be saved as local cookies by assigning an optional 'chkID' to the checkbox. Add custom javascript for programmatic initialization and onClick handling for any checkbox. Also provides access to checkbox DOM element data and tracks the checkbox state in TiddlyWiki's config.options[] internal data.\n\n!!!!!Usage\n&lt;&lt;&lt;\nThe checkbox syntax, including all optional parameters, is contained inside a matched set of [ and ] brackets.\n{{{ [x=id(title:tag){init_script}{onclick_script}] }}}\n\nAn alternative syntax lets you place the optional parameters ''outside'' the [ and ] brackets, and is provided for backward-compatibility with existing content that may include checkbox definitions based on earlier releases of this plugin:\n{{{ [x]=id(title:tag){init_script}{onclick_script} }}}\n\n//{{{\n[ ]or[_] and [x]or[X]\n//}}}\nSimple checkboxes. The current unchecked/checked state is indicated by the character between the {{{[}}} and {{{]}}} brackets (&quot;_&quot; means unchecked, &quot;X&quot; means checked). When you click on a checkbox, the current state is retained by directly modifying the tiddler content to place the corresponding &quot;_&quot; or &quot;X&quot; character in between the brackets\n//{{{\n[x=id]\n//}}}\nAssign an optional ID to the checkbox so you can use {{{document.getElementByID(&quot;id&quot;)}}} to manipulate the checkbox DOM element, as well as tracking the current checkbox state in {{{config.options[&quot;id&quot;]}}}. If the ID starts with &quot;chk&quot; the checkbox state will also be saved in a cookie, so it can be automatically restored whenever the checkbox is re-rendered (overrides any default {{{[x]}}} or {{{[_]}}} value). If a cookie value is kept, the &quot;_&quot; or &quot;X&quot; character in the tiddler content remains unchanged, and is only applied as the default when a cookie-based value is not currently defined.\n//{{{\n[x(title:tag)]\n//}}}\nInitializes and tracks the current checkbox state by setting or removing (&quot;TogglyTagging&quot;) a particular tag value from a specified tiddler. If you omit the tiddler title (and the &quot;:&quot; separator), the specified tag is assigned to the current tiddler. If you omit the tag value, as in {{{(title:)}}}, the default tag, {{{checked}}}, is assumed. Omitting both the title and tag, {{{()}}}, tracks the checkbox state by setting the &quot;checked&quot; tag on the current tiddler. When tag tracking is used, the &quot;_&quot; or &quot;X&quot; character in the tiddler content remains unchanged, and is not used to set or track the checkbox state. If a tiddler title named in the tag does not exist, the checkbox state defaults to //unselected//. When the checkbox is subsequently changed to //selected//, it will automatically (and silently) create the missing tiddler and then add the tag to it.\n//{{{\n[x{javascript}{javascript}]\n//}}}\nYou can define optional javascript code segments to add custom initialization and/or 'onClick' handling to a checkbox. The current checkbox state (and it's other DOM attributes) can be set or read from within these code segments by reference to the default context-object, 'this'.\n\nThe first code segment will be executed when the checkbox is initially displayed, so that you can programmatically determine it's starting checked/unchecked state. The second code segment (if present) is executed whenever the checkbox is clicked, so that you can perform programmed responses or intercept and override the checkbox state based on complex logic using the TW core API or custom functions defined in plugins (e.g. testing a particular tiddler title to see if certain tags are set or setting some tags when the checkbox is clicked).\n\nNote: if you want to use the default checkbox initialization processing with a custom onclick function, use this syntax: {{{ [x=id{}{javascript}] }}} \n&lt;&lt;&lt;\n!!!!!Configuration\n&lt;&lt;&lt;\nNormally, when a checkbox state is changed, the affected tiddlers are automatically re-rendered, so that any checkbox-dependent dynamic content can be updated. There are three possible tiddlers to be re-rendered, depending upon where the checkbox is placed, and what kind of storage method it is using.\n*''container'': the tiddler in which the checkbox is displayed. (e.g., this tiddler)\n*''tagged'': the tiddler that is being tagged (e.g., &quot;~MyTask&quot; when tagging &quot;~MyTask:done&quot;)\n*''tagging'': the &quot;tag tiddler&quot; (e.g., &quot;~done&quot; when tagging &quot;~MyTask:done&quot;)\nYou can set the default refresh handling for all checkboxes in your document by using the following javascript syntax either in a systemConfig plugin, or as an inline script. (Substitute true/false values as desired):\n{{{config.checkbox.refresh = { tagged:true, tagging:true, container:true };}}}\n\nYou can also override these defaults for any given checkbox by using an initialization function to set one or more of the refresh options. For example:\n{{{[_{this.refresh.container=false}]}}}\n&lt;&lt;&lt;\n!!!!!Examples\n&lt;&lt;&lt;\n//{{{\n[X] label\n[_] label\n//}}}\n&gt;checked and unchecked static default values\n&gt;[X] label\n&gt;[_] label\n//{{{\n[_=demo] label\n//}}}\n&gt;document-based value (id='demo', no cookie)\n&gt;[_=demo] label\n//{{{\n[_=chkDemo] label\n//}}}\n&gt;cookie-based value (id='chkDemo')\n&gt;[_=chkDemo] label\n//{{{\n[_(CheckboxPlugin:demotag)]\n[_(CheckboxPlugin:demotag){this.refresh.tagged=this.refresh.container=false}]\n//}}}\n&gt;tag-based value (TogglyTagging)\n&gt;[_(CheckboxPlugin:demotag)] toggle 'demotag' (and refresh tiddler display)\n&gt;[_(CheckboxPlugin:demotag){this.refresh.tagged=this.refresh.container=false}] toggle 'demotag' (no refresh)\n&gt;current tags: &lt;script&gt;return store.getTiddler(story.findContainingTiddler(place).id.substr(7)).tags.toString();&lt;/script&gt;\n&gt;&lt;script label=&quot;click to view current tags&quot;&gt;alert(store.getTiddler(story.findContainingTiddler(place).id.substr(7)).tags.toString());&lt;/script&gt;\n//{{{\n[X{this.checked=true}{alert(this.checked?&quot;on&quot;:&quot;off&quot;)}] message box with checkbox state\n//}}}\n&gt;custom init and onClick functions\n&gt;[X{this.checked=true}{alert(this.checked?&quot;on&quot;:&quot;off&quot;)}] message box with checkbox state\nRetrieving option values:\nconfig.options['demo']=&lt;script&gt;return config.options['demo']?&quot;true&quot;:&quot;false&quot;;&lt;/script&gt;\nconfig.options['chkDemo']=&lt;script&gt;return config.options['chkDemo']?&quot;true&quot;:&quot;false&quot;;&lt;/script&gt;\n\n!!!!!Installation\nimport (or copy/paste) the following tiddlers into your document:\n''CheckboxPlugin'' (tagged with &lt;&lt;tag systemConfig&gt;&gt;)\n&lt;&lt;&lt;\n!!!!!Revision History\n&lt;&lt;&lt;\n2006.02.25 - 2.1.0\nadded configuration options to enable/disable forced refresh of tiddlers when toggling tags\n\n2006.02.23 - 2.0.4\nwhen toggling tags, force refresh of the tiddler containing the checkbox.\n\n2006.02.23 - 2.0.3\nwhen toggling tags, force refresh of the 'tagged tiddler' so that tag-related tiddler content (such as &quot;to-do&quot; lists) can be re-rendered.\n\n2006.02.23 - 2.0.2\nwhen using tag-based storage, allow use [[ and ]] to quote tiddler or tag names that contain spaces:\n&quot;&quot;&quot;[x([[Tiddler with spaces]]:[[tag with spaces]])]&quot;&quot;&quot;\n\n2006.01.10 - 2.0.1\nwhen toggling tags, force refresh of the 'tagging tiddler'. For example, if you toggle the &quot;systemConfig&quot; tag on a plugin, the corresponding &quot;systemConfig&quot; TIDDLER will be automatically refreshed (if currently displayed), so that the 'tagged' list in that tiddler will remain up-to-date.\n\n2006.01.04 - 2.0.0\nupdate for ~TW2.0\n\n2005.12.27 - 1.1.2\nFix lookAhead regExp handling for &quot;&quot;&quot;[x=id]&quot;&quot;&quot;, which had been including the &quot;]&quot; in the extracted ID. \nAdded check for &quot;chk&quot; prefix on ID before calling saveOptionCookie()\n\n2005.12.26 - 1.1.2\nCorrected use of toUpperCase() in tiddler re-write code when comparing &quot;&quot;&quot;[X]&quot;&quot;&quot; in tiddler content with checkbox state. Fixes a problem where simple checkboxes could be set, but never cleared.\n\n2005.12.26 - 1.1.0\nRevise syntax so all optional parameters are included INSIDE the [ and ] brackets. Backward compatibility with older syntax is supported, so content changes are not required when upgrading to the current version of this plugin. Based on a suggestion by GeoffSlocock\n\n2005.12.25 - 1.0.0\nadded support for tracking checkbox state using tags (&quot;TogglyTagging&quot;)\nRevised version number for official post-beta release.\n\n2005.12.08 - 0.9.3\nsupport separate 'init' and 'onclick' function definitions.\n\n2005.12.08 - 0.9.2\nclean up lookahead pattern\n\n2005.12.07 - 0.9.1\nonly update tiddler source content if checkbox state is actually different. Eliminates unnecessary tiddler changes (and 'unsaved changes' warnings)\n\n2005.12.07 - 0.9.0\ninitial BETA release\n&lt;&lt;&lt;\n!!!!!Credits\n&lt;&lt;&lt;\nThis feature was created by EricShulman from [[ELS Design Studios|http:/www.elsdesign.com]]\n&lt;&lt;&lt;\n!!!!!Code\n***/\n//{{{\nversion.extensions.CheckboxPlugin = {major: 2, minor: 1, revision:0 , date: new Date(2006,2,25)};\n//}}}\n\n// // 1.2.x compatibility\n//{{{\nif (!window.story) window.story=window;\nif (!store.getTiddler) store.getTiddler=function(title){return store.tiddlers[title]}\nif (!store.addTiddler) store.addTiddler=function(tiddler){store.tiddlers[tiddler.title]=tiddler}\nif (!store.deleteTiddler) store.deleteTiddler=function(title){delete store.tiddlers[title]}\n//}}}\n\n//{{{\nconfig.checkbox = { refresh: { tagged:true, tagging:true, container:true } };\nconfig.formatters.push( {\n name: &quot;checkbox&quot;,\n match: &quot;\s\s[[xX_ ][\s\s]\s\s=\s\s(\s\s{]&quot;,\n lookahead: &quot;\s\s[([xX_ ])(\s\s])?(=[^\s\ss\s\s(\s\s]{]+)?(\s\s([^\s\s)]*\s\s))?({[^}]*})?({[^}]*})?(\s\s])?&quot;,\n handler: function(w)\n {\n var lookaheadRegExp = new RegExp(this.lookahead,&quot;mg&quot;);\n lookaheadRegExp.lastIndex = w.matchStart;\n var lookaheadMatch = lookaheadRegExp.exec(w.source)\n if(lookaheadMatch &amp;&amp; lookaheadMatch.index == w.matchStart)\n {\n // get params\n var checked=lookaheadMatch[1];\n var id=lookaheadMatch[3];\n var tag=lookaheadMatch[4];\n var fn_init=lookaheadMatch[5];\n var fn_click=lookaheadMatch[6];\n // create checkbox element\n var c = document.createElement(&quot;input&quot;);\n c.setAttribute(&quot;type&quot;,&quot;checkbox&quot;);\n c.onclick=onClickCheckbox;\n c.srcpos=w.matchStart+1; // remember location of &quot;X&quot;\n c.container=story.findContainingTiddler(w.output).id.substr(7); // tiddler containing checkbox\n c.refresh = { };\n c.refresh.container=config.checkbox.refresh.container;\n c.refresh.tagged=config.checkbox.refresh.tagged;\n c.refresh.tagging=config.checkbox.refresh.tagging;\n w.output.appendChild(c);\n // set default state\n c.checked=(checked.toUpperCase()==&quot;X&quot;);\n // get/set state by ID\n if (id) {\n c.id=id.substr(1); // trim off leading &quot;=&quot;\n if (config.options[c.id]!=undefined)\n c.checked=config.options[c.id];\n else\n config.options[c.id]=c.checked;\n }\n // get/set state by tag\n if (tag) {\n c.tiddler=c.container;\n c.tag=tag.substr(1,tag.length-2).trim(); // trim off parentheses\n var pos=c.tag.indexOf(&quot;:&quot;);\n if (pos==0) { c.tag=tag.substr(1); }\n if (pos&gt;0) { c.tiddler=c.tag.substr(0,pos).replace(/\s[\s[/g,&quot;&quot;).replace(/\s]\s]/g,&quot;&quot;); c.tag=c.tag.substr(pos+1); }\n c.tag.replace(/\s[\s[/g,&quot;&quot;).replace(/\s]\s]/g,&quot;&quot;);\n if (!c.tag.length) c.tag=&quot;checked&quot;;\n var t=store.getTiddler(c.tiddler);\n c.checked = (t &amp;&amp; t.tags)?(t.tags.find(c.tag)!=null):false;\n }\n if (fn_init) c.fn_init=fn_init.trim().substr(1,fn_init.length-2); // trim off surrounding { and } delimiters\n if (fn_click) c.fn_click=fn_click.trim().substr(1,fn_click.length-2);\n c.init=true; c.onclick(); c.init=false; // compute initial state and save in tiddler/config/cookie\n w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;\n }\n }\n }\n)\n//}}}\n\n//{{{\nfunction onClickCheckbox()\n{\n if (this.fn_init)\n // custom function hook to set initial state (run only once)\n { try { eval(this.fn_init); this.fn_init=null; } catch(e) { displayMessage(&quot;Checkbox init error: &quot;+e.toString()); } }\n else if (this.fn_click)\n // custom function hook to override or react to changes in checkbox state\n { try { eval(this.fn_click) } catch(e) { displayMessage(&quot;Checkbox click error: &quot;+e.toString()); } }\n if (this.id)\n // save state in config AND cookie (only when ID starts with 'chk')\n { config.options[this.id]=this.checked; if (this.id.substr(0,3)==&quot;chk&quot;) saveOptionCookie(this.id); }\n if ((!this.id || this.id.substr(0,3)!=&quot;chk&quot;) &amp;&amp; !this.tag) {\n // save state in tiddler content only if not using cookie or tag tracking\n var t=store.getTiddler(story.findContainingTiddler(this).id.substr(7));\n if (this.checked!=(t.text.substr(this.srcpos,1).toUpperCase()==&quot;X&quot;)) { // if changed\n t.set(null,t.text.substr(0,this.srcpos)+(this.checked?&quot;X&quot;:&quot;_&quot;)+t.text.substr(this.srcpos+1),null,null,t.tags);\n store.setDirty(true);\n }\n }\n if (this.tag) {\n var t=store.getTiddler(this.tiddler);\n if (!t) { t=(new Tiddler()); t.set(this.tiddler,&quot;&quot;,config.options.txtUserName,(new Date()),null); store.addTiddler(t); } \n var tagged=(t.tags &amp;&amp; t.tags.find(this.tag)!=null);\n if (this.checked &amp;&amp; !tagged) { t.tags.push(this.tag); store.setDirty(true); }\n if (!this.checked &amp;&amp; tagged) { t.tags.splice(t.tags.find(this.tag),1); store.setDirty(true); }\n // if tag state has been changed, force a display update\n if (this.checked!=tagged) {\n if (this.refresh.tagged) story.refreshTiddler(this.tiddler,null,true); // the TAGGED tiddler\n if (this.refresh.tagging) story.refreshTiddler(this.tag,null,true); // the TAGGING tiddler\n }\n }\n // refresh containing tiddler (but not during initial rendering, or we get an infinite loop!)\n if (!this.init &amp;&amp; this.refresh.container &amp;&amp; this.container!=this.tiddler)\n story.refreshTiddler(this.container,null,true); // the tiddler CONTAINING the checkbox\n return true;\n}\n//}}}</div>
<div tiddler="CheckboxRefreshConfig" modifier="Saq" modified="200604171220" created="200602252156" tags="systemConfig excludeLists MovieManagerTiddlers">config.checkbox.refresh = { tagged:true, tagging:true, container:false };</div>
<div tiddler="DataTiddlerPlugin" modifier="Saq" modified="200604172150" created="200604172150" tags="systemConfig excludeLists MovieManagerTiddlers">/***\n|''Name:''|DataTiddlerPlugin|\n|''Version:''|1.0.4 (2006-02-05)|\n|''Source:''|http://tiddlywiki.abego-software.de/#DataTiddlerPlugin|\n|''Author:''|UdoBorkowski (ub [at] abego-software [dot] de)|\n|''Licence:''|[[BSD open source license]]|\n|''TiddlyWiki:''|1.2.38+, 2.0|\n|''Browser:''|Firefox 1.0.4+; InternetExplorer 6.0|\n!Description\nEnhance your tiddlers with structured data (such as strings, booleans, numbers, or even arrays and compound objects) that can be easily accessed and modified through named fields (in JavaScript code).\n\nSuch tiddler data can be used in various applications. E.g. you may create tables that collect data from various tiddlers. \n\n''//Example: &quot;Table with all December Expenses&quot;//''\n{{{\n&lt;&lt;forEachTiddler\n where\n 'tiddler.tags.contains(&quot;expense&quot;) &amp;&amp; tiddler.data(&quot;month&quot;) == &quot;Dec&quot;'\n write\n '&quot;|[[&quot;+tiddler.title+&quot;]]|&quot;+tiddler.data(&quot;descr&quot;)+&quot;| &quot;+tiddler.data(&quot;amount&quot;)+&quot;|\sn&quot;'\n&gt;&gt;\n}}}\n//(This assumes that expenses are stored in tiddlers tagged with &quot;expense&quot;.)//\n&lt;&lt;forEachTiddler\n where\n 'tiddler.tags.contains(&quot;expense&quot;) &amp;&amp; tiddler.data(&quot;month&quot;) == &quot;Dec&quot;'\n write\n '&quot;|[[&quot;+tiddler.title+&quot;]]|&quot;+tiddler.data(&quot;descr&quot;)+&quot;| &quot;+tiddler.data(&quot;amount&quot;)+&quot;|\sn&quot;'\n&gt;&gt;\nFor other examples see DataTiddlerExamples.\n\n\n\n\n''Access and Modify Tiddler Data''\n\nYou can &quot;attach&quot; data to every tiddler by assigning a JavaScript value (such as a string, boolean, number, or even arrays and compound objects) to named fields. \n\nThese values can be accessed and modified through the following Tiddler methods:\n|!Method|!Example|!Description|\n|{{{data(field)}}}|{{{t.data(&quot;age&quot;)}}}|Returns the value of the given data field of the tiddler. When no such field is defined or its value is undefined {{{undefined}}} is returned.|\n|{{{data(field,defaultValue)}}}|{{{t.data(&quot;isVIP&quot;,false)}}}|Returns the value of the given data field of the tiddler. When no such field is defined or its value is undefined the defaultValue is returned.|\n|{{{data()}}}|{{{t.data()}}}|Returns the data object of the tiddler, with a property for every field. The properties of the returned data object may only be read and not be modified. To modify the data use DataTiddler.setData(...) or the corresponding Tiddler method.|\n|{{{setData(field,value)}}}|{{{t.setData(&quot;age&quot;,42)}}}|Sets the value of the given data field of the tiddler to the value. When the value is {{{undefined}}} the field is removed.|\n|{{{setData(field,value,defaultValue)}}}|{{{t.setData(&quot;isVIP&quot;,flag,false)}}}|Sets the value of the given data field of the tiddler to the value. When the value is equal to the defaultValue no value is set (and the field is removed).|\n\nAlternatively you may use the following functions to access and modify the data. In this case the tiddler argument is either a tiddler or the name of a tiddler.\n|!Method|!Description|\n|{{{DataTiddler.getData(tiddler,field)}}}|Returns the value of the given data field of the tiddler. When no such field is defined or its value is undefined {{{undefined}}} is returned.|\n|{{{DataTiddler.getData(tiddler,field,defaultValue)}}}|Returns the value of the given data field of the tiddler. When no such field is defined or its value is undefined the defaultValue is returned.|\n|{{{DataTiddler.getDataObject(tiddler)}}}|Returns the data object of the tiddler, with a property for every field. The properties of the returned data object may only be read and not be modified. To modify the data use DataTiddler.setData(...) or the corresponding Tiddler method.|\n|{{{DataTiddler.setData(tiddler,field,value)}}}|Sets the value of the given data field of the tiddler to the value. When the value is {{{undefined}}} the field is removed.|\n|{{{DataTiddler.setData(tiddler,field,value,defaultValue)}}}|Sets the value of the given data field of the tiddler to the value. When the value is equal to the defaultValue no value is set (and the field is removed).|\n//(For details on the various functions see the detailed comments in the source code.)//\n\n\n''Data Representation in a Tiddler''\n\nThe data of a tiddler is stored as plain text in the tiddler's content/text, inside a &quot;data&quot; section that is framed by a {{{&lt;data&gt;...&lt;/data&gt;}}} block. Inside the data section the information is stored in the [[JSON format|http://www.crockford.com/JSON/index.html]]. \n\n//''Data Section Example:''//\n{{{\n&lt;data&gt;{&quot;isVIP&quot;:true,&quot;user&quot;:&quot;John Brown&quot;,&quot;age&quot;:34}&lt;/data&gt;\n}}}\n\nThe data section is not displayed when viewing the tiddler (see also &quot;The showData Macro&quot;).\n\nBeside the data section a tiddler may have all kind of other content.\n\nTypically you will not access the data section text directly but use the methods given above. Nevertheless you may retrieve the text of the data section's content through the {{{DataTiddler.getDataText(tiddler)}}} function.\n\n\n''Saving Changes''\n\nThe &quot;setData&quot; methods respect the &quot;ForceMinorUpdate&quot; and &quot;AutoSave&quot; configuration values. I.e. when &quot;ForceMinorUpdate&quot; is true changing a value using setData will not affect the &quot;modifier&quot; and &quot;modified&quot; attributes. With &quot;AutoSave&quot; set to true every setData will directly save the changes after a setData.\n\n\n''Notifications''\n\nNo notifications are sent when a tiddler's data value is changed through the &quot;setData&quot; methods. \n\n''Escape Data Section''\nIn case that you want to use the text {{{&lt;data&gt;}}} or {{{&lt;/data&gt;}}} in a tiddler text you must prefix the text with a tilde ('~'). Otherwise it may be wrongly considered as the data section. The tiddler text {{{~&lt;data&gt;}}} is displayed as {{{&lt;data&gt;}}}.\n\n\n''The showData Macro''\n\nBy default the data of a tiddler (that is stored in the {{{&lt;data&gt;...&lt;/data&gt;}}} section of the tiddler) is not displayed. If you want to display this data you may used the {{{&lt;&lt;showData ...&gt;&gt;}}} macro:\n\n''Syntax:'' \n|&gt;|{{{&lt;&lt;}}}''showData '' [''JSON''] [//tiddlerName//] {{{&gt;&gt;}}}|\n|''JSON''|By default the data is rendered as a table with a &quot;Name&quot; and &quot;Value&quot; column. When defining ''JSON'' the data is rendered in JSON format|\n|//tiddlerName//|Defines the tiddler holding the data to be displayed. When no tiddler is given the tiddler containing the showData macro is used. When the tiddler name contains spaces you must quote the name (or use the {{{[[...]]}}} syntax.)|\n|&gt;|~~Syntax formatting: Keywords in ''bold'', optional parts in [...]. 'or' means that exactly one of the two alternatives must exist.~~|\n\n\n!Revision history\n* v1.0.4 (2006-02-05)\n** Bugfix: showData fails in TiddlyWiki 2.0\n* v1.0.3 (2006-01-06)\n** Support TiddlyWiki 2.0\n* v1.0.2 (2005-12-22)\n** Enhancements:\n*** Handle texts &quot;&lt;data&gt;&quot; or &quot;&lt;/data&gt;&quot; more robust when used in a tiddler text or as a field value.\n*** Improved (JSON) error messages.\n** Bugs fixed: \n*** References are not updated when using the DataTiddler.\n*** Changes to compound objects are not always saved.\n*** &quot;~&lt;/data&gt;&quot; is not rendered correctly (expected &quot;&lt;/data&gt;&quot;)\n* v1.0.1 (2005-12-13)\n** Features: \n*** The showData macro supports an optional &quot;tiddlername&quot; argument to specify the tiddler containing the data to be displayed\n** Bugs fixed: \n*** A script immediately following a data section is deleted when the data is changed. (Thanks to GeoffS for reporting.)\n* v1.0.0 (2005-12-12)\n** initial version\n\n!Code\n***/\n//{{{\n//============================================================================\n//============================================================================\n// DataTiddlerPlugin\n//============================================================================\n//============================================================================\n\n// Ensure that the DataTiddler Plugin is only installed once.\n//\nif (!version.extensions.DataTiddlerPlugin) {\n\n\n\nversion.extensions.DataTiddlerPlugin = {\n major: 1, minor: 0, revision: 4,\n date: new Date(2006, 2, 5), \n type: 'plugin',\n source: &quot;http://tiddlywiki.abego-software.de/#DataTiddlerPlugin&quot;\n};\n\n// For backward compatibility with v1.2.x\n//\nif (!window.story) window.story=window; \nif (!TiddlyWiki.prototype.getTiddler) TiddlyWiki.prototype.getTiddler = function(title) { return t = this.tiddlers[title]; return (t != undefined &amp;&amp; t instanceof Tiddler) ? t : null; } \n\n//============================================================================\n// DataTiddler Class\n//============================================================================\n\n// ---------------------------------------------------------------------------\n// Configurations and constants \n// ---------------------------------------------------------------------------\n\nfunction DataTiddler() {\n}\n\nDataTiddler = {\n // Function to stringify a JavaScript value, producing the text for the data section content.\n // (Must match the implementation of DataTiddler.parse.)\n //\n stringify : null,\n \n\n // Function to parse the text for the data section content, producing a JavaScript value.\n // (Must match the implementation of DataTiddler.stringify.)\n //\n parse : null\n};\n\n// Ensure access for IE\nwindow.DataTiddler = DataTiddler;\n\n// ---------------------------------------------------------------------------\n// Data Accessor and Mutator\n// ---------------------------------------------------------------------------\n\n\n// Returns the value of the given data field of the tiddler.\n// When no such field is defined or its value is undefined\n// the defaultValue is returned.\n// \n// @param tiddler either a tiddler name or a tiddler\n//\nDataTiddler.getData = function(tiddler, field, defaultValue) {\n var t = (typeof tiddler == &quot;string&quot;) ? store.getTiddler(tiddler) : tiddler;\n if (!(t instanceof Tiddler)) {\n throw &quot;Tiddler expected. Got &quot;+tiddler;\n }\n\n return DataTiddler.getTiddlerDataValue(t, field, defaultValue);\n}\n\n\n// Sets the value of the given data field of the tiddler to\n// the value. When the value is equal to the defaultValue\n// no value is set (and the field is removed)\n//\n// Changing data of a tiddler will not trigger notifications.\n// \n// @param tiddler either a tiddler name or a tiddler\n//\nDataTiddler.setData = function(tiddler, field, value, defaultValue) {\n var t = (typeof tiddler == &quot;string&quot;) ? store.getTiddler(tiddler) : tiddler;\n if (!(t instanceof Tiddler)) {\n throw &quot;Tiddler expected. Got &quot;+tiddler+ &quot;(&quot;+t+&quot;)&quot;;\n }\n\n DataTiddler.setTiddlerDataValue(t, field, value, defaultValue);\n}\n\n\n// Returns the data object of the tiddler, with a property for every field.\n//\n// The properties of the returned data object may only be read and\n// not be modified. To modify the data use DataTiddler.setData(...) \n// or the corresponding Tiddler method.\n//\n// If no data section is defined a new (empty) object is returned.\n//\n// @param tiddler either a tiddler name or a Tiddler\n//\nDataTiddler.getDataObject = function(tiddler) {\n var t = (typeof tiddler == &quot;string&quot;) ? store.getTiddler(tiddler) : tiddler;\n if (!(t instanceof Tiddler)) {\n throw &quot;Tiddler expected. Got &quot;+tiddler;\n }\n\n return DataTiddler.getTiddlerDataObject(t);\n}\n\n// Returns the text of the content of the data section of the tiddler.\n//\n// When no data section is defined for the tiddler null is returned \n//\n// @param tiddler either a tiddler name or a Tiddler\n// @return [may be null]\n//\nDataTiddler.getDataText = function(tiddler) {\n var t = (typeof tiddler == &quot;string&quot;) ? store.getTiddler(tiddler) : tiddler;\n if (!(t instanceof Tiddler)) {\n throw &quot;Tiddler expected. Got &quot;+tiddler;\n }\n\n return DataTiddler.readDataSectionText(t);\n}\n\n\n// ---------------------------------------------------------------------------\n// Internal helper methods (must not be used by code from outside this plugin)\n// ---------------------------------------------------------------------------\n\n// Internal.\n//\n// The original JSONError is not very user friendly, \n// especially it does not define a toString() method\n// Therefore we extend it here.\n//\nDataTiddler.extendJSONError = function(ex) {\n if (ex.name == 'JSONError') {\n ex.toString = function() {\n return ex.name + &quot;: &quot;+ex.message+&quot; (&quot;+ex.text+&quot;)&quot;;\n }\n }\n return ex;\n}\n\n// Internal.\n//\n// @param t a Tiddler\n//\nDataTiddler.getTiddlerDataObject = function(t) {\n if (t.dataObject == undefined) {\n var data = DataTiddler.readData(t);\n t.dataObject = (data) ? data : {};\n }\n \n return t.dataObject;\n}\n\n\n// Internal.\n//\n// @param tiddler a Tiddler\n//\nDataTiddler.getTiddlerDataValue = function(tiddler, field, defaultValue) {\n var value = DataTiddler.getTiddlerDataObject(tiddler)[field];\n return (value == undefined) ? defaultValue : value;\n}\n\n\n// Internal.\n//\n// @param tiddler a Tiddler\n//\nDataTiddler.setTiddlerDataValue = function(tiddler, field, value, defaultValue) {\n var data = DataTiddler.getTiddlerDataObject(tiddler);\n var oldValue = data[field];\n \n if (value == defaultValue) {\n if (oldValue != undefined) {\n delete data[field];\n DataTiddler.save(tiddler);\n }\n return;\n }\n data[field] = value;\n DataTiddler.save(tiddler);\n}\n\n// Internal.\n//\n// Reads the data section from the tiddler's content and returns its text\n// (as a String).\n//\n// Returns null when no data is defined.\n//\n// @param tiddler a Tiddler\n// @return [may be null]\n//\nDataTiddler.readDataSectionText = function(tiddler) {\n var matches = DataTiddler.getDataTiddlerMatches(tiddler);\n if (matches == null || !matches[2]) {\n return null;\n }\n return matches[2];\n}\n\n// Internal.\n//\n// Reads the data section from the tiddler's content and returns it\n// (as an internalized object).\n//\n// Returns null when no data is defined.\n//\n// @param tiddler a Tiddler\n// @return [may be null]\n//\nDataTiddler.readData = function(tiddler) {\n var text = DataTiddler.readDataSectionText(tiddler);\n try {\n return text ? DataTiddler.parse(text) : null;\n } catch(ex) {\n throw DataTiddler.extendJSONError(ex);\n }\n}\n\n// Internal.\n// \n// Returns the serialized text of the data of the given tiddler, as it\n// should be stored in the data section.\n//\n// @param tiddler a Tiddler\n//\nDataTiddler.getDataTextOfTiddler = function(tiddler) {\n var data = DataTiddler.getTiddlerDataObject(tiddler);\n return DataTiddler.stringify(data);\n}\n\n\n// Internal.\n// \nDataTiddler.indexOfNonEscapedText = function(s, subString, startIndex) {\n var index = s.indexOf(subString, startIndex);\n while ((index &gt; 0) &amp;&amp; (s[index-1] == '~')) { \n index = s.indexOf(subString, index+1);\n }\n return index;\n}\n\n// Internal.\n//\nDataTiddler.getDataSectionInfo = function(text) {\n // Special care must be taken to handle &quot;&lt;data&gt;&quot; and &quot;&lt;/data&gt;&quot; texts inside\n // a data section. \n // Also take care not to use an escaped &lt;data&gt; (i.e. &quot;~&lt;data&gt;&quot;) as the start \n // of a data section. (Same for &lt;/data&gt;)\n\n // NOTE: we are explicitly searching for a data section that contains a JSON\n // string, i.e. framed with braces. This way we are little bit more robust in\n // case the tiddler contains unescaped texts &quot;&lt;data&gt;&quot; or &quot;&lt;/data&gt;&quot;. This must\n // be changed when using a different stringifier.\n\n var startTagText = &quot;&lt;data&gt;{&quot;;\n var endTagText = &quot;}&lt;/data&gt;&quot;;\n\n var startPos = 0;\n\n // Find the first not escaped &quot;&lt;data&gt;&quot;.\n var startDataTagIndex = DataTiddler.indexOfNonEscapedText(text, startTagText, 0);\n if (startDataTagIndex &lt; 0) {\n return null;\n }\n\n // Find the *last* not escaped &quot;&lt;/data&gt;&quot;.\n var endDataTagIndex = text.indexOf(endTagText, startDataTagIndex);\n if (endDataTagIndex &lt; 0) {\n return null;\n }\n var nextEndDataTagIndex;\n while ((nextEndDataTagIndex = text.indexOf(endTagText, endDataTagIndex+1)) &gt;= 0) {\n endDataTagIndex = nextEndDataTagIndex;\n };\n\n return {\n prefixEnd: startDataTagIndex, \n dataStart: startDataTagIndex+(startTagText.length)-1, \n dataEnd: endDataTagIndex, \n suffixStart: endDataTagIndex+(endTagText.length)\n };\n}\n\n// Internal.\n// \n// Returns the &quot;matches&quot; of a content of a DataTiddler on the\n// &quot;data&quot; regular expression. Return null when no data is defined\n// in the tiddler content.\n//\n// Group 1: text before data section (prefix)\n// Group 2: content of data section\n// Group 3: text behind data section (suffix)\n//\n// @param tiddler a Tiddler\n// @return [may be null] null when the tiddler contains no data section, otherwise see above.\n//\nDataTiddler.getDataTiddlerMatches = function(tiddler) {\n var text = tiddler.text;\n var info = DataTiddler.getDataSectionInfo(text);\n if (!info) {\n return null;\n }\n\n var prefix = text.substr(0,info.prefixEnd);\n var data = text.substr(info.dataStart, info.dataEnd-info.dataStart+1);\n var suffix = text.substr(info.suffixStart);\n \n return [text, prefix, data, suffix];\n}\n\n\n// Internal.\n//\n// Saves the data in a &lt;data&gt; block of the given tiddler (as a minor change). \n//\n// The &quot;chkAutoSave&quot; and &quot;chkForceMinorUpdate&quot; options are respected. \n// I.e. the TiddlyWiki *file* is only saved when AutoSave is on.\n//\n// Notifications are not send. \n//\n// This method should only be called when the data really has changed. \n//\n// @param tiddler\n// the tiddler to be saved.\n//\nDataTiddler.save = function(tiddler) {\n\n var matches = DataTiddler.getDataTiddlerMatches(tiddler);\n\n var prefix;\n var suffix;\n if (matches == null) {\n prefix = tiddler.text;\n suffix = &quot;&quot;;\n } else {\n prefix = matches[1];\n suffix = matches[3];\n }\n\n var dataText = DataTiddler.getDataTextOfTiddler(tiddler);\n var newText = \n (dataText != null) \n ? prefix + &quot;&lt;data&gt;&quot; + dataText + &quot;&lt;/data&gt;&quot; + suffix\n : prefix + suffix;\n if (newText != tiddler.text) {\n // make the change in the tiddlers text\n \n // ... see DataTiddler.MyTiddlerChangedFunction\n tiddler.isDataTiddlerChange = true;\n \n // ... do the action change\n tiddler.set(\n tiddler.title,\n newText,\n config.options.txtUserName, \n config.options.chkForceMinorUpdate? undefined : new Date(),\n tiddler.tags);\n\n // ... see DataTiddler.MyTiddlerChangedFunction\n delete tiddler.isDataTiddlerChange;\n\n // Mark the store as dirty.\n store.dirty = true;\n \n // AutoSave if option is selected\n if(config.options.chkAutoSave) {\n saveChanges();\n }\n }\n}\n\n// Internal.\n//\nDataTiddler.MyTiddlerChangedFunction = function() {\n // Remove the data object from the tiddler when the tiddler is changed\n // by code other than DataTiddler code. \n //\n // This is necessary since the data object is just a &quot;cached version&quot; \n // of the data defined in the data section of the tiddler and the \n // &quot;external&quot; change may have changed the content of the data section.\n // Thus we are not sure if the data object reflects the data section \n // contents. \n // \n // By deleting the data object we ensure that the data object is \n // reconstructed the next time it is needed, with the data defined by\n // the data section in the tiddler's text.\n \n // To indicate that a change is a &quot;DataTiddler change&quot; a temporary\n // property &quot;isDataTiddlerChange&quot; is added to the tiddler.\n if (this.dataObject &amp;&amp; !this.isDataTiddlerChange) {\n delete this.dataObject;\n }\n \n // call the original code.\n DataTiddler.originalTiddlerChangedFunction.apply(this, arguments);\n}\n\n\n//============================================================================\n// Formatters\n//============================================================================\n\n// This formatter ensures that &quot;~&lt;data&gt;&quot; is rendered as &quot;&lt;data&gt;&quot;. This is used to \n// escape the &quot;&lt;data&gt;&quot; of a data section, just in case someone really wants to use\n// &quot;&lt;data&gt;&quot; as a text in a tiddler and not start a data section.\n//\n// Same for &lt;/data&gt;.\n//\nconfig.formatters.push( {\n name: &quot;data-escape&quot;,\n match: &quot;~&lt;\s\s/?data&gt;&quot;,\n\n handler: function(w) {\n w.outputText(w.output,w.matchStart + 1,w.nextMatch);\n }\n} )\n\n\n// This formatter ensures that &lt;data&gt;...&lt;/data&gt; sections are not rendered.\n//\nconfig.formatters.push( {\n name: &quot;data&quot;,\n match: &quot;&lt;data&gt;&quot;,\n\n handler: function(w) {\n var info = DataTiddler.getDataSectionInfo(w.source);\n if (info &amp;&amp; info.prefixEnd == w.matchStart) {\n w.nextMatch = info.suffixStart;\n } else {\n w.outputText(w.output,w.matchStart,w.nextMatch);\n }\n }\n} )\n\n\n//============================================================================\n// Tiddler Class Extension\n//============================================================================\n\n// &quot;Hijack&quot; the changed method ---------------------------------------------------\n\nDataTiddler.originalTiddlerChangedFunction = Tiddler.prototype.changed;\nTiddler.prototype.changed = DataTiddler.MyTiddlerChangedFunction;\n\n// Define accessor methods -------------------------------------------------------\n\n// Returns the value of the given data field of the tiddler. When no such field \n// is defined or its value is undefined the defaultValue is returned.\n//\n// When field is undefined (or null) the data object is returned. (See \n// DataTiddler.getDataObject.)\n//\n// @param field [may be null, undefined]\n// @param defaultValue [may be null, undefined]\n// @return [may be null, undefined]\n//\nTiddler.prototype.data = function(field, defaultValue) {\n return (field) \n ? DataTiddler.getTiddlerDataValue(this, field, defaultValue)\n : DataTiddler.getTiddlerDataObject(this);\n}\n\n// Sets the value of the given data field of the tiddler to the value. When the \n// value is equal to the defaultValue no value is set (and the field is removed).\n//\n// @param value [may be null, undefined]\n// @param defaultValue [may be null, undefined]\n//\nTiddler.prototype.setData = function(field, value, defaultValue) {\n DataTiddler.setTiddlerDataValue(this, field, value, defaultValue);\n}\n\n\n//============================================================================\n// showData Macro\n//============================================================================\n\nconfig.macros.showData = {\n // Standard Properties\n label: &quot;showData&quot;,\n prompt: &quot;Display the values stored in the data section of the tiddler&quot;\n}\n\nconfig.macros.showData.handler = function(place,macroName,params) {\n // --- Parsing ------------------------------------------\n\n var i = 0; // index running over the params\n // Parse the optional &quot;JSON&quot;\n var showInJSONFormat = false;\n if ((i &lt; params.length) &amp;&amp; params[i] == &quot;JSON&quot;) {\n i++;\n showInJSONFormat = true;\n }\n \n var tiddlerName = story.findContainingTiddler(place).id.substr(7);\n if (i &lt; params.length) {\n tiddlerName = params[i]\n i++;\n }\n\n // --- Processing ------------------------------------------\n try {\n if (showInJSONFormat) {\n this.renderDataInJSONFormat(place, tiddlerName);\n } else {\n this.renderDataAsTable(place, tiddlerName);\n }\n } catch (e) {\n this.createErrorElement(place, e);\n }\n}\n\nconfig.macros.showData.renderDataInJSONFormat = function(place,tiddlerName) {\n var text = DataTiddler.getDataText(tiddlerName);\n if (text) {\n createTiddlyElement(place,&quot;pre&quot;,null,null,text);\n }\n}\n\nconfig.macros.showData.renderDataAsTable = function(place,tiddlerName) {\n var text = &quot;|!Name|!Value|\sn&quot;;\n var data = DataTiddler.getDataObject(tiddlerName);\n if (data) {\n for (var i in data) {\n var value = data[i];\n text += &quot;|&quot;+i+&quot;|&quot;+DataTiddler.stringify(value)+&quot;|\sn&quot;;\n }\n }\n \n wikify(text, place);\n}\n\n\n// Internal.\n//\n// Creates an element that holds an error message\n// \nconfig.macros.showData.createErrorElement = function(place, exception) {\n var message = (exception.description) ? exception.description : exception.toString();\n return createTiddlyElement(place,&quot;span&quot;,null,&quot;showDataError&quot;,&quot;&lt;&lt;showData ...&gt;&gt;: &quot;+message);\n}\n\n// ---------------------------------------------------------------------------\n// Stylesheet Extensions (may be overridden by local StyleSheet)\n// ---------------------------------------------------------------------------\n//\nsetStylesheet(\n &quot;.showDataError{color: #ffffff;background-color: #880000;}&quot;,\n &quot;showData&quot;);\n\n\n} // of &quot;install only once&quot;\n//}}}\n\n\n\n/***\n!JSON Code, used to serialize the data\n//(embedded in the plugin tiddler to make it selfcontained)//\n***/\n//{{{\n/*\nCopyright (c) 2005 JSON.org\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the &quot;Software&quot;), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe Software shall be used for Good, not Evil.\n\nTHE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n/*\n The global object JSON contains two methods.\n\n JSON.stringify(value) takes a JavaScript value and produces a JSON text.\n The value must not be cyclical.\n\n JSON.parse(text) takes a JSON text and produces a JavaScript value. It will\n throw a 'JSONError' exception if there is an error.\n*/\nvar JSON = {\n copyright: '(c)2005 JSON.org',\n license: 'http://www.crockford.com/JSON/license.html',\n/*\n Stringify a JavaScript value, producing a JSON text.\n*/\n stringify: function (v) {\n var a = [];\n\n/*\n Emit a string.\n*/\n function e(s) {\n a[a.length] = s;\n }\n\n/*\n Convert a value.\n*/\n function g(x) {\n var c, i, l, v;\n\n switch (typeof x) {\n case 'object':\n if (x) {\n if (x instanceof Array) {\n e('[');\n l = a.length;\n for (i = 0; i &lt; x.length; i += 1) {\n v = x[i];\n if (typeof v != 'undefined' &amp;&amp;\n typeof v != 'function') {\n if (l &lt; a.length) {\n e(',');\n }\n g(v);\n }\n }\n e(']');\n return;\n } else if (typeof x.toString != 'undefined') {\n e('{');\n l = a.length;\n for (i in x) {\n v = x[i];\n if (x.hasOwnProperty(i) &amp;&amp;\n typeof v != 'undefined' &amp;&amp;\n typeof v != 'function') {\n if (l &lt; a.length) {\n e(',');\n }\n g(i);\n e(':');\n g(v);\n }\n }\n return e('}');\n }\n }\n e('null');\n return;\n case 'number':\n e(isFinite(x) ? +x : 'null');\n return;\n case 'string':\n l = x.length;\n e('&quot;');\n for (i = 0; i &lt; l; i += 1) {\n c = x.charAt(i);\n if (c &gt;= ' ') {\n if (c == '\s\s' || c == '&quot;') {\n e('\s\s');\n }\n e(c);\n } else {\n switch (c) {\n case '\sb':\n e('\s\sb');\n break;\n case '\sf':\n e('\s\sf');\n break;\n case '\sn':\n e('\s\sn');\n break;\n case '\sr':\n e('\s\sr');\n break;\n case '\st':\n e('\s\st');\n break;\n default:\n c = c.charCodeAt();\n e('\s\su00' + Math.floor(c / 16).toString(16) +\n (c % 16).toString(16));\n }\n }\n }\n e('&quot;');\n return;\n case 'boolean':\n e(String(x));\n return;\n default:\n e('null');\n return;\n }\n }\n g(v);\n return a.join('');\n },\n/*\n Parse a JSON text, producing a JavaScript value.\n*/\n parse: function (text) {\n var p = /^\ss*(([,:{}\s[\s]])|&quot;(\s\s.|[^\sx00-\sx1f&quot;\s\s])*&quot;|-?\sd+(\s.\sd*)?([eE][+-]?\sd+)?|true|false|null)\ss*/,\n token,\n operator;\n\n function error(m, t) {\n throw {\n name: 'JSONError',\n message: m,\n text: t || operator || token\n };\n }\n\n function next(b) {\n if (b &amp;&amp; b != operator) {\n error(&quot;Expected '&quot; + b + &quot;'&quot;);\n }\n if (text) {\n var t = p.exec(text);\n if (t) {\n if (t[2]) {\n token = null;\n operator = t[2];\n } else {\n operator = null;\n try {\n token = eval(t[1]);\n } catch (e) {\n error(&quot;Bad token&quot;, t[1]);\n }\n }\n text = text.substring(t[0].length);\n } else {\n error(&quot;Unrecognized token&quot;, text);\n }\n } else {\n token = operator = undefined;\n }\n }\n\n\n function val() {\n var k, o;\n switch (operator) {\n case '{':\n next('{');\n o = {};\n if (operator != '}') {\n for (;;) {\n if (operator || typeof token != 'string') {\n error(&quot;Missing key&quot;);\n }\n k = token;\n next();\n next(':');\n o[k] = val();\n if (operator != ',') {\n break;\n }\n next(',');\n }\n }\n next('}');\n return o;\n case '[':\n next('[');\n o = [];\n if (operator != ']') {\n for (;;) {\n o.push(val());\n if (operator != ',') {\n break;\n }\n next(',');\n }\n }\n next(']');\n return o;\n default:\n if (operator !== null) {\n error(&quot;Missing value&quot;);\n }\n k = token;\n next();\n return k;\n }\n }\n next();\n return val();\n }\n};\n//}}}\n/***\n!Setup the data serialization\n***/\n//{{{\nDataTiddler.format = &quot;JSON&quot;;\nDataTiddler.stringify = JSON.stringify;\nDataTiddler.parse = JSON.parse;\n\n//}}}\n\n</div>
<div tiddler="DefaultTiddlers" modifier="Saq" modified="200603101726" created="200603101726" tags=""></div>
<div tiddler="DropTagsMacro" modifier="Saq" modified="200606031757" created="200606031757" tags="systemConfig excludeLists">/***\n|''Name:''|''dropTags''|\n|''Version:''|0.5 (12-May-2006)|\n|''Created by:''|SaqImtiaz|\n|''Location:''|http://lewcid.googlepages.com/lewcid.html#DropTagsMacro|\n|''Description:''|provides a drop down list of tags in the current tiddler,&lt;&lt;br&gt;&gt; a replacement for the core tags macro.|\n|''Documentation:''|DropTagsMacroDocumentation |\n|''Source Code:''|DropTagsMacroSource |\n|''Requires:''|~TW2.07|\n\n***/\n// /%\nconfig.macros.dropTags={};config.macros.dropTags.dropdownchar=(document.all?&quot;â¼&quot;:&quot;â¾&quot;);config.macros.dropTags.handler=function(_1,_2,_3,_4,_5,_6){var _7=config.macros.dropTags.dropdownchar;var _8=(_3[0]&amp;&amp;_3[0]!=&quot;.&quot;)?_3[0]+_7:&quot;tags&quot;+_7;var _9=&quot;current tags for this tiddler&quot;;var _a=function(e){if(!e){var e=window.event;}var _d=Popup.create(this);var _e=config.views.wikified.tag;if(_6.tags.length==0){createTiddlyElement(_d,&quot;li&quot;,null,&quot;listTitle&quot;,_e.labelNoTags);}else{for(var t=0;t&lt;_6.tags.length;t++){createTagButton(createTiddlyElement(_d,&quot;li&quot;),_6.tags[t],_6.title);}}if(version.extensions.IntelliTaggerPlugin){createTiddlyElement(createTiddlyElement(_d,&quot;li&quot;),&quot;hr&quot;);abego.IntelliTagger.createEditTagsButton(_6,createTiddlyElement(_d,&quot;li&quot;),&quot;[IntelliEdit]&quot;,&quot;Edit tags with Intellitagger&quot;);}Popup.show(_d,false);e.cancelBubble=true;if(e.stopPropagation){e.stopPropagation();}return (false);};createTiddlyButton(_1,_8,_8,_a,&quot;button&quot;,&quot;dropTagBtn&quot;);};setStylesheet(&quot;.popup .highlight{background: #fe8; color:#000;}\sn&quot;+&quot;#nestedtagger {background:#2E5ADF; border: 1px solid #0331BF;}\sn&quot;+&quot;&quot;,&quot;DropTagsStyles&quot;);if(!config.macros.tagger){window.onClickTag=function(e){if(!e){var e=window.event;}var _12=resolveTarget(e);var _13=(!isNested(_12));if((Popup.stack.length&gt;1)&amp;&amp;(_13==true)){Popup.removeFrom(1);}else{if(Popup.stack.length&gt;0&amp;&amp;_13==false){Popup.removeFrom(0);}}var _14=(_13==false)?&quot;popup&quot;:&quot;nestedtagger&quot;;var _15=createTiddlyElement(document.body,&quot;ol&quot;,_14,&quot;popup&quot;,null);Popup.stack.push({root:this,popup:_15});var tag=this.getAttribute(&quot;tag&quot;);var _17=this.getAttribute(&quot;tiddler&quot;);if(_15&amp;&amp;tag){var _18=store.getTaggedTiddlers(tag);var _19=[];var li,r;for(r=0;r&lt;_18.length;r++){if(_18[r].title!=_17){_19.push(_18[r].title);}}var _1b=config.views.wikified.tag;if(_19.length&gt;0){var _1c=createTiddlyButton(createTiddlyElement(_15,&quot;li&quot;),_1b.openAllText.format([tag]),_1b.openAllTooltip,onClickTagOpenAll);_1c.setAttribute(&quot;tag&quot;,tag);createTiddlyElement(createTiddlyElement(_15,&quot;li&quot;),&quot;hr&quot;);for(r=0;r&lt;_19.length;r++){createTiddlyLink(createTiddlyElement(_15,&quot;li&quot;),_19[r],true);}}else{createTiddlyText(createTiddlyElement(_15,&quot;li&quot;,null,&quot;disabled&quot;),_1b.popupNone.format([tag]));}createTiddlyElement(createTiddlyElement(_15,&quot;li&quot;),&quot;hr&quot;);var h=createTiddlyLink(createTiddlyElement(_15,&quot;li&quot;),tag,false);createTiddlyText(h,_1b.openTag.format([tag]));}Popup.show(_15,false);e.cancelBubble=true;if(e.stopPropagation){e.stopPropagation();}return (false);};}if(!window.isNested){window.isNested=function(e){while(e!=null){var _1f=document.getElementById(&quot;contentWrapper&quot;);if(_1f==e){return true;}e=e.parentNode;}return false;};};config.shadowTiddlers.DropTagsMacroDocumentation=&quot;The documentation is available [[here.|http://lewcid.googlepages.com/lewcid.html#DropTagsMacroDocumentation]]&quot;;config.shadowTiddlers.DropTagsMacroSource=&quot;The documentation is available [[here.|http://lewcid.googlepages.com/lewcid.html#DropTagsMacroDocumentation]]&quot;;\n// %/</div>
<div tiddler="ForEachTiddlerPlugin" modifier="Saq" modified="200604171221" created="200512281150" tags="systemConfig excludeLists MovieManagerTiddlers">/***\n|''Name:''|ForEachTiddlerPlugin|\n|''Version:''|1.0.5 (2006-02-05)|\n|''Source:''|http://tiddlywiki.abego-software.de/#ForEachTiddlerPlugin|\n|''Author:''|UdoBorkowski (ub [at] abego-software [dot] de)|\n|''Licence:''|[[BSD open source license]]|\n|''Macros:''|[[ForEachTiddlerMacro]] v1.0.5|\n|''TiddlyWiki:''|1.2.38+, 2.0|\n|''Browser:''|Firefox 1.0.4+; Firefox 1.5; InternetExplorer 6.0|\n!Description\n\nCreate customizable lists, tables etc. for your selections of tiddlers. Specify the tiddlers to include and their order through a powerful language.\n\n''Syntax:'' \n|&gt;|{{{&lt;&lt;}}}''forEachTiddler'' [''in'' //tiddlyWikiPath//] [''where'' //whereCondition//] [''sortBy'' //sortExpression// [''ascending'' //or// ''descending'']] [''script'' //scriptText//] [//action// [//actionParameters//]]{{{&gt;&gt;}}}|\n|//tiddlyWikiPath//|The filepath to the TiddlyWiki the macro should work on. When missing the current TiddlyWiki is used.|\n|//whereCondition//|(quoted) JavaScript boolean expression. May refer to the build-in variables {{{tiddler}}} and {{{context}}}.|\n|//sortExpression//|(quoted) JavaScript expression returning &quot;comparable&quot; objects (using '{{{&lt;}}}','{{{&gt;}}}','{{{==}}}'. May refer to the build-in variables {{{tiddler}}} and {{{context}}}.|\n|//scriptText//|(quoted) JavaScript text. Typically defines JavaScript functions that are called by the various JavaScript expressions (whereClause, sortClause, action arguments,...)|\n|//action//|The action that should be performed on every selected tiddler, in the given order. By default the actions [[addToList|AddToListAction]] and [[write|WriteAction]] are supported. When no action is specified [[addToList|AddToListAction]] is used.|\n|//actionParameters//|(action specific) parameters the action may refer while processing the tiddlers (see action descriptions for details). &lt;&lt;tiddler [[JavaScript in actionParameters]]&gt;&gt;|\n|&gt;|~~Syntax formatting: Keywords in ''bold'', optional parts in [...]. 'or' means that exactly one of the two alternatives must exist.~~|\n\nSee details see [[ForEachTiddlerMacro]] and [[ForEachTiddlerExamples]].\n\n!Revision history\n* v1.0.5\n** Pass tiddler containing the macro with wikify, context object also holds reference to tiddler containing the macro (&quot;inTiddler&quot;). Thanks to SimonBaird.\n** Support Firefox 1.5.0.1\n** Internal\n*** Make &quot;JSLint&quot; conform\n*** &quot;Only install once&quot;\n* v1.0.4 (2006-01-06)\n** Support TiddlyWiki 2.0\n* v1.0.3 (2005-12-22)\n** Features: \n*** Write output to a file supports multi-byte environments (Thanks to Bram Chen) \n*** Provide API to access the forEachTiddler functionality directly through JavaScript (see getTiddlers and performMacro)\n** Enhancements:\n*** Improved error messages on InternetExplorer.\n* v1.0.2 (2005-12-10)\n** Features: \n*** context object also holds reference to store (TiddlyWiki)\n** Fixed Bugs: \n*** ForEachTiddler 1.0.1 has broken support on win32 Opera 8.51 (Thanks to BrunoSabin for reporting)\n* v1.0.1 (2005-12-08)\n** Features: \n*** Access tiddlers stored in separated TiddlyWikis through the &quot;in&quot; option. I.e. you are no longer limited to only work on the &quot;current TiddlyWiki&quot;.\n*** Write output to an external file using the &quot;toFile&quot; option of the &quot;write&quot; action. With this option you may write your customized tiddler exports.\n*** Use the &quot;script&quot; section to define &quot;helper&quot; JavaScript functions etc. to be used in the various JavaScript expressions (whereClause, sortClause, action arguments,...).\n*** Access and store context information for the current forEachTiddler invocation (through the build-in &quot;context&quot; object) .\n*** Improved script evaluation (for where/sort clause and write scripts).\n* v1.0.0 (2005-11-20)\n** initial version\n\n!Code\n***/\n//{{{\n\n \n//============================================================================\n//============================================================================\n// ForEachTiddlerPlugin\n//============================================================================\n//============================================================================\n\n// Only install once\nif (!version.extensions.ForEachTiddlerPlugin) {\n\nversion.extensions.ForEachTiddlerPlugin = {major: 1, minor: 0, revision: 5, date: new Date(2006,2,5), source: &quot;http://tiddlywiki.abego-software.de/#ForEachTiddlergPlugin&quot;};\n\n// For backward compatibility with TW 1.2.x\n//\nif (!TiddlyWiki.prototype.forEachTiddler) {\n TiddlyWiki.prototype.forEachTiddler = function(callback) {\n for(var t in this.tiddlers) {\n callback.call(this,t,this.tiddlers[t]);\n }\n };\n}\n\n//============================================================================\n// forEachTiddler Macro\n//============================================================================\n\nversion.extensions.forEachTiddler = {major: 1, minor: 0, revision: 5, date: new Date(2006,2,5), provider: &quot;http://tiddlywiki.abego-software.de&quot;};\n\n// ---------------------------------------------------------------------------\n// Configurations and constants \n// ---------------------------------------------------------------------------\n\nconfig.macros.forEachTiddler = {\n // Standard Properties\n label: &quot;forEachTiddler&quot;,\n prompt: &quot;Perform actions on a (sorted) selection of tiddlers&quot;,\n\n // actions\n actions: {\n addToList: {},\n write: {}\n }\n};\n\n// ---------------------------------------------------------------------------\n// The forEachTiddler Macro Handler \n// ---------------------------------------------------------------------------\n\nconfig.macros.forEachTiddler.getContainingTiddler = function(e) {\n while(e &amp;&amp; !hasClass(e,&quot;tiddler&quot;))\n e = e.parentNode;\n var title = e ? e.getAttribute(&quot;tiddler&quot;) : null; \n return title ? store.getTiddler(title) : null;\n};\n\nconfig.macros.forEachTiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler) {\n // config.macros.forEachTiddler.traceMacroCall(place,macroName,params,wikifier,paramString,tiddler);\n\n if (!tiddler) tiddler = config.macros.forEachTiddler.getContainingTiddler(place);\n // --- Parsing ------------------------------------------\n\n var i = 0; // index running over the params\n // Parse the &quot;in&quot; clause\n var tiddlyWikiPath = undefined;\n if ((i &lt; params.length) &amp;&amp; params[i] == &quot;in&quot;) {\n i++;\n if (i &gt;= params.length) {\n this.handleError(place, &quot;TiddlyWiki path expected behind 'in'.&quot;);\n return;\n }\n tiddlyWikiPath = this.paramEncode((i &lt; params.length) ? params[i] : &quot;&quot;);\n i++;\n }\n\n // Parse the where clause\n var whereClause =&quot;true&quot;;\n if ((i &lt; params.length) &amp;&amp; params[i] == &quot;where&quot;) {\n i++;\n whereClause = this.paramEncode((i &lt; params.length) ? params[i] : &quot;&quot;);\n i++;\n }\n\n // Parse the sort stuff\n var sortClause = null;\n var sortAscending = true; \n if ((i &lt; params.length) &amp;&amp; params[i] == &quot;sortBy&quot;) {\n i++;\n if (i &gt;= params.length) {\n this.handleError(place, &quot;sortClause missing behind 'sortBy'.&quot;);\n return;\n }\n sortClause = this.paramEncode(params[i]);\n i++;\n\n if ((i &lt; params.length) &amp;&amp; (params[i] == &quot;ascending&quot; || params[i] == &quot;descending&quot;)) {\n sortAscending = params[i] == &quot;ascending&quot;;\n i++;\n }\n }\n\n // Parse the script\n var scriptText = null;\n if ((i &lt; params.length) &amp;&amp; params[i] == &quot;script&quot;) {\n i++;\n scriptText = this.paramEncode((i &lt; params.length) ? params[i] : &quot;&quot;);\n i++;\n }\n\n // Parse the action. \n // When we are already at the end use the default action\n var actionName = &quot;addToList&quot;;\n if (i &lt; params.length) {\n if (!config.macros.forEachTiddler.actions[params[i]]) {\n this.handleError(place, &quot;Unknown action '&quot;+params[i]+&quot;'.&quot;);\n return;\n } else {\n actionName = params[i]; \n i++;\n }\n } \n \n // Get the action parameter\n // (the parsing is done inside the individual action implementation.)\n var actionParameter = params.slice(i);\n\n\n // --- Processing ------------------------------------------\n try {\n this.performMacro({\n place: place, \n inTiddler: tiddler,\n whereClause: whereClause, \n sortClause: sortClause, \n sortAscending: sortAscending, \n actionName: actionName, \n actionParameter: actionParameter, \n scriptText: scriptText, \n tiddlyWikiPath: tiddlyWikiPath});\n\n } catch (e) {\n this.handleError(place, e);\n }\n};\n\n// Returns an object with properties &quot;tiddlers&quot; and &quot;context&quot;.\n// tiddlers holds the (sorted) tiddlers selected by the parameter,\n// context the context of the execution of the macro.\n//\n// The action is not yet performed.\n//\n// @parameter see performMacro\n//\nconfig.macros.forEachTiddler.getTiddlersAndContext = function(parameter) {\n\n var context = config.macros.forEachTiddler.createContext(parameter.place, parameter.whereClause, parameter.sortClause, parameter.sortAscending, parameter.actionName, parameter.actionParameter, parameter.scriptText, parameter.tiddlyWikiPath, parameter.inTiddler);\n\n var tiddlyWiki = parameter.tiddlyWikiPath ? this.loadTiddlyWiki(parameter.tiddlyWikiPath) : store;\n context[&quot;tiddlyWiki&quot;] = tiddlyWiki;\n \n // Get the tiddlers, as defined by the whereClause\n var tiddlers = this.findTiddlers(parameter.whereClause, context, tiddlyWiki);\n context[&quot;tiddlers&quot;] = tiddlers;\n\n // Sort the tiddlers, when sorting is required.\n if (parameter.sortClause) {\n this.sortTiddlers(tiddlers, parameter.sortClause, parameter.sortAscending, context);\n }\n\n return {tiddlers: tiddlers, context: context};\n};\n\n// Returns the (sorted) tiddlers selected by the parameter.\n//\n// The action is not yet performed.\n//\n// @parameter see performMacro\n//\nconfig.macros.forEachTiddler.getTiddlers = function(parameter) {\n return this.getTiddlersAndContext(parameter).tiddlers;\n};\n\n// Performs the macros with the given parameter.\n//\n// @param parameter holds the parameter of the macro as separate properties.\n// The following properties are supported:\n//\n// place\n// whereClause\n// sortClause\n// sortAscending\n// actionName\n// actionParameter\n// scriptText\n// tiddlyWikiPath\n//\n// All properties are optional. \n// For most actions the place property must be defined.\n//\nconfig.macros.forEachTiddler.performMacro = function(parameter) {\n var tiddlersAndContext = this.getTiddlersAndContext(parameter);\n\n // Perform the action\n var actionName = parameter.actionName ? parameter.actionName : &quot;addToList&quot;;\n var action = config.macros.forEachTiddler.actions[actionName];\n if (!action) {\n this.handleError(parameter.place, &quot;Unknown action '&quot;+actionName+&quot;'.&quot;);\n return;\n }\n\n var actionHandler = action.handler;\n actionHandler(parameter.place, tiddlersAndContext.tiddlers, parameter.actionParameter, tiddlersAndContext.context);\n};\n\n// ---------------------------------------------------------------------------\n// The actions \n// ---------------------------------------------------------------------------\n\n// Internal.\n//\n// --- The addToList Action -----------------------------------------------\n//\nconfig.macros.forEachTiddler.actions.addToList.handler = function(place, tiddlers, parameter, context) {\n // Parse the parameter\n var p = 0;\n\n // Check for extra parameters\n if (parameter.length &gt; p) {\n config.macros.forEachTiddler.createExtraParameterErrorElement(place, &quot;addToList&quot;, parameter, p);\n return;\n }\n\n // Perform the action.\n var list = document.createElement(&quot;ul&quot;);\n place.appendChild(list);\n for (var i = 0; i &lt; tiddlers.length; i++) {\n var tiddler = tiddlers[i];\n var listItem = document.createElement(&quot;li&quot;);\n list.appendChild(listItem);\n createTiddlyLink(listItem, tiddler.title, true);\n }\n};\n\n// Internal.\n//\n// --- The write Action ---------------------------------------------------\n//\nconfig.macros.forEachTiddler.actions.write.handler = function(place, tiddlers, parameter, context) {\n // Parse the parameter\n var p = 0;\n if (p &gt;= parameter.length) {\n this.handleError(place, &quot;Missing expression behind 'write'.&quot;);\n return;\n }\n\n var textExpression = config.macros.forEachTiddler.paramEncode(parameter[p]);\n p++;\n\n // Parse the &quot;toFile&quot; option\n var filename = null;\n var lineSeparator = undefined;\n if ((p &lt; parameter.length) &amp;&amp; parameter[p] == &quot;toFile&quot;) {\n p++;\n if (p &gt;= parameter.length) {\n this.handleError(place, &quot;Filename expected behind 'toFile' of 'write' action.&quot;);\n return;\n }\n \n filename = config.macros.forEachTiddler.getLocalPath(config.macros.forEachTiddler.paramEncode(parameter[p]));\n p++;\n if ((p &lt; parameter.length) &amp;&amp; parameter[p] == &quot;withLineSeparator&quot;) {\n p++;\n if (p &gt;= parameter.length) {\n this.handleError(place, &quot;Line separator text expected behind 'withLineSeparator' of 'write' action.&quot;);\n return;\n }\n lineSeparator = config.macros.forEachTiddler.paramEncode(parameter[p]);\n p++;\n }\n }\n \n // Check for extra parameters\n if (parameter.length &gt; p) {\n config.macros.forEachTiddler.createExtraParameterErrorElement(place, &quot;write&quot;, parameter, p);\n return;\n }\n\n // Perform the action.\n var func = config.macros.forEachTiddler.getEvalTiddlerFunction(textExpression, context);\n var count = tiddlers.length;\n var text = &quot;&quot;;\n for (var i = 0; i &lt; count; i++) {\n var tiddler = tiddlers[i];\n text += func(tiddler, context, count, i);\n }\n \n if (filename) {\n if (lineSeparator !== undefined) {\n lineSeparator = lineSeparator.replace(/\s\sn/mg, &quot;\sn&quot;).replace(/\s\sr/mg, &quot;\sr&quot;);\n text = text.replace(/\sn/mg,lineSeparator);\n }\n saveFile(filename, convertUnicodeToUTF8(text));\n } else {\n var wrapper = createTiddlyElement(place, &quot;span&quot;);\n wikify(text, wrapper, null/* highlightRegExp */, context.inTiddler);\n }\n};\n\n\n// ---------------------------------------------------------------------------\n// Helpers\n// ---------------------------------------------------------------------------\n\n// Internal.\n//\nconfig.macros.forEachTiddler.createContext = function(placeParam, whereClauseParam, sortClauseParam, sortAscendingParam, actionNameParam, actionParameterParam, scriptText, tiddlyWikiPathParam, inTiddlerParam) {\n return {\n place : placeParam, \n whereClause : whereClauseParam, \n sortClause : sortClauseParam, \n sortAscending : sortAscendingParam, \n script : scriptText,\n actionName : actionNameParam, \n actionParameter : actionParameterParam,\n tiddlyWikiPath : tiddlyWikiPathParam,\n inTiddler : inTiddlerParam\n };\n};\n\n// Internal.\n//\n// Returns a TiddlyWiki with the tiddlers loaded from the TiddlyWiki of \n// the given path.\n//\nconfig.macros.forEachTiddler.loadTiddlyWiki = function(path, idPrefix) {\n if (!idPrefix) {\n idPrefix = &quot;store&quot;;\n }\n var lenPrefix = idPrefix.length;\n \n // Read the content of the given file\n var content = loadFile(this.getLocalPath(path));\n if(content === null) {\n throw &quot;TiddlyWiki '&quot;+path+&quot;' not found.&quot;;\n }\n \n // Locate the storeArea div's\n var posOpeningDiv = content.indexOf(startSaveArea);\n var posClosingDiv = content.lastIndexOf(endSaveArea);\n if((posOpeningDiv == -1) || (posClosingDiv == -1)) {\n throw &quot;File '&quot;+path+&quot;' is not a TiddlyWiki.&quot;;\n }\n var storageText = content.substr(posOpeningDiv + startSaveArea.length, posClosingDiv);\n \n // Create a &quot;div&quot; element that contains the storage text\n var myStorageDiv = document.createElement(&quot;div&quot;);\n myStorageDiv.innerHTML = storageText;\n myStorageDiv.normalize();\n \n // Create all tiddlers in a new TiddlyWiki\n // (following code is modified copy of TiddlyWiki.prototype.loadFromDiv)\n var tiddlyWiki = new TiddlyWiki();\n var store = myStorageDiv.childNodes;\n for(var t = 0; t &lt; store.length; t++) {\n var e = store[t];\n var title = null;\n if(e.getAttribute)\n title = e.getAttribute(&quot;tiddler&quot;);\n if(!title &amp;&amp; e.id &amp;&amp; e.id.substr(0,lenPrefix) == idPrefix)\n title = e.id.substr(lenPrefix);\n if(title &amp;&amp; title !== &quot;&quot;) {\n var tiddler = tiddlyWiki.createTiddler(title);\n tiddler.loadFromDiv(e,title);\n }\n }\n tiddlyWiki.dirty = false;\n\n return tiddlyWiki;\n};\n\n\n \n// Internal.\n//\n// Returns a function that has a function body returning the given javaScriptExpression.\n// The function has the parameters:\n// \n// (tiddler, context, count, index)\n//\nconfig.macros.forEachTiddler.getEvalTiddlerFunction = function (javaScriptExpression, context) {\n var script = context[&quot;script&quot;];\n var functionText = &quot;var theFunction = function(tiddler, context, count, index) { return &quot;+javaScriptExpression+&quot;}&quot;;\n var fullText = (script ? script+&quot;;&quot; : &quot;&quot;)+functionText+&quot;;theFunction;&quot;;\n return eval(fullText);\n};\n\n// Internal.\n//\nconfig.macros.forEachTiddler.findTiddlers = function(whereClause, context, tiddlyWiki) {\n var result = [];\n var func = config.macros.forEachTiddler.getEvalTiddlerFunction(whereClause, context);\n tiddlyWiki.forEachTiddler(function(title,tiddler) {\n if (func(tiddler, context, undefined, undefined)) {\n result.push(tiddler);\n }\n });\n return result;\n};\n\n// Internal.\n//\nconfig.macros.forEachTiddler.createExtraParameterErrorElement = function(place, actionName, parameter, firstUnusedIndex) {\n var message = &quot;Extra parameter behind '&quot;+actionName+&quot;':&quot;;\n for (var i = firstUnusedIndex; i &lt; parameter.length; i++) {\n message += &quot; &quot;+parameter[i];\n }\n this.handleError(place, message);\n};\n\n// Internal.\n//\nconfig.macros.forEachTiddler.sortAscending = function(tiddlerA, tiddlerB) {\n var result = \n (tiddlerA.forEachTiddlerSortValue == tiddlerB.forEachTiddlerSortValue) \n ? 0\n : (tiddlerA.forEachTiddlerSortValue &lt; tiddlerB.forEachTiddlerSortValue)\n ? -1 \n : +1; \n return result;\n};\n\n// Internal.\n//\nconfig.macros.forEachTiddler.sortDescending = function(tiddlerA, tiddlerB) {\n var result = \n (tiddlerA.forEachTiddlerSortValue == tiddlerB.forEachTiddlerSortValue) \n ? 0\n : (tiddlerA.forEachTiddlerSortValue &lt; tiddlerB.forEachTiddlerSortValue)\n ? +1 \n : -1; \n return result;\n};\n\n// Internal.\n//\nconfig.macros.forEachTiddler.sortTiddlers = function(tiddlers, sortClause, ascending, context) {\n // To avoid evaluating the sortClause whenever two items are compared \n // we pre-calculate the sortValue for every item in the array and store it in a \n // temporary property (&quot;forEachTiddlerSortValue&quot;) of the tiddlers.\n var func = config.macros.forEachTiddler.getEvalTiddlerFunction(sortClause, context);\n var count = tiddlers.length;\n var i;\n for (i = 0; i &lt; count; i++) {\n var tiddler = tiddlers[i];\n tiddler.forEachTiddlerSortValue = func(tiddler,context, undefined, undefined);\n }\n\n // Do the sorting\n tiddlers.sort(ascending ? this.sortAscending : this.sortDescending);\n\n // Delete the temporary property that holds the sortValue. \n for (i = 0; i &lt; tiddlers.length; i++) {\n delete tiddlers[i].forEachTiddlerSortValue;\n }\n};\n\n\n// Internal.\n//\nconfig.macros.forEachTiddler.trace = function(message) {\n displayMessage(message);\n};\n\n// Internal.\n//\nconfig.macros.forEachTiddler.traceMacroCall = function(place,macroName,params) {\n var message =&quot;&lt;&lt;&quot;+macroName;\n for (var i = 0; i &lt; params.length; i++) {\n message += &quot; &quot;+params[i];\n }\n message += &quot;&gt;&gt;&quot;;\n displayMessage(message);\n};\n\n\n// Internal.\n//\n// Creates an element that holds an error message\n// \nconfig.macros.forEachTiddler.createErrorElement = function(place, exception) {\n var message = (exception.description) ? exception.description : exception.toString();\n return createTiddlyElement(place,&quot;span&quot;,null,&quot;forEachTiddlerError&quot;,&quot;&lt;&lt;forEachTiddler ...&gt;&gt;: &quot;+message);\n};\n\n// Internal.\n//\n// @param place [may be null]\n//\nconfig.macros.forEachTiddler.handleError = function(place, exception) {\n if (place) {\n this.createErrorElement(place, exception);\n } else {\n throw exception;\n }\n};\n\n// Internal.\n//\n// Encodes the given string.\n//\n// Replaces \n// &quot;$))&quot; to &quot;&gt;&gt;&quot;\n// &quot;$)&quot; to &quot;&gt;&quot;\n//\nconfig.macros.forEachTiddler.paramEncode = function(s) {\n var reGTGT = new RegExp(&quot;\s\s$\s\s)\s\s)&quot;,&quot;mg&quot;);\n var reGT = new RegExp(&quot;\s\s$\s\s)&quot;,&quot;mg&quot;);\n return s.replace(reGTGT, &quot;&gt;&gt;&quot;).replace(reGT, &quot;&gt;&quot;);\n};\n\n// Internal.\n//\n// Returns the given original path (that is a file path, starting with &quot;file:&quot;)\n// as a path to a local file, in the systems native file format.\n//\n// Location information in the originalPath (i.e. the &quot;#&quot; and stuff following)\n// is stripped.\n// \nconfig.macros.forEachTiddler.getLocalPath = function(originalPath) {\n // Remove any location part of the URL\n var hashPos = originalPath.indexOf(&quot;#&quot;);\n if(hashPos != -1)\n originalPath = originalPath.substr(0,hashPos);\n // Convert to a native file format assuming\n // &quot;file:///x:/path/path/path...&quot; - pc local file --&gt; &quot;x:\spath\spath\spath...&quot;\n // &quot;file://///server/share/path/path/path...&quot; - FireFox pc network file --&gt; &quot;\s\sserver\sshare\spath\spath\spath...&quot;\n // &quot;file:///path/path/path...&quot; - mac/unix local file --&gt; &quot;/path/path/path...&quot;\n // &quot;file://server/share/path/path/path...&quot; - pc network file --&gt; &quot;\s\sserver\sshare\spath\spath\spath...&quot;\n var localPath;\n if(originalPath.charAt(9) == &quot;:&quot;) // pc local file\n localPath = unescape(originalPath.substr(8)).replace(new RegExp(&quot;/&quot;,&quot;g&quot;),&quot;\s\s&quot;);\n else if(originalPath.indexOf(&quot;file://///&quot;) === 0) // FireFox pc network file\n localPath = &quot;\s\s\s\s&quot; + unescape(originalPath.substr(10)).replace(new RegExp(&quot;/&quot;,&quot;g&quot;),&quot;\s\s&quot;);\n else if(originalPath.indexOf(&quot;file:///&quot;) === 0) // mac/unix local file\n localPath = unescape(originalPath.substr(7));\n else if(originalPath.indexOf(&quot;file:/&quot;) === 0) // mac/unix local file\n localPath = unescape(originalPath.substr(5));\n else // pc network file\n localPath = &quot;\s\s\s\s&quot; + unescape(originalPath.substr(7)).replace(new RegExp(&quot;/&quot;,&quot;g&quot;),&quot;\s\s&quot;); \n return localPath;\n};\n\n// ---------------------------------------------------------------------------\n// Stylesheet Extensions (may be overridden by local StyleSheet)\n// ---------------------------------------------------------------------------\n//\nsetStylesheet(\n &quot;.forEachTiddlerError{color: #ffffff;background-color: #880000;}&quot;,\n &quot;forEachTiddler&quot;);\n\n//============================================================================\n// End of forEachTiddler Macro\n//============================================================================\n\n\n//============================================================================\n// String.startsWith Function\n//============================================================================\n//\n// Returns true if the string starts with the given prefix, false otherwise.\n//\nversion.extensions[&quot;String.startsWith&quot;] = {major: 1, minor: 0, revision: 0, date: new Date(2005,11,20), provider: &quot;http://tiddlywiki.abego-software.de&quot;};\n//\nString.prototype.startsWith = function(prefix) {\n var n = prefix.length;\n return (this.length &gt;= n) &amp;&amp; (this.slice(0, n) == prefix);\n};\n\n\n\n//============================================================================\n// String.endsWith Function\n//============================================================================\n//\n// Returns true if the string ends with the given suffix, false otherwise.\n//\nversion.extensions[&quot;String.endsWith&quot;] = {major: 1, minor: 0, revision: 0, date: new Date(2005,11,20), provider: &quot;http://tiddlywiki.abego-software.de&quot;};\n//\nString.prototype.endsWith = function(suffix) {\n var n = suffix.length;\n return (this.length &gt;= n) &amp;&amp; (this.right(n) == suffix);\n};\n\n\n//============================================================================\n// String.contains Function\n//============================================================================\n//\n// Returns true when the string contains the given substring, false otherwise.\n//\nversion.extensions[&quot;String.contains&quot;] = {major: 1, minor: 0, revision: 0, date: new Date(2005,11,20), provider: &quot;http://tiddlywiki.abego-software.de&quot;};\n//\nString.prototype.contains = function(substring) {\n return this.indexOf(substring) &gt;= 0;\n};\n\n//============================================================================\n// Array.indexOf Function\n//============================================================================\n//\n// Returns the index of the first occurance of the given item in the array or \n// -1 when no such item exists.\n//\n// @param item [may be null]\n//\nversion.extensions[&quot;Array.indexOf&quot;] = {major: 1, minor: 0, revision: 0, date: new Date(2005,11,20), provider: &quot;http://tiddlywiki.abego-software.de&quot;};\n//\nArray.prototype.indexOf = function(item) {\n for (var i = 0; i &lt; this.length; i++) {\n if (this[i] == item) {\n return i;\n }\n }\n return -1;\n};\n\n//============================================================================\n// Array.contains Function\n//============================================================================\n//\n// Returns true when the array contains the given item, otherwise false. \n//\n// @param item [may be null]\n//\nversion.extensions[&quot;Array.contains&quot;] = {major: 1, minor: 0, revision: 0, date: new Date(2005,11,20), provider: &quot;http://tiddlywiki.abego-software.de&quot;};\n//\nArray.prototype.contains = function(item) {\n return (this.indexOf(item) &gt;= 0);\n};\n\n//============================================================================\n// Array.containsAny Function\n//============================================================================\n//\n// Returns true when the array contains at least one of the elements \n// of the item. Otherwise (or when items contains no elements) false is returned.\n//\nversion.extensions[&quot;Array.containsAny&quot;] = {major: 1, minor: 0, revision: 0, date: new Date(2005,11,20), provider: &quot;http://tiddlywiki.abego-software.de&quot;};\n//\nArray.prototype.containsAny = function(items) {\n for(var i = 0; i &lt; items.length; i++) {\n if (this.contains(items[i])) {\n return true;\n }\n }\n return false;\n};\n\n\n//============================================================================\n// Array.containsAll Function\n//============================================================================\n//\n// Returns true when the array contains all the items, otherwise false.\n// \n// When items is null false is returned (even if the array contains a null).\n//\n// @param items [may be null] \n//\nversion.extensions[&quot;Array.containsAll&quot;] = {major: 1, minor: 0, revision: 0, date: new Date(2005,11,20), provider: &quot;http://tiddlywiki.abego-software.de&quot;};\n//\nArray.prototype.containsAll = function(items) {\n for(var i = 0; i &lt; items.length; i++) {\n if (!this.contains(items[i])) {\n return false;\n }\n }\n return true;\n};\n\n\n} // of &quot;install only once&quot;\n\n// Used Globals (for JSLint) ==============\n// ... DOM\n/*global document */\n// ... TiddlyWiki Core\n/*global convertUnicodeToUTF8, createTiddlyElement, createTiddlyLink, \n displayMessage, endSaveArea, hasClass, loadFile, saveFile, \n startSaveArea, store, wikify */\n//}}}\n\n\n/***\n!Licence and Copyright\nCopyright (c) abego Software ~GmbH, 2005 ([[www.abego-software.de|http://www.abego-software.de]])\n\nRedistribution and use in source and binary forms, with or without modification,\nare permitted provided that the following conditions are met:\n\nRedistributions of source code must retain the above copyright notice, this\nlist of conditions and the following disclaimer.\n\nRedistributions in binary form must reproduce the above copyright notice, this\nlist of conditions and the following disclaimer in the documentation and/or other\nmaterials provided with the distribution.\n\nNeither the name of abego Software nor the names of its contributors may be\nused to endorse or promote products derived from this software without specific\nprior written permission.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY\nEXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES\nOF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT\nSHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,\nINCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED\nTO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR\nBUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\nCONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN\nANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH\nDAMAGE.\n***/\n\n</div>
<div tiddler="FormTiddlerPlugin" modifier="Saq" modified="200604171221" created="200603041842" tags="systemConfig excludeLists MovieManagerTiddlers">/***\n&lt;&lt;checkForDataTiddlerPlugin&gt;&gt;\n|''Name:''|FormTiddlerPlugin|\n|''Version:''|1.0.5 (2006-02-24)|\n|''Source:''|http://tiddlywiki.abego-software.de/#FormTiddlerPlugin|\n|''Author:''|UdoBorkowski (ub [at] abego-software [dot] de)|\n|''Licence:''|[[BSD open source license]]|\n|''Macros:''|formTiddler, checkForDataTiddlerPlugin, newTiddlerWithForm|\n|''Requires:''|DataTiddlerPlugin|\n|''TiddlyWiki:''|1.2.38+, 2.0|\n|''Browser:''|Firefox 1.0.4+; InternetExplorer 6.0|\n!Description\nUse form-based tiddlers to enter your tiddler data using text fields, listboxes, checkboxes etc. (All standard HTML Form input elements supported).\n\n''Syntax:'' \n|&gt;|{{{&lt;&lt;}}}''formTiddler'' //tiddlerName//{{{&gt;&gt;}}}|\n|//tiddlerName//|The name of the FormTemplate tiddler to be used to edit the data of the tiddler containing the macro.|\n\n|&gt;|{{{&lt;&lt;}}}''newTiddlerWithForm'' //formTemplateName// //buttonLabel// [//titleExpression// [''askUser'']] {{{&gt;&gt;}}}|\n|//formTemplateName//|The name of the tiddler that defines the form the new tiddler should use.|\n|//buttonLabel//|The label of the button|\n|//titleExpression//|A (quoted) JavaScript String expression that defines the title (/name) of the new tiddler.|\n|''askUser''|Typically the user is not asked for the title when a title is specified (and not yet used). When ''askUser'' is given the user will be asked in any case. This may be used when the calculated title is just a suggestion that must be confirmed by the user|\n|&gt;|~~Syntax formatting: Keywords in ''bold'', optional parts in [...]. 'or' means that exactly one of the two alternatives must exist.~~|\n\nFor details and how to use the macros see the [[introduction|FormTiddler Introduction]] and the [[examples|FormTiddler Examples]].\n\n!Revision history\n* v1.0.5 (2006-02-24)\n** Removed &quot;debugger;&quot; instruction\n* v1.0.4 (2006-02-07)\n** Bug: On IE no data is written to data section when field values changed (thanks to KenGirard for reporting)\n* v1.0.3 (2006-02-05)\n** Bug: {{{&quot;No form template specified in &lt;&lt;formTiddler&gt;&gt;&quot;}}} when using formTiddler macro on InternetExplorer (thanks to KenGirard for reporting)\n* v1.0.2 (2006-01-06)\n** Support TiddlyWiki 2.0\n* v1.0.1 (2005-12-22)\n** Features: \n*** Support InternetExplorer\n*** Added newTiddlerWithForm Macro\n* v1.0.0 (2005-12-14)\n** initial version\n\n!Code\n***/\n//{{{\n\n//============================================================================\n//============================================================================\n// FormTiddlerPlugin\n//============================================================================\n//============================================================================\n\n\nversion.extensions.FormTiddlerPlugin = {\n major: 1, minor: 0, revision: 5,\n date: new Date(2006, 2, 24), \n type: 'plugin',\n source: &quot;http://tiddlywiki.abego-software.de/#FormTiddlerPlugin&quot;\n};\n\n// For backward compatibility with v1.2.x\n//\nif (!window.story) window.story=window; \nif (!TiddlyWiki.prototype.getTiddler) TiddlyWiki.prototype.getTiddler = function(title) { return t = this.tiddlers[title]; return (t != undefined &amp;&amp; t instanceof Tiddler) ? t : null; } \n\n//============================================================================\n// formTiddler Macro\n//============================================================================\n\n// -------------------------------------------------------------------------------\n// Configurations and constants \n// -------------------------------------------------------------------------------\n\nconfig.macros.formTiddler = {\n // Standard Properties\n label: &quot;formTiddler&quot;,\n version: {major: 1, minor: 0, revision: 4, date: new Date(2006, 2, 7)},\n prompt: &quot;Edit tiddler data using forms&quot;,\n\n // Define the &quot;setters&quot; that set the values of INPUT elements of a given type\n // (must match the corresponding &quot;getter&quot;)\n setter: { \n button: function(e, value) {/*contains no data */ },\n checkbox: function(e, value) {e.checked = value;},\n file: function(e, value) {try {e.value = value;} catch(e) {/* ignore, possibly security error*/}},\n hidden: function(e, value) {e.value = value;},\n password: function(e, value) {e.value = value;},\n radio: function(e, value) {e.checked = (e.value == value);},\n reset: function(e, value) {/*contains no data */ },\n &quot;select-one&quot;: function(e, value) {config.macros.formTiddler.setSelectOneValue(e,value);},\n &quot;select-multiple&quot;: function(e, value) {config.macros.formTiddler.setSelectMultipleValue(e,value);},\n submit: function(e, value) {/*contains no data */},\n text: function(e, value) {e.value = value;},\n textarea: function(e, value) {e.value = value;}\n },\n\n // Define the &quot;getters&quot; that return the value of INPUT elements of a given type\n // Return undefined to not store any data.\n getter: { \n button: function(e, value) {return undefined;},\n checkbox: function(e, value) {return e.checked;},\n file: function(e, value) {return e.value;},\n hidden: function(e, value) {return e.value;},\n password: function(e, value) {return e.value;},\n radio: function(e, value) {return e.checked ? e.value : undefined;},\n reset: function(e, value) {return undefined;},\n &quot;select-one&quot;: function(e, value) {return config.macros.formTiddler.getSelectOneValue(e);},\n &quot;select-multiple&quot;: function(e, value) {return config.macros.formTiddler.getSelectMultipleValue(e);},\n submit: function(e, value) {return undefined;},\n text: function(e, value) {return e.value;},\n textarea: function(e, value) {return e.value;}\n }\n};\n\n\n// -------------------------------------------------------------------------------\n// The formTiddler Macro Handler \n// -------------------------------------------------------------------------------\n\nconfig.macros.formTiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler) {\n if (!config.macros.formTiddler.checkForExtensions(place, macroName)) {\n return;\n }\n \n // --- Parsing ------------------------------------------\n\n var i = 0; // index running over the params\n\n // get the name of the form template tiddler\n var formTemplateName = undefined;\n if (i &lt; params.length) {\n formTemplateName = params[i];\n i++;\n }\n\n if (!formTemplateName) {\n config.macros.formTiddler.createErrorElement(place, &quot;No form template specified in &lt;&lt;&quot; + macroName + &quot;&gt;&gt;.&quot;);\n return;\n }\n\n\n // --- Processing ------------------------------------------\n\n // Get the form template text. \n // (This contains the INPUT elements for the form.)\n var formTemplateTiddler = store.getTiddler(formTemplateName);\n if (!formTemplateTiddler) {\n config.macros.formTiddler.createErrorElement(place, &quot;Form template '&quot; + formTemplateName + &quot;' not found.&quot;);\n return;\n }\n var templateText = formTemplateTiddler.text;\n if(!templateText) {\n // Shortcut: when template text is empty we do nothing.\n return;\n }\n\n // Get the name of the tiddler containing this &quot;formTiddler&quot; macro\n // (i.e. the tiddler, that will be edited and that contains the data)\n var tiddlerName = config.macros.formTiddler.getContainingTiddlerName(place);\n\n // Append a &quot;form&quot; element. \n var formName = &quot;form&quot;+formTemplateName+&quot;__&quot;+tiddlerName;\n var e = document.createElement(&quot;form&quot;);\n e.setAttribute(&quot;name&quot;, formName);\n place.appendChild(e);\n\n // &quot;Embed&quot; the elements defined by the templateText (i.e. the INPUT elements) \n // into the &quot;form&quot; element we just created\n wikify(templateText, e);\n\n // Initialize the INPUT elements.\n config.macros.formTiddler.initValuesAndHandlersInFormElements(formName, DataTiddler.getDataObject(tiddlerName));\n}\n\n\n// -------------------------------------------------------------------------------\n// Form Data Access \n// -------------------------------------------------------------------------------\n\n// Internal.\n//\n// Initialize the INPUT elements of the form with the values of their &quot;matching&quot;\n// data fields in the tiddler. Also setup the onChange handler to ensure that\n// changes in the INPUT elements are stored in the tiddler's data.\n//\nconfig.macros.formTiddler.initValuesAndHandlersInFormElements = function(formName, data) {\n // config.macros.formTiddler.trace(&quot;initValuesAndHandlersInFormElements(formName=&quot;+formName+&quot;, data=&quot;+data+&quot;)&quot;);\n\n // find the form\n var form = config.macros.formTiddler.findForm(formName);\n if (!form) {\n return;\n }\n\n try {\n var elems = form.elements;\n for (var i = 0; i &lt; elems.length; i++) {\n var c = elems[i];\n \n var setter = config.macros.formTiddler.setter[c.type];\n if (setter) {\n var value = data[c.name];\n if (value != null) {\n setter(c, value);\n }\n c.onchange = onFormTiddlerChange;\n } else {\n config.macros.formTiddler.displayFormTiddlerError(&quot;No setter defined for INPUT element of type '&quot;+c.type+&quot;'. (Element '&quot;+c.name+&quot;' in form '&quot;+formName+&quot;')&quot;);\n }\n }\n } catch(e) {\n config.macros.formTiddler.displayFormTiddlerError(&quot;Error when updating elements with new formData. &quot;+e);\n }\n}\n\n\n// Internal.\n//\n// @return [may be null]\n//\nconfig.macros.formTiddler.findForm = function(formName) {\n // We must manually iterate through the document's forms, since\n // IE does not support the &quot;document[formName]&quot; approach\n\n var forms = window.document.forms;\n for (var i = 0; i &lt; forms.length; i++) {\n var form = forms[i];\n if (form.name == formName) {\n return form;\n }\n }\n\n return null;\n}\n\n\n// Internal.\n//\nconfig.macros.formTiddler.setSelectOneValue = function(element,value) {\n var n = element.options.length;\n for (var i = 0; i &lt; n; i++) {\n element.options[i].selected = element.options[i].value == value;\n }\n}\n\n// Internal.\n//\nconfig.macros.formTiddler.setSelectMultipleValue = function(element,value) {\n var values = {};\n for (var i = 0; i &lt; value.length; i++) {\n values[value[i]] = true;\n }\n \n var n = element.length;\n for (var i = 0; i &lt; n; i++) {\n element.options[i].selected = !(!values[element.options[i].value]);\n }\n}\n\n// Internal.\n//\nconfig.macros.formTiddler.getSelectOneValue = function(element) {\n var i = element.selectedIndex;\n return (i &gt;= 0) ? element.options[i].value : null;\n}\n\n// Internal.\n//\nconfig.macros.formTiddler.getSelectMultipleValue = function(element) {\n var values = [];\n var n = element.length;\n for (var i = 0; i &lt; n; i++) {\n if (element.options[i].selected) {\n values.push(element.options[i].value);\n }\n }\n return values;\n}\n\n\n\n// -------------------------------------------------------------------------------\n// Helpers \n// -------------------------------------------------------------------------------\n\n// Internal.\n//\nconfig.macros.formTiddler.checkForExtensions = function(place,macroName) {\n if (!version.extensions.DataTiddlerPlugin) {\n config.macros.formTiddler.createErrorElement(place, &quot;&lt;&lt;&quot; + macroName + &quot;&gt;&gt; requires the DataTiddlerPlugin. (You can get it from http://tiddlywiki.abego-software.de/#DataTiddlerPlugin)&quot;);\n return false;\n }\n return true;\n}\n\n// Internal.\n//\n// Displays a trace message in the &quot;TiddlyWiki&quot; message pane.\n// (used for debugging)\n//\nconfig.macros.formTiddler.trace = function(s) {\n displayMessage(&quot;Trace: &quot;+s);\n}\n\n// Internal.\n//\n// Display some error message in the &quot;TiddlyWiki&quot; message pane.\n//\nconfig.macros.formTiddler.displayFormTiddlerError = function(s) {\n alert(&quot;FormTiddlerPlugin Error: &quot;+s);\n}\n\n// Internal.\n//\n// Creates an element that holds an error message\n// \nconfig.macros.formTiddler.createErrorElement = function(place, message) {\n return createTiddlyElement(place,&quot;span&quot;,null,&quot;formTiddlerError&quot;,message);\n}\n\n// Internal.\n//\n// Returns the name of the tiddler containing the given element.\n// \nconfig.macros.formTiddler.getContainingTiddlerName = function(element) {\n return story.findContainingTiddler(element).id.substr(7);\n}\n\n// -------------------------------------------------------------------------------\n// Event Handlers \n// -------------------------------------------------------------------------------\n\n// This function must be called by the INPUT elements whenever their\n// data changes. Typically this is done through an &quot;onChange&quot; handler.\n//\nfunction onFormTiddlerChange (e) {\n // config.macros.formTiddler.trace(&quot;onFormTiddlerChange &quot;+e);\n\n if (!e) var e = window.event;\n\n var target = resolveTarget(e);\n var tiddlerName = config.macros.formTiddler.getContainingTiddlerName(target);\n var getter = config.macros.formTiddler.getter[target.type];\n if (getter) {\n var value = getter(target);\n DataTiddler.setData(tiddlerName, target.name, value);\n } else {\n config.macros.formTiddler.displayFormTiddlerError(&quot;No getter defined for INPUT element of type '&quot;+target.type+&quot;'. (Element '&quot;+target.name+&quot;' used in tiddler '&quot;+tiddlerName+&quot;')&quot;);\n }\n}\n\n// ensure that the function can be used in HTML event handler\nwindow.onFormTiddlerChange = onFormTiddlerChange;\n\n\n// -------------------------------------------------------------------------------\n// Stylesheet Extensions (may be overridden by local StyleSheet)\n// -------------------------------------------------------------------------------\n\nsetStylesheet(\n &quot;.formTiddlerError{color: #ffffff;background-color: #880000;}&quot;,\n &quot;formTiddler&quot;);\n\n\n//============================================================================\n// checkForDataTiddlerPlugin Macro\n//============================================================================\n\nconfig.macros.checkForDataTiddlerPlugin = {\n // Standard Properties\n label: &quot;checkForDataTiddlerPlugin&quot;,\n version: {major: 1, minor: 0, revision: 0, date: new Date(2005, 12, 14)},\n prompt: &quot;Check if the DataTiddlerPlugin exists&quot;\n}\n\nconfig.macros.checkForDataTiddlerPlugin.handler = function(place,macroName,params) {\n config.macros.formTiddler.checkForExtensions(place, config.macros.formTiddler.label);\n}\n\n\n\n//============================================================================\n// newTiddlerWithForm Macro\n//============================================================================\n\nconfig.macros.newTiddlerWithForm = {\n // Standard Properties\n label: &quot;newTiddlerWithForm&quot;,\n version: {major: 1, minor: 0, revision: 1, date: new Date(2006, 1, 6)},\n prompt: &quot;Creates a new Tiddler with a &lt;&lt;formTiddler ...&gt;&gt; macro&quot;\n}\n\nconfig.macros.newTiddlerWithForm.handler = function(place,macroName,params) {\n // --- Parsing ------------------------------------------\n\n var i = 0; // index running over the params\n\n // get the name of the form template tiddler\n var formTemplateName = undefined;\n if (i &lt; params.length) {\n formTemplateName = params[i];\n i++;\n }\n\n if (!formTemplateName) {\n config.macros.formTiddler.createErrorElement(place, &quot;No form template specified in &lt;&lt;&quot; + macroName + &quot;&gt;&gt;.&quot;);\n return;\n }\n\n // get the button label\n var buttonLabel = undefined;\n if (i &lt; params.length) {\n buttonLabel = params[i];\n i++;\n }\n\n if (!buttonLabel) {\n config.macros.formTiddler.createErrorElement(place, &quot;No button label specified in &lt;&lt;&quot; + macroName + &quot;&gt;&gt;.&quot;);\n return;\n }\n\n // get the (optional) tiddlerName script and &quot;askUser&quot;\n var tiddlerNameScript = undefined;\n var askUser = false;\n if (i &lt; params.length) {\n tiddlerNameScript = params[i];\n i++;\n\n if (i &lt; params.length &amp;&amp; params[i] == &quot;askUser&quot;) {\n askUser = true;\n i++;\n }\n }\n\n // --- Processing ------------------------------------------\n\n if(!readOnly) {\n var onClick = function() {\n var tiddlerName;\n if (tiddlerNameScript) {\n try {\n tiddlerName = eval(tiddlerNameScript);\n } catch (ex) {\n }\n }\n if (!tiddlerName || askUser) {\n tiddlerName = prompt(&quot;Please specify a tiddler name.&quot;, askUser ? tiddlerName : &quot;&quot;);\n }\n while (tiddlerName &amp;&amp; store.getTiddler(tiddlerName)) {\n tiddlerName = prompt(&quot;A tiddler named '&quot;+tiddlerName+&quot;' already exists.\sn\sn&quot;+&quot;Please specify a tiddler name.&quot;, tiddlerName);\n }\n\n // tiddlerName is either null (user canceled) or a name that is not yet in the store.\n if (tiddlerName) {\n var body = &quot;&lt;&lt;formTiddler [[&quot;+formTemplateName+&quot;]]&gt;&gt;&quot;;\n var tags = [];\n store.saveTiddler(tiddlerName,tiddlerName,body,config.options.txtUserName,new Date(),tags);\n story.displayTiddler(null,tiddlerName,1);\n }\n }\n\n createTiddlyButton(place,buttonLabel,buttonLabel,onClick);\n }\n}\n\n//}}}\n\n\n/***\n!Licence and Copyright\nCopyright (c) abego Software ~GmbH, 2005 ([[www.abego-software.de|http://www.abego-software.de]])\n\nRedistribution and use in source and binary forms, with or without modification,\nare permitted provided that the following conditions are met:\n\nRedistributions of source code must retain the above copyright notice, this\nlist of conditions and the following disclaimer.\n\nRedistributions in binary form must reproduce the above copyright notice, this\nlist of conditions and the following disclaimer in the documentation and/or other\nmaterials provided with the distribution.\n\nNeither the name of abego Software nor the names of its contributors may be\nused to endorse or promote products derived from this software without specific\nprior written permission.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY\nEXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES\nOF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT\nSHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,\nINCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED\nTO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR\nBUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\nCONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN\nANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH\nDAMAGE.\n***/\n</div>
<div tiddler="HtmlFormattingPlugin" modifier="Saq" modified="200604171221" created="200603132159" tags="systemConfig excludeLists MovieManagerTiddlers">/***\n''HTML Formatting Plugin for TiddlyWiki version 1.2.x and 2.0''\n^^author: Eric Shulman - ELS Design Studios\nsource: http://www.TiddlyTools.com/#HTMLFormattingPlugin\nlicense: [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]^^\n\nThe shorthand Wiki-style formatting syntax of ~TiddlyWiki is very convenient and enables most content to be reasonably well presented. However, there are times when tried-and-true HTML formatting syntax allows more more precise control of the content display.\n\nWhen HTML formatting syntax is embedded within a tiddler (in between {{{&lt;}}}{{{html&gt;}}} and {{{&lt;}}}{{{/html&gt;}}} markers) TiddlyWiki passes this content to the browser for processing as 'native' HTML. However, TiddlyWiki does not also process the HTML source content for any embedded wiki-formatting syntax it may contain. This means that while you can use HTML formatted content, you cannot mix wiki-formatted content within the HTML formatting.\n!!!!!Usage\n&lt;&lt;&lt;\nThe ~HTMLFormatting plugin allows you to freely ''mix wiki-style formatting syntax within HTML formatted content'' by extending the action of the standard TiddlyWiki formatting handler.\n\nWhen a tiddler is about to be displayed, ~TiddlyWiki looks for tiddler content contained within ''&lt;{{{html}}}&gt;'' and ''&lt;{{{/html}}}&gt;'' HTML tags. This content (if any) is passed directly to the browser's internal &quot;rendering engine&quot; to process as ~HTML-formatted content. Once the HTML formatting has been processed, all the pieces of text occuring in between the HTML formatting are then processed by the ~TiddlyWiki rendering engine, one piece at a time, so that normal wiki-style formatting can be applied to the individual text pieces.\n&lt;&lt;&lt;\n!!!!!Line breaks\n&lt;&lt;&lt;\nOne major difference between Wiki formatting and HTML formatting is how &quot;line breaks&quot; are processed. Wiki formatting treats all line breaks as literal content to be displayed //as-is//. However, because HTML normally ignores line breaks and actually processes them as simple &quot;word separators&quot; instead, many people who write HTML include extra line breaks in their documents, just to make the &quot;source code&quot; easier to read.\n\nEven though you can use HTML tags within your tiddler content, the default treatment for line breaks still follows the Wiki-style rule (i.e., all new lines are displayed as-is). When adding HTML content to a tiddler (especially if you cut-and-paste it from another web page), you should take care to avoid adding extra line breaks to the text.\n\nIf removing all the extra line breaks from your HTML content would be a big hassle, you can quickly //override the default Wiki-style line break rule// so that the line breaks use the standard HTML rules instead. Placing a ''&lt;{{{hide linebreaks}}}&gt;'' tag within the tiddler's HTML content changes all line breaks to spaces before rendering the content, so that the literal line breaks will be processed as simple word-breaks instead.\n\nNote: this does //not// alter the actual tiddler content that is stored in the document, just the manner in which it is displayed. Any line breaks contained in the tiddler will still be there when you edit its content. Also, to include a literal line break when the ''&lt;{{{hide linebreaks}}}&gt;'' tag is present, you will need to use a ''&lt;{{{br}}}&gt;'' or ''&lt;{{{p}}}&gt;'' HTML tag instead of simply typing a line break.\n&lt;&lt;&lt;\n!!!!!How it works\n&lt;&lt;&lt;\nThe TW core support for HTML does not let you put ANY wiki-style syntax (including TW macros) *inside* the &lt;html&gt;...&lt;/html&gt; block. Everything\nbetween &lt;html&gt; and &lt;/html&gt; is handed to the browser for processing and that is it. Fortunately, this plugin ADDS the ability to let you put wiki-syntax (including macros) inside the html. It does this by first giving the tiddler source content to the browser to process the HTML, and then handling any wiki-based syntax that remains afterward.\n\nHowever, not all wiki syntax can be safely passed through the browser's parser. Specifically, any TW macros inside the HTML will get 'eaten' by the browser since the macro brackets, &quot;&quot;&quot;&lt;&lt;...&gt;&gt;&quot;&quot;&quot; use the &quot;&lt;&quot; and &quot;&gt;&quot; that normally delimit the HTML/XML syntax recognized by the browser's parser.\n\nSimilarly, you can't use InlineJavascript within the HTML because the &quot;&quot;&quot;&lt;script&gt;...&lt;/script&gt;&quot;&quot;&quot; syntax will also be consumed by the browser and there will be nothing left to process afterward. Note: unfortunately, even though the browser removes the &quot;&quot;&quot;&lt;script&gt;...&lt;/script&gt;&quot;&quot;&quot; sequence, it doesn't actually execute the embedded javascript code that it removes, so any scripts contained inside of &lt;html&gt; blocks in TW are currently being ignored. :-(\n\nAs a work-around to allow TW *macros* (but not inline scripts) to exist inside of &lt;html&gt; formatted blocks of content, the plugin first converts the &quot;&quot;&quot;&lt;&lt;&quot;&quot;&quot; and &quot;&quot;&quot;&gt;&gt;&quot;&quot;&quot; into &quot;%%(&quot; and &quot;)%%&quot;, making them &quot;indigestible&quot; so they can pass unchanged through the belly of the beast (the browser's HTML parser).\n\nAfter the browser has done its job, the wiki syntax sequences (including the &quot;undigested&quot; macros) are contained in #text nodes in the browser-generated DOM elements. The plugin then recursively locates and processes each #text node, converts the %%( and )%% back into &quot;&quot;&quot;&lt;&lt; and &gt;&gt;&quot;&quot;&quot;, passes the result to wikify() for further rendering of the wiki-formatted syntax into a containing SPAN that replaces the previous #text node. At the end of this process, none of the encoded %%( and )%% sequences remain in the rendered tiddler output.\n&lt;&lt;&lt;\n!!!!!Installation\n&lt;&lt;&lt;\nimport (or copy/paste) the following tiddlers into your document:\n''HTMLFormattingPlugin'' (tagged with &lt;&lt;tag systemConfig&gt;&gt;)\n^^documentation and javascript for HTMLFormatting handling^^\n&lt;&lt;&lt;\n!!!!!Revision History\n&lt;&lt;&lt;\n''2006.02.19 [2.1.2]''\nin wikifyTextNodes(), put SPAN element into tiddler DOM (replacing text node), BEFORE wikifying the text content. This ensures that the 'place' passed to any macros is correctly defined when the macro is evaluated, so that calls to story.findContainingTiddler(place) will work as expected. (Thanks for bug report from GeoffSlocock)\n''2006.02.05 [2.1.1]''\nwrapped wikifier hijack in init function to eliminate globals and avoid FireFox 1.5.0.1 crash bug when referencing globals\n''2005.12.01 [2.1.0]''\ndon't wikify #TEXT nodes inside SELECT and TEXTAREA elements\n''2005.11.06 [2.0.1]''\ncode cleanup\n''2005.10.31 [2.0.0]''\nreplaced hijack wikify() with hijack config.formatters[&quot;html&quot;] and simplified recursive WikifyTextNodes() code\n''2005.10.09 [1.0.2]''\ncombined documentation and code into a single tiddler\n''2005.08.05 [1.0.1]''\nmoved HTML and CSS definitions into plugin code instead of using separate tiddlers\n''2005.07.26 [1.0.1]''\nRe-released as a plugin.\nAdded &lt;{{{html}}}&gt;...&lt;/{{{nohtml}}}&gt; and &lt;{{{hide newlines}}}&gt; handling\n''2005.07.20 [1.0.0]''\nInitial Release (as code adaptation)\n&lt;&lt;&lt;\n!!!!!Credits\n&lt;&lt;&lt;\nThis feature was developed by EricShulman from [[ELS Design Studios|http:/www.elsdesign.com]]\n&lt;&lt;&lt;\n!!!!!Code\n***/\n//{{{\nversion.extensions.HTMLFormatting = {major: 2, minor: 1, revision: 2, date: new Date(2006,2,19)};\n\n// find the formatter for HTML and replace the handler\ninitHTMLFormatter();\nfunction initHTMLFormatter()\n{\n for (var i=0; i&lt;config.formatters.length &amp;&amp; config.formatters[i].name!=&quot;html&quot;; i++);\n if (i&lt;config.formatters.length) config.formatters[i].handler=function(w) {\n var lookaheadRegExp = new RegExp(this.lookahead,&quot;mg&quot;);\n lookaheadRegExp.lastIndex = w.matchStart;\n var lookaheadMatch = lookaheadRegExp.exec(w.source)\n if(lookaheadMatch &amp;&amp; lookaheadMatch.index == w.matchStart) {\n var html=lookaheadMatch[1];\n // optionally suppress wiki-style literal handling of newlines\n // strip any carriage returns added by Internet Explorer's textarea edit field\n // encode newlines as \sn so Internet Explorer's HTML parser won't eat them\n // encode macro brackets (&lt;&lt; and &gt;&gt;) so HTML parser won't eat them\n if (html.indexOf('&lt;hide linebreaks&gt;')!=-1) html=html.replace(regexpNewLine,' ');\n html=html.replace(regexpCarriageReturn,'');\n html=html.replace(regexpNewLine,'\s\sn');\n html=html.replace(/&lt;&lt;/g,'%%(').replace(/&gt;&gt;/g,')%%');\n // create span to hold HTML\n // parse HTML and normalize the results\n // walk node tree and call wikify() on each text node\n var e = createTiddlyElement(w.output,&quot;span&quot;);\n e.innerHTML=html;\n e.normalize(); \n wikifyTextNodes(e);\n // advance to next parse position\n w.nextMatch=lookaheadMatch.index + lookaheadMatch[0].length;\n }\n }\n}\n\n// wikify text nodes remaining after HTML content is processed (pre-order recursion)\nfunction wikifyTextNodes(theNode)\n{\n for (var i=0;i&lt;theNode.childNodes.length;i++) {\n var theChild=theNode.childNodes.item(i);\n if (theChild.nodeName.toLowerCase()=='option') continue;\n if (theChild.nodeName.toLowerCase()=='select') continue;\n wikifyTextNodes(theChild);\n if (theChild.nodeName=='#text') {\n var txt=theChild.nodeValue;\n // decode macro brackets and newlines\n txt=txt.replace(/\s%%\s(/g,'&lt;&lt;').replace(/\s)\s%%/g,'&gt;&gt;').replace(regexpBackSlashEn,'\sn');\n // replace text node with wikified() span\n var newNode=createTiddlyElement(null,&quot;span&quot;);\n theNode.replaceChild(newNode,theChild);\n wikify(txt,newNode);\n }\n }\n}\n//}}}\n</div>
<div tiddler="ImdbLinkMacro" modifier="Saq" modified="200604171221" created="200602241822" tags="systemConfig excludeLists MovieManagerTiddlers">/***\n|!Name|ImdbLinkMacro|\n|!Created by|Saq|\n|!Source||\n|!Version|1.5|\n!Description\nTurns a movie reference into a link on IMDB. Basically a quick hack of JeremyCowgar 's EsvLinkMacro. All credit belongs to him.\nIt basically appends the movie title at the end of the url {{{http://www.imdb.com/find?q=}}}\n\n!Examples\n{{{&lt;&lt;imdb Institute Benjamenta, or This Dream People Call Human Life&gt;&gt;}}}\n&lt;&lt;imdb Institute Benjamenta, or This Dream People Call Human Life&gt;&gt;\n\n{{{&lt;&lt;imdb &quot;middle&quot; &quot;Institute Benjamenta, or This Dream People Call Human Life&quot;&gt;&gt;}}}\n&lt;&lt;imdb &quot;middle&quot; &quot;Institute Benjamenta, or This Dream People Call Human Life&quot;&gt;&gt;\n\n{{{&lt;&lt;imdb &quot;right&quot; &quot;Institute Benjamenta, or This Dream People Call Human Life&quot;&gt;&gt;}}}\n&lt;&lt;imdb &quot;right&quot; &quot;Institute Benjamenta, or This Dream People Call Human Life&quot;&gt;&gt;\n\n!Notes\nTo make the macro work you have to give this tiddler a tag of systemConfig then save and reload.\n\nAlso, what this essentially does is search for the movie on Imdb. So if you want to to be taken directly to the movie and not a search page, change your search preferences at http://www.imdb.com/find/preferences and choose 'Always redirect to first result'.\n\nIf anyone knows a better way to do this, please let me know.\n\n!Todo\n\n!Code\n***/\n//{{{\nconfig.macros.imdb = {};\nconfig.macros.imdb.handler= function(place,macroName,params) {\nif ((params.length==2) &amp;&amp; ((params[0]==&quot;right&quot;) || (params[0]==&quot;middle&quot;)))\n{\n var searchterm = params[1];\n var mode = params[0];}\nelse\n var searchterm = params.join(' ');\n // the maximum length of the links\n var mustlength=30;\n // the string added to or in the middle of the link text after shortening\n var connector='...';\n \n\nif ((searchterm.length&gt;mustlength) &amp;&amp; (mode!=null)) {\n switch(mode){\n case 'middle':\n var searchtitle =searchterm.substr(0,mustlength/2)+connector+searchterm.substr(searchterm.length-mustlength/2-connector.length,searchterm.length);\n break;\n case 'right':\n var searchtitle =searchterm.substr(0,mustlength-connector.length)+connector;\n break;\n }\n}\nelse\nsearchtitle = searchterm;\nvar x = 'http://imdb.com/find?q=';\nvar x2 = ' on IMDB';\n var theLink = document.createElement(&quot;a&quot;);\n theLink.className = &quot;externalLink&quot;;\n theLink.target = &quot;_blank&quot;;\n theLink.href = x+searchterm.replace(/ /g, '+') +';tt=on;nm=on;mx=20;';\n theLink.title = searchterm + x2;\n place.appendChild(theLink);\n theLink.appendChild(document.createTextNode(searchtitle))\n}\n\n\n\n//}}}\n </div>
<div tiddler="ImportTiddlersPlugin" modifier="Saq" modified="200604171221" created="200604170908" tags="systemConfig excludeLists MovieManagerTiddlers">/***\n''Import Tiddlers Plugin for TiddlyWiki version 1.2.x, 2.0 and 2.1beta''\n^^author: Eric Shulman - ELS Design Studios\nsource: http://www.TiddlyTools.com/#ImportTiddlersPlugin\nlicense: [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]^^\n\nWhen many people share and edit copies of the same TiddlyWiki document, the ability to quickly collect all these changes back into a single, updated document that can then be redistributed to the entire group is very important. This plugin lets you selectively combine tiddlers from any two TiddlyWiki documents. It can also be very useful when moving your own tiddlers from document to document (e.g., when upgrading to the latest version of TiddlyWiki, or 'pre-loading' your favorite stylesheets into a new 'empty' TiddlyWiki document.)\n\n!!!!!Interactive interface\n&lt;&lt;&lt;\n{{{&lt;&lt;importTiddlers&gt;&gt;}}}\ncreates &quot;import tiddlers&quot; link. click to show/hide import control panel\n\n{{{&lt;&lt;importTiddlers inline&gt;&gt;}}}\ncreates import control panel directly in tiddler content\n\n&lt;&lt;importTiddlers inline&gt;&gt;\n\nPress ''[browse]'' to select a TiddlyWiki document file to import. You can also type in the path/filename or a remote document URL (starting with http://)and press ''[open]''. //Note: There may be some delay to permit the browser time to access and load the document before updating the listbox with the titles of all tiddlers that are available to be imported.//\n\nSelect one or more titles from the listbox (hold CTRL or SHIFT while clicking to add/remove the highlight from individual list items). You can press ''[select all]'' to quickly highlight all tiddler titles in the list. Use the ''[-]'', ''[+]'', or ''[=]'' links to adjust the listbox size so you can view more (or less) tiddler titles at one time. When you have chosen the tiddlers you want to import and entered any extra tags, press ''[import]'' to begin copying them to the current TiddlyWiki document.\n\n''select: all, new, changes, or differences''\n\nYou can click on ''all'', ''new'', ''changes'', or ''differences'' to automatically select a subset of tiddlers from the list. This makes it very quick and easy to find and import just the updated tiddlers you are interested in:\n&gt;''&quot;all&quot;'' selects ALL tiddlers from the import source document, even if they have not been changed.\n&gt;''&quot;new&quot;'' selects only tiddlers that are found in the import source document, but do not yet exist in the destination document\n&gt;''&quot;changes&quot;'' selects only tiddlers that exist in both documents but that are newer in the source document\n&gt;''&quot;differences&quot;'' selects all new and existing tiddlers that are different from the destination document (even if destination tiddler is newer)\n\n''Import Tagging:''\n\nTiddlers that have been imported can be automatically tagged, so they will be easier to find later on, after they have been added to your document. New tags are entered into the &quot;add tags&quot; input field, and then //added// to the existing tags for each tiddler as it is imported.\n\n''Skip, Rename, Merge, or Replace:''\n\nWhen importing a tiddler whose title is identical to one that already exists, the import process pauses and the tiddler title is displayed in an input field, along with four push buttons: ''[skip]'', ''[rename]'', ''[merge]'' and ''[replace]''.\n\nTo bypass importing this tiddler, press ''[skip]''. To import the tiddler with a different name (so that both the tiddlers will exist when the import is done), enter a new title in the input field and then press ''[rename]''. Press ''[merge]'' to combine the content from both tiddlers into a single tiddler. Press ''[replace]'' to overwrite the existing tiddler with the imported one, discarding the previous tiddler content.\n\n//Note: if both the title ''and'' modification date/////time match, the imported tiddler is assumed to be identical to the existing one, and will be automatically skipped (i.e., not imported) without asking.//\n\n''Import Report History''\n\nWhen tiddlers are imported, a report is generated into ImportedTiddlers, indicating when the latest import was performed, the number of tiddlers successfully imported, from what location, and by whom. It also includes a list with the title, date and author of each tiddler that was imported.\n\nWhen the import process is completed, the ImportedTiddlers report is automatically displayed for your review. If more tiddlers are subsequently imported, a new report is //added// to ImportedTiddlers, above the previous report (i.e., at the top of the tiddler), so that a reverse-chronological history of imports is maintained.\n\nIf a cumulative record is not desired, the ImportedTiddlers report may be deleted at any time. A new ImportedTiddlers report will be created the next time tiddlers are imported.\n\nNote: You can prevent the ImportedTiddlers report from being generated for any given import activity by clearing the &quot;create a report&quot; checkbox before beginning the import processing.\n\n&lt;&lt;&lt;\n!!!!!non-interactive 'load tiddlers' macro\n&lt;&lt;&lt;\nUseful for automated installation/update of plugins and other tiddler content.\n\n{{{&lt;&lt;loadTiddlers &quot;label:load tiddlers from %0&quot; http://www.tiddlytools.com/example.html confirm&gt;&gt;}}}\n&lt;&lt;loadTiddlers &quot;label:load tiddlers from %0&quot; http://www.tiddlytools.com/example.html confirm&gt;&gt;\n\nSyntax:\n{{{&lt;&lt;loadTiddlers label:text prompt:text filter source quiet confirm&gt;&gt;}}}\n\n''label:text'' and ''prompt:text''\n&gt;defines link text and tooltip (prompt) that can be clicked to trigger the load tiddler processing. If a label is NOT provided, then no link is created and loadTiddlers() is executed whenever the containing tiddler is rendered.\n''filter'' (optional) determines which tiddlers will be automatically selected for importing. Use one of the following keywords:\n&gt;''&quot;all&quot;'' retrieves ALL tiddlers from the import source document, even if they have not been changed.\n&gt;''&quot;new&quot;'' retrieves only tiddlers that are found in the import source document, but do not yet exist in the destination document\n&gt;''&quot;changes&quot;'' retrieves only tiddlers that exist in both documents for which the import source tiddler is newer than the existing tiddler\n&gt;''&quot;updates&quot;'' retrieves both ''new'' and ''changed'' tiddlers (this is the default action when none is specified)\n&gt;''&quot;tiddler:~TiddlerName&quot;'' retrieves only the specific tiddler named in the parameter.\n&gt;''&quot;tag:text&quot;'' retrieves only the tiddlers tagged with the indicated text.\n''source'' (required) is the location of the imported document. It can be either a local document path/filename in whatever format your system requires, or a remote web location (starting with &quot;http://&quot; or &quot;https://&quot;)\n&gt;use the keyword ''ask'' to prompt for a source location whenever the macro is invoked\n''&quot;quiet&quot;'' (optional)\n&gt;supresses all status message during the import processing (e.g., &quot;opening local file...&quot;, &quot;found NN tiddlers...&quot; etc). Note that if ANY tiddlers are actualy imported, a final information message will still be displayed (along with the ImportedTiddlers report), even when 'quiet' is specified. This ensures that changes to your document cannot occur without any visible indication at all.\n''&quot;confirm&quot;'' (optional)\n&gt;adds interactive confirmation. A browser message box (OK/Cancel) is displayed for each tiddler that will be imported, so that you can manually bypass any tiddlers that you do not want to import.\n&lt;&lt;&lt;\n!!!!!Installation\n&lt;&lt;&lt;\ncopy/paste the following tiddlers into your document:\n''ImportTiddlersPlugin'' (tagged with &lt;&lt;tag systemConfig&gt;&gt;)\n\ncreate/edit ''SideBarOptions'': (sidebar menu items) \n^^Add &quot;&lt; &lt; ImportTiddlers &gt; &gt;&quot; macro^^\n\n''Quick Installation Tip #1:''\nIf you are using an unmodified version of TiddlyWiki (core release version &lt;&lt;version&gt;&gt;), you can get a new, empty TiddlyWiki with the Import Tiddlers plugin pre-installed (''[[download from here|TW+ImportExport.html]]''), and then simply import all your content from your old document into this new, empty document.\n&lt;&lt;&lt;\n!!!!!Revision History\n&lt;&lt;&lt;\n''2006.04.12 [3.0.3]''\nmoved many display messages to macro properties for easier L10N translations via 'lingo' definitions.\n''2006.04.12 [3.0.2]''\nadditional refactoring of 'core candidate' code. Proposed API now defines &quot;loadRemoteFile()&quot; for XMLHttpRequest processing with built in fallback for handling local filesystem access, and readTiddlersFromHTML() to process the resulting source HTML content.\n''2006.04.04 [3.0.1]''\nin refreshImportList(), when using [by tags], tiddlers without tags are now included in a new &quot;untagged&quot; psuedo-tag list section\n''2006.04.04 [3.0.0]''\nSeparate non-interactive {{{&lt;&lt;importTiddlers...&gt;&gt;}}} macro functionality for incorporation into TW2.1 core and renamed as {{{&lt;&lt;loadTiddlers&gt;&gt;}}} macro. New parameters for loadTiddlers: ''label:text'' and ''prompt:text'' for link creation, ''ask'' for filename/URL, ''tag:text'' for filtering, &quot;confirm&quot; for accept/reject of individual inbound tiddlers. Also, ImportedTiddlers report generator output has been simplified and &quot;importReplace/importPublic&quot; tags and associated &quot;force&quot; param (which were rarely, if ever, used) has been dropped.\n''2006.03.30 [2.9.1]''\nwhen extracting store area from remote URL, look for &quot;&lt;/body&gt;&quot; instead of &quot;&lt;/body&gt;\sn&lt;/html&gt;&quot; so it will match even if the &quot;\sn&quot; is absent from the source.\n''2006.03.30 [2.9.0]''\nadded optional 'force' macro param. When present, autoImportTiddlers() bypasses the checks for importPublic and importReplace. Based on a request from Tom Otvos.\n''2006.03.28 [2.8.1]''\nin loadImportFile(), added checks to see if 'netscape' and 'x.overrideMimeType()' are defined (IE does *not* define these values, so we bypass this code)\nAlso, when extracting store area from remote URL, explicitly look for &quot;&lt;/body&gt;\sn&lt;/html&gt;&quot; to exclude any extra content that may have been added to the end of the file by hosting environments such as GeoCities. Thanks to Tom Otvos for finding these bugs and suggesting some fixes.\n''2006.02.21 [2.8.0]''\nadded support for &quot;tiddler:TiddlerName&quot; filtering parameter in auto-import processing\n''2006.02.21 [2.7.1]''\nClean up layout problems with IE. (Use tables for alignment instead of SPANs styled with float:left and float:right)\n''2006.02.21 [2.7.0]''\nAdded &quot;local file&quot; and &quot;web server&quot; radio buttons for selecting dynamic import source controls in ImportPanel. Default file control is replaced with URL text input field when &quot;web server&quot; is selected. Default remote document URL is defined in SiteURL tiddler. Also, added option for prepending SiteProxy URL as prefix to remote URL to mask cross-domain document access (requires compatible server-side script)\n''2006.02.17 [2.6.0]''\nRemoved &quot;differences only&quot; listbox display mode, replaced with selection filter 'presets': all/new/changes/differences. Also fixed initialization handling for &quot;add new tags&quot; so that checkbox state is correctly tracked when panel is first displayed.\n''2006.02.16 [2.5.4]''\nadded checkbox options to control &quot;import remote tags&quot; and &quot;keep existing tags&quot; behavior, in addition to existing &quot;add new tags&quot; functionality.\n''2006.02.14 [2.5.3]''\nFF1501 corrected unintended global 't' (loop index) in importReport() and autoImportTiddlers()\n''2006.02.10 [2.5.2]''\ncorrected unintended global variable in importReport().\n''2006.02.05 [2.5.1]''\nmoved globals from window.* to config.macros.importTiddlers.* to avoid FireFox 1.5.0.1 crash bug when referencing globals\n''2006.01.18 [2.5.0]''\nadded checkbox for &quot;create a report&quot;. Default is to create/update the ImportedTiddlers report. Clear the checkbox to skip this step.\n''2006.01.15 [2.4.1]''\nadded &quot;importPublic&quot; tag and inverted default so that auto sharing is NOT done unless tagged with importPublic\n''2006.01.15 [2.4.0]''\nAdded support for tagging individual tiddlers with importSkip, importReplace, and/or importPrivate to control which tiddlers can be overwritten or shared with others when using auto-import macro syntax. Defaults are to SKIP overwriting existing tiddlers with imported tiddlers, and ALLOW your tiddlers to be auto-imported by others.\n''2006.01.15 [2.3.2]''\nAdded &quot;ask&quot; parameter to confirm each tiddler before importing (for use with auto-importing)\n''2006.01.15 [2.3.1]''\nStrip TW core scripts from import source content and load just the storeArea into the hidden IFRAME. Makes loading more efficient by reducing the document size and by preventing the import document from executing its TW initialization (including plugins). Seems to resolve the &quot;Found 0 tiddlers&quot; problem. Also, when importing local documents, use convertUTF8ToUnicode() to convert the file contents so support international characters sets.\n''2006.01.12 [2.3.0]''\nReorganized code to use callback function for loading import files to support event-driven I/O via an ASYNCHRONOUS XMLHttpRequest. Let's processing continue while waiting for remote hosts to respond to URL requests. Added non-interactive 'batch' macro mode, using parameters to specify which tiddlers to import, and from what document source. Improved error messages and diagnostics, plus an optional 'quiet' switch for batch mode to eliminate //most// feedback.\n''2006.01.11 [2.2.0]''\nAdded &quot;[by tags]&quot; to list of tiddlers, based on code submitted by BradleyMeck\n''2006.01.09 [2.1.1]''\nWhen a URL is typed in, and then the &quot;open&quot; button is pressed, it generates both an onChange event for the file input and a click event for open button. This results in multiple XMLHttpRequest()'s which seem to jam things up quite a bit. I removed the onChange handling for file input field. To open a file (local or URL), you must now explicitly press the &quot;open&quot; button in the control panel.\n''2006.01.08 [2.1.0]''\nIMPORT FROM ANYWHERE!!! re-write getImportedTiddlers() logic to either read a local file (using local I/O), OR... read a remote file, using a combination of XML and an iframe to permit cross-domain reading of DOM elements. Adapted from example code and techniques courtesy of Jonny LeRoy.\n''2006.01.06 [2.0.2]''\nWhen refreshing list contents, fixed check for tiddlerExists() when &quot;show differences only&quot; is selected, so that imported tiddlers that don't exist in the current file will be recognized as differences and included in the list.\n''2006.01.04 [2.0.1]''\nWhen &quot;show differences only&quot; is NOT checked, import all tiddlers that have been selected even when they have a matching title and date.\n''2005.12.27 [2.0.0]''\nUpdate for TW2.0\nDefer initial panel creation and only register a notification function when panel first is created\n''2005.12.22 [1.3.1]''\ntweak formatting in importReport() and add 'discard report' link to output\n''2005.12.03 [1.3.0]''\nDynamically create/remove importPanel as needed to ensure only one instance of interface elements exists, even if there are multiple instances of macro embedding. Also, dynamically create/recreate importFrame each time an external TW document is loaded for importation (reduces DOM overhead and ensures a 'fresh' frame for each document)\n''2005.11.29 [1.2.1]''\nfixed formatting of 'detail info' in importReport()\n''2005.11.11 [1.2.0]''\nadded 'inline' param to embed controls in a tiddler\n''2005.11.09 [1.1.0]''\nonly load HTML and CSS the first time the macro handler is called. Allows for redundant placement of the macro without creating multiple instances of controls with the same ID's.\n''2005.10.25 [1.0.5]''\nfixed typo in importReport() that prevented reports from being generated\n''2005.10.09 [1.0.4]''\ncombined documentation with plugin code instead of using separate tiddlers\n''2005.08.05 [1.0.3]''\nmoved CSS and HTML definitions into plugin code instead of using separate tiddlers\n''2005.07.27 [1.0.2]''\ncore update 1.2.29: custom overlayStyleSheet() replaced with new core setStylesheet()\n''2005.07.23 [1.0.1]''\nadded parameter checks and corrected addNotification() usage\n''2005.07.20 [1.0.0]''\nInitial Release\n&lt;&lt;&lt;\n!!!!!Credits\n&lt;&lt;&lt;\nThis feature was developed by EricShulman from [[ELS Design Studios|http:/www.elsdesign.com]]\n&lt;&lt;&lt;\n!!!!!Code\n***/\n// // ''MACRO DEFINITION''\n//{{{\n// Version\nversion.extensions.importTiddlers = {major: 3, minor: 0, revision: 3, date: new Date(2006,4,12)};\n\n// IE needs explicit global scoping for functions/vars called from browser events\nwindow.onClickImportButton=onClickImportButton;\nwindow.refreshImportList=refreshImportList;\n\n// default cookie/option values\nif (!config.options.chkImportReport) config.options.chkImportReport=true;\n\nconfig.macros.importTiddlers = { };\nconfig.macros.importTiddlers = {\n label: &quot;import tiddlers&quot;,\n prompt: &quot;Copy tiddlers from another document&quot;,\n foundMsg: &quot;Found %0 tiddlers in %1&quot;,\n countMsg: &quot;%0 tiddlers selected for import&quot;,\n importedMsg: &quot;Imported %0 of %1 tiddlers from %2&quot;,\n src: &quot;&quot;, // path/filename or URL of document to import (retrieved from SiteUrl tiddler)\n proxy: &quot;&quot;, // URL for remote proxy script (retrieved from SiteProxy tiddler)\n useProxy: false, // use specific proxy script in front of remote URL\n inbound: null, // hash-indexed array of tiddlers from other document\n newTags: &quot;&quot;, // text of tags added to imported tiddlers\n addTags: true, // add new tags to imported tiddlers\n listsize: 8, // # of lines to show in imported tiddler list\n importTags: true, // include tags from remote source document when importing a tiddler\n keepTags: true, // retain existing tags when replacing a tiddler\n index: 0, // current processing index in import list\n sort: &quot;&quot; // sort order for imported tiddler listbox\n};\n\nconfig.macros.importTiddlers.handler = function(place,macroName,params) {\n if (!config.macros.loadTiddlers.handler)\n { alert(&quot;importTiddlers error: this plugin requires LoadTiddlersPlugin or TiddlyWiki 2.1+&quot;); return; }\n if (!params[0]) // LINK TO FLOATING PANEL\n createTiddlyButton(place,this.label,this.prompt,onClickImportMenu);\n else if (params[0]==&quot;inline&quot;) {// // INLINE TIDDLER CONTENT\n createImportPanel(place);\n document.getElementById(&quot;importPanel&quot;).style.position=&quot;static&quot;;\n document.getElementById(&quot;importPanel&quot;).style.display=&quot;block&quot;;\n }\n else config.macros.loadTiddlers.handler(place,macroName,params); // FALLBACK: PASS TO LOADTIDDLERS\n}\n//}}}\n\n// // ''INTERFACE DEFINITION''\n\n// // Handle link click to create/show/hide control panel\n//{{{\nfunction onClickImportMenu(e)\n{\n if (!e) var e = window.event;\n var parent=resolveTarget(e).parentNode;\n var panel = document.getElementById(&quot;importPanel&quot;);\n if (panel==undefined || panel.parentNode!=parent)\n panel=createImportPanel(parent);\n var isOpen = panel.style.display==&quot;block&quot;;\n if(config.options.chkAnimate)\n anim.startAnimating(new Slider(panel,!isOpen,e.shiftKey || e.altKey,&quot;none&quot;));\n else\n panel.style.display = isOpen ? &quot;none&quot; : &quot;block&quot; ;\n e.cancelBubble = true;\n if (e.stopPropagation) e.stopPropagation();\n return(false);\n}\n//}}}\n\n// // Create control panel: HTML, CSS, register for notification\n//{{{\nfunction createImportPanel(place) {\n var panel=document.getElementById(&quot;importPanel&quot;);\n if (panel) { panel.parentNode.removeChild(panel); }\n setStylesheet(config.macros.importTiddlers.css,&quot;importTiddlers&quot;);\n panel=createTiddlyElement(place,&quot;span&quot;,&quot;importPanel&quot;,null,null)\n panel.innerHTML=config.macros.importTiddlers.html;\n store.addNotification(null,refreshImportList); // refresh listbox after every tiddler change\n refreshImportList();\n var siteURL=store.getTiddlerText(&quot;SiteUrl&quot;); if (!siteURL) siteURL=&quot;&quot;;\n document.getElementById(&quot;importSourceURL&quot;).value=siteURL;\n config.macros.importTiddlers.src=siteURL;\n var siteProxy=store.getTiddlerText(&quot;SiteProxy&quot;); if (!siteProxy) siteProxy=&quot;SiteProxy&quot;;\n document.getElementById(&quot;importSiteProxy&quot;).value=siteProxy;\n config.macros.importTiddlers.proxy=siteProxy;\n return panel;\n}\n//}}}\n\n// // CSS\n//{{{\nconfig.macros.importTiddlers.css = '\s\n#importPanel {\s\n display: none; position:absolute; z-index:11; width:35em; right:105%; top:3em;\s\n background-color: #eee; color:#000; font-size: 8pt; line-height:110%;\s\n border:1px solid black; border-bottom-width: 3px; border-right-width: 3px;\s\n padding: 0.5em; margin:0em; -moz-border-radius:1em;\s\n}\s\n#importPanel a, #importPanel td a { color:#009; display:inline; margin:0px; padding:1px; }\s\n#importPanel table { width:100%; border:0px; padding:0px; margin:0px; font-size:8pt; line-height:110%; background:transparent; }\s\n#importPanel tr { border:0px;padding:0px;margin:0px; background:transparent; }\s\n#importPanel td { color:#000; border:0px;padding:0px;margin:0px; background:transparent; }\s\n#importPanel select { width:98%;margin:0px;font-size:8pt;line-height:110%;}\s\n#importPanel input { width:98%;padding:0px;margin:0px;font-size:8pt;line-height:110%}\s\n#importPanel .box { border:1px solid black; padding:3px; margin-bottom:5px; background:#f8f8f8; -moz-border-radius:5px;}\s\n#importPanel .topline { border-top:2px solid black; padding-top:3px; margin-bottom:5px; }\s\n#importPanel .rad { width:auto; }\s\n#importPanel .chk { width:auto; margin:1px; }\s\n#importPanel .btn { width:auto; }\s\n#importPanel .btn1 { width:98%; }\s\n#importPanel .btn2 { width:48%; }\s\n#importPanel .btn3 { width:32%; }\s\n#importPanel .btn4 { width:24%; }\s\n#importPanel .btn5 { width:19%; }\s\n#importPanel .importButton { padding: 0em; margin: 0px; font-size:8pt; }\s\n#importPanel .importListButton { padding:0em 0.25em 0em 0.25em; color: #000000; display:inline }\s\n#importCollisionPanel { display:none; margin:0.5em 0em 0em 0em; }\s\n';\n//}}}\n\n// // HTML \n//{{{\nconfig.macros.importTiddlers.html = '\s\n&lt;!-- source and report --&gt;\s\n&lt;table&gt;&lt;tr&gt;&lt;td align=left&gt;\s\n import from\s\n &lt;input type=&quot;radio&quot; class=&quot;rad&quot; name=&quot;importFrom&quot; value=&quot;file&quot; CHECKED\s\n onClick=&quot;document.getElementById(\s'importLocalPanel\s').style.display=this.checked?\s'block\s':\s'none\s';\s\n document.getElementById(\s'importHTTPPanel\s').style.display=!this.checked?\s'block\s':\s'none\s'&quot;&gt; local file\s\n &lt;input type=&quot;radio&quot; class=&quot;rad&quot; name=&quot;importFrom&quot; value=&quot;http&quot;\s\n onClick=&quot;document.getElementById(\s'importLocalPanel\s').style.display=!this.checked?\s'block\s':\s'none\s';\s\n document.getElementById(\s'importHTTPPanel\s').style.display=this.checked?\s'block\s':\s'none\s'&quot;&gt; web server\s\n&lt;/td&gt;&lt;td align=right&gt;\s\n &lt;input type=checkbox class=&quot;chk&quot; id=&quot;chkImportReport&quot; checked\s\n onClick=&quot;config.options[\s'chkImportReport\s']=this.checked;&quot;&gt; create a report\s\n&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;\s\n&lt;!-- import from local file --&gt;\s\n&lt;div id=&quot;importLocalPanel&quot; style=&quot;display:block;margin-bottom:5px;margin-top:5px;padding-top:3px;border-top:1px solid #999&quot;&gt;\s\nlocal document path/filename:&lt;br&gt;\s\n&lt;input type=&quot;file&quot; id=&quot;fileImportSource&quot; size=57 style=&quot;width:100%&quot;\s\n onKeyUp=&quot;config.macros.importTiddlers.src=this.value&quot;\s\n onChange=&quot;config.macros.importTiddlers.src=this.value;&quot;&gt;\s\n&lt;/div&gt;&lt;!--panel--&gt;\s\n\s\n&lt;!-- import from http server --&gt;\s\n&lt;div id=&quot;importHTTPPanel&quot; style=&quot;display:none;margin-bottom:5px;margin-top:5px;padding-top:3px;border-top:1px solid #999&quot;&gt;\s\n&lt;table&gt;&lt;tr&gt;&lt;td align=left&gt;\s\n remote document URL:&lt;br&gt;\s\n&lt;/td&gt;&lt;td align=right&gt;\s\n &lt;input type=&quot;checkbox&quot; class=&quot;chk&quot; id=&quot;importUseProxy&quot;\s\n onClick=&quot;config.macros.importTiddlers.useProxy=this.checked;\s\n document.getElementById(\s'importSiteProxy\s').style.display=this.checked?\s'block\s':\s'none\s'&quot;&gt; use a proxy script\s\n&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;\s\n&lt;input type=&quot;text&quot; id=&quot;importSiteProxy&quot; style=&quot;display:none;margin-bottom:1px&quot; onfocus=&quot;this.select()&quot; value=&quot;SiteProxy&quot;\s\n onKeyUp=&quot;config.macros.importTiddlers.proxy=this.value&quot;\s\n onChange=&quot;config.macros.importTiddlers.proxy=this.value;&quot;&gt;\s\n&lt;input type=&quot;text&quot; id=&quot;importSourceURL&quot; onfocus=&quot;this.select()&quot; value=&quot;SiteUrl&quot;\s\n onKeyUp=&quot;config.macros.importTiddlers.src=this.value&quot;\s\n onChange=&quot;config.macros.importTiddlers.src=this.value;&quot;&gt;\s\n&lt;/div&gt;&lt;!--panel--&gt;\s\n\s\n&lt;table&gt;&lt;tr&gt;&lt;td align=left&gt;\s\n select:\s\n &lt;a href=&quot;JavaScript:;&quot; id=&quot;importSelectAll&quot;\s\n onclick=&quot;onClickImportButton(this)&quot; title=&quot;select all tiddlers&quot;&gt;\s\n &amp;nbsp;all&amp;nbsp;&lt;/a&gt;\s\n &lt;a href=&quot;JavaScript:;&quot; id=&quot;importSelectNew&quot;\s\n onclick=&quot;onClickImportButton(this)&quot; title=&quot;select tiddlers not already in destination document&quot;&gt;\s\n &amp;nbsp;added&amp;nbsp;&lt;/a&gt; \s\n &lt;a href=&quot;JavaScript:;&quot; id=&quot;importSelectChanges&quot;\s\n onclick=&quot;onClickImportButton(this)&quot; title=&quot;select tiddlers that have been updated in source document&quot;&gt;\s\n &amp;nbsp;changes&amp;nbsp;&lt;/a&gt; \s\n &lt;a href=&quot;JavaScript:;&quot; id=&quot;importSelectDifferences&quot;\s\n onclick=&quot;onClickImportButton(this)&quot; title=&quot;select tiddlers that have been added or are different from existing tiddlers&quot;&gt;\s\n &amp;nbsp;differences&amp;nbsp;&lt;/a&gt; \s\n &lt;a href=&quot;JavaScript:;&quot; id=&quot;importToggleFilter&quot;\s\n onclick=&quot;onClickImportButton(this)&quot; title=&quot;show/hide selection filter&quot;&gt;\s\n &amp;nbsp;filter&amp;nbsp;&lt;/a&gt; \s\n&lt;/td&gt;&lt;td align=right&gt;\s\n &lt;a href=&quot;JavaScript:;&quot; id=&quot;importListSmaller&quot;\s\n onclick=&quot;onClickImportButton(this)&quot; title=&quot;reduce list size&quot;&gt;\s\n &amp;nbsp;&amp;#150;&amp;nbsp;&lt;/a&gt;\s\n &lt;a href=&quot;JavaScript:;&quot; id=&quot;importListLarger&quot;\s\n onclick=&quot;onClickImportButton(this)&quot; title=&quot;increase list size&quot;&gt;\s\n &amp;nbsp;+&amp;nbsp;&lt;/a&gt;\s\n &lt;a href=&quot;JavaScript:;&quot; id=&quot;importListMaximize&quot;\s\n onclick=&quot;onClickImportButton(this)&quot; title=&quot;maximize/restore list size&quot;&gt;\s\n &amp;nbsp;=&amp;nbsp;&lt;/a&gt;\s\n&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;\s\n&lt;select id=&quot;importList&quot; size=8 multiple\s\n onchange=&quot;setTimeout(\s'refreshImportList(\s'+this.selectedIndex+\s')\s',1)&quot;&gt;\s\n &lt;!-- NOTE: delay refresh so list is updated AFTER onchange event is handled --&gt;\s\n&lt;/select&gt;\s\n&lt;input type=checkbox class=&quot;chk&quot; id=&quot;chkAddTags&quot; checked\s\n onClick=&quot;config.macros.importTiddlers.addTags=this.checked;&quot;&gt;add new tags &amp;nbsp;\s\n&lt;input type=checkbox class=&quot;chk&quot; id=&quot;chkImportTags&quot; checked\s\n onClick=&quot;config.macros.importTiddlers.importTags=this.checked;&quot;&gt;import source tags &amp;nbsp;\s\n&lt;input type=checkbox class=&quot;chk&quot; id=&quot;chkKeepTags&quot; checked\s\n onClick=&quot;config.macros.importTiddlers.keepTags=this.checked;&quot;&gt;keep existing tags&lt;br&gt;\s\n&lt;input type=text id=&quot;txtNewTags&quot; size=15 onKeyUp=&quot;config.macros.importTiddlers.newTags=this.value&quot; autocomplete=off&gt;\s\n&lt;div align=center&gt;\s\n &lt;input type=button id=&quot;importOpen&quot; class=&quot;importButton&quot; style=&quot;width:32%&quot; value=&quot;open&quot;\s\n onclick=&quot;onClickImportButton(this)&quot;&gt;\s\n &lt;input type=button id=&quot;importStart&quot; class=&quot;importButton&quot; style=&quot;width:32%&quot; value=&quot;import&quot;\s\n onclick=&quot;onClickImportButton(this)&quot;&gt;\s\n &lt;input type=button id=&quot;importClose&quot; class=&quot;importButton&quot; style=&quot;width:32%&quot; value=&quot;close&quot;\s\n onclick=&quot;onClickImportButton(this)&quot;&gt;\s\n&lt;/div&gt;\s\n&lt;div id=&quot;importCollisionPanel&quot;&gt;\s\n tiddler already exists:\s\n &lt;input type=text id=&quot;importNewTitle&quot; size=15 autocomplete=off&quot;&gt;\s\n &lt;div align=center&gt;\s\n &lt;input type=button id=&quot;importSkip&quot; class=&quot;importButton&quot; style=&quot;width:23%&quot; value=&quot;skip&quot;\s\n onclick=&quot;onClickImportButton(this)&quot;&gt;\s\n &lt;input type=button id=&quot;importRename&quot; class=&quot;importButton&quot; style=&quot;width:23%&quot; value=&quot;rename&quot;\s\n onclick=&quot;onClickImportButton(this)&quot;&gt;\s\n &lt;input type=button id=&quot;importMerge&quot; class=&quot;importButton&quot; style=&quot;width:23%&quot; value=&quot;merge&quot;\s\n onclick=&quot;onClickImportButton(this)&quot;&gt;\s\n &lt;input type=button id=&quot;importReplace&quot; class=&quot;importButton&quot; style=&quot;width:23%&quot; value=&quot;replace&quot;\s\n onclick=&quot;onClickImportButton(this)&quot;&gt;\s\n &lt;/div&gt;\s\n&lt;/div&gt;\s\n';\n//}}}\n\n// // Control interactions\n//{{{\nfunction onClickImportButton(which)\n{\n // DEBUG alert(which.id);\n var theList = document.getElementById('importList');\n if (!theList) return;\n var thePanel = document.getElementById('importPanel');\n var theCollisionPanel = document.getElementById('importCollisionPanel');\n var theNewTitle = document.getElementById('importNewTitle');\n var count=0;\n switch (which.id)\n {\n case 'fileImportSource':\n case 'importOpen': // load import source into hidden frame\n importReport(); // if an import was in progress, generate a report\n config.macros.importTiddlers.inbound=null; // clear the imported tiddler buffer\n refreshImportList(); // reset/resize the listbox\n if (config.macros.importTiddlers.src==&quot;&quot;) break;\n // Load document into hidden iframe so we can read it's DOM and fill the list\n loadRemoteFile(config.macros.importTiddlers.src, function(src,txt) {\n var tiddlers = readTiddlersFromHTML(txt);\n var count=tiddlers?tiddlers.length:0;\n displayMessage(config.macros.importTiddlers.foundMsg.format([count,src]));\n config.macros.importTiddlers.inbound=tiddlers;\n window.refreshImportList(0);\n });\n break;\n case 'importSelectAll': // select all tiddler list items (i.e., not headings)\n importReport(); // if an import was in progress, generate a report\n for (var t=0,count=0; t &lt; theList.options.length; t++) {\n if (theList.options[t].value==&quot;&quot;) continue;\n theList.options[t].selected=true;\n count++;\n }\n clearMessage(); displayMessage(config.macros.importTiddlers.countMsg.format([count]));\n break;\n case 'importSelectNew': // select tiddlers not in current document\n importReport(); // if an import was in progress, generate a report\n for (var t=0,count=0; t &lt; theList.options.length; t++) {\n theList.options[t].selected=false;\n if (theList.options[t].value==&quot;&quot;) continue;\n theList.options[t].selected=!store.tiddlerExists(theList.options[t].value);\n count+=theList.options[t].selected?1:0;\n }\n clearMessage(); displayMessage(config.macros.importTiddlers.countMsg.format([count]));\n break;\n case 'importSelectChanges': // select tiddlers that are updated from existing tiddlers\n importReport(); // if an import was in progress, generate a report\n for (var t=0,count=0; t &lt; theList.options.length; t++) {\n theList.options[t].selected=false;\n if (theList.options[t].value==&quot;&quot;||!store.tiddlerExists(theList.options[t].value)) continue;\n for (var i=0; i&lt;config.macros.importTiddlers.inbound.length; i++) // find matching inbound tiddler\n { var inbound=config.macros.importTiddlers.inbound[i]; if (inbound.title==theList.options[t].value) break; }\n theList.options[t].selected=(inbound.modified-store.getTiddler(theList.options[t].value).modified&gt;0); // updated tiddler\n count+=theList.options[t].selected?1:0;\n }\n clearMessage(); displayMessage(config.macros.importTiddlers.countMsg.format([count]));\n break;\n case 'importSelectDifferences': // select tiddlers that are new or different from existing tiddlers\n importReport(); // if an import was in progress, generate a report\n for (var t=0,count=0; t &lt; theList.options.length; t++) {\n theList.options[t].selected=false;\n if (theList.options[t].value==&quot;&quot;) continue;\n if (!store.tiddlerExists(theList.options[t].value)) { theList.options[t].selected=true; count++; continue; }\n for (var i=0; i&lt;config.macros.importTiddlers.inbound.length; i++) // find matching inbound tiddler\n { var inbound=config.macros.importTiddlers.inbound[i]; if (inbound.title==theList.options[t].value) break; }\n theList.options[t].selected=(inbound.modified-store.getTiddler(theList.options[t].value).modified!=0); // changed tiddler\n count+=theList.options[t].selected?1:0;\n }\n clearMessage(); displayMessage(config.macros.importTiddlers.countMsg.format([count]));\n break;\n case 'importToggleFilter': // show/hide filter\n case 'importFilter': // apply filter\n alert(&quot;coming soon!&quot;);\n break;\n case 'importStart': // initiate the import processing\n importReport(); // if an import was in progress, generate a report\n config.macros.importTiddlers.index=0;\n config.macros.importTiddlers.index=importTiddlers(0);\n importStopped();\n break;\n case 'importClose': // unload imported tiddlers or hide the import control panel\n // if imported tiddlers not loaded, close the import control panel\n if (!config.macros.importTiddlers.inbound) { thePanel.style.display='none'; break; }\n importReport(); // if an import was in progress, generate a report\n config.macros.importTiddlers.inbound=null; // clear the imported tiddler buffer\n refreshImportList(); // reset/resize the listbox\n break;\n case 'importSkip': // don't import the tiddler\n var theItem = theList.options[config.macros.importTiddlers.index];\n for (var j=0;j&lt;config.macros.importTiddlers.inbound.length;j++)\n if (config.macros.importTiddlers.inbound[j].title==theItem.value) break;\n var theImported = config.macros.importTiddlers.inbound[j];\n theImported.status='skipped after asking'; // mark item as skipped\n theCollisionPanel.style.display='none';\n config.macros.importTiddlers.index=importTiddlers(config.macros.importTiddlers.index+1); // resume with NEXT item\n importStopped();\n break;\n case 'importRename': // change name of imported tiddler\n var theItem = theList.options[config.macros.importTiddlers.index];\n for (var j=0;j&lt;config.macros.importTiddlers.inbound.length;j++)\n if (config.macros.importTiddlers.inbound[j].title==theItem.value) break;\n var theImported = config.macros.importTiddlers.inbound[j];\n theImported.status = 'renamed from '+theImported.title; // mark item as renamed\n theImported.set(theNewTitle.value,null,null,null,null); // change the tiddler title\n theItem.value = theNewTitle.value; // change the listbox item text\n theItem.text = theNewTitle.value; // change the listbox item text\n theCollisionPanel.style.display='none';\n config.macros.importTiddlers.index=importTiddlers(config.macros.importTiddlers.index); // resume with THIS item\n importStopped();\n break;\n case 'importMerge': // join existing and imported tiddler content\n var theItem = theList.options[config.macros.importTiddlers.index];\n for (var j=0;j&lt;config.macros.importTiddlers.inbound.length;j++)\n if (config.macros.importTiddlers.inbound[j].title==theItem.value) break;\n var theImported = config.macros.importTiddlers.inbound[j];\n var theExisting = store.getTiddler(theItem.value);\n var theText = theExisting.text+'\sn----\sn^^merged from: ';\n theText +='[['+config.macros.importTiddlers.src+'#'+theItem.value+'|'+config.macros.importTiddlers.src+'#'+theItem.value+']]^^\sn';\n theText +='^^'+theImported.modified.toLocaleString()+' by '+theImported.modifier+'^^\sn'+theImported.text;\n var theDate = new Date();\n var theTags = theExisting.getTags()+' '+theImported.getTags();\n theImported.set(null,theText,null,theDate,theTags);\n theImported.status = 'merged with '+theExisting.title; // mark item as merged\n theImported.status += ' - '+theExisting.modified.formatString(&quot;MM/DD/YYYY 0hh:0mm:0ss&quot;);\n theImported.status += ' by '+theExisting.modifier;\n theCollisionPanel.style.display='none';\n config.macros.importTiddlers.index=importTiddlers(config.macros.importTiddlers.index); // resume with this item\n importStopped();\n break;\n case 'importReplace': // substitute imported tiddler for existing tiddler\n var theItem = theList.options[config.macros.importTiddlers.index];\n for (var j=0;j&lt;config.macros.importTiddlers.inbound.length;j++)\n if (config.macros.importTiddlers.inbound[j].title==theItem.value) break;\n var theImported = config.macros.importTiddlers.inbound[j];\n var theExisting = store.getTiddler(theItem.value);\n theImported.status = 'replaces '+theExisting.title; // mark item for replace\n theImported.status += ' - '+theExisting.modified.formatString(&quot;MM/DD/YYYY 0hh:0mm:0ss&quot;);\n theImported.status += ' by '+theExisting.modifier;\n theCollisionPanel.style.display='none';\n config.macros.importTiddlers.index=importTiddlers(config.macros.importTiddlers.index); // resume with THIS item\n importStopped();\n break;\n case 'importListSmaller': // decrease current listbox size, minimum=5\n if (theList.options.length==1) break;\n theList.size-=(theList.size&gt;5)?1:0;\n config.macros.importTiddlers.listsize=theList.size;\n break;\n case 'importListLarger': // increase current listbox size, maximum=number of items in list\n if (theList.options.length==1) break;\n theList.size+=(theList.size&lt;theList.options.length)?1:0;\n config.macros.importTiddlers.listsize=theList.size;\n break;\n case 'importListMaximize': // toggle listbox size between current and maximum\n if (theList.options.length==1) break;\n theList.size=(theList.size==theList.options.length)?config.macros.importTiddlers.listsize:theList.options.length;\n break;\n }\n}\n//}}}\n\n// // refresh listbox\n//{{{\nfunction refreshImportList(selectedIndex)\n{\n var theList = document.getElementById(&quot;importList&quot;);\n if (!theList) return;\n // if nothing to show, reset list content and size\n if (!config.macros.importTiddlers.inbound) \n {\n while (theList.length &gt; 0) { theList.options[0] = null; }\n theList.options[0]=new Option('please open a document...',&quot;&quot;,false,false);\n theList.size=config.macros.importTiddlers.listsize;\n return;\n }\n // get the sort order\n if (!selectedIndex) selectedIndex=0;\n if (selectedIndex==0) config.macros.importTiddlers.sort='title'; // heading\n if (selectedIndex==1) config.macros.importTiddlers.sort='title';\n if (selectedIndex==2) config.macros.importTiddlers.sort='modified';\n if (selectedIndex==3) config.macros.importTiddlers.sort='tags';\n if (selectedIndex&gt;3) {\n // display selected tiddler count\n for (var t=0,count=0; t &lt; theList.options.length; t++) count+=(theList.options[t].selected&amp;&amp;theList.options[t].value!=&quot;&quot;)?1:0;\n clearMessage(); displayMessage(config.macros.importTiddlers.countMsg.format([count]));\n return; // no refresh needed\n }\n\n // get the alphasorted list of tiddlers (optionally, filter out unchanged tiddlers)\n var tiddlers=config.macros.importTiddlers.inbound;\n tiddlers.sort(function (a,b) {if(a['title'] == b['title']) return(0); else return (a['title'] &lt; b['title']) ? -1 : +1; });\n // clear current list contents\n while (theList.length &gt; 0) { theList.options[0] = null; }\n // add heading and control items to list\n var i=0;\n var indent=String.fromCharCode(160)+String.fromCharCode(160);\n theList.options[i++]=new Option(tiddlers.length+' tiddler'+((tiddlers.length!=1)?'s are':' is')+' in the document',&quot;&quot;,false,false);\n theList.options[i++]=new Option(((config.macros.importTiddlers.sort==&quot;title&quot; )?&quot;&gt;&quot;:indent)+' [by title]',&quot;&quot;,false,false);\n theList.options[i++]=new Option(((config.macros.importTiddlers.sort==&quot;modified&quot;)?&quot;&gt;&quot;:indent)+' [by date]',&quot;&quot;,false,false);\n theList.options[i++]=new Option(((config.macros.importTiddlers.sort==&quot;tags&quot;)?&quot;&gt;&quot;:indent)+' [by tags]',&quot;&quot;,false,false);\n // output the tiddler list\n switch(config.macros.importTiddlers.sort)\n {\n case &quot;title&quot;:\n for(var t = 0; t &lt; tiddlers.length; t++)\n theList.options[i++] = new Option(tiddlers[t].title,tiddlers[t].title,false,false);\n break;\n case &quot;modified&quot;:\n // sort descending for newest date first\n tiddlers.sort(function (a,b) {if(a['modified'] == b['modified']) return(0); else return (a['modified'] &gt; b['modified']) ? -1 : +1; });\n var lastSection = &quot;&quot;;\n for(var t = 0; t &lt; tiddlers.length; t++) {\n var tiddler = tiddlers[t];\n var theSection = tiddler.modified.toLocaleDateString();\n if (theSection != lastSection) {\n theList.options[i++] = new Option(theSection,&quot;&quot;,false,false);\n lastSection = theSection;\n }\n theList.options[i++] = new Option(indent+indent+tiddler.title,tiddler.title,false,false);\n }\n break;\n case &quot;tags&quot;:\n var theTitles = {}; // all tiddler titles, hash indexed by tag value\n var theTags = new Array();\n for(var t=0; t&lt;tiddlers.length; t++) {\n var title=tiddlers[t].title;\n var tags=tiddlers[t].tags;\n if (!tags || !tags.length) {\n if (theTitles[&quot;untagged&quot;]==undefined) { theTags.push(&quot;untagged&quot;); theTitles[&quot;untagged&quot;]=new Array(); }\n theTitles[&quot;untagged&quot;].push(title);\n }\n else for(var s=0; s&lt;tags.length; s++) {\n if (theTitles[tags[s]]==undefined) { theTags.push(tags[s]); theTitles[tags[s]]=new Array(); }\n theTitles[tags[s]].push(title);\n }\n }\n theTags.sort();\n for(var tagindex=0; tagindex&lt;theTags.length; tagindex++) {\n var theTag=theTags[tagindex];\n theList.options[i++]=new Option(theTag,&quot;&quot;,false,false);\n for(var t=0; t&lt;theTitles[theTag].length; t++)\n theList.options[i++]=new Option(indent+indent+theTitles[theTag][t],theTitles[theTag][t],false,false);\n }\n break;\n }\n theList.selectedIndex=selectedIndex; // select current control item\n if (theList.size&lt;config.macros.importTiddlers.listsize) theList.size=config.macros.importTiddlers.listsize;\n if (theList.size&gt;theList.options.length) theList.size=theList.options.length;\n}\n//}}}\n\n// // re-entrant processing for handling import with interactive collision prompting\n//{{{\nfunction importTiddlers(startIndex)\n{\n if (!config.macros.importTiddlers.inbound) return -1;\n\n var theList = document.getElementById('importList');\n if (!theList) return;\n var t;\n // if starting new import, reset import status flags\n if (startIndex==0)\n for (var t=0;t&lt;config.macros.importTiddlers.inbound.length;t++)\n config.macros.importTiddlers.inbound[t].status=&quot;&quot;;\n for (var i=startIndex; i&lt;theList.options.length; i++)\n {\n // if list item is not selected or is a heading (i.e., has no value), skip it\n if ((!theList.options[i].selected) || ((t=theList.options[i].value)==&quot;&quot;))\n continue;\n for (var j=0;j&lt;config.macros.importTiddlers.inbound.length;j++)\n if (config.macros.importTiddlers.inbound[j].title==t) break;\n var theImported = config.macros.importTiddlers.inbound[j];\n var theExisting = store.getTiddler(theImported.title);\n // avoid redundant import for tiddlers that are listed multiple times (when 'by tags')\n if (theImported.status==&quot;added&quot;)\n continue;\n // don't import the &quot;ImportedTiddlers&quot; history from the other document...\n if (theImported.title=='ImportedTiddlers')\n continue;\n // if tiddler exists and import not marked for replace or merge, stop importing\n if (theExisting &amp;&amp; (theImported.status.substr(0,7)!=&quot;replace&quot;) &amp;&amp; (theImported.status.substr(0,5)!=&quot;merge&quot;))\n return i;\n // assemble tags (remote + existing + added)\n var newTags = &quot;&quot;;\n if (config.macros.importTiddlers.importTags)\n newTags+=theImported.getTags() // import remote tags\n if (config.macros.importTiddlers.keepTags &amp;&amp; theExisting)\n newTags+=&quot; &quot;+theExisting.getTags(); // keep existing tags\n if (config.macros.importTiddlers.addTags &amp;&amp; config.macros.importTiddlers.newTags.trim().length)\n newTags+=&quot; &quot;+config.macros.importTiddlers.newTags; // add new tags\n theImported.set(null,null,null,null,newTags.trim());\n // set the status to 'added' (if not already set by the 'ask the user' UI)\n theImported.status=(theImported.status==&quot;&quot;)?'added':theImported.status;\n // do the import!\n store.addTiddler(theImported);\n store.setDirty(true);\n }\n return(-1); // signals that we really finished the entire list\n}\n//}}}\n\n//{{{\nfunction importStopped()\n{\n var theList = document.getElementById('importList');\n var theNewTitle = document.getElementById('importNewTitle');\n if (!theList) return;\n if (config.macros.importTiddlers.index==-1)\n importReport(); // import finished... generate the report\n else\n {\n // DEBUG alert('import stopped at: '+config.macros.importTiddlers.index);\n // import collision... show the collision panel and set the title edit field\n document.getElementById('importCollisionPanel').style.display='block';\n theNewTitle.value=theList.options[config.macros.importTiddlers.index].value;\n }\n}\n//}}}\n\n// // ''REPORT GENERATOR''\n//{{{\nfunction importReport(quiet)\n{\n if (!config.macros.importTiddlers.inbound) return;\n // DEBUG alert('importReport: start');\n\n // if import was not completed, the collision panel will still be open... close it now.\n var panel=document.getElementById('importCollisionPanel'); if (panel) panel.style.display='none';\n\n // get the alphasorted list of tiddlers\n var tiddlers = config.macros.importTiddlers.inbound;\n // gather the statistics\n var count=0;\n for (var t=0; t&lt;tiddlers.length; t++)\n if (tiddlers[t].status &amp;&amp; tiddlers[t].status.trim().length &amp;&amp; tiddlers[t].status.substr(0,7)!=&quot;skipped&quot;) count++;\n\n // generate a report\n if (count &amp;&amp; config.options.chkImportReport) {\n // get/create the report tiddler\n var theReport = store.getTiddler('ImportedTiddlers');\n if (!theReport) { theReport= new Tiddler(); theReport.title = 'ImportedTiddlers'; theReport.text = &quot;&quot;; }\n // format the report content\n var now = new Date();\n var newText = &quot;On &quot;+now.toLocaleString()+&quot;, &quot;+config.options.txtUserName\n newText +=&quot; imported &quot;+count+&quot; tiddler&quot;+(count==1?&quot;&quot;:&quot;s&quot;)+&quot; from\sn[[&quot;+config.macros.importTiddlers.src+&quot;|&quot;+config.macros.importTiddlers.src+&quot;]]:\sn&quot;;\n if (config.macros.importTiddlers.addTags &amp;&amp; config.macros.importTiddlers.newTags.trim().length)\n newText += &quot;imported tiddlers were tagged with: \s&quot;&quot;+config.macros.importTiddlers.newTags+&quot;\s&quot;\sn&quot;;\n newText += &quot;&lt;&lt;&lt;\sn&quot;;\n for (var t=0; t&lt;tiddlers.length; t++) if (tiddlers[t].status) newText += &quot;#[[&quot;+tiddlers[t].title+&quot;]] - &quot;+tiddlers[t].status+&quot;\sn&quot;;\n newText += &quot;&lt;&lt;&lt;\sn&quot;;\n newText += &quot;&lt;html&gt;&lt;input type=\s&quot;button\s&quot; href=\s&quot;javascript:;\s&quot; &quot;;\n newText += &quot;onclick=\s&quot;story.closeTiddler('&quot;+theReport.title+&quot;'); store.deleteTiddler('&quot;+theReport.title+&quot;');\s&quot; &quot;;\n newText += &quot;value=\s&quot;discard report\s&quot;&gt;&lt;/html&gt;&quot;;\n // update the ImportedTiddlers content and show the tiddler\n theReport.text = newText+((theReport.text!=&quot;&quot;)?'\sn----\sn':&quot;&quot;)+theReport.text;\n theReport.modifier = config.options.txtUserName;\n theReport.modified = new Date();\n store.addTiddler(theReport);\n if (!quiet) { story.displayTiddler(null,theReport.title,1,null,null,false); story.refreshTiddler(theReport.title,1,true); }\n }\n\n // reset status flags\n for (var t=0; t&lt;config.macros.importTiddlers.inbound.length; t++) config.macros.importTiddlers.inbound[t].status=&quot;&quot;;\n\n // refresh display if tiddlers have been loaded\n if (count) { store.setDirty(true); store.notifyAll(); }\n\n // always show final message when tiddlers were actually loaded\n if (count) displayMessage(config.macros.importTiddlers.importedMsg.format([count,tiddlers.length,config.macros.importTiddlers.src]));\n}\n//}}}\n\n/***\n!!!!!TW 2.1beta Core Code Candidate\n//The following section is a preliminary 'code candidate' for incorporation of non-interactive 'load tiddlers' functionality into TW2.1beta. //\n***/\n//{{{\n// default cookie/option values\nif (!config.options.chkImportReport) config.options.chkImportReport=true;\n\nconfig.macros.loadTiddlers = {\n label: &quot;&quot;,\n prompt: &quot;add/update tiddlers from '%0'&quot;,\n askMsg: &quot;Please enter a local path/filename or a remote URL&quot;,\n openMsg: &quot;Opening %0&quot;,\n openErrMsg: &quot;Could not open %0 - error=%1&quot;,\n readMsg: &quot;Read %0 bytes from %1&quot;,\n foundMsg: &quot;Found %0 tiddlers in %1&quot;,\n loadedMsg: &quot;Loaded %0 of %1 tiddlers from %2&quot;\n};\n\nconfig.macros.loadTiddlers.handler = function(place,macroName,params) {\n var label=(params[0].substr(0,6)=='label:')?params.shift().substr(6):this.label;\n var prompt=(params[0].substr(0,7)=='prompt:')?params.shift().substr(6):this.prompt;\n var filter=&quot;updates&quot;;\n if (params[0]=='all' || params[0]=='new' || params[0]=='changes' || params[0]=='updates'\n || params[0].substr(0,8)=='tiddler:' || params[0].substr(0,4)=='tag:')\n filter=params.shift();\n var src=params.shift(); if (!src || !src.length) return; // filename is required\n var quiet=(params[0]==&quot;quiet&quot;); if (quiet) params.shift();\n var ask=(params[0]==&quot;confirm&quot;); if (ask) params.shift();\n if (label.trim().length) {\n // link triggers load tiddlers from another file/URL and then applies filtering rules to add/replace tiddlers in the store\n createTiddlyButton(place,label.format([src]),prompt.format([src]), function() {\n if (src==&quot;ask&quot;) src=prompt(config.macros.loadTiddlers.askMsg);\n loadRemoteFile(src,loadTiddlers,quiet,ask,filter);\n })\n }\n else {\n // load tiddlers from another file/URL and then apply filtering rules to add/replace tiddlers in the store\n if (src==&quot;ask&quot;) src=prompt(config.macros.loadTiddlers.askMsg);\n loadRemoteFile(src,loadTiddlers,quiet,ask,filter);\n }\n}\n\nfunction loadTiddlers(src,html,filter,quiet,ask)\n{\n var tiddlers = readTiddlersFromHTML(html);\n var count=tiddlers?tiddlers.length:0;\n if (!quiet) displayMessage(config.macros.loadTiddlers.foundMsg.format([count,src]));\n var count=0;\n if (tiddlers) for (var t=0;t&lt;tiddlers.length;t++) {\n var theInbound = tiddlers[t];\n var theExisting = store.getTiddler(theInbound.title);\n if (theInbound.title=='ImportedTiddlers')\n continue; // skip &quot;ImportedTiddlers&quot; history from the other document...\n\n // apply the all/new/changes/updates filter (if any)\n if (filter &amp;&amp; filter!=&quot;all&quot;) {\n if ((filter==&quot;new&quot;) &amp;&amp; theExisting) // skip existing tiddlers\n continue;\n if ((filter==&quot;changes&quot;) &amp;&amp; !theExisting) // skip new tiddlers\n continue;\n if ((filter.substr(0,4)==&quot;tag:&quot;) &amp;&amp; theInbound.tags.find(filter.substr(4))==null) // must match specific tag value\n continue;\n if ((filter.substr(0,8)==&quot;tiddler:&quot;) &amp;&amp; theInbound.title!=filter.substr(8)) // must match specific tiddler name\n continue;\n if (store.tiddlerExists(theInbound.title) &amp;&amp; ((theExisting.modified.getTime()-theInbound.modified.getTime())&gt;=0)) // tiddler is unchanged\n continue;\n }\n // get confirmation if required\n if (ask &amp;&amp; !confirm((theExisting?&quot;Update&quot;:&quot;Add&quot;)+&quot; tiddler '&quot;+theInbound.title+&quot;'\snfrom &quot;+src))\n { tiddlers[t].status=&quot;skipped - cancelled by user&quot;; continue; }\n // DO IT!\n store.addTiddler(theInbound);\n tiddlers[t].status=theExisting?&quot;updated&quot;:&quot;added&quot;\n count++;\n }\n if (count) {\n // refresh display\n store.setDirty(true);\n store.notifyAll();\n // generate a report\n if (config.options.chkImportReport) {\n // get/create the report tiddler\n var theReport = store.getTiddler('ImportedTiddlers');\n if (!theReport) { theReport= new Tiddler(); theReport.title = 'ImportedTiddlers'; theReport.text = &quot;&quot;; }\n // format the report content\n var now = new Date();\n var newText = &quot;On &quot;+now.toLocaleString()+&quot;, &quot;+config.options.txtUserName+&quot; loaded &quot;+count+&quot; tiddlers from\sn[[&quot;+src+&quot;|&quot;+src+&quot;]]:\sn&quot;;\n newText += &quot;&lt;&lt;&lt;\sn&quot;;\n for (var t=0; t&lt;tiddlers.length; t++) if (tiddlers[t].status) newText += &quot;#[[&quot;+tiddlers[t].title+&quot;]] - &quot;+tiddlers[t].status+&quot;\sn&quot;;\n newText += &quot;&lt;&lt;&lt;\sn&quot;;\n newText += &quot;&lt;html&gt;&lt;input type=\s&quot;button\s&quot; href=\s&quot;javascript:;\s&quot; &quot;;\n newText += &quot;onclick=\s&quot;story.closeTiddler('&quot;+theReport.title+&quot;'); store.deleteTiddler('&quot;+theReport.title+&quot;');\s&quot; &quot;;\n newText += &quot;value=\s&quot;discard report\s&quot;&gt;&lt;/html&gt;&quot;;\n // update the ImportedTiddlers content and show the tiddler\n theReport.text = newText+((theReport.text!=&quot;&quot;)?'\sn----\sn':&quot;&quot;)+theReport.text;\n theReport.modifier = config.options.txtUserName;\n theReport.modified = new Date();\n store.addTiddler(theReport);\n if (!quiet) { story.displayTiddler(null,theReport.title,1,null,null,false); story.refreshTiddler(theReport.title,1,true); }\n }\n }\n // always show final message when tiddlers were actually loaded\n if (!quiet||count) displayMessage(config.macros.loadTiddlers.loadedMsg.format([count,tiddlers.length,src]));\n}\n\nfunction loadRemoteFile(src,callback,quiet,ask,filter) {\n if (src==undefined || !src.length) return null; // filename is required\n if (!quiet) clearMessage();\n if (!quiet) displayMessage(config.macros.loadTiddlers.openMsg.format([src]));\n if (src.substr(0,4)!=&quot;http&quot;) { // fallback to read from local filesystem\n var txt=loadFile(src);\n if ((txt==null)||(txt==false)) // file didn't load\n { if (!quiet) displayMessage(config.macros.loadTiddlers.openErrMsg.format([src,&quot;(unknown)&quot;])); }\n else {\n if (!quiet) displayMessage(config.macros.loadTiddlers.readMsg.format([txt.length,src]));\n if (callback) callback(src,convertUTF8ToUnicode(txt),quiet,ask,filter);\n }\n }\n else {\n var x; // XML object\n try {x = new XMLHttpRequest()}\n catch(e) {\n try {x = new ActiveXObject(&quot;Msxml2.XMLHTTP&quot;)}\n catch (e) {\n try {x = new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;)}\n catch (e) { return }\n }\n }\n x.onreadystatechange = function() {\n if (x.readyState == 4) {\n if (x.status == 200) {\n if (!quiet) displayMessage(config.macros.loadTiddlers.readMsg.format([x.responseText.length,src]));\n if (callback) callback(src,x.responseText,quiet,ask,filter);\n }\n else {\n if (!quiet) displayMessage(config.macros.loadTiddlers.openErrMsg.format([src,x.status]));\n }\n }\n }\n if ((document.location.protocol==&quot;file:&quot;) &amp;&amp; (typeof(netscape)!=&quot;undefined&quot;)) { // UniversalBrowserRead only works from a local file context\n try { netscape.security.PrivilegeManager.enablePrivilege('UniversalBrowserRead')}\n catch (e) { if (!quiet) displayMessage(e.description?e.description:e.toString()); }\n }\n try {\n var url=src+(src.indexOf('?')&lt;0?'?':'&amp;')+'nocache='+Math.random();\n x.open(&quot;GET&quot;,url,true);\n if (x.overrideMimeType) x.overrideMimeType('text/html');\n x.send(null);\n }\n catch (e) {\n if (!quiet) {\n displayMessage(config.macros.loadTiddlers.openErrMsg.format([src,&quot;(unknown)&quot;]));\n displayMessage(e.description?e.description:e.toString());\n }\n }\n }\n}\n\nfunction readTiddlersFromHTML(html)\n{\n // extract store area from html \n var start=html.indexOf('&lt;div id=&quot;storeArea&quot;&gt;');\n var end=html.indexOf('&lt;/body&gt;',start);\n var sa=&quot;&lt;html&gt;&lt;body&gt;&quot;+html.substring(start,end)+&quot;&lt;/body&gt;&lt;/html&gt;&quot;;\n\n // load html into iframe document\n var f=document.getElementById(&quot;loaderFrame&quot;); if (f) document.body.removeChild(f);\n f=document.createElement(&quot;iframe&quot;); f.id=&quot;loaderFrame&quot;;\n f.style.width=&quot;0px&quot;; f.style.height=&quot;0px&quot;; f.style.border=&quot;0px&quot;;\n document.body.appendChild(f);\n var d=f.document;\n if (f.contentDocument) d=f.contentDocument; // For NS6\n else if (f.contentWindow) d=f.contentWindow.document; // For IE5.5 and IE6\n d.open(); d.writeln(sa); d.close();\n\n // read tiddler DIVs from storeArea DOM element \n var sa = d.getElementById(&quot;storeArea&quot;);\n if (!sa) return null;\n sa.normalize();\n var nodes = sa.childNodes;\n if (!nodes || !nodes.length) return null;\n var tiddlers = [];\n for(var t = 0; t &lt; nodes.length; t++) {\n var title = null;\n if(nodes[t].getAttribute)\n title = nodes[t].getAttribute(&quot;tiddler&quot;);\n if(!title &amp;&amp; nodes[t].id &amp;&amp; (nodes[t].id.substr(0,5) == &quot;store&quot;))\n title = nodes[t].id.substr(5);\n if(title &amp;&amp; title != &quot;&quot;)\n tiddlers.push((new Tiddler()).loadFromDiv(nodes[t],title));\n }\n return tiddlers;\n}\n//}}}</div>
<div tiddler="MainMenu" modifier="Saq" modified="200604171817" created="200603101727" tags="">\nMovieManager\n\n&lt;&lt;newMovie NewMovieForm &quot;New Movie&quot; '&quot;Movies - MovieNameHere&quot;' askUser &quot;Movie&quot;&gt;&gt;\n\nToDo\nChangeLog \nMainMenu\nStyleSheet\n[[CSS-movietable]]\nMovieTools\n</div>
<div tiddler="Maintenance" modifier="Saq" modified="200604182109" created="200604171338" tags="systemConfig MovieManagerTiddlers excludeLists">/***\n&lt;&lt;DateSeen&gt;&gt;\n\n&lt;&lt;SetRating&gt;&gt;\n***/\n//{{{\nconfig.macros.DateSeen={};\nconfig.macros.DateSeen.handler=function(place,macroName,params,wikifier,paramString,tiddler){\n\n var onClick=function(){\n var taggedtiddlers = store.getTaggedTiddlers(&quot;MovSeen&quot;);\n for (var t=0; t&lt;taggedtiddlers.length; t++){\n var tiddler= taggedtiddlers[t];\n if (!tiddler.data(&quot;movieDateSeen&quot;))\n var thedate= (tiddler.modified)?tiddler.modified:tiddler.created;\n\n var timeFormat= 'YY0MMDD';\n var thedate2= (thedate).formatString(timeFormat);\n tiddler.setData(&quot;movieDateSeen&quot;,thedate2);\n}\n\n}\n\ncreateTiddlyButton(place,&quot;Set Date Seen&quot;,&quot;Set Date Seen&quot;,onClick);\n\n}\n//}}}\n\n//{{{\nconfig.macros.SetRating={};\nconfig.macros.SetRating.handler=function(place,macroName,params,wikifier,paramString,tiddler){\n\n var onClick=function(){\n var taggedtiddlers = store.getTaggedTiddlers(&quot;Movie&quot;);\n for (var t=0; t&lt;taggedtiddlers.length; t++){\n var tiddler= taggedtiddlers[t];\n if (!tiddler.data(&quot;movieRating&quot;))\ntiddler.setData(&quot;movieRating&quot;,&quot;&quot;);\n}\n\n\n}\n\ncreateTiddlyButton(place,&quot;Set Blank Rating&quot;,&quot;Set Blank Rating&quot;,onClick);\n\n}\n//}}}</div>
<div tiddler="MovieLink" modifier="Saq" modified="200604171221" created="200603061751" tags="systemConfig excludeLists MovieManagerTiddlers">config.macros.movielink = {};\nconfig.macros.movielink.handler= function(place,macroName,params) {\n\nvar t=store.getTiddler(story.findContainingTiddler(place).id.substr(7));\nvar mTitle=t.data(&quot;movieName&quot;);\nvar x= 'http://imdb.com/find?q=';\n\n var theMLink = document.createElement(&quot;a&quot;);\n theMLink.className = &quot;externalLink&quot;;\n theMLink.target = &quot;_blank&quot;;\n theMLink.href = x+mTitle.replace(/ /g, '+');\n theMLink.title = mTitle + ' ' + 'on IMDB';\n place.appendChild(theMLink);\n theMLink.appendChild(document.createTextNode('IMDB'));\n }</div>
<div tiddler="MovieManager" modifier="Saq" modified="200604200858" created="200602261322" tags="MovieManagerTiddlers">&lt;&lt;forEachTiddler\n where \n 'tiddler.tags.contains(&quot;Movie&quot;) &amp;&amp; ! tiddler.tags.containsAny([&quot;MovToSee&quot;,&quot;MovFav&quot;,&quot;MovSeen&quot;,&quot;MovWatchAgain&quot;])'\n sortBy \n '(tiddler.data(&quot;movieName&quot;).toLowerCase())'\nwrite\n'(index==0?&quot;!!There are \s'\s'@@color:red;&quot;+count+&quot;@@\s'\s' movies not on any list.&quot;:&quot;&quot;)'\n&gt;&gt;&lt;&lt;tabs txtMovMan\n'Movies To See' &quot;Movies to see&quot; MoviesToSee\n'Movies Seen' &quot;Movies Seen&quot; MoviesSeen\n'Top Movies' &quot;Top Movies&quot; MoviesTop\n'Watch Again' &quot;Watch Again&quot; MoviesWatchAgain\n'Tools' &quot;MovieManager Tools&quot; MovieTools \n&gt;&gt;</div>
<div tiddler="MovieTools" modifier="Saq" modified="200606031721" created="200603152037" tags="excludeLists MovieManagerTiddlers">{{movietable{\n!Movies not on any list\n{{boxtext{&lt;&lt;forEachTiddler \n where \n 'tiddler.tags.contains(&quot;Movie&quot;) &amp;&amp; ! tiddler.tags.containsAny([&quot;MovToSee&quot;,&quot;MovFav&quot;,&quot;MovSeen&quot;,&quot;MovWatchAgain&quot;])'\n sortBy \n '(tiddler.data(&quot;movieName&quot;).toLowerCase())'\nwrite\n'(index == 0 ? &quot;There are \s'\s'@@color:red;&quot;+count+&quot;@@\s'\s' movies not on any list.+++...\sn&lt;html&gt;&lt;br&gt;&lt;table id=\s&quot;MoviesNotOnList\s&quot; cellspacing=\s&quot;0\s&quot; &gt;&lt;caption align=\s&quot;top\s&quot;&gt;Movies Not On Any Lists&lt;/caption&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt; # &lt;/th&gt;&lt;th&gt;Title&lt;/th&gt;&lt;th&gt;&lt;/th&gt;&lt;th&gt;Seen&lt;/th&gt;&lt;th&gt;Top Movie&lt;/th&gt;&lt;th&gt;Watch Again&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&quot;: &quot;&quot;) +(index%2 == 0 ? &quot;&lt;tr class=\s&quot;evenRow\s&quot;&gt;&lt;td align=center&gt;&quot;+(index+1)+&quot;&lt;/td&gt;&lt;td&gt;&lt;&lt;imdb \s&quot;right\s&quot; \s&quot;&quot;+tiddler.data(&quot;movieName&quot;)+&quot;\s&quot;$))&lt;/td&gt;&lt;td align=center&gt;[[&gt;$))|&quot;+tiddler.title+&quot;]]&lt;/td&gt;&lt;td align=center &gt; [_(&quot;+tiddler.title+&quot;:MovSeen){(this.fn_init)}{movieMarkSeen(this.tiddler,\s'MovToSee\s')}]&lt;/td&gt;&lt;td align=center&gt;[_(&quot;+tiddler.title+&quot;:MovFav)]&lt;/td&gt;&lt;td align=center&gt;[_(&quot;+tiddler.title+&quot;:MovWatchAgain){(this.fn_init)}{removeTag(this.tiddler,\s'MovSeenAgain\s')}]&lt;/td&gt;&lt;/tr&gt;&quot; : &quot;&lt;tr class=\s&quot;oddRow\s&quot;&gt;&lt;td align=center&gt;&quot;+(index+1)+&quot;&lt;/td&gt;&lt;td&gt;&lt;&lt;imdb \s&quot;right\s&quot; \s&quot;&quot;+tiddler.data(&quot;movieName&quot;)+&quot;\s&quot;$))&lt;/td&gt;&lt;td align=center&gt;[[&gt;$))|&quot;+tiddler.title+&quot;]]&lt;/td&gt;&lt;td align=center &gt; [_(&quot;+tiddler.title+&quot;:MovSeen){(this.fn_init)}{movieMarkSeen(this.tiddler,\s'MovToSee\s')}]&lt;/td&gt;&lt;td align=center&gt;[_(&quot;+tiddler.title+&quot;:MovFav)]&lt;/td&gt;&lt;td align=center&gt;[_(&quot;+tiddler.title+&quot;:MovWatchAgain){(this.fn_init)}{removeTag(this.tiddler,\s'MovSeenAgain\s')}]&lt;/td&gt;&lt;/tr&gt;&quot;) +\n(index == count-1 ? &quot;&lt;/tbody&gt;&lt;/table&gt;&lt;br&gt;&lt;/html&gt;\sn===&quot; : &quot;&quot;)'\n&gt;&gt;}}}\n!Movies seen but not rated\n{{boxtext{&lt;&lt;forEachTiddler \n where \n 'tiddler.tags.containsAny([&quot;MovFav&quot;,&quot;MovSeen&quot;,&quot;MovWatchAgain&quot;]) &amp;&amp; ! tiddler.data(&quot;movieRating&quot;)'\n sortBy \n '(tiddler.data(&quot;movieName&quot;).toLowerCase())'\nwrite\n'(index == 0 ? &quot;There are \s'\s'@@color:red;&quot;+count+&quot;@@\s'\s' movies seen but not rated.+++...\sn&lt;html&gt;&lt;table id=\s&quot;MoviesSeenNotRated\s&quot; cellspacing=\s&quot;0\s&quot; &gt;&lt;caption align=\s&quot;top\s&quot;&gt;Movies Seen But Not Rated&lt;/caption&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt; # &lt;/th&gt;&lt;th&gt;Title&lt;/th&gt;&lt;th&gt;&lt;/th&gt;&lt;th&gt;Enter Rating&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&quot;: &quot;&quot;) +(index%2 == 0 ? &quot;&lt;tr class=\s&quot;evenRow\s&quot;&gt;&lt;td align=center&gt;&quot;+(index+1)+&quot;&lt;/td&gt;&lt;td&gt;&lt;&lt;imdb \s&quot;right\s&quot; \s&quot;&quot;+tiddler.data(&quot;movieName&quot;)+&quot;\s&quot;$))&lt;/td&gt;&lt;td align=center&gt;[[&gt;$))|&quot;+tiddler.title+&quot;]]&lt;/td&gt;&lt;td align=center onclick=\s&quot;setRating(\s'&quot;+tiddler.title+&quot;\s',\s'&quot;+config.macros.forEachTiddler.getContainingTiddler(context.place).title+&quot;\s')\s&quot; class=\s&quot;adjustable\s&quot; title=\s&quot;Click to change rating\s&quot;&gt;&quot;+tiddler.data(&quot;movieRating&quot;,&quot;---&quot;)+&quot;&lt;/td&gt;&lt;/tr&gt;&quot; : &quot;&lt;tr class=\s&quot;oddRow\s&quot;&gt;&lt;td align=center&gt;&quot;+(index+1)+&quot;&lt;/td&gt;&lt;td&gt;&lt;&lt;imdb \s&quot;right\s&quot; \s&quot;&quot;+tiddler.data(&quot;movieName&quot;)+&quot;\s&quot;$))&lt;/td&gt;&lt;td align=center&gt;[[&gt;$))|&quot;+tiddler.title+&quot;]]&lt;/td&gt;&lt;td align=center onclick=\s&quot;setRating(\s'&quot;+tiddler.title+&quot;\s',\s'&quot;+config.macros.forEachTiddler.getContainingTiddler(context.place).title+&quot;\s')\s&quot; class=\s&quot;adjustable\s&quot; title=\s&quot;Click to change rating\s&quot;&gt;&quot;+tiddler.data(&quot;movieRating&quot;,&quot;---&quot;)+&quot;&lt;/td&gt;&lt;/tr&gt;&quot;) +\n(index == count-1 ? &quot;&lt;/tbody&gt;&lt;/table&gt;&lt;br&gt;&lt;/html&gt;\sn===&quot; : &quot;&quot;)'\n&gt;&gt;}}}\n!Official List of Movies (Top Movies + Movies To See)\n{{boxtext{&lt;&lt;forEachTiddler \n where \n 'tiddler.tags.containsAny([&quot;MovFav&quot;,&quot;MovToSee&quot;])'\n sortBy \n '(tiddler.data(&quot;movieName&quot;).toLowerCase())'\nwrite\n'(index == 0 ? &quot;There are \s'\s'&quot;+count+&quot;\s'\s' movies on this list.+++...\sn&lt;html&gt;&lt;table id=\s&quot;MoviesOfficialList\s&quot; cellspacing=\s&quot;0\s&quot; width=\s&quot;380\s&quot;&gt;&lt;caption align=\s&quot;top\s&quot;&gt;Official List of Movies (Top + To See)&lt;/caption&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt; # &lt;/th&gt;&lt;th&gt;Title&lt;/th&gt;&lt;th&gt;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&quot;: &quot;&quot;) +(index%2 == 0 ? &quot;&lt;tr class=\s&quot;evenRow\s&quot;&gt;&lt;td align=center&gt;&quot;+(index+1)+&quot;&lt;/td&gt;&lt;td&gt;&lt;&lt;imdb \s&quot;right\s&quot; \s&quot;&quot;+tiddler.data(&quot;movieName&quot;)+&quot;\s&quot;$))&lt;/td&gt;&lt;td align=center&gt;[[&gt;$))|&quot;+tiddler.title+&quot;]]&lt;/td&gt;&lt;/tr&gt;&quot; : &quot;&lt;tr class=\s&quot;oddRow\s&quot;&gt;&lt;td align=center&gt;&quot;+(index+1)+&quot;&lt;/td&gt;&lt;td&gt;&lt;&lt;imdb \s&quot;right\s&quot; \s&quot;&quot;+tiddler.data(&quot;movieName&quot;)+&quot;\s&quot;$))&lt;/td&gt;&lt;td align=center&gt;[[&gt;$))|&quot;+tiddler.title+&quot;]]&lt;/td&gt;&lt;/tr&gt;&quot;) +\n(index == count-1 ? &quot;&lt;/tbody&gt;&lt;/table&gt;&lt;br&gt;&lt;/html&gt;\sn===&quot; : &quot;&quot;)'\n&gt;&gt;}}}\n!Recent Imported Movies\n{{boxtext{&lt;&lt;forEachTiddler\n where \n 'tiddler.tags.contains(&quot;MovImported&quot;)&amp;&amp; (((tiddler.created).formatString(&quot;MMM&quot;))==((new Date()).formatString(&quot;MMM&quot;)))'\n sortBy \n '(tiddler.created)'\ndescending\nwrite\n'(index == 0 ? &quot;There are \s'\s'&quot;+count+&quot;\s'\s' movies imported this month.+++...\sn&lt;html&gt;&lt;table id=\s&quot;MoviesImportedThisMonth\s&quot; cellspacing=\s&quot;0\s&quot; width=\s&quot;320\s&quot;&gt;&lt;caption align=\s&quot;top\s&quot;&gt;Movies Imported This Month&lt;/caption&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt; # &lt;/th&gt;&lt;th&gt;Title&lt;/th&gt;&lt;th&gt;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&quot;: &quot;&quot;) +((index%2== 0)? &quot;&lt;tr class=\s&quot;evenRow\s&quot;&gt;&lt;td align=center&gt;&quot;+(index+1)+&quot;&lt;/td&gt;&lt;td&gt;&lt;&lt;imdb \s&quot;right\s&quot; \s&quot;&quot;+tiddler.data(&quot;movieName&quot;)+&quot;\s&quot;$))&lt;/td&gt;&lt;td align=center&gt;[[&gt;$))|&quot;+tiddler.title+&quot;]]&lt;/td&gt;&lt;/tr&gt;&quot; : &quot;&quot;) +((index%2 == 1)? &quot;&lt;tr class=\s&quot;oddRow\s&quot;&gt;&lt;td align=center&gt;&quot;+(index+1)+&quot;&lt;/td&gt;&lt;td&gt;&lt;&lt;imdb \s&quot;right\s&quot; \s&quot;&quot;+tiddler.data(&quot;movieName&quot;)+&quot;\s&quot;$))&lt;/td&gt;&lt;td align=center&gt;[[&gt;$))|&quot;+tiddler.title+&quot;]]&lt;/td&gt;&lt;/tr&gt;&quot;:&quot;&quot;) + (index == count-1 ? &quot;&lt;/tbody&gt;&lt;/table&gt;&lt;/html&gt;\sn===&quot; : &quot;&quot;)'\n&gt;&gt;\nLast ''15'' imported movies.+++...&lt;&lt;forEachTiddler\n where\n 'tiddler.tags.contains(&quot;MovImported&quot;)'\n sortBy\n '(tiddler.created)'\ndescending\nwrite\n'(index == 0 ? &quot;&lt;html&gt;&lt;table id=\s&quot;MoviesImported15\s&quot; cellspacing=\s&quot;0\s&quot; width=\s&quot;320\s&quot;&gt;&lt;caption align=\s&quot;top\s&quot;&gt;Movies Recently Imported&lt;/caption&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt; # &lt;/th&gt;&lt;th&gt;Title&lt;/th&gt;&lt;th&gt;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&quot;: &quot;&quot;) +((index%2== 0)&amp;&amp;(index&lt;15) ? &quot;&lt;tr class=\s&quot;evenRow\s&quot;&gt;&lt;td align=center&gt;&quot;+(index+1)+&quot;&lt;/td&gt;&lt;td&gt;&lt;&lt;imdb \s&quot;right\s&quot; \s&quot;&quot;+tiddler.data(&quot;movieName&quot;)+&quot;\s&quot;$))&lt;/td&gt;&lt;td align=center&gt;[[&gt;$))|&quot;+tiddler.title+&quot;]]&lt;/td&gt;&lt;/tr&gt;&quot; : &quot;&quot;) +((index%2 == 1)&amp;&amp;(index&lt;15) ? &quot;&lt;tr class=\s&quot;oddRow\s&quot;&gt;&lt;td align=center&gt;&quot;+(index+1)+&quot;&lt;/td&gt;&lt;td&gt;&lt;&lt;imdb \s&quot;right\s&quot; \s&quot;&quot;+tiddler.data(&quot;movieName&quot;)+&quot;\s&quot;$))&lt;/td&gt;&lt;td align=center&gt;[[&gt;$))|&quot;+tiddler.title+&quot;]]&lt;/td&gt;&lt;/tr&gt;&quot;:&quot;&quot;) + (index == count-1 ? &quot;&lt;/tbody&gt;&lt;/table&gt;&lt;br&gt;&lt;/html&gt;\sn&quot; : &quot;&quot;)'\n&gt;&gt;===}}}\n!Recent Manually Added Movies.\n{{boxtext{Last ''15'' manually added movies.+++...&lt;&lt;forEachTiddler\n where\n 'tiddler.tags.contains(&quot;Movie&quot;) &amp;&amp; ! tiddler.tags.contains(&quot;MovImported&quot;)'\n sortBy\n '(tiddler.created)'\ndescending\nwrite\n'(index == 0 ? &quot;&lt;html&gt;&lt;table id=\s&quot;MoviesAdded15\s&quot; cellspacing=\s&quot;0\s&quot; width=\s&quot;320\s&quot;&gt;&lt;caption align=\s&quot;top\s&quot;&gt;Movies Recently Added&lt;/caption&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt; # &lt;/th&gt;&lt;th&gt;Title&lt;/th&gt;&lt;th&gt;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&quot;: &quot;&quot;) +((index%2== 0)&amp;&amp;(index&lt;15) ? &quot;&lt;tr class=\s&quot;evenRow\s&quot;&gt;&lt;td align=center&gt;&quot;+(index+1)+&quot;&lt;/td&gt;&lt;td&gt;&lt;&lt;imdb \s&quot;right\s&quot; \s&quot;&quot;+tiddler.data(&quot;movieName&quot;)+&quot;\s&quot;$))&lt;/td&gt;&lt;td align=center&gt;[[&gt;$))|&quot;+tiddler.title+&quot;]]&lt;/td&gt;&lt;/tr&gt;&quot; : &quot;&quot;) +((index%2 == 1)&amp;&amp;(index&lt;15) ? &quot;&lt;tr class=\s&quot;oddRow\s&quot;&gt;&lt;td align=center&gt;&quot;+(index+1)+&quot;&lt;/td&gt;&lt;td&gt;&lt;&lt;imdb \s&quot;right\s&quot; \s&quot;&quot;+tiddler.data(&quot;movieName&quot;)+&quot;\s&quot;$))&lt;/td&gt;&lt;td align=center&gt;[[&gt;$))|&quot;+tiddler.title+&quot;]]&lt;/td&gt;&lt;/tr&gt;&quot;:&quot;&quot;) + (index == count-1 ? &quot;&lt;/tbody&gt;&lt;/table&gt;&lt;br&gt;&lt;/html&gt;\sn&quot; : &quot;&quot;)'\n&gt;&gt;===}}}}}}\n!Save Movie Lists to File.\n{{boxtext{\n*Choose a movie list from the drop down menu.&lt;&lt;writeMovieList&gt;&gt;\n*The text file will be saved in current &lt;&lt;dynamicLink&gt;&gt;.\n}}}\n</div>
<div tiddler="Movies - 12 Monkeys" modifier="Saq" modified="200604171424" created="200603042058" tags="MovFav Movie">&lt;&lt;formTiddler [[NewMovieForm]]&gt;&gt;&lt;data&gt;{&quot;movieName&quot;:&quot;12 Monkeys&quot;,&quot;movieRating&quot;:&quot;7.5&quot;}&lt;/data&gt;\n\n</div>
<div tiddler="Movies - Cars" modifier="Saq" modified="200606031715" created="200604181327" tags="Movie MovImported MovToSee">&lt;&lt;formTiddler [[NewMovieForm]]&gt;&gt;&lt;data&gt;{&quot;movieName&quot;:&quot;Cars&quot;,&quot;movieRating&quot;:&quot;&quot;,&quot;movieDateSeen&quot;:&quot;06063&quot;}&lt;/data&gt;</div>
<div tiddler="Movies - Death to Smoochy" modifier="Saq" modified="200604300852" created="200603120007" tags="Movie MovSeen MovFav MovWatchAgain">&lt;&lt;formTiddler [[NewMovieForm]]&gt;&gt;&lt;data&gt;{&quot;movieName&quot;:&quot;Death to Smoochy&quot;,&quot;movieDateSeen&quot;:&quot;060417&quot;}&lt;/data&gt;</div>
<div tiddler="Movies - Erin Brockovich" modifier="Saq" modified="200606031656" created="200606021644" tags="Movie MovImported MovSeen">&lt;&lt;formTiddler [[NewMovieForm]]&gt;&gt;&lt;data&gt;{&quot;movieName&quot;:&quot;Erin Brockovich&quot;,&quot;movieRating&quot;:&quot;&quot;,&quot;movieDateSeen&quot;:&quot;06063&quot;}&lt;/data&gt;</div>
<div tiddler="Movies - Fight Club" modifier="Saq" modified="200604301118" created="200603042058" tags="MovFav Movie">&lt;&lt;formTiddler [[NewMovieForm]]&gt;&gt;&lt;data&gt;{&quot;movieName&quot;:&quot;Fight Club&quot;}&lt;/data&gt;</div>
<div tiddler="Movies - Finding Nemo" modifier="YourName" modified="200606031046" created="200606021643" tags="Movie MovImported MovSeen">&lt;&lt;formTiddler [[NewMovieForm]]&gt;&gt;&lt;data&gt;{&quot;movieName&quot;:&quot;Finding Nemo&quot;,&quot;movieRating&quot;:&quot;7.5&quot;,&quot;movieDateSeen&quot;:&quot;06063&quot;}&lt;/data&gt;</div>
<div tiddler="Movies - Institute Benjamenta, or This Dream People Call Human Life" modifier="YourName" modified="200606031046" created="200603141605" tags="Movie">&lt;&lt;formTiddler [[NewMovieForm]]&gt;&gt;&lt;data&gt;{&quot;movieName&quot;:&quot;Institute Benjamenta, or This Dream People Call Human Life&quot;,&quot;movieRating&quot;:&quot;8.0&quot;,&quot;movieDateSeen&quot;:&quot;06063&quot;}&lt;/data&gt;</div>
<div tiddler="Movies - Kinky Boots" modifier="YourName" modified="200606031047" created="200603042147" tags="Movie">&lt;&lt;formTiddler [[NewMovieForm]]&gt;&gt;&lt;data&gt;{&quot;movieName&quot;:&quot;Kinky Boots&quot;,&quot;movieRating&quot;:&quot;7.0&quot;,&quot;movieDateSeen&quot;:&quot;06063&quot;}&lt;/data&gt;</div>
<div tiddler="Movies - Kiss Kiss Bang Bang" modifier="Saq" modified="200606031741" created="200603042059" tags="MovSeen MovFav Movie">&lt;&lt;formTiddler [[NewMovieForm]]&gt;&gt;&lt;data&gt;{&quot;movieName&quot;:&quot;Kiss Kiss Bang Bang&quot;,&quot;movieRating&quot;:&quot;9.1&quot;,&quot;movieReview&quot;:&quot;Best comedy I have seen in a long time.&quot;,&quot;movieNotes&quot;:&quot;Dont quit your gay job!&quot;,&quot;movieDateSeen&quot;:&quot;060415&quot;}&lt;/data&gt;</div>
<div tiddler="Movies - London" modifier="YourName" modified="200606031048" created="200604181325" tags="Movie MovImported MovSeen">&lt;&lt;formTiddler [[NewMovieForm]]&gt;&gt;&lt;data&gt;{&quot;movieName&quot;:&quot;London&quot;,&quot;movieRating&quot;:&quot;9.0&quot;,&quot;movieDateSeen&quot;:&quot;06063&quot;}&lt;/data&gt;</div>
<div tiddler="Movies - Matador" modifier="Saq" modified="200604181117" created="200603042101" tags="MovSeen MovToSee Movie">&lt;&lt;formTiddler [[NewMovieForm]]&gt;&gt;&lt;data&gt;{&quot;movieName&quot;:&quot;The Matador&quot;,&quot;movieRating&quot;:&quot;8.5&quot;,&quot;movieDateSeen&quot;:&quot;060418&quot;}&lt;/data&gt;</div>
<div tiddler="Movies - Mission: Impossible III" modifier="YourName" modified="200606021645" created="200606021645" tags="Movie MovImported">&lt;&lt;formTiddler [[NewMovieForm]]&gt;&gt;&lt;data&gt;{&quot;movieName&quot;:&quot;Mission: Impossible III&quot;,&quot;movieRating&quot;:&quot;&quot;}&lt;/data&gt;</div>
<div tiddler="Movies - Munich" modifier="Saq" modified="200604181327" created="200604181327" tags="Movie MovImported">&lt;&lt;formTiddler [[NewMovieForm]]&gt;&gt;&lt;data&gt;{&quot;movieName&quot;:&quot;Munich&quot;,&quot;movieRating&quot;:&quot;&quot;}&lt;/data&gt;</div>
<div tiddler="Movies - Proof" modifier="Saq" modified="200604181248" created="200603042059" tags="MovToSee Movie">&lt;&lt;formTiddler [[NewMovieForm]]&gt;&gt;&lt;data&gt;{&quot;movieName&quot;:&quot;Proof&quot;,&quot;movieRating&quot;:&quot;&quot;}&lt;/data&gt;</div>
<div tiddler="Movies - Reservoir Dogs" modifier="Saq" modified="200604170939" created="200604170938" tags="Movie MovFav MovWatchAgain">&lt;&lt;formTiddler [[NewMovieForm]]&gt;&gt;&lt;data&gt;{&quot;movieName&quot;:&quot;Reservoir Dogs&quot;,&quot;movieRating&quot;:&quot;&quot;}&lt;/data&gt;</div>
<div tiddler="Movies - Syriana" modifier="Saq" modified="200604181248" created="200603042059" tags="MovToSee Movie">&lt;&lt;formTiddler [[NewMovieForm]]&gt;&gt;&lt;data&gt;{&quot;movieName&quot;:&quot;Syriana&quot;,&quot;movieRating&quot;:&quot;&quot;}&lt;/data&gt;\n\n</div>
<div tiddler="Movies - The Benchwarmers" modifier="YourName" modified="200604201150" created="200604201150" tags="Movie MovImported">&lt;&lt;formTiddler [[NewMovieForm]]&gt;&gt;&lt;data&gt;{&quot;movieName&quot;:&quot;The Benchwarmers&quot;,&quot;movieRating&quot;:&quot;&quot;}&lt;/data&gt;</div>
<div tiddler="Movies - The Break-Up" modifier="YourName" modified="200606021643" created="200606021643" tags="Movie MovImported">&lt;&lt;formTiddler [[NewMovieForm]]&gt;&gt;&lt;data&gt;{&quot;movieName&quot;:&quot;The Break-Up&quot;,&quot;movieRating&quot;:&quot;&quot;}&lt;/data&gt;</div>
<div tiddler="Movies - Titus" modifier="Saq" modified="200605121540" created="200603042126" tags="MovFav Movie">&lt;&lt;formTiddler [[NewMovieForm]]&gt;&gt;&lt;data&gt;{&quot;movieName&quot;:&quot;Titus&quot;,&quot;movieReview&quot;:&quot;A brilliant Shakespeare adaptation&quot;,&quot;movieRating&quot;:&quot;9.2&quot;}&lt;/data&gt;</div>
<div tiddler="Movies - Wolf Creek" modifier="Saq" modified="200604181252" created="200604171358" tags="Movie MovSeen">&lt;&lt;formTiddler [[NewMovieForm]]&gt;&gt;&lt;data&gt;{&quot;movieName&quot;:&quot;Wolf Creek&quot;,&quot;movieDateSeen&quot;:&quot;060417&quot;,&quot;movieRating&quot;:&quot;6.0&quot;}&lt;/data&gt;</div>
<div tiddler="Movies - animatrix" modifier="YourName" modified="200606031410" created="200603152037" tags="Movie MovSeen MovWatchAgain">&lt;&lt;formTiddler [[NewMovieForm]]&gt;&gt;&lt;data&gt;{&quot;movieName&quot;:&quot;animatrix&quot;,&quot;movieRating&quot;:&quot;6.6&quot;}&lt;/data&gt;</div>
<div tiddler="MoviesSeen" modifier="Saq" modified="200606031803" created="200602261217" tags="excludeLists MovieManagerTiddlers">\n{{movietable{\n&lt;&lt;forEachTiddler \n where \n 'tiddler.tags.containsAny([&quot;MovSeen&quot;,&quot;MovSeenAgain&quot;])'\n sortBy \n 'tiddler.data(&quot;movieDateSeen&quot;)'\ndescending\nwrite\n'(index == 0 ? &quot;&lt;html&gt;&lt;table id=\s&quot;MoviesSeenTable\s&quot; cellspacing=\s&quot;0\s&quot;&gt;&lt;caption align=\s&quot;top\s&quot;&gt;Movies Seen - 2006&lt;/caption&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt; # &lt;/th&gt;&lt;th&gt;Title&lt;/th&gt;&lt;th&gt;&lt;/th&gt;&lt;th&gt;Rating&lt;/th&gt;&lt;th&gt;Seen&lt;/th&gt;&lt;th&gt;Top Movie&lt;/th&gt;&lt;th&gt;Watch Again&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&quot;: &quot;&quot;) +(index%2 == 0 ? &quot;&lt;tr class=\s&quot;evenRow\s&quot;&gt;&lt;td align=center&gt;&quot;+(index+1)+&quot;&lt;/td&gt;&lt;td&gt;&lt;&lt;imdb \s&quot;right\s&quot; \s&quot;&quot;+tiddler.data(&quot;movieName&quot;)+&quot;\s&quot;$))&lt;/td&gt;&lt;td align=center&gt;[[&gt;$))|&quot;+tiddler.title+&quot;]]&lt;/td&gt;&lt;td align=center onclick=\s&quot;setRating(\s'&quot;+tiddler.title+&quot;\s',\s'&quot;+config.macros.forEachTiddler.getContainingTiddler(context.place).title+&quot;\s')\s&quot; class=\s&quot;adjustable\s&quot; title=\s&quot;Click to change rating\s&quot;&gt;&quot;+tiddler.data(&quot;movieRating&quot;,&quot;---&quot;)+&quot;&lt;/td&gt;&lt;td align=center&gt; [_(&quot;+tiddler.title+&quot;:MovSeen){(this.fn_init)}{removeTag(this.tiddler,\s'MovToSee\s')}]&lt;/td&gt;&lt;td align=center&gt;[_(&quot;+tiddler.title+&quot;:MovFav)]&lt;/td&gt;&lt;td align=center&gt;[_(&quot;+tiddler.title+&quot;:MovWatchAgain){(this.fn_init)}{removeTag(this.tiddler,\s'MovSeenAgain\s')}]&lt;/td&gt;&lt;/tr&gt;&quot; : &quot;&lt;tr class=\s&quot;oddRow\s&quot;&gt;&lt;td align=center&gt;&quot;+(index+1)+&quot;&lt;/td&gt;&lt;td&gt;&lt;&lt;imdb \s&quot;right\s&quot; \s&quot;&quot;+tiddler.data(&quot;movieName&quot;)+&quot;\s&quot;$))&lt;/td&gt;&lt;td align=center&gt;[[&gt;$))|&quot;+tiddler.title+&quot;]]&lt;/td&gt;&lt;td align=center onclick=\s&quot;setRating(\s'&quot;+tiddler.title+&quot;\s',\s'&quot;+config.macros.forEachTiddler.getContainingTiddler(context.place).title+&quot;\s')\s&quot; class=\s&quot;adjustable\s&quot; title=\s&quot;Click to change rating\s&quot;&gt;&quot;+tiddler.data(&quot;movieRating&quot;,&quot;---&quot;)+&quot;&lt;/td&gt;&lt;td align=center&gt; [_(&quot;+tiddler.title+&quot;:MovSeen){(this.fn_init)}{removeTag(this.tiddler,\s'MovToSee\s')}]&lt;/td&gt;&lt;td align=center&gt;[_(&quot;+tiddler.title+&quot;:MovFav)]&lt;/td&gt;&lt;td align=center&gt;[_(&quot;+tiddler.title+&quot;:MovWatchAgain){(this.fn_init)}{removeTag(this.tiddler,\s'MovSeenAgain\s')}]&lt;/td&gt;&lt;/tr&gt;&quot;) +\n(index == count-1 ? &quot;&lt;/tbody&gt;&lt;/table&gt;&lt;/html&gt;&quot; : &quot;&quot;)'\n&gt;&gt;\n&lt;&lt;sortit &quot;MoviesSeenTable&quot;&gt;&gt;\n}}}</div>
<div tiddler="MoviesToSee" modifier="Saq" modified="200606031803" created="200602260943" tags="excludeLists MovieManagerTiddlers">\n{{movietable{\n&lt;&lt;forEachTiddler \n where \n 'tiddler.tags.contains(&quot;MovToSee&quot;) &amp;&amp; ! tiddler.tags.contains(&quot;MovSeen&quot;)'\n sortBy \n '(tiddler.data(&quot;movieName&quot;).toLowerCase())'\nwrite\n'(index == 0 ? &quot;&lt;html&gt;&lt;table id=\s&quot;MoviesToSeeTable\s&quot; cellspacing=\s&quot;0\s&quot;&gt;&lt;caption align=\s&quot;top\s&quot;&gt;Movies To See&lt;/caption&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt; # &lt;/th&gt;&lt;th&gt;Title&lt;/th&gt;&lt;th&gt;&lt;/th&gt;&lt;th&gt;Seen&lt;/th&gt;&lt;th&gt;Top Movie&lt;/th&gt;&lt;th&gt;Watch Again&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&quot;: &quot;&quot;) +(index%2 == 0 ? &quot;&lt;tr class=\s&quot;evenRow\s&quot;&gt;&lt;td align=center&gt;&quot;+(index+1)+&quot;&lt;/td&gt;&lt;td&gt;&lt;&lt;imdb \s&quot;right\s&quot; \s&quot;&quot;+tiddler.data(&quot;movieName&quot;)+&quot;\s&quot;$))&lt;/td&gt;&lt;td align=center&gt;[[&gt;$))|&quot;+tiddler.title+&quot;]]&lt;/td&gt;&lt;td align=center &gt; [_(&quot;+tiddler.title+&quot;:MovSeen){(this.fn_init)}{movieMarkSeen(this.tiddler,\s'MovToSee\s')}]&lt;/td&gt;&lt;td align=center&gt;[_(&quot;+tiddler.title+&quot;:MovFav)]&lt;/td&gt;&lt;td align=center&gt;[_(&quot;+tiddler.title+&quot;:MovWatchAgain){(this.fn_init)}{removeTag(this.tiddler,\s'MovSeenAgain\s')}]&lt;/td&gt;&lt;/tr&gt;&quot; : &quot;&lt;tr class=\s&quot;oddRow\s&quot;&gt;&lt;td align=center&gt;&quot;+(index+1)+&quot;&lt;/td&gt;&lt;td&gt;&lt;&lt;imdb \s&quot;right\s&quot; \s&quot;&quot;+tiddler.data(&quot;movieName&quot;)+&quot;\s&quot;$))&lt;/td&gt;&lt;td align=center&gt;[[&gt;$))|&quot;+tiddler.title+&quot;]]&lt;/td&gt;&lt;td align=center&gt; [_(&quot;+tiddler.title+&quot;:MovSeen){(this.fn_init)}{movieMarkSeen(this.tiddler,\s'MovToSee\s')}]&lt;/td&gt;&lt;td align=center&gt;[_(&quot;+tiddler.title+&quot;:MovFav)]&lt;/td&gt;&lt;td align=center&gt;[_(&quot;+tiddler.title+&quot;:MovWatchAgain){(this.fn_init)}{removeTag(this.tiddler,\s'MovSeenAgain\s')}]&lt;/td&gt;&lt;/tr&gt;&quot;) +\n(index == count-1 ? &quot;&lt;/tbody&gt;&lt;/table&gt;&lt;/html&gt;&quot; : &quot;&quot;)'\n&gt;&gt;\n&lt;&lt;sortit &quot;MoviesToSeeTable&quot;&gt;&gt;\n}}}</div>
<div tiddler="MoviesTop" modifier="Saq" modified="200606031803" created="200602261320" tags="excludeLists MovieManagerTiddlers">\n{{movietable{\n&lt;&lt;forEachTiddler \n where \n 'tiddler.tags.contains(&quot;MovFav&quot;)'\n sortBy \n '(9.99-tiddler.data(&quot;movieRating&quot;))+(tiddler.data(&quot;movieName&quot;).toLowerCase())'\nwrite\n'(index == 0 ? &quot;&lt;html&gt;&lt;table id=\s&quot;TopMoviesTable\s&quot; cellspacing=\s&quot;0\s&quot;&gt;&lt;caption align=\s&quot;top\s&quot;&gt;Top Movies&lt;/caption&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt; # &lt;/th&gt;&lt;th&gt;Title&lt;/th&gt;&lt;th&gt;&lt;/th&gt;&lt;th&gt;Rating&lt;/th&gt;&lt;th&gt;Top Movie&lt;/th&gt;&lt;th&gt;Watch Again&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&quot;: &quot;&quot;) +(index%2 == 0 ? &quot;&lt;tr class=\s&quot;evenRow\s&quot;&gt;&lt;td align=center&gt;&quot;+(index+1)+&quot;&lt;/td&gt;&lt;td&gt;&lt;&lt;imdb \s&quot;right\s&quot; \s&quot;&quot;+tiddler.data(&quot;movieName&quot;)+&quot;\s&quot;$))&lt;/td&gt;&lt;td align=center&gt;[[&gt;$))|&quot;+tiddler.title+&quot;]]&lt;/td&gt;&lt;td align=center onclick=\s&quot;setRating(\s'&quot;+tiddler.title+&quot;\s',\s'&quot;+config.macros.forEachTiddler.getContainingTiddler(context.place).title+&quot;\s')\s&quot; class=\s&quot;adjustable\s&quot; title=\s&quot;Click to change rating\s&quot;&gt;&quot;+tiddler.data(&quot;movieRating&quot;,&quot;---&quot;)+&quot;&lt;/td&gt;&lt;td align=center&gt;[_(&quot;+tiddler.title+&quot;:MovFav)]&lt;/td&gt;&lt;td align=center&gt;[_(&quot;+tiddler.title+&quot;:MovWatchAgain){(this.fn_init)}{removeTag(this.tiddler,\s'MovSeenAgain\s')}]&lt;/td&gt;&lt;/tr&gt;&quot; : &quot;&lt;tr class=\s&quot;oddRow\s&quot;&gt;&lt;td align=center&gt;&quot;+(index+1)+&quot;&lt;/td&gt;&lt;td&gt;&lt;&lt;imdb \s&quot;right\s&quot; \s&quot;&quot;+tiddler.data(&quot;movieName&quot;)+&quot;\s&quot;$))&lt;/td&gt;&lt;td align=center&gt;[[&gt;$))|&quot;+tiddler.title+&quot;]]&lt;/td&gt;&lt;td align=center onclick=\s&quot;setRating(\s'&quot;+tiddler.title+&quot;\s',\s'&quot;+config.macros.forEachTiddler.getContainingTiddler(context.place).title+&quot;\s')\s&quot; class=\s&quot;adjustable\s&quot; title=\s&quot;Click to change rating\s&quot;&gt;&quot;+tiddler.data(&quot;movieRating&quot;,&quot;---&quot;)+&quot;&lt;/td&gt;&lt;td align=center&gt;[_(&quot;+tiddler.title+&quot;:MovFav)]&lt;/td&gt;&lt;td align=center&gt;[_(&quot;+tiddler.title+&quot;:MovWatchAgain){(this.fn_init)}{removeTag(this.tiddler,\s'MovSeenAgain\s')}]&lt;/td&gt;&lt;/tr&gt;&quot;) +\n(index == count-1 ? &quot;&lt;/tbody&gt;&lt;/table&gt;&lt;/html&gt;&quot; : &quot;&quot;)'\n&gt;&gt;\n&lt;&lt;sortit TopMoviesTable&gt;&gt;\n}}}</div>
<div tiddler="MoviesWatchAgain" modifier="Saq" modified="200606031804" created="200603101825" tags="excludeLists MovieManagerTiddlers">\n{{movietable{\n&lt;&lt;forEachTiddler \n where \n 'tiddler.tags.contains(&quot;MovWatchAgain&quot;)'\n sortBy \n '(9.9-tiddler.data(&quot;movieRating&quot;))+(tiddler.data(&quot;movieName&quot;).toLowerCase())'\nwrite\n'(index == 0 ? &quot;&lt;html&gt;&lt;table id=\s&quot;MoviesWatchAgainTable\s&quot; cellspacing=\s&quot;0\s&quot;&gt;&lt;caption align=\s&quot;top\s&quot;&gt;Movies to Watch Again&lt;/caption&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt; # &lt;/th&gt;&lt;th&gt;Title&lt;/th&gt;&lt;th&gt;&lt;/th&gt;&lt;th&gt;Rating&lt;/th&gt;&lt;th&gt;Watch Again&lt;/th&gt;&lt;th&gt;Seen Again&lt;/th&gt;&lt;th&gt;Top Movie&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&quot;: &quot;&quot;) +(index%2 == 0 ? &quot;&lt;tr class=\s&quot;evenRow\s&quot;&gt;&lt;td align=center&gt;&quot;+(index+1)+&quot;&lt;/td&gt;&lt;td&gt;&lt;&lt;imdb \s&quot;right\s&quot; \s&quot;&quot;+tiddler.data(&quot;movieName&quot;)+&quot;\s&quot;$))&lt;/td&gt;&lt;td align=center&gt;[[&gt;$))|&quot;+tiddler.title+&quot;]]&lt;/td&gt;&lt;td align=center onclick=\s&quot;setRating(\s'&quot;+tiddler.title+&quot;\s',\s'&quot;+config.macros.forEachTiddler.getContainingTiddler(context.place).title+&quot;\s')\s&quot; class=\s&quot;adjustable\s&quot; title=\s&quot;Click to change rating\s&quot;&gt;&quot;+tiddler.data(&quot;movieRating&quot;,&quot;---&quot;)+&quot;&lt;/td&gt;&lt;td align=center&gt;[_(&quot;+tiddler.title+&quot;:MovWatchAgain)]&lt;/td&gt;&lt;td align=center&gt;[_(&quot;+tiddler.title+&quot;:MovSeenAgain){(this.fn_init)}{removeTag(this.tiddler,\s'MovWatchAgain\s')}]&lt;/td&gt;&lt;td align=center&gt;[_(&quot;+tiddler.title+&quot;:MovFav)]&lt;/td&gt;&lt;/tr&gt;&quot; : &quot;&lt;tr class=\s&quot;oddRow\s&quot;&gt;&lt;td align=center&gt;&quot;+(index+1)+&quot;&lt;/td&gt;&lt;td&gt;&lt;&lt;imdb \s&quot;right\s&quot; \s&quot;&quot;+tiddler.data(&quot;movieName&quot;)+&quot;\s&quot;$))&lt;/td&gt;&lt;td align=center&gt;[[&gt;$))|&quot;+tiddler.title+&quot;]]&lt;/td&gt;&lt;td align=center onclick=\s&quot;setRating(\s'&quot;+tiddler.title+&quot;\s',\s'&quot;+config.macros.forEachTiddler.getContainingTiddler(context.place).title+&quot;\s')\s&quot; class=\s&quot;adjustable\s&quot; title=\s&quot;Click to change rating\s&quot;&gt;&quot;+tiddler.data(&quot;movieRating&quot;,&quot;---&quot;)+&quot;&lt;/td&gt;&lt;td align=center&gt;[_(&quot;+tiddler.title+&quot;:MovWatchAgain)]&lt;/td&gt;&lt;td align=center&gt;[_(&quot;+tiddler.title+&quot;:MovSeenAgain){(this.fn_init)}{removeTag(this.tiddler,\s'MovWatchAgain\s')}]&lt;/td&gt;&lt;td align=center&gt;[_(&quot;+tiddler.title+&quot;:MovFav)]&lt;/td&gt;&lt;/tr&gt;&quot;) +\n(index == count-1 ? &quot;&lt;/tbody&gt;&lt;/table&gt;&lt;/html&gt;&quot; : &quot;&quot;)'\n&gt;&gt;\n&lt;&lt;sortit &quot;MoviesWatchAgainTable&quot;&gt;&gt;\n}}}</div>
<div tiddler="NestedSlidersPlugin" modifier="Saq" modified="200604171222" created="200604160650" tags="systemConfig excludeLists MovieManagerTiddlers">/***\n''NestedSlidersPlugin for TiddlyWiki version 1.2.x and 2.0''\n^^author: Eric Shulman\nsource: http://www.TiddlyTools.com/#NestedSlidersPlugin\nlicense: [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]^^\n\nQuickly make any tiddler content into an expandable 'slider' panel, without needing to create a separate tiddler to contain the slider content. Optional syntax allows ''default to open'', ''custom button label/tooltip'' and ''automatic blockquote formatting.''\n\nYou can also 'nest' these sliders as deep as you like (see complex nesting example below), so that expandable 'tree-like' hierarchical displays can be created. This is most useful when converting existing in-line text content to create in-line annotations, footnotes, context-sensitive help, or other subordinate information displays.\n\nFor more details, please click on a section headline below:\n++++!!!!![Configuration]&gt;\nDebugging messages for 'lazy sliders' deferred rendering:\n&lt;&lt;option chkDebugLazySliderDefer&gt;&gt; show debugging alert when deferring slider rendering\n&lt;&lt;option chkDebugLazySliderRender&gt;&gt; show debugging alert when deferred slider is actually rendered\n===\n++++!!!!![Usage]&gt;\nWhen installed, this plugin adds new wiki syntax for embedding 'slider' panels directly into tiddler content. Use {{{+++}}} and {{{===}}} to delimit the slider content. Additional optional syntax elements let you specify\n*default to open\n*cookiename\n*heading level\n*floater\n*rollover\n*custom label/tooltip\n*automatic blockquote\n*deferred rendering\nThe complete syntax, using all options, is:\n//{{{\n++++(cookiename)!!!!!^*[label|tooltip]&gt;...\ncontent goes here\n===\n//}}}\nwhere:\n* {{{+++}}} (or {{{++++}}}) and {{{===}}}^^\nmarks the start and end of the slider definition, respectively. When the extra {{{+}}} is used, the slider will be open when initially displayed.^^\n* {{{(cookiename)}}}^^\nsaves the slider opened/closed state, and restores this state whenever the slider is re-rendered.^^\n* {{{!}}} through {{{!!!!!}}}^^\ndisplays the slider label using a formatted headline (Hn) style instead of a button/link style^^\n* {{{&quot;^&quot;}}} //(without the quotes)//^^\nmakes the slider 'float' on top of other content rather than shifting that content downward^^\n* {{{&quot;*&quot;}}} //(without the quotes)//^^\nautomatically opens/closes slider on &quot;rollover&quot; as well as when clicked^^\n* {{{[label]}}} or {{{[label|tooltip]}}}^^\nuses custom label/tooltip. (defaults are: &quot;&gt;&quot; (more) and &quot;&lt;&quot; (less)^^\n* {{{&quot;&gt;&quot;}}} //(without the quotes)//^^\nautomatically adds blockquote formatting to slider content^^\n* {{{&quot;...&quot;}}} //(without the quotes)//^^\ndefers rendering of closed sliders until the first time they are opened. //Note: deferred rendering may produce unexpected results in some cases. Use with care.//^^\n\n//Note: to make slider definitions easier to read and recognize when editing a tiddler, newlines immediately following the {{{+++}}} 'start slider' or preceding the {{{===}}} 'end slider' sequence are automatically supressed so that excess whitespace is eliminated from the output.//\n===\n++++!!!!![Examples]&gt;\nsimple in-line slider: \n{{{\n+++\n content\n===\n}}}\n+++\n content\n===\n----\nuse a custom label and tooltip: \n{{{\n+++[label|tooltip]\n content\n===\n}}}\n+++[label|tooltip]\n content\n===\n----\ncontent automatically blockquoted: \n{{{\n+++&gt;\n content\n===\n}}}\n+++&gt;\n content\n===\n----\nall options combined //(default open, cookie, heading, floater, rollover, label/tooltip, blockquoted, deferred)//\n{{{\n++++(testcookie)!!!^*[label|tooltip]&gt;...\n content\n===\n}}}\n++++(testcookie)!!!^*[label|tooltip]&gt;...\n content\n===\n----\ncomplex nesting example:\n{{{\n+++^[get info...|click for information]\n put some general information here, plus a floating slider with more specific info:\n +++^[view details...|click for details]\n put some detail here, which could include a rollover with a +++^*[glossary definition]explaining technical terms===\n ===\n===\n}}}\n+++^[get info...|click for information]\n put some general information here, plus a floating slider with more specific info:\n +++^[view details...|click for details]\n put some detail here, which could include a rollover with a +++^*[glossary definition]explaining technical terms===\n ===\n===\n----\nnested floaters\n&gt;menu: &lt;&lt;tiddler NestedSlidersExample&gt;&gt;\n(see [[NestedSlidersExample]] for definition)\n----\n===\n+++!!!!![Installation]&gt;\nimport (or copy/paste) the following tiddlers into your document:\n''NestedSlidersPlugin'' (tagged with &lt;&lt;tag systemConfig&gt;&gt;)\n===\n+++!!!!![Revision History]&gt;\n\n++++[2006.02.16 - 1.7.7]\ncorrected deferred rendering to account for use-case where show/hide state is tracked in a cookie\n===\n\n++++[2006.02.15 - 1.7.6]\nin adjustSliderPos(), ensure that floating panel is positioned completely within the browser window (i.e., does not go beyond the right edge of the browser window)\n===\n\n++++[2006.02.04 - 1.7.5]\nadd 'var' to unintended global variable declarations to avoid FireFox 1.5.0.1 crash bug when assigning to globals\n===\n\n++++[2006.01.18 - 1.7.4]\nonly define adjustSliderPos() function if it has not already been provided by another plugin. This lets other plugins 'hijack' the function even when they are loaded first.\n===\n\n++++[2006.01.16 - 1.7.3]\nadded adjustSliderPos(place,btn,panel,panelClass) function to permit specialized logic for placement of floating panels. While it provides improved placement for many uses of floating panels, it exhibits a relative offset positioning error when used within *nested* floating panels. Short-term workaround is to only adjust the position for 'top-level' floaters.\n===\n\n++++[2006.01.16 - 1.7.2]\nadded button property to slider panel elements so that slider panel can tell which button it belongs to. Also, re-activated and corrected animation handling so that nested sliders aren't clipped by hijacking Slider.prototype.stop so that &quot;overflow:hidden&quot; can be reset to &quot;overflow:visible&quot; after animation ends\n===\n\n++++[2006.01.14 - 1.7.1]\nadded optional &quot;^&quot; syntax for floating panels. Defines new CSS class, &quot;.floatingPanel&quot;, as an alternative for standard in-line &quot;.sliderPanel&quot; styles.\n===\n\n++++[2006.01.14 - 1.7.0]\nadded optional &quot;*&quot; syntax for rollover handling to show/hide slider without requiring a click (Based on a suggestion by tw4efl)\n===\n\n+++[2006.01.03 - 1.6.2]\nWhen using optional &quot;!&quot; heading style, instead of creating a clickable &quot;Hn&quot; element, create an &quot;A&quot; element inside the &quot;Hn&quot; element. (allows click-through in SlideShowPlugin, which captures nearly all click events, except for hyperlinks)\n===\n\n+++[2005.12.15 - 1.6.1]\nadded optional &quot;...&quot; syntax to invoke deferred ('lazy') rendering for initially hidden sliders\nremoved checkbox option for 'global' application of lazy sliders\n===\n\n+++[2005.11.25 - 1.6.0]\nadded optional handling for 'lazy sliders' (deferred rendering for initially hidden sliders)\n===\n\n+++[2005.11.21 - 1.5.1]\nrevised regular expressions: if present, a single newline //preceding// and/or //following// a slider definition will be suppressed so start/end syntax can be place on separate lines in the tiddler 'source' for improved readability. Similarly, any whitespace (newlines, tabs, spaces, etc.) trailing the 'start slider' syntax or preceding the 'end slider' syntax is also suppressed.\n===\n\n+++[2005.11.20 - 1.5.0]\n added (cookiename) syntax for optional tracking and restoring of slider open/close state\n===\n\n+++[2005.11.11 - 1.4.0]\n added !!!!! syntax to render slider label as a header (Hn) style instead of a button/link style\n===\n\n+++[2005.11.07 - 1.3.0]\n removed alternative syntax {{{(((}}} and {{{)))}}} (so they can be used by other\n formatting extensions) and simplified/improved regular expressions to trim multiple excess newlines\n===\n\n+++[2005.11.05 - 1.2.1]\n changed name to NestedSlidersPlugin\n more documentation\n===\n\n+++[2005.11.04 - 1.2.0]\n added alternative character-mode syntax {{{(((}}} and {{{)))}}}\n tweaked &quot;eat newlines&quot; logic for line-mode {{{+++}}} and {{{===}}} syntax\n===\n\n+++[2005.11.03 - 1.1.1]\n fixed toggling of default tooltips (&quot;more...&quot; and &quot;less...&quot;) when a non-default button label is used\n code cleanup, added documentation\n===\n\n+++[2005.11.03 - 1.1.0]\n changed delimiter syntax from {{{(((}}} and {{{)))}}} to {{{+++}}} and {{{===}}}\n changed name to EasySlidersPlugin\n===\n\n+++[2005.11.03 - 1.0.0]\n initial public release\n===\n\n===\n+++!!!!![Credits]&gt;\nThis feature was implemented by EricShulman from [[ELS Design Studios|http:/www.elsdesign.com]] with research, programming and suggestions from RodneyGomes, GeoffSlocock, and PaulPetterson\n===\n***/\n// //+++!!!!![Code]\n//{{{\nversion.extensions.nestedSliders = {major: 1, minor: 7, revision: 7, date: new Date(2006,2,16)};\n//}}}\n\n//{{{\n// options for deferred rendering of sliders that are not initially displayed\nif (config.options.chkDebugLazySliderDefer==undefined) config.options.chkDebugLazySliderDefer=false;\nif (config.options.chkDebugLazySliderRender==undefined) config.options.chkDebugLazySliderRender=false;\n\n// default styles for 'floating' class\nsetStylesheet(&quot;.floatingPanel { position:absolute; z-index:10; padding:0.5em; margin:0em; \s\n background-color:#eee; color:#000; border:1px solid #000; text-align:left; }&quot;,&quot;floatingPanelStylesheet&quot;);\n//}}}\n\n//{{{\nconfig.formatters.push( {\n name: &quot;nestedSliders&quot;,\n match: &quot;\s\sn?\s\s+{3}&quot;,\n terminator: &quot;\s\ss*\s\s={3}\s\sn?&quot;,\n lookahead: &quot;\s\sn?\s\s+{3}(\s\s+)?(\s\s([^\s\s)]*\s\s))?(\s\s!*)?(\s\s^)?(\s\s*)?(\s\s[[^\s\s]]*\s\s])?(\s\s&gt;)?(\s\s.\s\s.\s\s.)?\s\ss*&quot;,\n handler: function(w)\n {\n var lookaheadRegExp = new RegExp(this.lookahead,&quot;mg&quot;);\n lookaheadRegExp.lastIndex = w.matchStart;\n var lookaheadMatch = lookaheadRegExp.exec(w.source)\n if(lookaheadMatch &amp;&amp; lookaheadMatch.index == w.matchStart)\n {\n // location for rendering button and panel\n var place=w.output;\n\n // default to closed, no cookie\n var show=&quot;none&quot;; var title=&quot;&gt;&quot;; var tooltip=&quot;show&quot;; var cookie=&quot;&quot;;\n\n // extra &quot;+&quot;, default to open\n if (lookaheadMatch[1])\n { show=&quot;block&quot;; title=&quot;&lt;&quot;; tooltip=&quot;hide&quot;; }\n\n // cookie, use saved open/closed state\n if (lookaheadMatch[2]) {\n cookie=lookaheadMatch[2].trim().substr(1,lookaheadMatch[2].length-2);\n cookie=&quot;chkSlider&quot;+cookie;\n if (config.options[cookie]==undefined)\n { config.options[cookie] = (show==&quot;block&quot;) }\n if (config.options[cookie])\n { show=&quot;block&quot;; title=&quot;&lt;&quot;; tooltip=&quot;hide&quot;; }\n else\n { show=&quot;none&quot;; title=&quot;&gt;&quot;; tooltip=&quot;show&quot;; }\n }\n\n // custom label/tooltip\n if (lookaheadMatch[6]) {\n title = lookaheadMatch[6].trim().substr(1,lookaheadMatch[6].length-2);\n var pos=title.indexOf(&quot;|&quot;);\n if (pos!=-1)\n { tooltip = title.substr(pos+1,title.length); title = title.substr(0,pos); }\n else\n { tooltip += &quot; &quot;+title; }\n }\n\n // create the button\n if (lookaheadMatch[3]) { // use &quot;Hn&quot; header format instead of button/link\n var lvl=(lookaheadMatch[3].length&gt;6)?6:lookaheadMatch[3].length;\n var btn = createTiddlyElement(createTiddlyElement(place,&quot;h&quot;+lvl,null,null,null),&quot;a&quot;,null,null,title);\n btn.onclick=onClickNestedSlider;\n btn.setAttribute(&quot;href&quot;,&quot;javascript:;&quot;);\n btn.setAttribute(&quot;title&quot;,tooltip);\n }\n else\n var btn = createTiddlyButton(place,title,tooltip,onClickNestedSlider);\n btn.sliderCookie = cookie; // save the cookiename (if any) in the button object\n\n // &quot;non-click&quot; MouseOver open/close slider\n if (lookaheadMatch[5]) btn.onmouseover=onClickNestedSlider;\n\n // create slider panel\n var panelClass=lookaheadMatch[4]?&quot;floatingPanel&quot;:&quot;sliderPanel&quot;;\n var panel=createTiddlyElement(place,&quot;div&quot;,null,panelClass,null);\n panel.style.display = show;\n panel.button = btn; // so the slider panel know which button it belongs to\n btn.sliderPanel=panel;\n\n // render slider (or defer until shown) \n w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;\n if ((show==&quot;block&quot;)||!lookaheadMatch[8]) {\n // render now if panel is supposed to be shown or NOT deferred rendering\n w.subWikify(lookaheadMatch[7]?createTiddlyElement(panel,&quot;blockquote&quot;):panel,this.terminator);\n // align slider/floater position with button\n adjustSliderPos(place,btn,panel,panelClass);\n }\n else {\n var src = w.source.substr(w.nextMatch);\n var endpos=findMatchingDelimiter(src,&quot;+++&quot;,&quot;===&quot;);\n panel.setAttribute(&quot;raw&quot;,src.substr(0,endpos));\n panel.setAttribute(&quot;blockquote&quot;,lookaheadMatch[7]?&quot;true&quot;:&quot;false&quot;);\n panel.setAttribute(&quot;rendered&quot;,&quot;false&quot;);\n w.nextMatch += endpos+3;\n if (w.source.substr(w.nextMatch,1)==&quot;\sn&quot;) w.nextMatch++;\n if (config.options.chkDebugLazySliderDefer) alert(&quot;deferred '&quot;+title+&quot;':\sn\sn&quot;+panel.getAttribute(&quot;raw&quot;));\n }\n }\n }\n }\n)\n\n// TBD: ignore 'quoted' delimiters (e.g., &quot;{{{+++foo===}}}&quot; isn't really a slider)\nfunction findMatchingDelimiter(src,starttext,endtext) {\n var startpos = 0;\n var endpos = src.indexOf(endtext);\n // check for nested delimiters\n while (src.substring(startpos,endpos-1).indexOf(starttext)!=-1) {\n // count number of nested 'starts'\n var startcount=0;\n var temp = src.substring(startpos,endpos-1);\n var pos=temp.indexOf(starttext);\n while (pos!=-1) { startcount++; pos=temp.indexOf(starttext,pos+starttext.length); }\n // set up to check for additional 'starts' after adjusting endpos\n startpos=endpos+endtext.length;\n // find endpos for corresponding number of matching 'ends'\n while (startcount &amp;&amp; endpos!=-1) {\n endpos = src.indexOf(endtext,endpos+endtext.length);\n startcount--;\n }\n }\n return (endpos==-1)?src.length:endpos;\n}\n//}}}\n\n//{{{\nfunction onClickNestedSlider(e)\n{\n if (!e) var e = window.event;\n var theTarget = resolveTarget(e);\n var theLabel = theTarget.firstChild.data;\n var theSlider = theTarget.sliderPanel\n var isOpen = theSlider.style.display!=&quot;none&quot;;\n // if using default button labels, toggle labels\n if (theLabel==&quot;&gt;&quot;) theTarget.firstChild.data = &quot;&lt;&quot;;\n else if (theLabel==&quot;&lt;&quot;) theTarget.firstChild.data = &quot;&gt;&quot;;\n // if using default tooltips, toggle tooltips\n if (theTarget.getAttribute(&quot;title&quot;)==&quot;show&quot;)\n theTarget.setAttribute(&quot;title&quot;,&quot;hide&quot;);\n else if (theTarget.getAttribute(&quot;title&quot;)==&quot;hide&quot;)\n theTarget.setAttribute(&quot;title&quot;,&quot;show&quot;);\n if (theTarget.getAttribute(&quot;title&quot;)==&quot;show &quot;+theLabel)\n theTarget.setAttribute(&quot;title&quot;,&quot;hide &quot;+theLabel);\n else if (theTarget.getAttribute(&quot;title&quot;)==&quot;hide &quot;+theLabel)\n theTarget.setAttribute(&quot;title&quot;,&quot;show &quot;+theLabel);\n // deferred rendering (if needed)\n if (theSlider.getAttribute(&quot;rendered&quot;)==&quot;false&quot;) {\n if (config.options.chkDebugLazySliderRender)\n alert(&quot;rendering '&quot;+theLabel+&quot;':\sn\sn&quot;+theSlider.getAttribute(&quot;raw&quot;));\n var place=theSlider;\n if (theSlider.getAttribute(&quot;blockquote&quot;)==&quot;true&quot;)\n place=createTiddlyElement(place,&quot;blockquote&quot;);\n wikify(theSlider.getAttribute(&quot;raw&quot;),place);\n theSlider.setAttribute(&quot;rendered&quot;,&quot;true&quot;);\n }\n // show/hide the slider\n if(config.options.chkAnimate)\n anim.startAnimating(new Slider(theSlider,!isOpen,e.shiftKey || e.altKey,&quot;none&quot;));\n else\n theSlider.style.display = isOpen ? &quot;none&quot; : &quot;block&quot;;\n if (this.sliderCookie &amp;&amp; this.sliderCookie.length)\n { config.options[this.sliderCookie]=!isOpen; saveOptionCookie(this.sliderCookie); }\n // align slider/floater position with target button\n adjustSliderPos(theSlider.parentNode,theTarget,theSlider,theSlider.className);\n return false;\n}\n\n// hijack animation handler 'stop' handler so overflow is visible after animation has completed\nSlider.prototype.coreStop = Slider.prototype.stop;\nSlider.prototype.stop = function() { this.coreStop(); this.element.style.overflow = &quot;visible&quot;; }\n\n// adjust panel position based on button position\nif (window.adjustSliderPos==undefined) window.adjustSliderPos=function(place,btn,panel,panelClass) {\n ///////////////////////////////////////////////////////////////////////////////\n /// EXPERIMENTAL HACK - WORKS IN SOME CASES, NOT IN OTHERS\n ///////////////////////////////////////////////////////////////////////////////\n // &quot;if this panel is floating and the parent is not also a floating panel&quot;...\n if (panelClass==&quot;floatingPanel&quot; &amp;&amp; place.className!=&quot;floatingPanel&quot;) {\n var left=0; var top=btn.offsetHeight;\n if (place.style.position!=&quot;relative&quot;) { left+=findPosX(btn); top+=findPosY(btn); }\n if (left+panel.offsetWidth &gt; getWindowWidth()) left=getWindowWidth()-panel.offsetWidth-10;\n panel.style.left=left+&quot;px&quot;; panel.style.top=top+&quot;px&quot;;\n }\n}\n\nfunction getWindowWidth() {\n if(document.width!=undefined)\n return document.width; // moz (FF)\n if(document.documentElement &amp;&amp; ( document.documentElement.clientWidth || document.documentElement.clientHeight ) )\n return document.documentElement.clientWidth; // IE6\n if(document.body &amp;&amp; ( document.body.clientWidth || document.body.clientHeight ) )\n return document.body.clientWidth; // IE4\n if(window.innerWidth!=undefined)\n return window.innerWidth; // IE - general\n return 0; // unknown\n}\n//}}}\n// //===</div>
<div tiddler="NewMovieForm" modifier="Saq" modified="200604171222" created="200603041844" tags="excludeLists MovieManagerTiddlers">|outerborderonly|k\n|&lt;html&gt;&lt;b&gt;Title:&lt;/b&gt;&lt;br&gt;&lt;input name=movieName type=text /&gt;&lt;/html&gt;||&gt;|&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;|&gt;|[x(MovToSee)] - Movie to see|\n|~|&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;&lt;movielink&gt;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;||&gt;|[x(MovSeen)] - Movie seen|\n|&lt;html&gt;&lt;b&gt;Rating:&lt;/b&gt;&lt;br&gt;&lt;input name=movieRating type=text /&gt;&lt;/html&gt;|||&gt;|[x(MovFav)] - Top Movie|\n|~|||&gt;|[x(MovWatchAgain)] - Watch Again|\n|&gt;|&gt;|&gt;|&gt;|&lt;html&gt;&lt;br&gt;&lt;b&gt;Review:&lt;/b&gt;&lt;br&gt;&lt;TEXTAREA name=movieReview rows=8 cols=80 &gt;&lt;/TEXTAREA&gt;&lt;/html&gt;|\n|&gt;|&gt;|&gt;|&gt;|&lt;html&gt;&lt;br&gt;&lt;b&gt;Other Notes:&lt;/b&gt;&lt;br&gt;&lt;TEXTAREA name=movieNotes rows=4 cols=80 &gt;&lt;/TEXTAREA&gt;&lt;/html&gt;|\n&lt;data&gt;{&quot;movieName&quot;:&quot;orm&quot;}&lt;/data&gt;</div>
<div tiddler="NewMovieMacro" modifier="Saq" modified="200604171222" created="200603141626" tags="systemConfig excludeLists MovieManagerTiddlers">/***\nTo Do:\n*adding more than one tag (will need to convert string into array i think)\n** add tags from template, any point in this case?\n*incorporate imdb ratings set, if ever working!\n!Code\n***/\n\n//{{{\nconfig.macros.newMovie = {\n // Standard Properties\n label: &quot;newTiddlerWithForm&quot;,\n version: {major: 1, minor: 0, revision: 1, date: new Date(2006, 1, 6)},\n prompt: &quot;Creates a new Tiddler with a &lt;&lt;formTiddler ...&gt;&gt; macro&quot;\n}\n\nconfig.macros.newMovie.handler = function(place,macroName,params) {\n // --- Parsing ------------------------------------------\n\n var i = 0; // index running over the params\n\n // get the name of the form template tiddler\n var formTemplateName = undefined;\n if (i &lt; params.length) {\n formTemplateName = params[i];\n i++;\n }\n\n if (!formTemplateName) {\n config.macros.formTiddler.createErrorElement(place, &quot;No form template specified in &lt;&lt;&quot; + macroName + &quot;&gt;&gt;.&quot;);\n return;\n }\n\n // get the button label\n var buttonLabel = undefined;\n if (i &lt; params.length) {\n buttonLabel = params[i];\n i++;\n }\n\n if (!buttonLabel) {\n config.macros.formTiddler.createErrorElement(place, &quot;No button label specified in &lt;&lt;&quot; + macroName + &quot;&gt;&gt;.&quot;);\n return;\n }\n\n // get the (optional) tiddlerName script and &quot;askUser&quot;\n var tiddlerNameScript = undefined;\n var askUser = false;\n if (i &lt; params.length) {\n tiddlerNameScript = params[i];\n i++;\n\n if (i &lt; params.length &amp;&amp; params[i] == &quot;askUser&quot;) {\n askUser = true;\n i++;\n }\n }\n var tempTag = undefined;\n if (i &lt; params.length) {\n tempTag = params[i];\n i++;\n }\n\n // --- Processing ------------------------------------------\n\n if(!readOnly) {\n var onClick = function() {\n var movieTitle;\n var tiddlerName = 'Movies - ' + movieTitle;\n\n if (tiddlerNameScript) {\n try {\n tiddlerName = eval(tiddlerNameScript);\n } catch (ex) {\n }\n }\n if (!tiddlerName || askUser) {\n movieTitle = prompt(&quot;Please specify a movie name.&quot;, &quot;&quot;);\n var tiddlerName = 'Movies - ' + movieTitle;}\n while (tiddlerName &amp;&amp; store.getTiddler(tiddlerName)) {\n movieTitle = prompt(&quot;A movie named '&quot;+movieTitle+&quot;' already exists.\sn\sn&quot;+&quot;Please specify a movie name.&quot;, movieTitle); var tiddlerName = 'Movies - ' + movieTitle;\n }\n\n // tiddlerName is either null (user canceled) or a name that is not yet in the store.\n if ((tiddlerName)&amp;&amp;(movieTitle!=null)) {\n var body = &quot;&lt;&lt;formTiddler [[&quot;+formTemplateName+&quot;]]&gt;&gt;&quot;;\n var tags = tempTag;\n store.saveTiddler(tiddlerName,tiddlerName,body,config.options.txtUserName,new Date(),tags);\n DataTiddler.setData(tiddlerName,&quot;movieName&quot;,movieTitle);\n DataTiddler.setData(tiddlerName,&quot;movieRating&quot;,&quot;&quot;);\n story.displayTiddler(null,tiddlerName,1);\n if(config.options.chkAutoSave)\n saveChanges();\n }\n else\n {return false;}\n }\n\n createTiddlyButton(place,buttonLabel,buttonLabel,onClick);\n }\n\n}\n//}}}</div>
<div tiddler="PageTemplate" modifier="Saq" modified="200604171222" created="200604162202" tags="excludeLists MovieManagerTiddlers">&lt;!---\nI've just tweaked my gradient colours and the topMenu bit. See HorizontalMainMenu.\n---&gt;\n&lt;!--{{{--&gt;\n\n&lt;div id='topMenu' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;\n&lt;/div&gt;\n&lt;div id='sidebar'&gt;\n&lt;div id='sidebarOptions' refresh='content' tiddler='SideBarOptions'&gt;&lt;/div&gt;\n&lt;div id='sidebarTabs' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;\n&lt;/div&gt;\n&lt;div id='displayArea'&gt;\n&lt;div id='messageArea'&gt;&lt;/div&gt;\n&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;\n&lt;/div&gt;\n&lt;!--}}}--&gt;\n</div>
<div tiddler="RefreshCommand" modifier="Saq" modified="200604171222" created="200604162157" tags="systemConfig excludeLists MovieManagerTiddlers">/***\n***/\n\n//{{{\n\nconfig.commands.refresh = {\n text: 'refresh',\n tooltip: 'Refresh this tiddler',\n handler: function(e,src,title) {\n clearMessage();\n story.refreshTiddler(title,false,true); // force=true\n return false;\n }\n};\n\n//}}}</div>
<div tiddler="SideBarCSS" modifier="Saq" modified="200604171223" created="200604162207" tags="excludeLists MovieManagerTiddlers">/***\nThis CSS by DaveBirss.\n***/\n/*{{{*/\n\n.tabSelected {\n background: #fff;\n}\n\n.tabUnselected {\n background: #eee;\n}\n\n#sidebar {\n color: #000;\n background: transparent; \n}\n\n#sidebarOptions {\n background: #fff;\n}\n\n#sidebarOptions .button {\n color: #999;\n}\n\n#sidebarOptions .button:hover {\n color: #000;\n background: #fff;\n border-color:white;\n}\n\n#sidebarOptions .button:active {\n color: #000;\n background: #fff;\n}\n\n#sidebarOptions .sliderPanel {\n background: transparent;\n}\n\n#sidebarOptions .sliderPanel A {\n color: #999;\n}\n\n#sidebarOptions .sliderPanel A:hover {\n color: #000;\n background: #fff;\n}\n\n#sidebarOptions .sliderPanel A:active {\n color: #000;\n background: #fff;\n}\n\n.sidebarSubHeading {\n color: #000;\n}\n\n#sidebarTabs {`\n background: #fff\n}\n\n#sidebarTabs .tabSelected {\n color: #000;\n background: #fff;\n border-top: solid 1px #ccc;\n border-left: solid 1px #ccc;\n border-right: solid 1px #ccc;\n border-bottom: none;\n}\n\n#sidebarTabs .tabUnselected {\n color: #999;\n background: #eee;\n border-top: solid 1px #ccc;\n border-left: solid 1px #ccc;\n border-right: solid 1px #ccc;\n border-bottom: none;\n}\n\n#sidebarTabs .tabContents {\n background: #fff;\n}\n\n\n#sidebarTabs .txtMoreTab .tabSelected {\n background: #fff;\n}\n\n#sidebarTabs .txtMoreTab .tabUnselected {\n background: #eee;\n}\n\n#sidebarTabs .txtMoreTab .tabContents {\n background: #fff;\n}\n\n#sidebarTabs .tabContents .tiddlyLink {\n color: #999;\n}\n\n#sidebarTabs .tabContents .tiddlyLink:hover {\n background: #fff;\n color: #000;\n}\n\n#sidebarTabs .tabContents {\n color: #000;\n}\n\n#sidebarTabs .button {\n color: #666;\n}\n\n#sidebarTabs .tabContents .button:hover {\n color: #000;\n background: #fff;\n}\n\n\n/*}}}*/</div>
<div tiddler="SortIt" modifier="Saq" modified="200604300850" created="200603141010" tags="systemConfig excludeLists MovieManagerTiddlers">config.macros.sortit = {}\nconfig.macros.sortit.handler = function(place,macroName,params,wikifier,paramString,callingTiddler){\n var tableId = params[0];\nif (document.getElementById(tableId))\n{config.macros.sortableGridPlugin.ts_makeSortable(document.getElementById(tableId))}\n}</div>
<div tiddler="SortableGridPlugin" modifier="Saq" modified="200604171223" created="200603050618" tags="systemConfig excludeLists MovieManagerTiddlers">// Begin SORTABLE.JS//\n// This Code is://\n// Code downloaded from the Browser Experiments section of kryogenix.org is licenced under the so-called MIT licence. The license is below.//\n////\n// Copyright (c) 1997-date Stuart Langridge//\n////\n// Permission is hereby granted, free of charge, to any person obtaining a copy of this //\n// software and associated documentation files (the &quot;Software&quot;), to deal in the Software //\n// without restriction, including without limitation the rights to use, copy, modify, merge, //\n// publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons //\n// to whom the Software is furnished to do so, subject to the following conditions://\n////\n// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, //\n// INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR //\n// PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE //\n// FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR //\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER //\n// DEALINGS IN THE SOFTWARE.//\n// //\n// //\n// Modified under the same aforementioned terms by Demian Johnston, 2006//\n/*\n! Test Cases\nSortable\nGrid requires the header row to be marked &quot;|h&quot;\n\n|Name |Salary|Extension |Start date|h\n|Bloggs, Fred |$12000.00 |1353|08/19/2003|\n|Bloggs, Fred |$12000.00 |1353|09/18/2003|\n|Bloggs, Fred |$12000.00 |1353|08/18/2003|\n|Bloggs, Fred |$12000.00 |1353|07/18/2003|\n|Bloggs, Fred |$12000.00 |1353|08/17/2003|\n|Turvey, Kevin |$191200.00 |2342 |02/05/1979|\n|Mbogo, Arnold |$32010.12 |2755 |09/08/1998|\n|Shakespeare, Bill |$122000.00|3211 |12/11/1961|\n|Shakespeare, Hamnet |$9000 |9005|01/01/2002|\n|Fitz, Marvin |$3300 |5554 |05/22/1995|\n\nUnsortableGrid (doesn't mark header row)\n\n|Name |Salary|Extension |Start date|\n|Bloggs, Fred |$12000.00 |1353|08/19/2003|\n|Bloggs, Fred |$12000.00 |1353|09/18/2003|\n|Bloggs, Fred |$12000.00 |1353|08/18/2003|\n|Bloggs, Fred |$12000.00 |1353|07/18/2003|\n|Bloggs, Fred |$12000.00 |1353|08/17/2003|\n|Turvey, Kevin |$191200.00 |2342 |02/05/1979|\n|Mbogo, Arnold |$32010.12 |2755 |09/08/1998|\n|Shakespeare, Bill |$122000.00|3211 |12/11/1961|\n|Shakespeare, Hamnet |$9000 |9005|01/01/2002|\n|Fitz, Marvin |$3300 |5554 |05/22/1995|\n\nCredit to Stuart Langridge,November 2003\nhttp://www.kryogenix.org/code/browser/sorttable/\n*/\n//{{{\nversion.extensions.sortableGrid= {major: 1, minor: 0, revision: 0, date: new Date(2006,2,14)};\n//}}}\n//{{{\nconfig.macros.sortableGridPlugin = {SORT_COLUMN_INDEX: 0};\n\nconfig.macros.sortableGridPlugin.ts_makeSortable=function(table) {\n var firstRow;\n if (table.rows &amp;&amp; table.rows.length &gt; 0) {\n firstRow = table.rows[0];\n }\n if (!firstRow) return;\n \n // We have a first row: assume it's the header, and make its contents clickable links\n for (var i=0;i&lt;firstRow.cells.length;i++) {\n var cell = firstRow.cells[i];\n var txt = config.macros.sortableGridPlugin.ts_getInnerText(cell);\n cell.innerHTML = '&lt;a href=&quot;#&quot; class=&quot;sortheader&quot; onclick=&quot;config.macros.sortableGridPlugin.ts_resortTable(this);return false;&quot;&gt;'+txt+'&lt;span class=&quot;sortarrow&quot;&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;/a&gt;';\n }\n};\n//}}}\n\n//{{{\nconfig.macros.sortableGridPlugin.ts_getInnerText=function(el) {\n if (typeof el == &quot;string&quot;) return el;\n if (typeof el == &quot;undefined&quot;) { return el };\n if (el.innerText) return el.innerText; //Not needed but it is faster\n var str = &quot;&quot;;\n \n var cs = el.childNodes;\n var l = cs.length;\n for (var i = 0; i &lt; l; i++) {\n switch (cs[i].nodeType) {\n case 1: //ELEMENT_NODE\n str += config.macros.sortableGridPlugin.ts_getInnerText(cs[i]);\n break;\n case 3: //TEXT_NODE\n str += cs[i].nodeValue;\n break;\n }\n }\n return str;\n};\n\nconfig.macros.sortableGridPlugin.getParent=function(el, pTagName) {\n if (el == null) return null;\n else if (el.nodeType == 1 &amp;&amp; el.tagName.toLowerCase() == pTagName.toLowerCase()) // Gecko bug, supposed to be uppercase\n return el;\n else\n return config.macros.sortableGridPlugin.getParent(el.parentNode, pTagName);\n};\n//}}}\n\n//{{{\nconfig.macros.sortableGridPlugin.ts_resortTable=function(lnk) {\n // get the span\n var span;\n for (var ci=0;ci&lt;lnk.childNodes.length;ci++) {\n if (lnk.childNodes[ci].tagName &amp;&amp; lnk.childNodes[ci].tagName.toLowerCase() == 'span') span = lnk.childNodes[ci];\n }\n var td = lnk.parentNode;\n var column = td.cellIndex;\n var table = config.macros.sortableGridPlugin.getParent(td,'TABLE');\n \n // Work out a type for the column\n if (table.rows.length &lt;= 1) return;\n var itm = config.macros.sortableGridPlugin.ts_getInnerText(table.rows[1].cells[column]);\n var sortfn = config.macros.sortableGridPlugin.ts_sort_caseinsensitive;\n if (itm.match(/^\sd\sd[\s/-]\sd\sd[\s/-]\sd\sd\sd\sd$/)) sortfn = config.macros.sortableGridPlugin.ts_sort_date;\n if (itm.match(/^\sd\sd[\s/-]\sd\sd[\s/-]\sd\sd$/)) sortfn = config.macros.sortableGridPlugin.ts_sort_date;\n if (itm.match(/^[?$]/)) sortfn = config.macros.sortableGridPlugin.ts_sort_currency;\n if (itm.match(/^[\sd\s.]+$/)) sortfn = config.macros.sortableGridPlugin.ts_sort_numeric;\n config.macros.sortableGridPlugin.SORT_COLUMN_INDEX = column;\n var firstRow = new Array();\n var newRows = new Array();\n for (var i=0;i&lt;table.rows[0].length;i++) { firstRow[i] = table.rows[0][i]; }\n for (var j=1;j&lt;table.rows.length;j++) { newRows[j-1] = table.rows[j]; }\n\n newRows.sort(sortfn);\n var ARROW;\n if (span.getAttribute(&quot;sortdir&quot;) == 'down') {\n ARROW = '&amp;nbsp;&amp;nbsp;&amp;uarr;';\n newRows.reverse();\n span.setAttribute('sortdir','up');\n } else {\n ARROW = '&amp;nbsp;&amp;nbsp;&amp;darr;';\n span.setAttribute('sortdir','down');\n }\n \n // We appendChild rows that already exist to the tbody, so it moves them rather than creating new ones\n // don't do sortbottom rows\n for ( i=0;i&lt;newRows.length;i++) { if (!newRows[i].className || (newRows[i].className &amp;&amp; (newRows[i].className.indexOf('sortbottom') == -1))) table.tBodies[0].appendChild(newRows[i]);}\n // do sortbottom rows only\n for ( i=0;i&lt;newRows.length;i++) { if (newRows[i].className &amp;&amp; (newRows[i].className.indexOf('sortbottom') != -1)) table.tBodies[0].appendChild(newRows[i]);}\n \n // Delete any other arrows there may be showing\n var allspans = document.getElementsByTagName(&quot;span&quot;);\n for ( ci=0;ci&lt;allspans.length;ci++) {\n if (allspans[ci].className == 'sortarrow') {\n if (config.macros.sortableGridPlugin.getParent(allspans[ci],&quot;table&quot;) == config.macros.sortableGridPlugin.getParent(lnk,&quot;table&quot;)) { // in the same table as us?\n allspans[ci].innerHTML = '&amp;nbsp;&amp;nbsp;&amp;nbsp;';\n }\n }\n }\n \n span.innerHTML = ARROW;\n};\n//}}}\n\n//{{{\n config.macros.sortableGridPlugin.ts_sort_date=function(a,b) {\n // y2k notes: two digit years less than 50 are treated as 20XX, greater than 50 are treated as 19XX\n var mmdd=1; // US Mode (set to 0) for dd/mm/yyyy\n\n var aa = config.macros.sortableGridPlugin.ts_getInnerText(a.cells[config.macros.sortableGridPlugin.SORT_COLUMN_INDEX]);\n var bb = config.macros.sortableGridPlugin.ts_getInnerText(b.cells[config.macros.sortableGridPlugin.SORT_COLUMN_INDEX]);\n var dt1;\n var dt2;\n var yr;\n if (aa.length == 10) {\n if (mmdd)\n dt1 = aa.substr(6,4)+aa.substr(0,2)+aa.substr(3,2);\n else\n dt1 = aa.substr(6,4)+aa.substr(3,2)+aa.substr(0,2);\n } else {\n yr = aa.substr(6,2);\n if (parseInt(yr) &lt; 50) { yr = '20'+yr; } else { yr = '19'+yr; }\n if (mmdd)\n dt1 = yr+aa.substr(0,2)+aa.substr(3,2);\n else\n dt1 = yr+aa.substr(3,2)+aa.substr(0,2);\n }\n if (bb.length == 10) {\n if (mmdd)\n dt2 = bb.substr(6,4)+bb.substr(0,2)+bb.substr(3,2);\n else\n dt2 = bb.substr(6,4)+bb.substr(3,2)+bb.substr(0,2);\n } else {\n yr = bb.substr(6,2);\n if (parseInt(yr) &lt; 50) { yr = '20'+yr; } else { yr = '19'+yr; }\n if (mmdd)\n dt2 = yr+bb.substr(0,2)+bb.substr(3,2);\n else\n dt2 = yr+bb.substr(3,2)+bb.substr(0,2);\n }\n if (dt1==dt2) return 0;\n if (dt1&lt;dt2) return -1;\n return 1;\n};\n\n config.macros.sortableGridPlugin.ts_sort_currency=function(a,b) { \n var aa = config.macros.sortableGridPlugin.ts_getInnerText(a.cells[config.macros.sortableGridPlugin.SORT_COLUMN_INDEX]).replace(/[^0-9.]/g,'');\n var bb = config.macros.sortableGridPlugin.ts_getInnerText(b.cells[config.macros.sortableGridPlugin.SORT_COLUMN_INDEX]).replace(/[^0-9.]/g,'');\n return parseFloat(aa) - parseFloat(bb);\n};\n\n config.macros.sortableGridPlugin.ts_sort_numeric=function(a,b) { \n var aa = parseFloat(config.macros.sortableGridPlugin.ts_getInnerText(a.cells[config.macros.sortableGridPlugin.SORT_COLUMN_INDEX]));\n if (isNaN(aa)) aa = 0;\n var bb = parseFloat(config.macros.sortableGridPlugin.ts_getInnerText(b.cells[config.macros.sortableGridPlugin.SORT_COLUMN_INDEX])); \n if (isNaN(bb)) bb = 0;\n return aa-bb;\n};\n\n config.macros.sortableGridPlugin.ts_sort_caseinsensitive=function(a,b) {\n var aa = config.macros.sortableGridPlugin.ts_getInnerText(a.cells[config.macros.sortableGridPlugin.SORT_COLUMN_INDEX]).toLowerCase();\n var bb = config.macros.sortableGridPlugin.ts_getInnerText(b.cells[config.macros.sortableGridPlugin.SORT_COLUMN_INDEX]).toLowerCase();\n if (aa==bb) return 0;\n if (aa&lt;bb) return -1;\n return 1;\n};\n\n config.macros.sortableGridPlugin.ts_sort_default=function(a,b) {\n var aa = config.macros.sortableGridPlugin.ts_getInnerText(a.cells[config.macros.sortableGridPlugin.SORT_COLUMN_INDEX]);\n var bb = config.macros.sortableGridPlugin.ts_getInnerText(b.cells[config.macros.sortableGridPlugin.SORT_COLUMN_INDEX]);\n if (aa==bb) return 0;\n if (aa&lt;bb) return -1;\n return 1;\n};\n//}}}\n\n// end Code downloaded from the Browser Experiments section of kryogenix.org is licenced under the so-called MIT licence. The license is below.//\n// //\n// end Copyright (c) 1997-date Stuart Langridge//\n// END SORTABLE.JS//\n\n\n\n//{{{\nconfig.formatters[0].handler=function(w)\n {\n var table = createTiddlyElement(w.output,&quot;table&quot;);\n w.nextMatch = w.matchStart;\n var lookaheadRegExp = new RegExp(this.lookahead,&quot;mg&quot;);\n var currRowType = null, nextRowType;\n var rowContainer, rowElement;\n var prevColumns = [];\n var rowCount = 0;\n var want_sortable=0;\n do {\n lookaheadRegExp.lastIndex = w.nextMatch;\n var lookaheadMatch = lookaheadRegExp.exec(w.source);\n var matched = lookaheadMatch &amp;&amp; lookaheadMatch.index == w.nextMatch;\n if(matched)\n {\n nextRowType = lookaheadMatch[2];\nif(nextRowType == &quot;k&quot;)\n {\n table.className = lookaheadMatch[1];\n w.nextMatch += lookaheadMatch[0].length+1;\n continue;\n }\n if(nextRowType != currRowType)\n rowContainer = createTiddlyElement(table,this.rowTypes[nextRowType]);\n currRowType = nextRowType;\n if(currRowType == &quot;c&quot;)\n {\n if(rowCount == 0)\n rowContainer.setAttribute(&quot;align&quot;,&quot;top&quot;);\n else\n rowContainer.setAttribute(&quot;align&quot;,&quot;bottom&quot;);\n w.nextMatch = w.nextMatch + 1;\n w.subWikify(rowContainer,this.rowTerminator);\n table.insertBefore(rowContainer,table.firstChild);\n }\n else\n {\n var rowClass = (rowCount &amp; 1) ? &quot;oddRow&quot; : &quot;evenRow&quot;;\n rowElement = createTiddlyElement(rowContainer,&quot;tr&quot;,null,rowClass);\n this.rowHandler(w,rowElement,prevColumns);\n }\n if(currRowType == &quot;h&quot;) {\n want_sortable=1;\n }\n rowCount++;\n }\n } while(matched);\n if (want_sortable) {\n table.setAttribute(&quot;class&quot;,&quot;sortable&quot;);\n config.macros.sortableGridPlugin.ts_makeSortable(table);\n }\n };\n\n//}}}</div>
<div tiddler="Stats" modifier="Saq" modified="200604171452" created="200604170857" tags="">&lt;&lt;forEachTiddler\nwhere\n'tiddler'\nsortBy\n'tiddler.text.length'\ndescending\nwrite\n'&quot;|[[&quot;+tiddler.title+&quot;]]|&quot;+tiddler.text.length+&quot;|\sn&quot;'\n&gt;&gt;</div>
<div tiddler="StyleSheet" modifier="Saq" modified="200604300844" created="200603061843" tags="excludeLists MovieManagerTiddlers">/***\n\n***/\n/*{{{*/\n[[CSS-movietable]]\n[[SideBarCSS]]\n/***\nClint's fix for weird IE behaviours\n***/\n/*{{{*/\nbody {position:static;}\n.tagClear{margin-top:1em;clear:both;}\n/*}}}*/\n/***\nJust colours, fonts, tweaks etc. See SideBarWhiteAndGrey\n***/\n/*{{{*/\n\n.adjustable {\n	cursor: pointer; \n}\n\n.boxtext {background:#eee;\ndisplay:block;margin:1em 1em 1em 1em;padding:3px 3px;border:1px solid #ccc;\n}\n\n\nbody {background:#eee; /* font-size:103%; */}\na{ color: #3A4880; }\na:hover{ background: #3A4856; color: #fff; }\n.popup { background:#3A4856; border: 1px solid #3A4856; }\n.popup li a:hover {\n background: #F0F2F4;\n color: #3A4856;\n border: none;\n}\n.viewer .button {\n color: white;\n background:#3A4856;\n border: 1px solid #EAECEE;\n\n}\n\n\n\n\n.button:hover, .button:active {\n color: #111;\n background: #EAECEE;\n border-color: #3A4856;\n}\n\n\n\n.highlight, .marked {\n background: #EAECEE;\n}\n\n.writemovie{\n	font-weight: bold; margin-left: 8.5em;\n}\n\n.writemovie .button { padding:1px;}\n\n.headerForeground a { color: #6fc;}\n.headerShadow { left: 2px; top: 2px; }\n.title { padding:0px; margin:0px; }\n.siteSubtitle { padding:0px; margin:0px; padding-left:1.5em; }\n.subtitle { font-size:90%; color:#ccc; padding-left:0.25em; }\nh1,h2,h3,h4,h5 { color: #000; background: transparent; }\n.title {color:black; font-size:2em;}\n.shadow .title {color:#999; }\n.viewer pre { background-color:#f8f8ff; border-color:#ddf; }\n.viewer { padding-top:0px; }\n.editor textarea { font-family:monospace; }\n#sidebarOptions { border:1px #ccc solid; }\n.tiddler {\n border-bottom:1px solid #ccc; border-right:1px solid #ccc; padding-bottom:1em; margin-bottom:1em; \n background:#fff; padding-right:1.5em; }\n#messageArea { background-color:#EAECEE; border-color:#3A4856; font-size:90%; }\n#messageArea .button { text-decoration:none; font-weight:bold; background:transparent; border:0px; }\n\n\n\n\n/*New Movie Form*/\ntable.outerborderonly {\n border-width: 1px 1px 1px 1px;\n border-spacing: 0px;\n border-style: solid solid solid solid;\n border-color: black black black black;\n border-collapse: collapse;\n background-color: ;\n}\ntable.outerborderonly td, table.outerborderonly tr, table.outerborderonly th {\n border-width: 0px 0px 0px 0px;\n padding: 5px 5px 5px 5px;\n background-color: #EEEEEE;}\n\n/*tabs*/\n.tabSelected{\n color: #014;\n background: #eee;\n border-left: 1px solid #ccc;\n border-top: 1px solid #ccc;\n border-right: 1px solid #ccc;\n}\n\n.tabUnselected {\n color: #fff;\n background: #999;\n}\n\n.tabContents {\n color: #014;\n background: #fff;\n border: 1px solid #ccc;\n}\n\n\n\n\n#topMenu br {display:none; }\n#topMenu { background: #3A4856; }\n#topMenu { padding:5px 2px 1px 2px; }\n#topMenu .button, #topMenu .tiddlyLink {\n margin-left:0.5em; margin-right:0.5em;\n padding-left:3px; padding-right:3px;\n color:white; font-size:125%;\n}\n\n\n#displayArea { margin: 1em 15.7em 0em 1em; } /* so we use the freed up space */\n#topMenu .button:hover, #topMenu .tiddlyLink:hover { background:#F0F2F4; color:#3A4856;}\n}\n\n\n/*}}}*/\n\n</div>
<div tiddler="TabEditPlugin" modifier="Saq" modified="200606031801" created="200606031801" tags="systemConfig excludeLists">/***\n|Name|TabEditPlugin|\n|Created by|SaqImtiaz|\n|Location|http://lewcid.googlepages.com/lewcid.html#TabEditPlugin|\n|Version|0.32|\n|Requires|~TW2.x|\n\n!Description\nMakes editing of tabs easier.\n\n!Usage\n*Double click a tab to edit the source tiddler\n*Double click outside the tabset to edit the containing tiddler. \n\n!Demo\nTestTabs\n\n!History\n*28-04-06, v0.32 - fixed previous bug fix!\n*27-04-06, v0.31 - fixed conflicts with tabs created using PartTiddler.\n*26-04-06, v0.30 - first public release\n\n***/\n\n//{{{\n\n//tab on double click event handler\nStory.prototype.onTabDblClick = function(e){\n        if (!e) var e = window.event;\n        var theTarget = resolveTarget(e);\n        var title= this.getAttribute(&quot;source&quot;);\n        if ((version.extensions.PartTiddlerPlugin)&amp;&amp;(title.indexOf(&quot;/&quot;)!=-1))\n                 {if (!oldFetchTiddler.call(this, [title]))\n                              {return false;}}   \n        story.displayTiddler(theTarget,title,2,false,null)\n        e.cancelBubble = true;\n        if (e.stopPropagation) e.stopPropagation();\n        return false;\n        }\n\nconfig.macros.tabs.switchTab = function(tabset,tab)\n{\n	var cookie = tabset.getAttribute(&quot;cookie&quot;);\n	var theTab = null\n	var nodes = tabset.childNodes;\n	for(var t=0; t&lt;nodes.length; t++)\n		if(nodes[t].getAttribute &amp;&amp; nodes[t].getAttribute(&quot;tab&quot;) == tab)\n			{\n			theTab = nodes[t];\n			theTab.className = &quot;tab tabSelected&quot;;\n			}\n		else\n			nodes[t].className = &quot;tab tabUnselected&quot;\n	if(theTab)\n		{\n		if(tabset.nextSibling &amp;&amp; tabset.nextSibling.className == &quot;tabContents&quot;)\n			tabset.parentNode.removeChild(tabset.nextSibling);\n		var tabContent = createTiddlyElement(null,&quot;div&quot;,null,&quot;tabContents&quot;,null);\n		tabset.parentNode.insertBefore(tabContent,tabset.nextSibling);\n		var contentTitle = theTab.getAttribute(&quot;content&quot;);\n\n                //set source attribute equal to title of tiddler displayed in tab\n		tabContent.setAttribute(&quot;source&quot;,contentTitle);\n		//add dbl click event\n		tabContent.ondblclick = story.onTabDblClick;\n\n		wikify(store.getTiddlerText(contentTitle),tabContent,null,store.getTiddler(contentTitle));\n		if(cookie)\n			{\n			config.options[cookie] = tab;\n			saveOptionCookie(cookie);\n			}\n		}\n}\n\n//}}}</div>
<div tiddler="TabTimeline" modifier="Saq" modified="200606031754" created="200606031734" tags="excludeLists">&lt;&lt;timeline '' ''  '' 30&gt;&gt;</div>
<div tiddler="Timeline Hack" modifier="Saq" modified="200606031753" created="200606031729" tags="systemConfig excludeLists">/***\nA hack of the core timeline macro. Now you can specify a start date for the timeline, and the max number of days to display\n\n''Syntax:''\n\n{{{&lt;&lt;timeline '' '' '20060512'&gt;&gt;}}}\nWill start the timeline from the 12th of May 2006. Note the start date is the third parameter.\n\n{{{&lt;&lt;timeline '' '' '' '7'&gt;&gt;}}}\nWill display the timeline for the last 7 days. Note the max days is the fourth parameter.\n\nOf course, you can combine the above as well, a start date and the max days.\n\n\n\nThe first two parameters are the same as in the core, the first being the field to sort by (modified or created) and the second being the maximum number of entries.\n\n\n***/\n\n//{{{\nconfig.macros.timeline.handler = function(place,macroName,params)\n{\n	var field = params[0] ? params[0] : &quot;modified&quot;;\n	var tiddlers = store.reverseLookup(&quot;tags&quot;,&quot;excludeLists&quot;,false,field);\n	var lastDay = &quot;&quot;;\n	var last = params[1] ? tiddlers.length-Math.min(tiddlers.length,parseInt(params[1])) : 0;\n        var firstDay = params[2]? params[2]: &quot;00010101&quot;;\n        var maxDays =   params[3]? params[3]*24*60*60*1000: (new Date()).getTime() ;\n\n\n	for(var t=tiddlers.length-1; t&gt;=last; t--)\n		{\nif (tiddlers[t].tags.contains('Movie')==false)\n		{var tiddler = tiddlers[t];\n		var theDay = tiddler[field].convertToLocalYYYYMMDDHHMM().substr(0,8);\n        if ((theDay&gt;=firstDay)&amp;&amp; (tiddler[field].getTime()&gt; (new Date()).getTime() - maxDays))\n        {\n           if(theDay != lastDay)\n			{\n			var theDateList = document.createElement(&quot;ul&quot;);\n			place.appendChild(theDateList);\n			createTiddlyElement(theDateList,&quot;li&quot;,null,&quot;listTitle&quot;,tiddler[field].formatString(this.dateFormat));\n			lastDay = theDay;\n			}\n		var theDateListItem = createTiddlyElement(theDateList,&quot;li&quot;,null,&quot;listLink&quot;,null);\n		theDateListItem.appendChild(createTiddlyLink(place,tiddler.title,true));\n	     }\n      }}\n}\n//}}}</div>
<div tiddler="ToDo" modifier="YourName" modified="200606040722" created="200603101749" tags="">!extension\nauto add backuptweaks optios to advancedoptios\n----\n*reduce timeline/sidebar size\n*movies tab in timeline?\n*reduce number of entries in timeline?\n*keep divided lists?\n----\n*droptagging\n----\ntiddlytools, new document plugin for creating clean distribution versions?\nTW 2.0.9\n----\nset search defaults?\n----\n*''replace plugin documentation with links ''\n----\nstats\n----\n\n----\n----\n*sortable grids changes run by squishy\n**try padd table rows a lot, remove padding from header, and then remove default nbsp but keep on mouseover\n***add nbsp to the smaller content columns to make equal width as header\n***sortable header mouse overs\n*embed css image file?\n*constant table widths?\n*scroll to top command?\n*Movies Seen, make2006 specific\n*clean up css\n*NewMovieForm\n**css!\n----\n----\n----\n\n----\n----\n*enable backuptweaks\n*delete ImportTiddlers?\n*remove stats,changelog, todo\n*set DefaultTiddlers\n*edit MainMenu\n*exclude movies from tabs? excludeLists\n*check excludeLists\n*need to add MovieManagerTiddlers tags?\n*run Maintenance\n*delete Maintenance\n\n==========\n==========\n==========\n----\n----\n\n{{{ for making a movies tab\n&lt;&lt;forEachTiddler\nwhere\ntiddler.tags.contains(&quot;Movie&quot;)\n sortBy &quot;tiddler.modified&quot;\ndescending\nwrite\n'&quot;*[[&quot;+tiddler.data(&quot;movieName&quot;)+&quot;|&quot;+tiddler.title+&quot;]]\sn&quot;'&gt;&gt;\n}}}</div>
<div tiddler="ViewTemplate" modifier="Saq" modified="200606031800" created="200604162158" tags="excludeLists MovieManagerTiddlers">&lt;div class='toolbar'&gt;\n&lt;span style=&quot;padding-right:1.75em;&quot; macro='dropTags'&gt;&lt;/span&gt;\n&lt;span macro='toolbar -closeTiddler closeOthers +editTiddler refresh permalink references jump'&gt;&lt;/span&gt;\n&lt;/div&gt;\n&lt;div class='title' macro='view title'&gt;&lt;/div&gt;\n&lt;div class='subtitle'&gt;&lt;span macro='view modifier link'&gt;&lt;/span&gt;, &lt;span macro='view modified date [[DD MMM YYYY]]'&gt;&lt;/span&gt; (created &lt;span macro='view created date [[DD MMM YYYY]]'&gt;&lt;/span&gt;)&lt;/div&gt;\n&lt;div class='tagging' macro='tagging'&gt;&lt;/div&gt;\n\n&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;\n&lt;div class='tagClear'&gt;&lt;/div&gt;</div>
<div tiddler="WriteMovieListMacro" modifier="Saq" modified="200604200917" created="200604190817" tags="systemConfig MovieManagerTiddlers excludeLists">/***\n\n***/\n//{{{\nwindow.getTiddlyWikiDir=getTiddlyWikiDir;\n\nfunction getTiddlyWikiDir() {\n          var path = document.location.toString();\n          var i = path.lastIndexOf(&quot;/&quot;);\n          return (i &gt;= 0) ? path.substr(0, i+1) : path;\n}\n\nconfig.macros.dynamicLink={};\nconfig.macros.dynamicLink.handler= function(place,macroName,params,wikifier,paramString,tiddler){\n\n      var link=getTiddlyWikiDir();\n      var text='TW folder';\n      wikify(('[['+text+'|'+link+']]'),place);\n      \n      }\n\nfunction writeMovieList(e){\n         if (!e) var e = window.event;\n         var theTarget = resolveTarget(e);\n         var theLink = theTarget;\n         var list= theLink.getAttribute(&quot;list&quot;);\n         theLink = theLink.parentNode.parentNode;\n         var theMacro = eval(&quot;config.macros.writeMovieList.&quot;+list);\n         wikify(theMacro,theLink);\n         displayMessage(&quot;Movie List Saved&quot;,(getTiddlyWikiDir()));\n         return(false);\n}\n\n\nconfig.macros.writeMovieList={\n\n         MovToSee: '&lt;&lt;forEachTiddler where \s'tiddler.tags.contains(&quot;MovToSee&quot;) &amp;&amp; ! tiddler.tags.contains(&quot;MovSeen&quot;)\s' sortBy \s'(tiddler.data(&quot;movieName&quot;).toLowerCase())\s' write \s'tiddler.data(&quot;movieName&quot;)+&quot;\s\sn&quot;\s' toFile {{getTiddlyWikiDir()+&quot;Movies To See.txt&quot;}} withLineSeparator \s'\sr\sn\s' &gt;&gt;',\n\n         MovSeen: '&lt;&lt;forEachTiddler where \s'tiddler.tags.containsAny([&quot;MovSeen&quot;,&quot;MovSeenAgain&quot;])\s' sortBy \s'tiddler.data(&quot;movieDateSeen&quot;)\s' write \s'tiddler.data(&quot;movieName&quot;)+&quot;\s\sn&quot;\s' toFile {{getTiddlyWikiDir()+&quot;Movies Seen 2006.txt&quot;}} withLineSeparator \s'\sr\sn\s' &gt;&gt;',\n\n         MovTop: '&lt;&lt;forEachTiddler where \s'tiddler.tags.contains(&quot;MovFav&quot;)\s' sortBy \s'(9.9-tiddler.data(&quot;movieRating&quot;))+(tiddler.data(&quot;movieName&quot;).toLowerCase())\s' write \s'tiddler.data(&quot;movieName&quot;)+&quot;\s\sn&quot;\s' toFile {{getTiddlyWikiDir()+&quot;Top Movies.txt&quot;}} withLineSeparator \s'\sr\sn\s' &gt;&gt;',\n\n         MovAgain: '&lt;&lt;forEachTiddler where \s'tiddler.tags.contains(&quot;MovWatchAgain&quot;)\s' sortBy \s'(9.9-tiddler.data(&quot;movieRating&quot;))+(tiddler.data(&quot;movieName&quot;).toLowerCase())\s' write \s'tiddler.data(&quot;movieName&quot;)+&quot;\s\sn&quot;\s' toFile {{getTiddlyWikiDir()+&quot;Movies Watch Again.txt&quot;}} withLineSeparator \s'\sr\sn\s' &gt;&gt;',\n\n         MovOfficial: '&lt;&lt;forEachTiddler where \s'tiddler.tags.containsAny([&quot;MovFav&quot;,&quot;MovToSee&quot;])\s' sortBy \s'(tiddler.data(&quot;movieName&quot;).toLowerCase())\s' write \s'tiddler.data(&quot;movieName&quot;)+&quot;\s\sn&quot;\s' toFile {{getTiddlyWikiDir()+&quot;Official List of Movies.txt&quot;}} withLineSeparator \s'\sr\sn\s' &gt;&gt;'\n};\n\nconfig.macros.writeMovieList.dropdownchar = &quot;â¼&quot;;\nconfig.macros.writeMovieList.handler = function(place,macroName,params,wikifier,paramString,tiddler){\n         var arrow = ': '+ config.macros.writeMovieList.dropdownchar;\n         var label = 'Save to File'+arrow;\n         var tooltip = 'Save Movie List To File';\n\n         var listNames= new Array(&quot;Movies To See&quot;,&quot;Movies Seen 2006&quot;,&quot;Top Movies&quot;,&quot;Movies Watch Again&quot;,&quot;Official List&quot;);\n         var listValues= new Array(&quot;MovToSee&quot;,&quot;MovSeen&quot;,&quot;MovTop&quot;,&quot;MovAgain&quot;,&quot;MovOfficial&quot;);\n\n         var onclick = function(e)\n             { if (!e) var e = window.event;\n             var popup = Popup.create(this);\n             var lingo = config.views.wikified.tag;\n             for(var t=0; t&lt;listValues.length; t++)\n                     { var theButton = createTiddlyButton(createTiddlyElement(popup,&quot;li&quot;),listNames[t],null,writeMovieList,&quot;tiddlyLinkExisting&quot;);\n                     theButton.setAttribute(&quot;list&quot;,listValues[t]);}\n             Popup.show(popup,false);\n             e.cancelBubble = true;\n             if (e.stopPropagation)\n                e.stopPropagation();\n             return(false);\n             };\n\n        var createdropperButton = function(place){\n        var sp = createTiddlyElement(place,&quot;span&quot;,null,&quot;writemovie&quot;);\n        var theDropDownBtn = createTiddlyButton(sp,label,tooltip,onclick);\n        };\n\ncreatedropperButton(place);\n};\n//}}}</div>
<div tiddler="YourSearchPlugin" modifier="Saq" modified="200604201037" created="200604172141" tags="systemConfig MovieManagerTiddlers excludeLists">/***\n|''Name:''|YourSearchPlugin|\n|''Version:''|2.0.2 (2006-02-13)|\n|''Source:''|http://tiddlywiki.abego-software.de/#YourSearchPlugin|\n|''Author:''|UdoBorkowski (ub [at] abego-software [dot] de)|\n|''Licence:''|[[BSD open source license]]|\n|''TiddlyWiki:''|2.0|\n|''Browser:''|Firefox 1.0.4+; Firefox 1.5; InternetExplorer 6.0|\n&lt;&lt;tiddler [[YourSearch Introduction]]&gt;&gt;\nFor more information see [[Help|YourSearch Help]].\n\n!Compatibility\nThis plugin requires TiddlyWiki 2.0. \nUse http://tiddlywiki.abego-software.de/#YourSearchPlugin-1.0.1 for older TiddlyWiki versions.\n\n!Revision history\n* v2.0.2 (2006-02-13)\n** Bugfix for Firefox 1.5.0.1 related to the &quot;Show prefix&quot; checkbox. Thanks to Ted Pavlic for reporting and to BramChen for fixing. \n** Internal\n*** Make &quot;JSLint&quot; conform\n* v2.0.1 (2006-02-05)\n** Support &quot;Exact Word Match&quot; (use '=' to prefix word)\n** Support default filter settings (when no filter flags are given in search term)\n** Rework on the &quot;less than 3 chars search text&quot; feature (thanks to EricShulman)\n** Better support SinglePageMode when doing &quot;Open all tiddlers&quot; (thanks to EricShulman)\n** Support Firefox 1.5.0.1\n** Bug: Fixed a hilite bug in &quot;classic search mode&quot; (thanks to EricShulman)\n* v2.0.0 (2006-01-16)\n** Add User Interface\n* v1.0.1 (2006-01-06)\n** Support TiddlyWiki 2.0\n* v1.0.0 (2005-12-28)\n** initial version\n!Code\nThe code is compressed. \n\nYou can retrieve a readable source code version from http://tiddlywiki.abego-software.de/#YourSearchPlugin-src.\n/%\n***/\nif(!version.extensions.YourSearchPlugin){version.extensions.YourSearchPlugin={major:2,minor:0,revision:2,date:new Date(2006,2,13),type:&quot;plugin&quot;,source:&quot;http://tiddlywiki.abego-software.de/#YourSearchPlugin&quot;};var alertAndThrow=function(_1){alert(_1);throw _1;};if(!window.abego){window.abego={};}if(abego.YourSearch){alertAndThrow(&quot;abego.YourSearch already defined&quot;);}abego.YourSearch={};if(version.major&lt;2){alertAndThrow(&quot;YourSearchPlugin requires TiddlyWiki 2.0 or newer.\sn\snGet YourSearch 1.0.1 to use YourSearch with older versions of TiddlyWiki.\sn\snhttp://tiddlywiki.abego-software.de/#YourSearchPlugin-1.0.1&quot;);}var STQ=function(_2,_3,_4,_5){this.queryText=_2;this.caseSensitive=_3;if(_5){this.regExp=new RegExp(_2,_3?&quot;mg&quot;:&quot;img&quot;);return;}this.terms=[];var re=/\ss*(\s-)?([#%!=]*)(?:(?:(&quot;(?:(?:\s\s&quot;)|[^&quot;])*&quot;)|(\sS+)))(?:\ss+((?:[aA][nN][dD])|(?:[oO][rR]))(?!\sS))?/mg;var _7=re.exec(_2);while(_7!=null&amp;&amp;_7.length==6){var _8=&quot;-&quot;==_7[1];var _9=_7[2];var _a=_9.indexOf(&quot;!&quot;)&gt;=0;var _b=_9.indexOf(&quot;%&quot;)&gt;=0;var _c=_9.indexOf(&quot;#&quot;)&gt;=0;var _d=_9.indexOf(&quot;=&quot;)&gt;=0;if(!_a&amp;&amp;!_b&amp;&amp;!_c){_a=config.options.chkSearchInTitle;_b=config.options.chkSearchInText;_c=config.options.chkSearchInTags;if(!_a&amp;&amp;!_b&amp;&amp;!_c){_a=_b=_c=true;}}if(_4){_b=false;_c=false;}var _e;if(_7[3]){try{_e=eval(_7[3]);}catch(ex){}}else{_e=_7[4];}if(!_e){throw &quot;Invalid search expression: %0&quot;.format([_2]);}var _f=_7[5]&amp;&amp;_7[5].charAt(0).toLowerCase()==&quot;o&quot;;this.terms.push(new STQ.Term(_e,_a,_b,_c,_8,_f,_3,_d));_7=re.exec(_2);}};var me=STQ.prototype;me.getMatchingTiddlers=function(_10){var _11=[];for(var i in _10){var t=_10[i];if((t instanceof Tiddler)&amp;&amp;this.matchesTiddler(t)){_11.push(t);}}return _11;};me.matchesTiddler=function(_14){if(this.regExp){return this.regExp.test(_14.title)||this.regExp.test(_14.text);}var n=this.terms.length;if(n==0){return false;}var _16=this.terms[0].matchesTiddler(_14);for(var i=1;i&lt;this.terms.length;i++){if(this.terms[i-1].orFollows){if(!_16){_16|=this.terms[i].matchesTiddler(_14);}}else{if(_16){_16&amp;=this.terms[i].matchesTiddler(_14);}}}return _16;};me.getOnlyMatchTitleQuery=function(){if(!this.onlyMatchTitleQuery){this.onlyMatchTitleQuery=new STQ(this.queryText,this.caseSensitive,true,this.useRegExp);}return this.onlyMatchTitleQuery;};me.getMarkRegExp=function(){if(this.regExp){return &quot;&quot;.search(this.regExp)&gt;=0?null:this.regExp;}var _18={};var n=this.terms.length;for(var i=0;i&lt;this.terms.length;i++){var _1b=this.terms[i];if(!_1b.negate){_18[_1b.text]=true;}}var _1c=[];for(var t in _18){_1c.push(&quot;(&quot;+t.escapeRegExp()+&quot;)&quot;);}if(_1c.length==0){return null;}var _1e=_1c.join(&quot;|&quot;);return new RegExp(_1e,this.caseSensitive?&quot;mg&quot;:&quot;img&quot;);};me.toString=function(){if(this.regExp){return this.regExp.toString();}var _1f=&quot;&quot;;for(var i=0;i&lt;this.terms.length;i++){_1f+=this.terms[i].toString();}return _1f;};STQ.Term=function(_21,_22,_23,_24,_25,_26,_27,_28){this.text=_21;this.inTitle=_22;this.inText=_23;this.inTag=_24;this.negate=_25;this.orFollows=_26;this.caseSensitive=_27;this.wordMatch=_28;var _29=_21.escapeRegExp();if(this.wordMatch){_29=&quot;\s\sb&quot;+_29+&quot;\s\sb&quot;;}this.regExp=new RegExp(_29,&quot;m&quot;+(_27?&quot;&quot;:&quot;i&quot;));};STQ.Term.prototype.toString=function(){return (this.negate?&quot;-&quot;:&quot;&quot;)+(this.inTitle?&quot;!&quot;:&quot;&quot;)+(this.inText?&quot;%&quot;:&quot;&quot;)+(this.inTag?&quot;#&quot;:&quot;&quot;)+(this.wordMatch?&quot;=&quot;:&quot;&quot;)+&quot;\s&quot;&quot;+this.text+&quot;\s&quot;&quot;+(this.orFollows?&quot; OR &quot;:&quot; AND &quot;);};STQ.Term.prototype.matchesTiddler=function(_2a){if(!_2a){return false;}if(this.inTitle&amp;&amp;this.regExp.test(_2a.title)){return !this.negate;}if(this.inText&amp;&amp;this.regExp.test(_2a.text)){return !this.negate;}if(this.inTag){var _2b=_2a.tags;if(_2b){for(var i=0;i&lt;_2b.length;i++){if(this.regExp.test(_2b[i])){return !this.negate;}}}}return this.negate;};var stringToInt=function(s,_2e){if(!s){return _2e;}var n=parseInt(s);return (n==NaN)?_2e:n;};var getIntAttribute=function(_30,_31,_32){return stringToInt(_30.getAttribute(_31));};var isDescendantOrSelf=function(_33,e){while(e!=null){if(_33==e){return true;}e=e.parentNode;}return false;};var getMatchCount=function(s,re){var m=s.match(re);return m?m.length:0;};var createEllipsis=function(_38){var e=createTiddlyElement(_38,&quot;span&quot;);e.innerHTML=&quot;&amp;hellip;&quot;;};var isWordChar=function(c){return (c&gt;=&quot;a&quot;&amp;&amp;c&lt;=&quot;z&quot;)||(c&gt;=&quot;A&quot;&amp;&amp;c&lt;=&quot;Z&quot;)||c==&quot;_&quot;;};var getWordBounds=function(s,_3c){if(!isWordChar(s[_3c])){return null;}for(var i=_3c-1;i&gt;=0&amp;&amp;isWordChar(s[i]);i--){}var _3e=i+1;var n=s.length;for(i=_3c+1;i&lt;n&amp;&amp;isWordChar(s[i]);i++){}return {start:_3e,end:i};};var removeTextDecoration=function(s){var _41=[&quot;''&quot;,&quot;{{{&quot;,&quot;}}}&quot;,&quot;//&quot;,&quot;&lt;&lt;&lt;&quot;,&quot;/***&quot;,&quot;***/&quot;];var _42=&quot;&quot;;for(var i=0;i&lt;_41.length;i++){if(i!=0){_42+=&quot;|&quot;;}_42+=&quot;(&quot;+_41[i].escapeRegExp()+&quot;)&quot;;}return s.replace(new RegExp(_42,&quot;mg&quot;),&quot;&quot;).trim();};var logText=&quot;&quot;;var lastLogTime=null;var logMessage=function(_44,s){var now=new Date();var _47=lastLogTime?(now-lastLogTime).toString():&quot;&quot;;logText+=&quot;&lt;tr&gt;&lt;td&gt;&quot;+now.convertToYYYYMMDDHHMMSSMMM()+&quot;&lt;/td&gt;&lt;td align='right'&gt;&quot;+_47+&quot;&lt;/td&gt;&lt;td&gt;&quot;+_44+&quot;&lt;/td&gt;&lt;td&gt;&quot;+s.htmlEncode()+&quot;&lt;/td&gt;&lt;/tr&gt;\sn&quot;;lastLogTime=now;};function writeLog(){var t=&quot; &lt;&lt;JsDoIt 'WriteLog' 'WriteLog' 'javascript:writeLog();story.closeTiddler(\s&quot;Log\s&quot;);story.displayTiddler(null,\s&quot;Log\s&quot;);'&gt;&gt;&quot;+&quot;&lt;html&gt;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th&gt;Time&lt;/th&gt;&lt;th&gt;Delta (ms)&lt;/th&gt;&lt;th&gt;Kind&lt;/th&gt;&lt;th&gt;Message&lt;/th&gt;&lt;/tr&gt;\sn&quot;+logText+&quot;&lt;/tbody&gt;&lt;/table&gt;&lt;/html&gt;&quot;;store.saveTiddler(&quot;Log&quot;,&quot;Log&quot;,t,config.options.txtUserName,new Date(),[&quot;System&quot;,&quot;Log&quot;]);logText=&quot;&quot;;lastLogTime=null;}var yourSearchResultID=&quot;yourSearchResult&quot;;var yourSearchResultItemsID=&quot;yourSearchResultItems&quot;;var maxCharsInTitle=80;var maxCharsInTags=50;var maxCharsInText=250;var maxPagesInNaviBar=10;var itemsPerPageDefault=25;var itemsPerPageWithPreviewDefault=10;var minMatchWithContextSize=40;var maxMovementForWordCorrection=4;var matchInTitleWeight=4;var precisionInTitleWeight=10;var matchInTagsWeight=2;var resultElement;var lastResults;var lastQuery;var lastSearchText;var searchInputField;var searchButton;var firstIndexOnPage=0;var currentTiddler;var indexInPage;var indexInResult;var getItemsPerPage=function(){var n=(config.options.chkPreviewText)?stringToInt(config.options.txtItemsPerPageWithPreview,itemsPerPageWithPreviewDefault):stringToInt(config.options.txtItemsPerPage,itemsPerPageDefault);return (n&gt;0)?n:1;};var standardRankFunction=function(_4a,_4b){var _4c=_4b.getMarkRegExp();if(!_4c){return 1;}var _4d=_4a.title.match(_4c);var _4e=_4d?_4d.length:0;var _4f=getMatchCount(_4a.getTags(),_4c);var _50=_4d?_4d.join(&quot;&quot;).length:0;var _51=_4a.title.length&gt;0?_50/_4a.title.length:0;var _52=_4e*matchInTitleWeight+_4f*matchInTagsWeight+_51*precisionInTitleWeight+1;return _52;};var findMatches=function(_53,_54,_55,_56,_57,_58){lastSearchText=_54;var _59=_53.reverseLookup(&quot;tags&quot;,_58,false);var _5a=new STQ(_54,_55,false,_56);lastQuery=_5a;var _5b=_5a.getMatchingTiddlers(_59);var _5c=abego.YourSearch.getRankFunction();for(var i=0;i&lt;_5b.length;i++){var _5e=_5b[i];var _5f=_5c(_5e,_5a);_5e.searchRank=_5f;}if(!_57){_57=&quot;title&quot;;}var _60=function(a,b){var _63=a.searchRank-b.searchRank;if(_63==0){if(a[_57]==b[_57]){return (0);}else{return (a[_57]&lt;b[_57])?-1:+1;}}else{return (_63&gt;0)?-1:+1;}};_5b.sort(_60);lastResults=_5b;return _5b;};var moveToWordBorder=function(s,_65,_66){var _67;if(_66){_67=getWordBounds(s,_65);}else{if(_65&lt;=0){return _65;}_67=getWordBounds(s,_65-1);}if(!_67){return _65;}if(_66){if(_67.start&gt;=_65-maxMovementForWordCorrection){return _67.start;}if(_67.end&lt;=_65+maxMovementForWordCorrection){return _67.end;}}else{if(_67.end&lt;=_65+maxMovementForWordCorrection){return _67.end;}if(_67.start&gt;=_65-maxMovementForWordCorrection){return _67.start;}}return _65;};var getContextRangeAround=function(s,_69,_6a,_6b,_6c){var _6d=Math.max(Math.floor(_6c/(_6b+1)),minMatchWithContextSize);var _6e=Math.max(_6d-(_6a-_69),0);var _6f=Math.min(Math.floor(_6a+_6e/3),s.length);var _70=Math.max(_6f-_6d,0);_70=moveToWordBorder(s,_70,true);_6f=moveToWordBorder(s,_6f,false);return {start:_70,end:_6f};};var getTextAndMatchArray=function(s,_72){var _73=[];if(_72){var _74=0;var n=s.length;var _76=0;do{_72.lastIndex=_74;var _77=_72.exec(s);if(_77){if(_74&lt;_77.index){var t=s.substring(_74,_77.index);_73.push({text:t});}_73.push({text:_77[0],isMatch:true});_74=_77.index+_77[0].length;}else{_73.push({text:s.substr(_74)});break;}}while(true);}else{_73.push({text:s});}return _73;};var simpleCreateLimitedTextWithMarks=function(_79,s,_7b){if(!lastQuery){return;}var _7c=getTextAndMatchArray(s,lastQuery.getMarkRegExp());var _7d=0;for(var i=0;i&lt;_7c.length&amp;&amp;_7d&lt;_7b;i++){var t=_7c[i];var _80=t.text;if(t.isMatch){createTiddlyElement(_79,&quot;span&quot;,null,&quot;marked&quot;,_80);}else{var _81=_7b-_7d;if(_81&lt;_80.length){_80=_80.substring(0,_81)+&quot;...&quot;;}createTiddlyText(_79,_80);}_7d+=_80.length;}};var addRange=function(_82,_83,_84){var n=_82.length;if(n==0){_82.push({start:_83,end:_84});return;}var i=0;for(;i&lt;n;i++){var _87=_82[i];if(_87.start&lt;=_84&amp;&amp;_83&lt;=_87.end){var r;var _89=i+1;for(;_89&lt;n;_89++){r=_82[_89];if(r.start&gt;_84||_83&gt;_87.end){break;}}var _8a=_83;var _8b=_84;for(var j=i;j&lt;_89;j++){r=_82[j];_8a=Math.min(_8a,r.start);_8b=Math.max(_8b,r.end);}_82.splice(i,_89-i,{start:_8a,end:_8b});return;}if(_87.start&gt;_84){break;}}_82.splice(i,0,{start:_83,end:_84});};var getTotalRangesSize=function(_8d){var _8e=0;for(var i=0;i&lt;_8d.length;i++){var _90=_8d[i];_8e+=_90.end-_90.start;}return _8e;};var writeTextAndMatchRange=function(_91,s,_93,_94,_95){var t;var _97;var pos=0;var i=0;var _9a=0;for(;i&lt;_93.length;i++){t=_93[i];_97=t.text;if(_94&lt;pos+_97.length){_9a=_94-pos;break;}pos+=_97.length;}var _9b=_95-_94;for(;i&lt;_93.length&amp;&amp;_9b&gt;0;i++){t=_93[i];_97=t.text.substr(_9a);_9a=0;if(_97.length&gt;_9b){_97=_97.substr(0,_9b);}if(t.isMatch){createTiddlyElement(_91,&quot;span&quot;,null,&quot;marked&quot;,_97);}else{createTiddlyText(_91,_97);}_9b-=_97.length;}if(_95&lt;s.length){createEllipsis(_91);}};var getMatchedTextCount=function(_9c){var _9d=0;for(var i=0;i&lt;_9c.length;i++){if(_9c[i].isMatch){_9d++;}}return _9d;};var getMatchedTextWithContextRanges=function(_9f,s,_a1){var _a2=[];var _a3=getMatchedTextCount(_9f);var pos=0;for(var i=0;i&lt;_9f.length;i++){var t=_9f[i];var _a7=t.text;if(t.isMatch){var _a8=getContextRangeAround(s,pos,pos+_a7.length,_a3,_a1);addRange(_a2,_a8.start,_a8.end);}pos+=_a7.length;}return _a2;};var fillUpRanges=function(s,_aa,_ab){var _ac=_ab-getTotalRangesSize(_aa);while(_ac&gt;0){if(_aa.length==0){addRange(_aa,0,moveToWordBorder(s,_ab,false));return;}else{var _ad=_aa[0];var _ae;var _af;if(_ad.start==0){_ae=_ad.end;if(_aa.length&gt;1){_af=_aa[1].start;}else{addRange(_aa,_ae,moveToWordBorder(s,_ae+_ac,false));return;}}else{_ae=0;_af=_ad.start;}var _b0=Math.min(_af,_ae+_ac);addRange(_aa,_ae,_b0);_ac-=(_b0-_ae);}}};var writeRanges=function(_b1,s,_b3,_b4,_b5){if(_b4.length==0){return;}if(_b4[0].start&gt;0){createEllipsis(_b1);}var _b6=_b5;for(var i=0;i&lt;_b4.length&amp;&amp;_b6&gt;0;i++){var _b8=_b4[i];var len=Math.min(_b8.end-_b8.start,_b6);writeTextAndMatchRange(_b1,s,_b3,_b8.start,_b8.start+len);_b6-=len;}};var createLimitedTextWithMarksAndContext=function(_ba,s,_bc){if(!lastQuery){return;}if(s.length&lt;_bc){_bc=s.length;}var _bd=getTextAndMatchArray(s,lastQuery.getMarkRegExp());var _be=getMatchedTextWithContextRanges(_bd,s,_bc);fillUpRanges(s,_be,_bc);writeRanges(_ba,s,_bd,_be,_bc);};var createLimitedTextWithMarks=function(_bf,s,_c1){return createLimitedTextWithMarksAndContext(_bf,s,_c1);};var myStorySearch=function(_c2,_c3,_c4){highlightHack=new RegExp(_c4?_c2:_c2.escapeRegExp(),_c3?&quot;mg&quot;:&quot;img&quot;);var _c5=findMatches(store,_c2,_c3,_c4,&quot;title&quot;,&quot;excludeSearch&quot;);firstIndexOnPage=0;showResult();highlightHack=null;};var myMacroSearchHandler=function(_c6,_c7,_c8){var _c9=&quot;&quot;;var _ca=null;var _cb=function(txt){if(config.options.chkUseYourSearch){myStorySearch(txt.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch);}else{story.search(txt.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch);}_c9=txt.value;};var _cd=function(e){_cb(searchInputField);return false;};var _cf=function(e){if(!e){var e=window.event;}switch(e.keyCode){case 13:_cb(this);break;case 27:if(isResultOpen()){closeResult();}else{this.value=&quot;&quot;;clearMessage();}break;}if(String.fromCharCode(e.keyCode)==this.accessKey||e.altKey){reopenResultIfApplicable();}if(this.value.length&lt;3&amp;&amp;_ca){clearTimeout(_ca);}if((this.value.length&gt;2)&amp;&amp;(this.value!=_c9)){if(!config.options.chkUseYourSearch||config.options.chkSearchAsYouType){if(_ca){clearTimeout(_ca);}var txt=this;_ca=setTimeout(function(){_cb(txt);},500);}}if(this.value.length==0){closeResult();}};var _d3=function(e){this.select();reopenResultIfApplicable();};var btn=createTiddlyButton(_c6,this.label,this.prompt,_cd);var txt=createTiddlyElement(_c6,&quot;input&quot;,null,null,null);if(_c8[0]){txt.value=_c8[0];}txt.onkeyup=_cf;txt.onfocus=_d3;txt.setAttribute(&quot;size&quot;,this.sizeTextbox);txt.setAttribute(&quot;accessKey&quot;,this.accessKey);txt.setAttribute(&quot;autocomplete&quot;,&quot;off&quot;);if(config.browser.isSafari){txt.setAttribute(&quot;type&quot;,&quot;search&quot;);txt.setAttribute(&quot;results&quot;,&quot;5&quot;);}else{txt.setAttribute(&quot;type&quot;,&quot;text&quot;);}searchInputField=txt;searchButton=btn;};var isResultOpen=function(){return resultElement!=null&amp;&amp;resultElement.parentNode==document.body;};var closeResult=function(){if(isResultOpen()){document.body.removeChild(resultElement);}};var openAllFoundTiddlers=function(){closeResult();if(lastResults){var _d7=[];for(var i=0;i&lt;lastResults.length;i++){_d7.push(lastResults[i].title);}story.displayTiddlers(null,_d7);}};var refreshResult=function(){if(!resultElement||!searchInputField){return;}var _d9=store.getTiddlerText(&quot;YourSearchResultTemplate&quot;);if(!_d9){_d9=&quot;&lt;b&gt;Tiddler YourSearchResultTemplate not found&lt;/b&gt;&quot;;}resultElement.innerHTML=_d9;firstIndexOnPage=Math.floor(firstIndexOnPage/getItemsPerPage())*getItemsPerPage();applyHtmlMacros(resultElement,null);refreshElements(resultElement,null);if(lastResults&amp;&amp;lastResults.length&gt;0){var _da=store.getTiddlerText(&quot;YourSearchItemTemplate&quot;);if(!_da){alertAndThrow(&quot;YourSearchItemTemplate not found&quot;);}var _db=document.getElementById(yourSearchResultItemsID);if(!_db){_db=createTiddlyElement(resultElement,&quot;div&quot;,yourSearchResultItemsID);}var _dc=Math.min(firstIndexOnPage+getItemsPerPage(),lastResults.length);indexInPage=-1;for(var i=firstIndexOnPage;i&lt;_dc;i++){currentTiddler=lastResults[i];indexInPage++;indexInResult=i;var _de=createTiddlyElement(_db,&quot;div&quot;,null,&quot;yourSearchItem&quot;);_de.innerHTML=_da;applyHtmlMacros(_de,null);refreshElements(_de,null);}}currentTiddler=null;ensureResultIsDisplayedNicely();};var ensureResultIsDisplayedNicely=function(){adjustResultPositionAndSize();scrollVisible();};var scrollVisible=function(){if(resultElement){window.scrollTo(0,ensureVisible(resultElement));}if(searchInputField){window.scrollTo(0,ensureVisible(searchInputField));}};var adjustResultPositionAndSize=function(){if(!searchInputField){return;}var _df=searchInputField;var _e0=findPosX(_df);var _e1=findPosY(_df);var _e2=_df.offsetHeight;var _e3=_e0;var _e4=_e1+_e2;var _e5=findWindowWidth();if(_e5&lt;resultElement.offsetWidth){resultElement.style.width=(_e5-100)+&quot;px&quot;;_e5=findWindowWidth();}var _e6=resultElement.offsetWidth;if(_e3+_e6&gt;_e5){_e3=_e5-_e6-30;}if(_e3&lt;0){_e3=0;}resultElement.style.left=_e3+&quot;px&quot;;resultElement.style.top=_e4+&quot;px&quot;;resultElement.style.display=&quot;block&quot;;};var showResult=function(){if(!resultElement){resultElement=createTiddlyElement(document.body,&quot;div&quot;,yourSearchResultID,&quot;yourSearchResult&quot;);}else{if(resultElement.parentNode!=document.body){document.body.appendChild(resultElement);}}refreshResult();};var reopenResultIfApplicable=function(){if(searchInputField==null||!config.options.chkUseYourSearch){return;}if((searchInputField.value==lastSearchText)&amp;&amp;lastSearchText&amp;&amp;!isResultOpen()){if(resultElement&amp;&amp;(resultElement.parentNode!=document.body)){document.body.appendChild(resultElement);ensureResultIsDisplayedNicely();}else{showResult();}}};var setFirstIndexOnPage=function(_e7){if(!lastResults||lastResults.length==0){return;}firstIndexOnPage=Math.min(Math.max(0,_e7),lastResults.length-1);refreshResult();};var onDocumentClick=function(e){if(e.target==searchInputField){return;}if(e.target==searchButton){return;}if(resultElement&amp;&amp;isDescendantOrSelf(resultElement,e.target)){return;}closeResult();};var onDocumentKeyup=function(e){if(e.keyCode==27){closeResult();}};addEvent(document,&quot;click&quot;,onDocumentClick);addEvent(document,&quot;keyup&quot;,onDocumentKeyup);config.macros.yourSearch={label:&quot;yourSearch&quot;,prompt:&quot;Gives access to the current/last YourSearch result&quot;,funcs:{},tests:{&quot;true&quot;:function(){return true;},&quot;false&quot;:function(){return false;},&quot;found&quot;:function(){return lastResults&amp;&amp;lastResults.length&gt;0;},&quot;previewText&quot;:function(){return config.options.chkPreviewText;}}};config.macros.yourSearch.handler=function(_ea,_eb,_ec,_ed,_ee,_ef){if(_ec.length==0){return;}var _f0=_ec[0];var _f1=config.macros.yourSearch.funcs[_f0];if(_f1){_f1(_ea,_eb,_ec,_ed,_ee,_ef);}};config.macros.yourSearch.funcs.itemRange=function(_f2){if(lastResults){var _f3=Math.min(firstIndexOnPage+getItemsPerPage(),lastResults.length);var s=&quot;%0 - %1&quot;.format([firstIndexOnPage+1,_f3]);createTiddlyText(_f2,s);}};config.macros.yourSearch.funcs.count=function(_f5){if(lastSearchText){createTiddlyText(_f5,lastResults.length.toString());}};config.macros.yourSearch.funcs.query=function(_f6){if(lastResults){createTiddlyText(_f6,lastSearchText);}};config.macros.yourSearch.funcs.version=function(_f7){var t=&quot;YourSearch %0.%1.%2&quot;.format([version.extensions.YourSearchPlugin.major,version.extensions.YourSearchPlugin.minor,version.extensions.YourSearchPlugin.revision]);var e=createTiddlyElement(_f7,&quot;a&quot;);e.setAttribute(&quot;href&quot;,&quot;http://tiddlywiki.abego-software.de/#YourSearchPlugin&quot;);e.innerHTML=&quot;&lt;font color=\s&quot;black\s&quot; face=\s&quot;Arial, Helvetica, sans-serif\s&quot;&gt;&quot;+t+&quot;&lt;font&gt;&quot;;};config.macros.yourSearch.funcs.copyright=function(_fa){var e=createTiddlyElement(_fa,&quot;a&quot;);e.setAttribute(&quot;href&quot;,&quot;http://tiddlywiki.abego-software.de&quot;);e.innerHTML=&quot;&lt;font color=\s&quot;black\s&quot; face=\s&quot;Arial, Helvetica, sans-serif\s&quot;&gt;&amp;copy; 2005-2006 &lt;b&gt;&lt;font color=\s&quot;red\s&quot;&gt;abego&lt;/font&gt;&lt;/b&gt; Software&lt;font&gt;&quot;;};config.macros.yourSearch.funcs.linkButton=function(_fc,_fd,_fe,_ff,_100,_101){if(_fe&lt;2){return;}var _102=_fe[1];var text=_fe&lt;3?_102:_fe[2];var _104=_fe&lt;4?text:_fe[3];var _105=_fe&lt;5?null:_fe[4];var btn=createTiddlyButton(_fc,text,_104,closeResultAndDisplayTiddler,null,null,_105);btn.setAttribute(&quot;tiddlyLink&quot;,_102);};config.macros.yourSearch.funcs.closeButton=function(_107,_108,_109,_10a,_10b,_10c){var _10d=createTiddlyButton(_107,&quot;close&quot;,&quot;Close the Search Results (Shortcut: ESC)&quot;,closeResult);};config.macros.yourSearch.funcs.openAllButton=function(_10e,_10f,_110,_111,_112,_113){if(!lastResults){return;}var n=lastResults.length;if(n==0){return;}var _115=n==1?&quot;open tiddler&quot;:&quot;open all %0 tiddlers&quot;.format([n]);var _116=createTiddlyButton(_10e,_115,&quot;Open all found tiddlers (Shortcut: Alt-O)&quot;,openAllFoundTiddlers);_116.setAttribute(&quot;accessKey&quot;,&quot;O&quot;);};var onNaviButtonClick=function(e){if(!e){var e=window.event;}var _119=getIntAttribute(this,&quot;page&quot;);setFirstIndexOnPage(_119*getItemsPerPage(),0);};config.macros.yourSearch.funcs.naviBar=function(_11a,_11b,_11c,_11d,_11e,_11f){if(!lastResults||lastResults.length==0){return;}var _120;var _121=Math.floor(firstIndexOnPage/getItemsPerPage());var _122=Math.floor((lastResults.length-1)/getItemsPerPage());if(_121&gt;0){_120=createTiddlyButton(_11a,&quot;Previous&quot;,&quot;Go to previous page (Shortcut: Alt-'&lt;')&quot;,onNaviButtonClick,&quot;prev&quot;);_120.setAttribute(&quot;page&quot;,(_121-1).toString());_120.setAttribute(&quot;accessKey&quot;,&quot;&lt;&quot;);}for(var i=-maxPagesInNaviBar;i&lt;maxPagesInNaviBar;i++){var _124=_121+i;if(_124&lt;0){continue;}if(_124&gt;_122){break;}var _125=(i+_121+1).toString();var _126=_124==_121?&quot;currentPage&quot;:&quot;otherPage&quot;;_120=createTiddlyButton(_11a,_125,&quot;Go to page %0&quot;.format([_125]),onNaviButtonClick,_126);_120.setAttribute(&quot;page&quot;,(_124).toString());}if(_121&lt;_122){_120=createTiddlyButton(_11a,&quot;Next&quot;,&quot;Go to next page (Shortcut: Alt-'&gt;')&quot;,onNaviButtonClick,&quot;next&quot;);_120.setAttribute(&quot;page&quot;,(_121+1).toString());_120.setAttribute(&quot;accessKey&quot;,&quot;&gt;&quot;);}};config.macros.yourSearch.funcs[&quot;if&quot;]=function(_127,_128,_129,_12a,_12b,_12c){if(_129.length&lt;2){return;}var _12d=_129[1];var _12e=(_12d==&quot;not&quot;);if(_12e){if(_129.length&lt;3){return;}_12d=_129[2];}var test=config.macros.yourSearch.tests[_12d];var _130=false;try{if(test){_130=test(_127,_128,_129,_12a,_12b,_12c)!=_12e;}else{_130=(!eval(_12d))==_12e;}}catch(ex){}if(!_130){_127.style.display=&quot;none&quot;;}};var createOptionWithRefresh=function(_131,_132,_133,_134){invokeMacro(_131,&quot;option&quot;,_132,_133,_134);var elem=_131.lastChild;var _136=elem.onclick;elem.onclick=function(e){var _138=_136.apply(this,arguments);refreshResult();return _138;};return elem;};config.macros.yourSearch.funcs.chkPreviewText=function(_139,_13a,_13b,_13c,_13d,_13e){var _13f=_13b.slice(1).join(&quot; &quot;);var elem=createOptionWithRefresh(_139,&quot;chkPreviewText&quot;,_13c,_13e);elem.setAttribute(&quot;accessKey&quot;,&quot;P&quot;);elem.title=&quot;Show text preview of found tiddlers (Shortcut: Alt-P)&quot;;return elem;};config.macros.foundTiddler={label:&quot;foundTiddler&quot;,prompt:&quot;Provides information on the tiddler currently processed on the YourSearch result page&quot;,funcs:{}};config.macros.foundTiddler.handler=function(_141,_142,_143,_144,_145,_146){if(!currentTiddler){return;}var name=_143[0];var func=config.macros.foundTiddler.funcs[name];if(func){func(_141,_142,_143,_144,_145,_146);}};var closeResultAndDisplayTiddler=function(e){closeResult();var _14a=this.getAttribute(&quot;tiddlyLink&quot;);if(_14a){var _14b=this.getAttribute(&quot;withHilite&quot;);var _14c=highlightHack;if(_14b&amp;&amp;_14b==&quot;true&quot;&amp;&amp;lastQuery){highlightHack=lastQuery.getMarkRegExp();}story.displayTiddler(this,_14a);highlightHack=_14c;}return (false);};var getShortCutNumber=function(){if(!currentTiddler){return -1;}if(indexInPage&gt;=0&amp;&amp;indexInPage&lt;=9){return indexInPage&lt;9?(indexInPage+1):0;}else{return -1;}};config.macros.foundTiddler.funcs.title=function(_14d,_14e,_14f,_150,_151,_152){if(!currentTiddler){return;}var _153=getShortCutNumber();var _154=_153&gt;=0?&quot;Open tiddler (Shortcut: Alt-%0)&quot;.format([_153.toString()]):&quot;Open tiddler&quot;;var btn=createTiddlyButton(_14d,null,_154,closeResultAndDisplayTiddler,null);btn.setAttribute(&quot;tiddlyLink&quot;,currentTiddler.title);btn.setAttribute(&quot;withHilite&quot;,&quot;true&quot;);createLimitedTextWithMarks(btn,currentTiddler.title,maxCharsInTitle);if(_153&gt;=0){btn.setAttribute(&quot;accessKey&quot;,_153.toString());}};config.macros.foundTiddler.funcs.tags=function(_156,_157,_158,_159,_15a,_15b){if(!currentTiddler){return;}createLimitedTextWithMarks(_156,currentTiddler.getTags(),maxCharsInTags);};config.macros.foundTiddler.funcs.text=function(_15c,_15d,_15e,_15f,_160,_161){if(!currentTiddler){return;}createLimitedTextWithMarks(_15c,removeTextDecoration(currentTiddler.text),maxCharsInText);};config.macros.foundTiddler.funcs.number=function(_162,_163,_164,_165,_166,_167){var _168=getShortCutNumber();if(_168&gt;=0){var text=&quot;%0)&quot;.format([_168.toString()]);createTiddlyElement(_162,&quot;span&quot;,null,&quot;shortcutNumber&quot;,text);}};function scrollToAnchor(name){return false;}if(config.options.chkUseYourSearch==undefined){config.options.chkUseYourSearch=true;}if(config.options.chkPreviewText==undefined){config.options.chkPreviewText=true;}if(config.options.chkSearchAsYouType==undefined){config.options.chkSearchAsYouType=true;}if(config.options.chkSearchInTitle==undefined){config.options.chkSearchInTitle=true;}if(config.options.chkSearchInText==undefined){config.options.chkSearchInText=true;}if(config.options.chkSearchInTags==undefined){config.options.chkSearchInTags=true;}if(config.options.txtItemsPerPage==undefined){config.options.txtItemsPerPage=itemsPerPageDefault;}if(config.options.txtItemsPerPageWithPreview==undefined){config.options.txtItemsPerPageWithPreview=itemsPerPageWithPreviewDefault;}config.shadowTiddlers.AdvancedOptions+=&quot;\sn&lt;&lt;option chkUseYourSearch&gt;&gt; Use 'Your Search' //([[more options|YourSearch Options]])//&quot;;config.shadowTiddlers[&quot;YourSearch Introduction&quot;]=&quot;!About YourSearch\sn&quot;+&quot;\sn&quot;+&quot;YourSearch gives you a bunch of new features to simplify and speed up your daily searches in TiddlyWiki. It seamlessly integrates into the standard TiddlyWiki search: just start typing into the 'search' field and explore!\sn&quot;+&quot;\sn&quot;+&quot;''May the '~Alt-F' be with you.''\sn&quot;+&quot;\sn&quot;+&quot;\sn&quot;+&quot;!Features\sn&quot;+&quot;* YourSearch searches for tiddlers that match your query ''as you type'' into the 'search' field. It presents a list of the ''\s&quot;Top Ten\s&quot;'' tiddlers in a ''popup-like window'': the ''[[YourSearch Result]]''. The tiddlers currently displayed in your TiddlyWiki are not affected.\sn&quot;+&quot;* Using ''~TiddlerRank technology'' the [[YourSearch Result]] lists the ''most interesting tiddlers first''.\sn&quot;+&quot;* Through ''Filtered Search'' and ''Boolean Search'' you can easily refining your search, like excluding words or searching for multiple words. This way less tiddlers are displayed in the [[YourSearch Result]] and you can faster scan the result for the tiddler you are looking for.\sn&quot;+&quot;* The [[YourSearch Result]] lists the found tiddlers ''page-wise'', e.g. 10 per page. Use the ''Result Page Navigation Bar'' to navigate between pages if the result does not fit on one page.\sn&quot;+&quot;* The [[YourSearch Result]] states the ''total number of found tiddlers''. This way you can quickly decide if you want to browse the result list or if you want to refine your search first to shorten the result list.\sn&quot;+&quot;* Beside the ''title of the found tiddlers'' the [[YourSearch Result]] also ''displays tags'' and ''tiddler text previews''. The ''tiddler text preview'' is an extract of the tiddler's content, showing the most interesting parts related to your query (e.g. the texts around the words you are looking for).\sn&quot;+&quot;* The words you are looking for are hilited in the titles, tags and text previews of the [[YourSearch Result]].\sn&quot;+&quot;* If you are not interested in the tiddler text previews but prefer to get longer lists of tiddlers on one result page you may ''switch of the text preview''.\sn&quot;+&quot;* If the [[YourSearch Result]] contains the tiddler you are looking for you can just ''click its title to display'' it in your TiddlyWiki. Alternatively you may also ''open all found tiddlers'' at once. \sn&quot;+&quot;* Use [[YourSearch Options]] to customize YourSearch to your needs. E.g. depending on the size of your screen you may change the number of tiddlers displayed in the [[YourSearch Result]]. In the [[YourSearch Options]] and the AdvancedOptions you may also switch off YourSearch in case you temporarily want to use the standard search.\sn&quot;+&quot;* For the most frequently actions ''access keys'' are defined so you can perform your search without using the mouse.\sn&quot;+&quot;\sn&quot;;config.shadowTiddlers[&quot;YourSearch Help&quot;]=&quot;&lt;&lt;tiddler [[YourSearch Introduction]]&gt;&gt;&quot;+&quot;\sn&quot;+&quot;!Filtered Search&lt;html&gt;&lt;a name='Filtered'/&gt;&lt;/html&gt;\sn&quot;+&quot;Using the Filtered Search you can restrict your search to certain parts of a tiddler, e.g only search the tags or only the titles.\sn&quot;+&quot;|!What you want|!What you type|!Example|\sn&quot;+&quot;|Search ''titles only''|start word with ''!''|{{{!jonny}}}|\sn&quot;+&quot;|Search ''contents only''|start word with ''%''|{{{%football}}}|\sn&quot;+&quot;|Search ''tags only''|start word with ''#''|{{{#Plugin}}}|\sn&quot;+&quot;\sn&quot;+&quot;You may use more than one filter for a word. E.g. {{{!#Plugin}}} finds tiddlers containing \s&quot;Plugin\s&quot; either in the title or in the tags (but does not look for \s&quot;Plugin\s&quot; in the content).\sn&quot;+&quot;\sn&quot;+&quot;!Boolean Search&lt;html&gt;&lt;a name='Boolean'/&gt;&lt;/html&gt;\sn&quot;+&quot;The Boolean Search is useful when searching for multiple words.\sn&quot;+&quot;|!What you want|!What you type|!Example|\sn&quot;+&quot;|''All words'' must exist|List of words|{{{jonny jeremy}}}|\sn&quot;+&quot;|''At least one word'' must exist|Separate words by ''or''|{{{jonny or jeremy}}}|\sn&quot;+&quot;|A word ''must not exist''|Start word with ''-''|{{{-jonny}}}|\sn&quot;+&quot;\sn&quot;+&quot;''Note:'' When you specify two words, separated with a space, YourSearch finds all tiddlers that contain both words, but not necessarily next to each other. If you want to find a sequence of word, e.g. '{{{John Brown}}}', you need to put the words into quotes. I.e. you type: {{{\s&quot;john brown\s&quot;}}}.\sn&quot;+&quot;\sn&quot;+&quot;!'Exact Word' Search&lt;html&gt;&lt;a name='Exact'/&gt;&lt;/html&gt;\sn&quot;+&quot;By default a search result all matches that 'contain' the searched text. \sn&quot;+&quot; E.g. if you search for 'Task' you will get all tiddlers containing 'Task', but also 'CompletedTask', 'TaskForce' etc.\sn&quot;+&quot;\sn&quot;+&quot;If you only want to get the tiddlers that contain 'exactly the word' you need to prefix it with a '='. E.g. typing '=Task' will the tiddlers that contain the word 'Task', ignoring words that just contain 'Task' as a substring.\sn&quot;+&quot;\sn&quot;+&quot;!Combined Search&lt;html&gt;&lt;a name='Combined'/&gt;&lt;/html&gt;\sn&quot;+&quot;You are free to combine the various search options. \sn&quot;+&quot;\sn&quot;+&quot;''Examples''\sn&quot;+&quot;|!What you type|!Result|\sn&quot;+&quot;|{{{!jonny !jeremy -%football}}}| all tiddlers with both {{{jonny}}} and {{{jeremy}}} in its titles, but no {{{football}}} in content.|\sn&quot;+&quot;|{{{#=Task}}}|All tiddlers tagged with 'Task' (the exact word). Tags named 'CompletedTask', 'TaskForce' etc. are not considered.|\sn&quot;+&quot;\sn&quot;+&quot;!~CaseSensitiveSearch and ~RegExpSearch&lt;html&gt;&lt;a name='Case'/&gt;&lt;/html&gt;\sn&quot;+&quot;The standard search options ~CaseSensitiveSearch and ~RegExpSearch are fully supported by YourSearch. However when ''~RegExpSearch'' is on Filtered and Boolean Search are disabled.\sn&quot;+&quot;\sn&quot;+&quot;!Access Keys&lt;html&gt;&lt;a name='Access'/&gt;&lt;/html&gt;\sn&quot;+&quot;You are encouraged to use the access keys (also called \s&quot;shortcut\s&quot; keys) for the most frequently used operations. For quick reference these shortcuts are also mentioned in the tooltip for the various buttons etc.\sn&quot;+&quot;\sn&quot;+&quot;|!Key|!Operation|\sn&quot;+&quot;|{{{Alt-F}}}|''The most important keystroke'': It moves the cursor to the search input field so you can directly start typing your query. Pressing {{{Alt-F}}} will also display the previous search result. This way you can quickly display multiple tiddlers using \s&quot;Press {{{Alt-F}}}. Select tiddler.\s&quot; sequences.|\sn&quot;+&quot;|{{{ESC}}}|Closes the [[YourSearch Result]]. When the [[YourSearch Result]] is already closed and the cursor is in the search input field the field's content is cleared so you start a new query.|\sn&quot;+&quot;|{{{Alt-1}}}, {{{Alt-2}}},... |Pressing these keys opens the first, second etc. tiddler from the result list.|\sn&quot;+&quot;|{{{Alt-O}}}|Opens all found tiddlers.|\sn&quot;+&quot;|{{{Alt-P}}}|Toggles the 'Preview Text' mode.|\sn&quot;+&quot;|{{{Alt-'&lt;'}}}, {{{Alt-'&gt;'}}}|Displays the previous or next page in the [[YourSearch Result]].|\sn&quot;+&quot;|{{{Return}}}|When you have turned off the 'as you type' search mode pressing the {{{Return}}} key actually starts the search (as does pressing the 'search' button).|\sn&quot;+&quot;\sn&quot;;config.shadowTiddlers[&quot;YourSearch Options&quot;]=&quot;|&gt;|!YourSearch Options|\sn&quot;+&quot;|&gt;|&lt;&lt;option chkUseYourSearch&gt;&gt; Use 'Your Search'|\sn&quot;+&quot;|!|&lt;&lt;option chkPreviewText&gt;&gt; Show Text Preview|\sn&quot;+&quot;|!|&lt;&lt;option chkSearchAsYouType&gt;&gt; 'Search As You Type' Mode (No RETURN required to start search)|\sn&quot;+&quot;|!|Default Search Filter:&lt;&lt;option chkSearchInTitle&gt;&gt;Titles ('!') &lt;&lt;option chkSearchInText&gt;&gt;Texts ('%') &lt;&lt;option chkSearchInTags&gt;&gt;Tags ('#') &lt;html&gt;&lt;br&gt;&lt;font size=\s&quot;-2\s&quot;&gt;The parts of a tiddlers that are searched when you don't explicitly specify a filter in the search text (using a '!', '%' or '#' prefix).&lt;/font&gt;&lt;/html&gt;|\sn&quot;+&quot;|!|Number of items on search result page: &lt;&lt;option txtItemsPerPage&gt;&gt;|\sn&quot;+&quot;|!|Number of items on search result page with preview text: &lt;&lt;option txtItemsPerPageWithPreview&gt;&gt;|\sn&quot;;config.shadowTiddlers[&quot;YourSearchStyleSheet&quot;]=&quot;/***\sn&quot;+&quot;!~YourSearchResult Stylesheet\sn&quot;+&quot;***/\sn&quot;+&quot;/*{{{*/\sn&quot;+&quot;.yourSearchResult {\sn&quot;+&quot;\stposition: absolute;\sn&quot;+&quot;\stwidth: 800px;\sn&quot;+&quot;\sn&quot;+&quot;\stpadding: 0.2em;\sn&quot;+&quot;\stlist-style: none;\sn&quot;+&quot;\stmargin: 0;\sn&quot;+&quot;\sn&quot;+&quot;\stbackground: White;\sn&quot;+&quot;\stborder: 1px solid DarkGray;\sn&quot;+&quot;}\sn&quot;+&quot;\sn&quot;+&quot;/*}}}*/\sn&quot;+&quot;/***\sn&quot;+&quot;!!Summary Section\sn&quot;+&quot;***/\sn&quot;+&quot;/*{{{*/\sn&quot;+&quot;.yourSearchResult .summary {\sn&quot;+&quot;\stborder-bottom-width: thin;\sn&quot;+&quot;\stborder-bottom-style: solid;\sn&quot;+&quot;\stborder-bottom-color: #999999;\sn&quot;+&quot;\stpadding-bottom: 4px;\sn&quot;+&quot;}\sn&quot;+&quot;\sn&quot;+&quot;.yourSearchRange, .yourSearchCount, .yourSearchQuery {\sn&quot;+&quot;\stfont-weight: bold;\sn&quot;+&quot;}\sn&quot;+&quot;\sn&quot;+&quot;.yourSearchResult .summary .button {\sn&quot;+&quot;\stfont-size: 10px;\sn&quot;+&quot;\sn&quot;+&quot;\stpadding-left: 0.3em;\sn&quot;+&quot;\stpadding-right: 0.3em;\sn&quot;+&quot;}\sn&quot;+&quot;\sn&quot;+&quot;.yourSearchResult .summary .chkBoxLabel {\sn&quot;+&quot;\stfont-size: 10px;\sn&quot;+&quot;\sn&quot;+&quot;\stpadding-right: 0.3em;\sn&quot;+&quot;}\sn&quot;+&quot;\sn&quot;+&quot;/*}}}*/\sn&quot;+&quot;/***\sn&quot;+&quot;!!Items Area\sn&quot;+&quot;***/\sn&quot;+&quot;/*{{{*/\sn&quot;+&quot;.yourSearchResult .marked {\sn&quot;+&quot;\stbackground: none;\sn&quot;+&quot;\stfont-weight: bold;\sn&quot;+&quot;}\sn&quot;+&quot;\sn&quot;+&quot;.yourSearchItem {\sn&quot;+&quot;\stmargin-top: 2px;\sn&quot;+&quot;}\sn&quot;+&quot;\sn&quot;+&quot;.yourSearchNumber {\sn&quot;+&quot;\stcolor: #808080;\sn&quot;+&quot;}\sn&quot;+&quot;\sn&quot;+&quot;\sn&quot;+&quot;.yourSearchTags {\sn&quot;+&quot;\stcolor: #008000;\sn&quot;+&quot;}\sn&quot;+&quot;\sn&quot;+&quot;.yourSearchText {\sn&quot;+&quot;\stcolor: #808080;\sn&quot;+&quot;\stmargin-bottom: 6px;\sn&quot;+&quot;}\sn&quot;+&quot;\sn&quot;+&quot;/*}}}*/\sn&quot;+&quot;/***\sn&quot;+&quot;!!Footer\sn&quot;+&quot;***/\sn&quot;+&quot;/*{{{*/\sn&quot;+&quot;.yourSearchFooter {\sn&quot;+&quot;\stmargin-top: 8px;\sn&quot;+&quot;\stborder-top-width: thin;\sn&quot;+&quot;\stborder-top-style: solid;\sn&quot;+&quot;\stborder-top-color: #999999;\sn&quot;+&quot;}\sn&quot;+&quot;\sn&quot;+&quot;.yourSearchFooter a:hover{\sn&quot;+&quot;\stbackground: none;\sn&quot;+&quot;\stcolor: none;\sn&quot;+&quot;}\sn&quot;+&quot;/*}}}*/\sn&quot;+&quot;/***\sn&quot;+&quot;!!Navigation Bar\sn&quot;+&quot;***/\sn&quot;+&quot;/*{{{*/\sn&quot;+&quot;.yourSearchNaviBar a {\sn&quot;+&quot;\stfont-size: 16px;\sn&quot;+&quot;\stmargin-left: 4px;\sn&quot;+&quot;\stmargin-right: 4px;\sn&quot;+&quot;\stcolor: black;\sn&quot;+&quot;\sttext-decoration: underline;\sn&quot;+&quot;}\sn&quot;+&quot;\sn&quot;+&quot;.yourSearchNaviBar a:hover {\sn&quot;+&quot;\stbackground-color: none;\sn&quot;+&quot;}\sn&quot;+&quot;\sn&quot;+&quot;.yourSearchNaviBar .prev {\sn&quot;+&quot;\stfont-weight: bold;\sn&quot;+&quot;\stcolor: blue;\sn&quot;+&quot;}\sn&quot;+&quot;\sn&quot;+&quot;.yourSearchNaviBar .currentPage {\sn&quot;+&quot;\stcolor: #FF0000;\sn&quot;+&quot;\stfont-weight: bold;\sn&quot;+&quot;\sttext-decoration: none;\sn&quot;+&quot;}\sn&quot;+&quot;\sn&quot;+&quot;.yourSearchNaviBar .next {\sn&quot;+&quot;\stfont-weight: bold;\sn&quot;+&quot;\stcolor: blue;\sn&quot;+&quot;}\sn&quot;+&quot;/*}}}*/\sn&quot;;config.shadowTiddlers[&quot;YourSearchResultTemplate&quot;]=&quot;&lt;!--\sn&quot;+&quot;{{{\sn&quot;+&quot;--&gt;\sn&quot;+&quot;&lt;span macro=\s&quot;yourSearch if found\s&quot;&gt;\sn&quot;+&quot;&lt;!-- The Summary Header ============================================ --&gt;\sn&quot;+&quot;&lt;table class=\s&quot;summary\s&quot; border=\s&quot;0\s&quot; width=\s&quot;100%\s&quot; cellspacing=\s&quot;0\s&quot; cellpadding=\s&quot;0\s&quot;&gt;&lt;tbody&gt;\sn&quot;+&quot; &lt;tr&gt;\sn&quot;+&quot;\st&lt;td align=\s&quot;left\s&quot;&gt;\sn&quot;+&quot;\st\stYourSearch Result &lt;span class=\s&quot;yourSearchRange\s&quot; macro=\s&quot;yourSearch itemRange\s&quot;&gt;&lt;/span&gt;\sn&quot;+&quot;\st\st&amp;nbsp;of&amp;nbsp;&lt;span class=\s&quot;yourSearchCount\s&quot; macro=\s&quot;yourSearch count\s&quot;&gt;&lt;/span&gt;\sn&quot;+&quot;\st\stfor&amp;nbsp;&lt;span class=\s&quot;yourSearchQuery\s&quot; macro=\s&quot;yourSearch query\s&quot;&gt;&lt;/span&gt;\sn&quot;+&quot;\st&lt;/td&gt;\sn&quot;+&quot;\st&lt;td class=\s&quot;yourSearchButtons\s&quot; align=\s&quot;right\s&quot;&gt;\sn&quot;+&quot;\st\st&lt;span macro=\s&quot;yourSearch chkPreviewText\s&quot;&gt;&lt;/span&gt;&lt;span class=\s&quot;chkBoxLabel\s&quot;&gt;preview text&lt;/span&gt;\sn&quot;+&quot;\st\st&lt;span macro=\s&quot;yourSearch openAllButton\s&quot;&gt;&lt;/span&gt;\sn&quot;+&quot;\st\st&lt;span macro=\s&quot;yourSearch linkButton 'YourSearch Options' options 'Configure YourSearch'\s&quot;&gt;&lt;/span&gt;\sn&quot;+&quot;\st\st&lt;span macro=\s&quot;yourSearch linkButton 'YourSearch Help' help 'Get help how to use YourSearch'\s&quot;&gt;&lt;/span&gt;\sn&quot;+&quot;\st\st&lt;span macro=\s&quot;yourSearch closeButton\s&quot;&gt;&lt;/span&gt;\sn&quot;+&quot;\st&lt;/td&gt;\sn&quot;+&quot; &lt;/tr&gt;\sn&quot;+&quot;&lt;/tbody&gt;&lt;/table&gt;\sn&quot;+&quot;\sn&quot;+&quot;&lt;!-- The List of Found Tiddlers ============================================ --&gt;\sn&quot;+&quot;&lt;div id=\s&quot;yourSearchResultItems\s&quot; itemsPerPage=\s&quot;25\s&quot; itemsPerPageWithPreview=\s&quot;10\s&quot;&gt;&lt;/div&gt;\sn&quot;+&quot;\sn&quot;+&quot;&lt;!-- The Footer (with the Navigation) ============================================ --&gt;\sn&quot;+&quot;&lt;table class=\s&quot;yourSearchFooter\s&quot; border=\s&quot;0\s&quot; width=\s&quot;100%\s&quot; cellspacing=\s&quot;0\s&quot; cellpadding=\s&quot;0\s&quot;&gt;&lt;tbody&gt;\sn&quot;+&quot; &lt;tr&gt;\sn&quot;+&quot;\st&lt;td align=\s&quot;left\s&quot;&gt;\sn&quot;+&quot;\st\stResult page: &lt;span class=\s&quot;yourSearchNaviBar\s&quot; macro=\s&quot;yourSearch naviBar\s&quot;&gt;&lt;/span&gt;\sn&quot;+&quot;\st&lt;/td&gt;\sn&quot;+&quot;\st&lt;td align=\s&quot;right\s&quot;&gt;&lt;span macro=\s&quot;yourSearch version\s&quot;&gt;&lt;/span&gt;, &lt;span macro=\s&quot;yourSearch copyright\s&quot;&gt;&lt;/span&gt;\sn&quot;+&quot;\st&lt;/td&gt;\sn&quot;+&quot; &lt;/tr&gt;\sn&quot;+&quot;&lt;/tbody&gt;&lt;/table&gt;\sn&quot;+&quot;&lt;!-- end of the 'tiddlers found' case =========================================== --&gt;\sn&quot;+&quot;&lt;/span&gt;\sn&quot;+&quot;\sn&quot;+&quot;\sn&quot;+&quot;&lt;!-- The \s&quot;No tiddlers found\s&quot; case =========================================== --&gt;\sn&quot;+&quot;&lt;span macro=\s&quot;yourSearch if not found\s&quot;&gt;\sn&quot;+&quot;&lt;table class=\s&quot;summary\s&quot; border=\s&quot;0\s&quot; width=\s&quot;100%\s&quot; cellspacing=\s&quot;0\s&quot; cellpadding=\s&quot;0\s&quot;&gt;&lt;tbody&gt;\sn&quot;+&quot; &lt;tr&gt;\sn&quot;+&quot;\st&lt;td align=\s&quot;left\s&quot;&gt;\sn&quot;+&quot;\st\stYourSearch Result: No tiddlers found for &lt;span class=\s&quot;yourSearchQuery\s&quot; macro=\s&quot;yourSearch query\s&quot;&gt;&lt;/span&gt;.\sn&quot;+&quot;\st&lt;/td&gt;\sn&quot;+&quot;\st&lt;td class=\s&quot;yourSearchButtons\s&quot; align=\s&quot;right\s&quot;&gt;\sn&quot;+&quot;\st\st&lt;span macro=\s&quot;yourSearch linkButton 'YourSearch Options' options 'Configure YourSearch'\s&quot;&gt;&lt;/span&gt;\sn&quot;+&quot;\st\st&lt;span macro=\s&quot;yourSearch linkButton 'YourSearch Help' help 'Get help how to use YourSearch'\s&quot;&gt;&lt;/span&gt;\sn&quot;+&quot;\st\st&lt;span macro=\s&quot;yourSearch closeButton\s&quot;&gt;&lt;/span&gt;\sn&quot;+&quot;\st&lt;/td&gt;\sn&quot;+&quot; &lt;/tr&gt;\sn&quot;+&quot;&lt;/tbody&gt;&lt;/table&gt;\sn&quot;+&quot;&lt;/span&gt;\sn&quot;+&quot;\sn&quot;+&quot;\sn&quot;+&quot;&lt;!--\sn&quot;+&quot;}}}\sn&quot;+&quot;--&gt;\sn&quot;;config.shadowTiddlers[&quot;YourSearchItemTemplate&quot;]=&quot;&lt;!--\sn&quot;+&quot;{{{\sn&quot;+&quot;--&gt;\sn&quot;+&quot;&lt;span class='yourSearchNumber' macro='foundTiddler number'&gt;&lt;/span&gt;\sn&quot;+&quot;&lt;span class='yourSearchTitle' macro='foundTiddler title'/&gt;&lt;/span&gt;&amp;nbsp;-&amp;nbsp;\sn&quot;+&quot;&lt;span class='yourSearchTags' macro='foundTiddler tags'/&gt;&lt;/span&gt;\sn&quot;+&quot;&lt;span macro=\s&quot;yourSearch if previewText\s&quot;&gt;&lt;div class='yourSearchText' macro='foundTiddler text'/&gt;&lt;/div&gt;&lt;/span&gt;\sn&quot;+&quot;&lt;!--\sn&quot;+&quot;}}}\sn&quot;+&quot;--&gt;&quot;;config.shadowTiddlers[&quot;YourSearch&quot;]=&quot;&lt;&lt;tiddler [[YourSearch Help]]&gt;&gt;&quot;;config.shadowTiddlers[&quot;YourSearch Result&quot;]=&quot;The popup-like window displaying the result of a YourSearch query.&quot;;setStylesheet(store.getTiddlerText(&quot;YourSearchStyleSheet&quot;),&quot;yourSearch&quot;);var origMacros_search_handler=config.macros.search.handler;config.macros.search.handler=myMacroSearchHandler;var ownsOverwrittenFunctions=function(){var _16b=(config.macros.search.handler==myMacroSearchHandler);return _16b;};var checkForOtherHijacker=function(){if(!ownsOverwrittenFunctions()){alert(&quot;Message from YourSearchPlugin:\sn\sn\sn&quot;+&quot;Another plugin has disabled the 'Your Search' features.\sn\sn\sn&quot;+&quot;You may disable the other plugin or change the load order of \sn&quot;+&quot;the plugins (by changing the names of the tiddlers)\sn&quot;+&quot;to enable the 'Your Search' features.&quot;);}};setTimeout(checkForOtherHijacker,5000);abego.YourSearch.getStandardRankFunction=function(){return standardRankFunction;};abego.YourSearch.getRankFunction=function(){return abego.YourSearch.getStandardRankFunction();};abego.YourSearch.getCurrentTiddler=function(){return currentTiddler;};}\n/***\n%/\n!Licence and Copyright\nCopyright (c) abego Software ~GmbH, 2005-2006 ([[www.abego-software.de|http://www.abego-software.de]])\n\nRedistribution and use in source and binary forms, with or without modification,\nare permitted provided that the following conditions are met:\n\nRedistributions of source code must retain the above copyright notice, this\nlist of conditions and the following disclaimer.\n\nRedistributions in binary form must reproduce the above copyright notice, this\nlist of conditions and the following disclaimer in the documentation and/or other\nmaterials provided with the distribution.\n\nNeither the name of abego Software nor the names of its contributors may be\nused to endorse or promote products derived from this software without specific\nprior written permission.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY\nEXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES\nOF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT\nSHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,\nINCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED\nTO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR\nBUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\nCONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN\nANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH\nDAMAGE.\n***/\n\n</div>
<div tiddler="movieParamifier" modifier="YourName" modified="200606020858" created="200603282130" tags="systemConfig excludeLists MovieManagerTiddlers">//{{{\n config.paramifiers.movie = {\n onstart: function(v) {\n     \n     var movieparams = v.split(&quot;$|$&quot;);\n\n\n     var movieTitle = movieparams[0];\n     var movieMode = movieparams[1];\n\n     var tiddlerName;\n     tiddlerName = 'Movies - ' + movieTitle;\n\n     while (tiddlerName &amp;&amp; store.getTiddler(tiddlerName)) {\n     movieTitle = prompt(&quot;A movie named '&quot;+movieTitle+&quot;' already exists.\sn\sn&quot;+&quot;Please specify a movie name.&quot;, movieTitle); var tiddlerName = 'Movies - ' + movieTitle;\n     }\n\n // tiddlerName is either null (user canceled) or a name that is not yet in the store.\n if ((tiddlerName)&amp;&amp;(movieTitle!=null)) {\n var body = &quot;&lt;&lt;formTiddler [[NewMovieForm]]&gt;&gt;&quot;;\n var tags = &quot;Movie MovImported&quot;;\n \n switch (movieMode){\n        case 'tosee':  tags+=&quot; MovToSee&quot;; break;\n        case 'seen': tags+=&quot; MovSeen&quot;; break;\n        case 'top': tags+=&quot; MovFav MovSeen&quot;; break;\n        case 'again': tags+=&quot; MovWatchAgain MovSeen&quot;; break;\n        }\n\n store.saveTiddler(tiddlerName,tiddlerName,body,config.options.txtUserName,new Date(),tags);\n DataTiddler.setData(tiddlerName,&quot;movieName&quot;,movieTitle);\n DataTiddler.setData(tiddlerName,&quot;movieRating&quot;,&quot;&quot;);\n story.displayTiddler(null,tiddlerName,1);\n if(config.options.chkAutoSave)\n {saveChanges();}\n\n\n }\n\n }\n};\n//}}}</div>
<div tiddler="removeAddTag" modifier="YourName" modified="200606031048" created="200603111752" tags="systemConfig excludeLists MovieManagerTiddlers">//{{{\nwindow.removeTag=function(title,tag)\n{\n var t=store.getTiddler(title);\n if (!t || !t.tags) return;\n if (t.tags.find(tag)!==null)\n t.tags.splice(t.tags.find(tag),1)\n}\n\nwindow.addTag=function(title,tag)\n{\n var t=store.getTiddler(title);\n if (!t || !t.tags) return;\n if (t.tags.find(tag)==null)\n t.tags.push(tag)\n\n}\n\nwindow.movieMarkSeen=function(title,tag)\n{setRating(title);\n var t=store.getTiddler(title);\n if (!t || !t.tags) return;\n if (t.tags.find(tag)!==null)\n t.tags.splice(t.tags.find(tag),1);\n var now = new Date();\n var timeFormat= 'YY0MMDD';\n var formattednow= now.formatString(timeFormat);\n//alert(formattednow);\nDataTiddler.setData(title,&quot;movieDateSeen&quot;,formattednow);\n\n}\n//}}}</div>
<div tiddler="setRating" modifier="Saq" modified="200606031754" created="200604300814" tags="systemConfig excludeLists">window.setRating = function(title,containerTitle){\n          var newRating=prompt(&quot;Enter new rating for this movie&quot;,&quot;&quot;);\n          if (newRating==null){return false;}\n          var tiddler = store.getTiddler(title);\n          tiddler.setData(&quot;movieRating&quot;,newRating);\n          if (containerTitle)\n                    {story.refreshTiddler(containerTitle,false,true);}\n          return false;\n}</div>
		</div>
<!--POST-BODY-START-->

<!--POST-BODY-END-->
	</body>
</html>
